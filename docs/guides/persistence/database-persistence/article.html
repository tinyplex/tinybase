<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/persistence/">Persistence</a></li><li><a href="/guides/persistence/database-persistence/">Database Persistence</a></li></ul></nav><section class="s1" id="/guides/persistence/database-persistence/" data-id="DP"><h1>Database Persistence</h1><p>Since v4.0, there are various options for persisting <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> data to and from SQLite databases, via a range of third-party modules.</p><p>There are currently nine SQLite-based persistence options, and two for PostgreSQL:</p><div class="table"><table><thead><tr><th><a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a></th><th>Storage</th></tr></thead><tbody><tr><td><a href="/api/persister-sqlite3/interfaces/persister/sqlite3persister/"><code>Sqlite3Persister</code></a></td><td>SQLite in Node, via <a href="https://github.com/TryGhost/node-sqlite3">sqlite3</a></td></tr><tr><td><a href="/api/persister-sqlite-bun/interfaces/persister/sqlitebunpersister/"><code>SqliteBunPersister</code></a></td><td>SQLite in Bun, via <a href="https://bun.sh/docs/api/sqlite">bun:sqlite</a></td></tr><tr><td><a href="/api/persister-sqlite-wasm/interfaces/persister/sqlitewasmpersister/"><code>SqliteWasmPersister</code></a></td><td>SQLite in a browser, via <a href="https://github.com/tomayac/sqlite-wasm">sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-expo-sqlite/interfaces/persister/exposqlitepersister/"><code>ExpoSqlitePersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/expo/expo/tree/main/packages/expo-sqlite">expo-sqlite</a></td></tr><tr><td><a href="/api/persister-react-native-sqlite/interfaces/persister/reactnativesqlitepersister/"><code>ReactNativeSqlitePersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/andpor/react-native-sqlite-storage">react-native-sqlite-storage</a></td></tr><tr><td><a href="/api/persister-cr-sqlite-wasm/interfaces/persister/crsqlitewasmpersister/"><code>CrSqliteWasmPersister</code></a></td><td>SQLite CRDTs, via <a href="https://github.com/vlcn-io/cr-sqlite">cr-sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-electric-sql/interfaces/persister/electricsqlpersister/"><code>ElectricSqlPersister</code></a></td><td>Electric SQL, via <a href="https://github.com/electric-sql/electric">electric</a></td></tr><tr><td><a href="/api/persister-libsql/interfaces/persister/libsqlpersister/"><code>LibSqlPersister</code></a></td><td>LibSQL for Turso, via <a href="https://github.com/tursodatabase/libsql-client-ts">libsql-client</a></td></tr><tr><td><a href="/api/persister-powersync/interfaces/persister/powersyncpersister/"><code>PowerSyncPersister</code></a></td><td>PowerSync, via <a href="https://github.com/powersync-ja/powersync-js">powersync-sdk</a></td></tr><tr><td><a href="/api/persister-postgres/interfaces/persister/postgrespersister/"><code>PostgresPersister</code></a></td><td>PostgreSQL, via <a href="https://github.com/porsager/postgres">postgres</a></td></tr><tr><td><a href="/api/persister-pglite/interfaces/persister/pglitepersister/"><code>PglitePersister</code></a></td><td>PostgreSQL, via <a href="https://github.com/electric-sql/pglite">PGlite</a></td></tr></tbody></table></div><p>Each creation function takes a database reference, and a <a href="/api/persisters/type-aliases/configuration/databasepersisterconfig/"><code>DatabasePersisterConfig</code></a> object to describe its configuration. There are two modes for persisting a <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> with a database:</p><ul><li>A JSON serialization of the whole <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>, which is stored in a single row of a table (normally called <code>tinybase</code>) within the database. This is configured by providing a <a href="/api/persisters/type-aliases/configuration/dpcjson/"><code>DpcJson</code></a> object.</li><li>A tabular mapping of <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> to database table names (and vice-versa). <a href="/api/store/type-aliases/store/values/"><code>Values</code></a> are stored in a separate special table (normally called <code>tinybase_values</code>). This is configured by providing a <a href="/api/persisters/type-aliases/configuration/dpctabular/"><code>DpcTabular</code></a> object.</li></ul><p>Note that changes made to the database (outside of a <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a>) are picked up immediately if they are made via the same connection or library that it is using. If the database is being changed by another client, the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> needs to poll for changes. Hence both configuration types also contain an <code>autoLoadIntervalSeconds</code> property which indicates how often it should do that. This defaults to 1 second.</p><h3 id="using-json-serialization">Using JSON Serialization</h3><p>To get started, we&#x27;ll use JSON serialization to save a <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> to SQLite in the browser, via the <a href="https://github.com/tomayac/sqlite-wasm">sqlite-wasm</a> module.</p><p>Firstly, use the module to initiate a database. Here it will be created in memory, but typically you would use the origin private file system (OPFS) as a storage back-end.</p><pre><code><span class="keyword">import</span> sqlite3InitModule <span class="keyword">from</span> <span class="string">'@sqlite.org/sqlite-wasm'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createSqliteWasmPersister<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/persisters/persister-sqlite-wasm'</span><span class="punctuation">;</span>

<span class="keyword">const</span> sqlite3 <span class="operator">=</span> <span class="keyword">await</span> <span class="function">sqlite3InitModule</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">let</span> db <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">sqlite3<span class="punctuation">.</span>oo1<span class="punctuation">.</span>DB</span><span class="punctuation">(</span><span class="string">':memory:'</span><span class="punctuation">,</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Next create a simple <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> with a small amount of data:</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/creating-stores/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> itself is created with the createSqliteWasmPersister method. This requires a reference to the the <code>sqlite3</code> module itself and the database. We&#x27;re not providing any configuration so it will use JSON serialization into the default table (namely one called <code>tinybase</code>).</p><pre><code><span class="keyword">const</span> jsonPersister <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/persisting-stores/createsqlitewasmpersister/">createSqliteWasmPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> sqlite3<span class="punctuation">,</span> db<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Now we can use the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> to save data to the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>. Of course you can also use the <a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/"><code>startAutoSave</code></a> method to make it automatic.</p><pre><code><span class="keyword">await</span> jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>And we can check the database to ensure the data has been stored:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM tinybase;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: '_', store: '[{"pets":{"fido":{"species":"dog"}}},{}]'}]</span>
</code></pre><p>If the data in the database is changed...</p><pre><code>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span>
  <span class="string">'UPDATE tinybase SET store = '</span> <span class="operator">+</span>
    <span class="template-string"><span class="template-punctuation">`</span><span class="string">'[{"pets":{"felix":{"species":"cat"}}},{}]' WHERE _id = '_';</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>...it can be picked up by loading it explicitly or with auto-loading:</p><pre><code><span class="keyword">await</span> jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {felix: {species: 'cat'}}}</span>

<span class="keyword">await</span> jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Please see the <a href="/api/persisters/type-aliases/configuration/dpcjson/"><code>DpcJson</code></a> documentation for more detail on configuring this type of persistence.</p><h3 id="using-tabular-mapping">Using Tabular Mapping</h3><p>More flexibly, you can map distinct <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> to database tables and back again. This is likely a more suitable approach if you are binding TinyBase to existing data.</p><p>To use this technique, you must provide a <a href="/api/persisters/type-aliases/configuration/databasepersisterconfig/"><code>DatabasePersisterConfig</code></a> object when you create the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a>, and specify how you would like <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> (and <a href="/api/store/type-aliases/store/values/"><code>Values</code></a>) to correspond to tables in the database.</p><p>It is important to note that both the tabular mapping in (&#x27;save&#x27;) and out (&#x27;load&#x27;) of an underlying database are disabled by default. This is to ensure that if you pass in an existing populated database you don&#x27;t run the immediate risk of corrupting or losing all your data.</p><p>This configuration therefore takes a <code>tables</code> property object (with child <code>load</code> and <code>save</code> property objects) and a <code>values</code> property object. One of these at least is required for the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> to do anything!</p><p>Let&#x27;s demonstrate. We start by creating a new database and resetting the data in the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> to put into it:</p><pre><code>db <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">sqlite3<span class="punctuation">.</span>oo1<span class="punctuation">.</span>DB</span><span class="punctuation">(</span><span class="string">':memory:'</span><span class="punctuation">,</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span>
  <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">}</span><span class="punctuation">,</span> <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">species</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">dog</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">price</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span> <span class="literal-property">cat</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">price</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The persister itself has a more complex configuration as described above:</p><pre><code><span class="keyword">const</span> tabularPersister <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/persisting-stores/createsqlitewasmpersister/">createSqliteWasmPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> sqlite3<span class="punctuation">,</span> db<span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">mode</span><span class="operator">:</span> <span class="string">'tabular'</span><span class="punctuation">,</span>
  <span class="literal-property">tables</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">save</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">species</span><span class="operator">:</span> <span class="string">'animal_species'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">load</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">animal_species</span><span class="operator">:</span> <span class="string">'species'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Notice how there is a symmetric mapping of <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to database table and vice-versa. It is deliberate that this must be spelled out like this, so that your intent to connect to (or especially mutate) existing data is very explicit.</p><p>Again, we can save the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>...</p><pre><code><span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>...and see the resulting data in the SQLite database:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'felix', species: 'cat'}, {_id: 'fido', species: 'dog'}]</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM animal_species;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'dog', price: 5}, {_id: 'cat', price: 4}]</span>
</code></pre><p>And, as expected, making a change to the database and re-loading brings the changes back into the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>:</p><pre><code>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">INSERT INTO pets (_id, species) VALUES ('cujo', 'wolf')</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {felix: {species: 'cat'}, fido: {species: 'dog'}, cujo: {species: 'wolf'}}</span>

<span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p><a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/values/"><code>Values</code></a> are saved into a separate table, normally called <code>tinybase_values</code>. See the <a href="/api/persisters/type-aliases/configuration/dpctabularvalues/"><code>DpcTabularValues</code></a> documentation for examples of how to use that.</p><h3 id="working-with-an-existing-database">Working With An Existing Database</h3><p>In theory, it&#x27;s possible to bind TinyBase to a SQLite database that already exists. You will obviously want to list the tables of interest in the <code>load</code> section of the configuration.</p><p>Do be aware that TinyBase is an in-memory data structure, and so you will not want to do this if your database tables are particularly large and complex.</p><p>Also be very careful when setting the <code>save</code> configuration, since it will mean that TinyBase writes its version of the data back to the database (optionally removing empty columns). If there is data that does not survive the round trip (because of schema constraints or data typing), it will be lost.</p><p>The <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> maps a column in the database table to provide and store the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>&#x27;s <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a>. By default, this is a database column called <code>_id</code>, but you can set it to be something else, per table. It is required that this column is a primary or unique key in the database so that the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> knows how to update existing records.</p><p>So for example, imagine your existing database table looks like this, with the first column of each table being a primary key:</p><pre><code>&gt; SELECT * FROM the_pets_table;
+--------+---------+-------+
| pet_id | species | color |
+--------+---------+-------+
| fido   | dog     | brown |
| felix  | cat     | black |
+--------+---------+-------+

&gt; SELECT * FROM the_species_table;
+------------+-------+
| species_id | price |
+------------+-------+
| dog        | 5     |
| cat        | 4     |
+------------+-------+
</code></pre><p>For this, you may consider the following configuration for your <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a>:</p><pre><code><span class="keyword">const</span> <span class="literal-property">databasePersisterConfig</span><span class="operator">:</span> DatabasePersisterConfig <span class="operator">=</span> <span class="punctuation">{</span>
  <span class="literal-property">mode</span><span class="operator">:</span> <span class="string">'tabular'</span><span class="punctuation">,</span>
  <span class="literal-property">tables</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">load</span><span class="operator">:</span> <span class="punctuation">{</span>
      <span class="literal-property">the_pets_table</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'pet_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="literal-property">the_species_table</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'species_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">save</span><span class="operator">:</span> <span class="punctuation">{</span>
      <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableName</span><span class="operator">:</span> <span class="string">'the_pets_table'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'pet_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="literal-property">species</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableName</span><span class="operator">:</span> <span class="string">'the_species_table'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'species_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>This will load into a <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> (and save back again) with <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> that look like this:</p><pre><code><span class="punctuation">{</span>
  <span class="property">"pets"</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="property">"fido"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"species"</span><span class="operator">:</span> <span class="string">"dog"</span><span class="punctuation">,</span> <span class="property">"color"</span><span class="operator">:</span> <span class="string">"brown"</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="property">"felix"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"species"</span><span class="operator">:</span> <span class="string">"cat"</span><span class="punctuation">,</span> <span class="property">"color"</span><span class="operator">:</span> <span class="string">"black"</span><span class="punctuation">}</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="property">"species"</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="property">"dog"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"price"</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="property">"cat"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"price"</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><h3 id="loading-subsets-of-database-tables">Loading subsets of database tables</h3><p>If you are using the tabular mapping, you can specify that only a subset of the data in the database table should be loaded into TinyBase. This is useful for reducing the amount of data that is loaded into memory, or for working with a subset of data that is relevant to the current user.</p><p>Do this by specifying a <code>condition</code> in the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> configuration. This is a single string argument which is used as a SQL <code>WHERE</code> clause when reading and observing data in the table. The string must include the placeholder <code>$tableName</code> which will be replaced with the name of the table being loaded or saved.</p><p>For example, imagine we have a database table of pets with a flag that indicates if they have been sold or not. Only Felix has:</p><pre><code>db <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">sqlite3<span class="punctuation">.</span>oo1<span class="punctuation">.</span>DB</span><span class="punctuation">(</span><span class="string">':memory:'</span><span class="punctuation">,</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">CREATE TABLE pets (_id PRIMARY KEY, species, sold);</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">;</span>
db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span>
  <span class="template-string"><span class="template-punctuation">`</span><span class="string">INSERT INTO pets (_id, species, sold) VALUES </span><span class="template-punctuation">`</span></span> <span class="operator">+</span>
    <span class="template-string"><span class="template-punctuation">`</span><span class="string">('fido', 'dog', 0),</span><span class="template-punctuation">`</span></span> <span class="operator">+</span>
    <span class="template-string"><span class="template-punctuation">`</span><span class="string">('felix', 'cat', 1),</span><span class="template-punctuation">`</span></span> <span class="operator">+</span>
    <span class="template-string"><span class="template-punctuation">`</span><span class="string">('cujo', 'wolf', 0);</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'fido', species: 'dog', sold: 0}, {_id: 'felix', species: 'cat', sold: 1}, {_id: 'cujo', species: 'wolf', sold: 0}]</span>
</code></pre><p>We can configure the <a href="/api/the-essentials/persisting-stores/persister/"><code>Persister</code></a> to only load and save pets that have not been sold:</p><pre><code><span class="keyword">const</span> subsetPersister <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/persisting-stores/createsqlitewasmpersister/">createSqliteWasmPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> sqlite3<span class="punctuation">,</span> db<span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">mode</span><span class="operator">:</span> <span class="string">'tabular'</span><span class="punctuation">,</span>
  <span class="literal-property">tables</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">load</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">condition</span><span class="operator">:</span> <span class="string">'$tableName.sold = 0'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">save</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableName</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">condition</span><span class="operator">:</span> <span class="string">'$tableName.sold = 0'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Then when we load the following data into the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>, notice that only Fido and Cujo are present:</p><pre><code><span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {species: 'dog', sold: 0}, cujo: {species: 'wolf', sold: 0}}</span>
</code></pre><p>And when we change the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> and save it back to the database, only Fido and Cujo are touched:</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'corgi'</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'cujo'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'husky'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Don&#x27;t worry, Felix is still in the database!</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'fido', species: 'corgi', sold: 0}, {_id: 'felix', species: 'cat', sold: 1}, {_id: 'cujo', species: 'husky', sold: 0}]</span>
</code></pre><p>An important note, of course, is that if you update the data in the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> such that the resulting data does not match the subset condition, saving it back to the database will succeed, and it will stay in the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>:</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {species: 'corgi', sold: 1}, cujo: {species: 'husky', sold: 0}}</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'fido', species: 'corgi', sold: 1}, {_id: 'felix', species: 'cat', sold: 1}, {_id: 'cujo', species: 'husky', sold: 0}]</span>
</code></pre><p>But it <em>will</em> be lost from the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> on the next load, even though it is still in the database:</p><pre><code><span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {cujo: {species: 'husky', sold: 0}}</span>
</code></pre><p>Finally it&#x27;s worth confirming that when this subset configuration is used, the underlying database table will not be cleared or removed if the <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> is emptied (since there may be other data in the table that is not relevant to this <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>). In this example, we remove <code>cujo</code>, but <code>fido</code> and <code>felix</code> (not in the subset) are still in the database:</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/deltable/">delTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {}</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'fido', species: 'corgi', sold: 1}, {_id: 'felix', species: 'cat', sold: 1}]</span>

<span class="keyword">await</span> subsetPersister<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="null-values-and-dense-tables">Null <a href="/api/store/type-aliases/store/values/"><code>Values</code></a> and Dense <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a></h3><p>When working with database persisters, it&#x27;s important to understand how SQL <code>NULL</code> values map to TinyBase values. This has significant implications for the structure of your <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a>.</p><h4 id="sql-null-is-tinybase-null">SQL NULL is TinyBase null</h4><p>In TinyBase v7.0, <code>null</code> became a valid <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> and <a href="/api/store/type-aliases/store/value/"><code>Value</code></a> type alongside <code>string</code>, <code>number</code>, and <code>boolean</code>. When a database persister loads data from a SQL table, any SQL <code>NULL</code> values are loaded as TinyBase <code>null</code> values.</p><p>This is the natural and correct behavior: SQL <code>NULL</code> represents an explicit null value, which maps directly to TinyBase&#x27;s <code>null</code> type.</p><h4 id="sparse-vs-dense-tables">Sparse vs Dense <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a></h4><p>TinyBase tables can be either <strong>sparse</strong> or <strong>dense</strong>:</p><ul><li>A <strong>sparse table</strong> has rows where some Cells may be missing entirely. The <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> object simply doesn&#x27;t have that <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> as a property.</li><li>A <strong>dense table</strong> has rows where every <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> is present, though some may have <code>null</code> values.</li></ul><p>Here&#x27;s an example showing the difference:</p><pre><code><span class="comment">// Sparse table - some Cells are missing</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/getting-data/getrow/">getRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {species: 'dog'}</span>
<span class="comment">// Note: no 'color' property</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/hascell/">hasCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> false</span>

<span class="comment">// Dense table - all Cells present, some are null</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/getting-data/getrow/">getRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {species: 'dog', color: null}</span>
<span class="comment">// Note: 'color' property exists with null value</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/hascell/">hasCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> true</span>
</code></pre><h4 id="why-database-tables-become-dense">Why Database <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> Become Dense</h4><p>SQL databases have a fixed schema: every table has a defined set of columns, and every row must account for all columns. When a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> has no value, SQL represents this as <code>NULL</code>.</p><p>When a database persister loads data from SQL into TinyBase:</p><ul><li>Every SQL column becomes a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> in the TinyBase table</li><li>Every SQL <code>NULL</code> becomes a TinyBase <code>null</code> value</li><li>The resulting TinyBase table is <strong>dense</strong> - every <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> has every <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a></li></ul><p>This means that if you save a sparse TinyBase table to a database and load it back, it will become dense. For example, the roundtrip transformation via a SQLite database looks something like:</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span>
  <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// After saving the the SQL database:</span>
<span class="comment">// SQL table: fido (species: 'dog', color: NULL)</span>
<span class="comment">//           felix (species: 'cat', color: 'black')</span>

<span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// After loading again, the Store now has a dense table with an explicit null:</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/getting-data/getrow/">getRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {species: 'dog', color: null}</span>
</code></pre><h4 id="important-implications">Important Implications</h4><ol><li><p><strong>Round-trip behavior</strong>: A sparse table that goes through a save/load cycle with a database persister will become dense. This is a breaking change from TinyBase v6.x and earlier.</p></li><li><p><strong>The <code>hasCell</code> method</strong>: After loading from a database, <code>hasCell</code> will return <code>true</code> for all Cells in the table schema, even those that were originally missing. Use <code>getCell(tableId, rowId, cellId) === null</code> to check if a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> has a null value.</p></li><li><p><strong><a href="/guides/schemas/">Schemas</a></strong>: When using database persisters, you may want to use the <code>allowNull</code> schema property to explicitly allow <code>null</code> values:</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settablesschema/">setTablesSchema</a></span><span class="punctuation">(</span><span class="punctuation">{</span>
  <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">species</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">color</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="literal-property">allowNull</span><span class="operator">:</span> <span class="boolean">true</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre></li><li><p><strong>Memory usage</strong>: Dense tables consume more memory than sparse tables. If you have large tables with many optional Cells, this could be significant.</p></li></ol><h3 id="summary">Summary</h3><p>With care, you can load and save <a href="/api/the-essentials/creating-stores/store/"><code>Store</code></a> data from and to a SQLite database in a variety of ways and via different modules. This is new in v4.0, so feedback on the functionality is welcomed!</p><p>Next we move on to look at how to fully synchronize TinyBase Stores using more complex CRDT frameworks, such as Yjs and Automerge, in the <a href="/guides/persistence/third-party-crdt-persistence/">Third-Party CRDT Persistence</a> guide.</p></section>