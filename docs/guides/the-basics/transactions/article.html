<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides">Guides</a></li><li><a href="/guides/the-basics">The Basics</a></li></ul></nav><section class="s1" id="/guides/the-basics/transactions" data-id="T"><h1>Transactions</h1><p>This guide shows you how to wrap multiple changes to the data in a <a href="/api/store/interfaces/store/store"><code>Store</code></a>.</p><p>A transaction is a sequence of changes made to a <a href="/api/store/interfaces/store/store"><code>Store</code></a>. No listeners will be fired until the full transaction complete. This is a useful way to debounce listener side-effects and ensure that you are only responding to net changes. Changes are made silently during the transaction, and listeners relevant to the changes you have made will instead only be called when the whole transaction is complete.</p><p>A transaction can also be rolled back and the original state of the <a href="/api/store/interfaces/store/store"><code>Store</code></a> will be restored.</p><h3 id="creating-transactions">Creating Transactions</h3><p>The <a href="/api/store/interfaces/store/store/methods/transaction/transaction"><code>transaction</code></a> method takes a function that makes multiple mutations to the store, buffering all calls to the relevant listeners until it completes.</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> listenerId <span class="operator">=</span> store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/listener/addrowlistener">addRowListener</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="string">'Fido changed'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

<span class="comment">// Multiple changes, not in a transaction</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'brown'</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'Fido changed'</span>
<span class="comment">// -> 'Fido changed'</span>

<span class="comment">// Multiple changes in a transaction</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'walnut'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'Fido changed'</span>

store<span class="punctuation">.</span><span class="function">delListener</span><span class="punctuation">(</span>listenerId<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>If multiple changes are made to a piece of <a href="/api/store/interfaces/store/store"><code>Store</code></a> data throughout the transaction, a relevant listener will only be called with the final value (assuming it is different to the value at the start of the transaction), regardless of the changes that happened in between. For example, if a <a href="/api/store/type-aliases/store/cell"><code>Cell</code></a> had a value <code>&#x27;b&#x27;</code> and then, within a transaction, it was changed to <code>&#x27;b&#x27;</code> and then <code>&#x27;c&#x27;</code>, any <a href="/api/store/type-aliases/listener/celllistener"><code>CellListener</code></a> registered for that cell would be called once as if there had been a single change from <code>&#x27;a&#x27;</code> to <code>&#x27;c&#x27;</code>:</p><pre><code><span class="keyword">const</span> listenerId2 <span class="operator">=</span> store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/listener/addcelllistener">addCellListener</a></span><span class="punctuation">(</span>
  <span class="string">'pets'</span><span class="punctuation">,</span>
  <span class="string">'fido'</span><span class="punctuation">,</span>
  <span class="string">'color'</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">store<span class="punctuation">,</span> tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> newCell</span><span class="punctuation">)</span> <span class="operator">=></span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">Fido color changed to </span><span class="interpolation"><span class="interpolation-punctuation">${</span>newCell<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'black'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'brown'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'Fido color changed to brown'</span>

store<span class="punctuation">.</span><span class="function">delListener</span><span class="punctuation">(</span>listenerId2<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Note that transactions can be nested. Relevant listeners will be called only when the outermost one completes.</p><h3 id="rolling-back-transactions">Rolling Back Transactions</h3><p>The <a href="/api/store/interfaces/store/store/methods/transaction/transaction"><code>transaction</code></a> method takes a second optional parameter, <code>doRollback</code>. This is a callback that you can use to rollback the transaction if it did not complete to your satisfaction. It is called with <code>changedCells</code> and <code>invalidCells</code> parameters, which inform you of the net changes that have been made during the transaction, and any invalid attempts to do so, respectively.</p><p>This example makes multiple changes to the <a href="/api/store/interfaces/store/store"><code>Store</code></a>, including some attempts to update a <a href="/api/store/type-aliases/store/cell"><code>Cell</code></a> with invalid values. The <code>doRollback</code> callback receives information about the changes and invalid attempts, and then judges that the transaction should be rolled back to its original state.</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction">transaction</a></span><span class="punctuation">(</span>
  <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'black'</span><span class="punctuation">)</span><span class="punctuation">;</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'eyes'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="string">'left'</span><span class="punctuation">,</span> <span class="string">'right'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'buyer'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Bob'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">changedCells<span class="punctuation">,</span> invalidCells</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="comment">// -> {pets: {fido: {species: 'dog', color: 'black', sold: true}}}</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>changedCells<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="comment">// -> {pets: {fido: {color: ['brown', 'black']}}}</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>invalidCells<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="comment">// -> {pets: {fido: {eyes: [['left', 'right']], buyer: [{name: 'Bob'}]}}}</span>
    <span class="keyword">return</span> invalidCells<span class="punctuation">[</span><span class="string">'pets'</span><span class="punctuation">]</span> <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog', color: 'brown', sold: true}}}</span>
</code></pre><h3 id="summary">Summary</h3><p>We&#x27;ve covered all of the essential basics of working with a <a href="/">TinyBase</a> <a href="/api/store/interfaces/store/store"><code>Store</code></a>, but that&#x27;s still just the start!</p><p>Next we will show how you can quickly build user interfaces on top of a <a href="/api/store/interfaces/store/store"><code>Store</code></a>, and for that, it&#x27;s time to proceed to the <a href="/guides/building-uis">Building UIs</a> guide.</p></section>