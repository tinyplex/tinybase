<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/synchronization/">Synchronization</a></li><li><a href="/guides/synchronization/using-a-synchronizer/">Using A Synchronizer</a></li></ul></nav><section class="s1" id="/guides/synchronization/using-a-synchronizer/" data-id="UAS"><h1>Using A Synchronizer</h1><p>The synchronizer module framework lets you synchronize <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> data between different devices, systems, or subsystems.</p><p>It contains the <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> interface, describing objects which can be used to synchronize a <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a>.</p><p>Under the covers, a <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> is actually a very specialized type of <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that <em>only</em> supports <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> objects, and which has a <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/"><code>startSync</code></a> method and a <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/stopsync/"><code>stopSync</code></a> method.</p><h3 id="types-of-synchronizer">Types Of <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a></h3><p>In <a href="/">TinyBase</a> v5.0, there are three types of <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a>:</p><ul><li>The <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> uses WebSockets to communicate between different systems.</li><li>The <a href="/api/synchronizer-broadcast-channel/interfaces/synchronizer/broadcastchannelsynchronizer/"><code>BroadcastChannelSynchronizer</code></a> uses the browser&#x27;s BroadcastChannel API to communicate between different tabs and workers.</li><li>The <a href="/api/synchronizer-local/interfaces/synchronizer/localsynchronizer/"><code>LocalSynchronizer</code></a> demonstrates synchronization in memory on a single local system.</li></ul><p>Of course it is also possible to create custom <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> objects if you have a transmission medium that allows the synchronization messages to be sent reliably between clients.</p><h3 id="synchronizing-with-websockets">Synchronizing With WebSockets</h3><p>A common pattern for synchronizing over the web is to use WebSockets. This allows multiple clients to pass lightweight messages to each other, facilitating efficient synchronization.</p><p>One thing to understand is that this set up will typically require a server. This can be a relatively &#x27;thin server&#x27; - it does not need to store data of its own - but is needed to keep a list of clients that are being synchronized together, and route and broadcast messages between the clients.</p><p><a href="/">TinyBase</a> includes a simple implementation of such a server. You simply need to create it, instantiated with a configured WebSocketServer object from the <code>ws</code> package:</p><pre><code><span class="comment">// On a server machine:</span>
<span class="keyword">import</span> <span class="punctuation">{</span>WebSocketServer<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'ws'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createWsServer<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/synchronizers/synchronizer-ws-server'</span><span class="punctuation">;</span>
<span class="keyword">const</span> server <span class="operator">=</span> <span class="function"><a href="/api/synchronizer-ws-server/functions/creation/createwsserver/">createWsServer</a></span><span class="punctuation">(</span><span class="keyword">new</span> <span class="class-name">WebSocketServer</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">port</span><span class="operator">:</span> <span class="number">8048</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This sets up a <a href="/api/synchronizer-ws-server/interfaces/server/wsserver/"><code>WsServer</code></a> object, listening on port 8048.</p><p>Each client then needs to create a <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> object, instantiated with the <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> being synchronized, and a WebSocket configured to connect to the aforementioned server:</p><pre><code><span class="comment">// On the first client machine:</span>
<span class="keyword">import</span> <span class="punctuation">{</span>WebSocket<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'ws'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createMergeableStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createWsSynchronizer<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/synchronizers/synchronizer-ws-client'</span><span class="punctuation">;</span>

<span class="keyword">const</span> clientStore1 <span class="operator">=</span> <span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> clientSynchronizer1 <span class="operator">=</span> <span class="keyword">await</span> <span class="function"><a href="/api/synchronizer-ws-client/functions/creation/createwssynchronizer/">createWsSynchronizer</a></span><span class="punctuation">(</span>
  clientStore1<span class="punctuation">,</span>
  <span class="keyword">new</span> <span class="class-name">WebSocket</span><span class="punctuation">(</span><span class="string">'ws://localhost:8048'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> can then be started, and data manipulated as normal:</p><pre><code><span class="keyword">await</span> clientSynchronizer1<span class="punctuation">.</span><span class="function"><a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/">startSync</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
clientStore1<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'dog'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>Meanwhile, on another client, an empty <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> and another <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> can be created and started, connecting to the same server.</p><pre><code><span class="comment">// On the second client machine:</span>
<span class="keyword">const</span> clientStore2 <span class="operator">=</span> <span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> clientSynchronizer2 <span class="operator">=</span> <span class="keyword">await</span> <span class="function"><a href="/api/synchronizer-ws-client/functions/creation/createwssynchronizer/">createWsSynchronizer</a></span><span class="punctuation">(</span>
  clientStore2<span class="punctuation">,</span>
  <span class="keyword">new</span> <span class="class-name">WebSocket</span><span class="punctuation">(</span><span class="string">'ws://localhost:8048'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> clientSynchronizer2<span class="punctuation">.</span><span class="function"><a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/">startSync</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Once the synchronization is started, the server will broker the messages being passed back and forward between the two clients, and the data will be synchronized. The empty second <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> will be populated with the data from the first:</p><pre><code><span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>clientStore2<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog'}}}</span>
</code></pre><p>And of course the synchronization is bi-directional:</p><pre><code>clientStore2<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'felix'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'cat'</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>clientStore2<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog'}, felix: {species: 'cat'}}}</span>
</code></pre><pre><code><span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>clientStore1<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog'}, felix: {species: 'cat'}}}</span>
</code></pre><p>When done, it&#x27;s important to destroy a <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> to close and tidy up the client WebSockets:</p><pre><code>clientSynchronizer1<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><pre><code>clientSynchronizer2<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>And, if shut down, the <a href="/api/synchronizer-ws-server/interfaces/server/wsserver/"><code>WsServer</code></a> should also be explicitly destroyed to close its listeners:</p><pre><code>server<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h4 id="persisting-data-on-the-server"><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a> On The Server</h4><p>New in <a href="/">TinyBase</a> v5.1, the <a href="/api/synchronizer-ws-server/functions/creation/createwsserver/"><code>createWsServer</code></a> function lets you specify a way to persist data to the server. This makes it possible for all clients to disconnect from a path, but, when they reconnect, for the data to still be present for them to sync with.</p><p>This is done by passing in a second argument to the function that creates a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> instance (for which also need to create or provide a <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a>) for a given path:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createFilePersister<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/persisters/persister-file'</span><span class="punctuation">;</span>

<span class="keyword">const</span> persistingServer <span class="operator">=</span> <span class="function"><a href="/api/synchronizer-ws-server/functions/creation/createwsserver/">createWsServer</a></span><span class="punctuation">(</span>
  <span class="keyword">new</span> <span class="class-name">WebSocketServer</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">port</span><span class="operator">:</span> <span class="number">8050</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">pathId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-file/functions/creation/createfilepersister/">createFilePersister</a></span><span class="punctuation">(</span><span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> pathId <span class="operator">+</span> <span class="string">'.json'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This is a very crude example, but demonstrates a server that will create a file, based on any path that clients connect to, and persist data to it. In production, you will certainly want to sanitize the file name! And more likely you will want to explore using a database-oriented <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> instead of simply using raw files.</p><p>See the <a href="/api/synchronizer-ws-server/functions/creation/createwsserver/"><code>createWsServer</code></a> function documentation for more details.</p><h3 id="synchronizing-over-the-browser-broadcastchannel">Synchronizing Over The Browser BroadcastChannel</h3><p>There may be situations where you need to synchronize data between different parts of a browser. For example, you might have a transient in-memory <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> driving your UI, but then another instance in a Service Worker that can be persisted to (say) IndexedDB or another medium.</p><p>To facilitate keeping these in sync, the <a href="/api/synchronizer-broadcast-channel/interfaces/synchronizer/broadcastchannelsynchronizer/"><code>BroadcastChannelSynchronizer</code></a> lets you synchronize over the browser&#x27;s BroadcastChannel API, common to each browser sub-system. You simply need to provide a distinguishing channel name that can be used to identify what the two parts should be using to send and receive messages.</p><p>For example, in the UI part of your app:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createBroadcastChannelSynchronizer<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/synchronizers/synchronizer-broadcast-channel'</span><span class="punctuation">;</span>

<span class="keyword">const</span> frontStore <span class="operator">=</span> <span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> frontSynchronizer <span class="operator">=</span> <span class="function"><a href="/api/synchronizer-broadcast-channel/functions/creation/createbroadcastchannelsynchronizer/">createBroadcastChannelSynchronizer</a></span><span class="punctuation">(</span>
  frontStore<span class="punctuation">,</span>
  <span class="string">'syncChannel'</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> frontSynchronizer<span class="punctuation">.</span><span class="function"><a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/">startSync</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>And then in the service worker:</p><pre><code><span class="keyword">const</span> backStore <span class="operator">=</span> <span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> backSynchronizer <span class="operator">=</span> <span class="function"><a href="/api/synchronizer-broadcast-channel/functions/creation/createbroadcastchannelsynchronizer/">createBroadcastChannelSynchronizer</a></span><span class="punctuation">(</span>
  backStore<span class="punctuation">,</span>
  <span class="string">'syncChannel'</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> backSynchronizer<span class="punctuation">.</span><span class="function"><a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/">startSync</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Since they both share the <code>syncChannel</code> channel name, the data of the two is now synchronized:</p><pre><code>frontStore<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'dog'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><pre><code><span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>backStore<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog'}}}</span>
</code></pre><p>And so on!</p><p>When finished, these synchronizers should also be explicitly destroyed to ensure the channel listeners are cleaned up:</p><pre><code>frontSynchronizer<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><pre><code>backSynchronizer<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="wrapping-up">Wrapping Up</h3><p>The <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> interface provides an easy way to keep multiple <a href="/">TinyBase</a> MergeableStores in sync. The WebSocket and BroadcastChannel options above allow for numerous interesting and powerful app architectures - and they are not sufficient, consider exploring the <a href="/api/synchronizers/functions/creation/createcustomsynchronizer/"><code>createCustomSynchronizer</code></a> function to develop your own!</p><p>We now move on to ways in which <a href="/">TinyBase</a> can be used like a database, starting with the <a href="/guides/using-metrics/">Using Metrics</a> guide.</p></section>