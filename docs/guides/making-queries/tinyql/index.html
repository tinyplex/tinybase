<!DOCTYPE html><html lang="en"><head><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link href="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ" rel="preload" as="script"><link rel="preload" as="font" href="/fonts/inter.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/inconsolata.woff2" type="font/woff2" crossorigin="anonymous"><title>TinyQL | TinyBase</title><meta name="description" content="This guide describes how to build a query against Store data, using the API provided by the setQueryDefinition method in the Queries object."><meta property="og:type" content="website"><meta property="og:title" content="TinyQL | TinyBase"><meta property="og:description" content="This guide describes how to build a query against Store data, using the API provided by the setQueryDefinition method in the Queries object."><meta property="og:url" content="https://beta.tinybase.org/guides/making-queries/tinyql/"><meta property="og:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="TinyQL | TinyBase"><meta name="twitter:description" content="This guide describes how to build a query against Store data, using the API provided by the setQueryDefinition method in the Queries object."><meta name="twitter:site" content="@tinybasejs"><meta name="twitter:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css"><link rel="canonical" href="https://beta.tinybase.org/guides/making-queries/tinyql/"><script src="/js/app.js"></script></head><body><header><a href="/"><img src="/favicon.svg" alt="TinyBase logo"><span>TinyBase <em title="3.1.0-beta.0">Î²</em></span></a><nav><ul><li><a href="/guides/">Guides</a></li><li><a href="/demos/">Demos</a></li><li><a href="/api/">API</a></li><li><a href="https://github.com/tinyplex/tinybase">GitHub</a></li></ul></nav><span id="dark"></span></header><main><nav><ul><li id="root" class="parent open"><span></span><a href="/">TinyBase</a><ul><li id="G" class="parent open"><span></span><a href="/guides/">Guides</a><ul><li id="R"><span></span><a href="/guides/releases/">Releases</a></li><li id="TB" class="parent"><span></span><a href="/guides/the-basics/">The Basics</a></li><li id="BUI" class="parent"><span></span><a href="/guides/building-uis/">Building UIs</a></li><li id="SAP" class="parent"><span></span><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a></li><li id="MAI" class="parent"><span></span><a href="/guides/metrics-and-indexes/">Metrics And Indexes</a></li><li id="RAC" class="parent"><span></span><a href="/guides/relationships-and-checkpoints/">Relationships And Checkpoints</a></li><li id="MQ" class="parent open"><span></span><a href="/guides/making-queries/">Making Queries</a><ul><li id="UQ"><span></span><a href="/guides/making-queries/using-queries/">Using Queries</a></li><li id="TQL" class="current"><span></span><a href="/guides/making-queries/tinyql/">TinyQL</a></li><li id="BAUIWQ"><span></span><a href="/guides/making-queries/building-a-ui-with-queries/">Building A UI With Queries</a></li></ul></li><li id="DT" class="parent"><span></span><a href="/guides/developer-tools/">Developer Tools</a></li><li id="HTBIB" class="parent"><span></span><a href="/guides/how-tinybase-is-built/">How TinyBase Is Built</a></li><li id="FAQ"><span></span><a href="/guides/faq/">FAQ</a></li></ul></li><li id="D2" class="parent"><span></span><a href="/demos/">Demos</a></li><li id="api" class="parent"><span></span><a href="/api/">API</a></li></ul></li></ul></nav><article><nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/making-queries/">Making Queries</a></li><li><a href="/guides/making-queries/tinyql/">TinyQL</a></li></ul></nav><section class="s1" id="/guides/making-queries/tinyql/" data-id="TQL"><h1>TinyQL</h1><p>This guide describes how to build a query against <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data, using the API provided by the <a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/"><code>setQueryDefinition</code></a> method in the <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> object.</p><p>This guide is called &#x27;TinyQL&#x27;, rather flippantly. <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> to <a href="/">TinyBase</a> are not made with a standard parsable language in the same way you would use SQL to access a traditional relational database. Rather, the API is typed and programmatic, making it a performant, unambiguous, and composable way to transform data.</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'brown'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">cujo</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> queries <span class="operator">=</span> <span class="function"><a href="/api/queries/functions/creation/createqueries/">createQueries</a></span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>
queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">keywords</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="comment">// TinyQL goes here</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>One downside might seem that you can&#x27;t directly use your experience of SQL syntax to work with <a href="/">TinyBase</a> queries - but, as you&#x27;ll see, many of the similar concepts will be very familiar.</p><p>You define a query with the <a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/"><code>setQueryDefinition</code></a> method. It takes an <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>, you&#x27;d like to assign to the query, and the <code>root</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> from which the data will be queried. The root table is like the first table that is named in a traditional SQL query, except that only &#x27;left&#x27; joins can be made from it. (This means that the result of a query can never have more Rows than that underlying <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> did.)</p><p>The third parameter, <code>build</code>, is where the magic happens: you provide a function to define the query. that will be called with with an object that contains the five named &#x27;keyword&#x27; functions for the query:</p><ul><li><code>select</code>: a function that lets you specify a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> or calculated value for including into the query&#x27;s result.</li><li><code>join</code> describes a function that lets you specify a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> or calculated value to join the main query <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to others, by <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>.</li><li><code>where</code> describes a function that lets you specify conditions to filter results, based on the underlying Cells of the main or joined <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a>.</li><li><code>group</code> describes a function that lets you specify that the values of a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> in multiple result Rows should be aggregated together.</li><li><code>having</code> describes a function that lets you specify conditions to filter results, based on the grouped Cells resulting from a <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> clause.</li></ul><p>All five can be destructured from the callback&#x27;s single parameter:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span>
  <span class="string">'query'</span><span class="punctuation">,</span>
  <span class="string">'pets'</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> join<span class="punctuation">,</span> where<span class="punctuation">,</span> group<span class="punctuation">,</span> having<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="function">select</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">select</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">join</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">where</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">group</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">having</span><span class="punctuation">(</span><span class="comment">/* ... */</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="comment">// and so on...</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Any of these keyword functions can be called multiple times (even imperatively, such as in a loop). The only requirement for a valid query is that at least one <code>select</code> function call is made.</p><p>Here&#x27;s a quick summary of each of the five keyword functions. Some of them are overloaded and have different effects based on the number of arguments, but they are all fully typed with TypeScript and well documented with examples.</p><h3 id="select"><a href="/api/queries/type-aliases/definition/select/"><code>Select</code></a></h3><p>The <a href="/api/queries/type-aliases/definition/select/"><code>Select</code></a> type describes the <code>select</code> function that lets you specify a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> or calculated value for including into the query&#x27;s result. You can chain the <code>as</code> function to change the name of the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a>.</p><p>Calling this function with one <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> parameter will indicate that the query should select the value of that specified <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> from the query&#x27;s main <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">select</span><span class="punctuation">(</span><span class="string">'color'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {color: 'brown'}, felix: {color: 'black'}, cujo: {color: 'black'}}</span>
</code></pre><p>Calling this function with one <em>callback</em> parameter will indicate that the query should select a calculated value, based on one or more <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function">select</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">getCell</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getcell/">getCell</a></span><span class="punctuation">(</span><span class="string">'color'</span><span class="punctuation">)</span><span class="operator">?.</span><span class="function">toUpperCase</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'COLOR'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {COLOR: 'BROWN'}, felix: {COLOR: 'BLACK'}, cujo: {COLOR: 'BLACK'}}</span>
</code></pre><p>If you are joining multiple <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> in the query, use an additional first parameter to indicate which the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> should come from:</p><pre><code>store
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">cujo</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'owners'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Alice'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Bob'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Carol'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> join<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'owners'</span><span class="punctuation">,</span> <span class="string">'name'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">join</span><span class="punctuation">(</span><span class="string">'owners'</span><span class="punctuation">,</span> <span class="string">'ownerId'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/iterator/foreachresultrow/">forEachResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="operator">:</span> queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultrow/">getResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {species: 'dog', name: 'Alice'}}</span>
<span class="comment">// -> {felix: {species: 'cat', name: 'Bob'}}</span>
<span class="comment">// -> {cujo: {species: 'dog', name: 'Carol'}}</span>
</code></pre><h3 id="join"><a href="/api/queries/type-aliases/definition/join/"><code>Join</code></a></h3><p>We just saw the <code>join</code> keyword in action. The <a href="/api/queries/type-aliases/definition/join/"><code>Join</code></a> type describes a function that lets you specify a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> or calculated value to join the main query <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to other <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a>, by their <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>.</p><p>Calling this function with two <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> parameters will indicate that the join to a <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> in an adjacent <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> is made by finding its <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> in a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> of the query&#x27;s main <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>, as in the example above.</p><p>You can join zero, one, or many <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a>. You can even join the same underlying <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> multiple times, (though in that case you will need to use the &#x27;as&#x27; function to distinguish them from each other):</p><pre><code>store
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">buyerId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">sellerId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">buyerId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">cujo</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">buyerId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">,</span> <span class="literal-property">sellerId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'humans'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Alice'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Bob'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Carol'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> join<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'buyers'</span><span class="punctuation">,</span> <span class="string">'name'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'buyer'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'sellers'</span><span class="punctuation">,</span> <span class="string">'name'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'seller'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">join</span><span class="punctuation">(</span><span class="string">'humans'</span><span class="punctuation">,</span> <span class="string">'buyerId'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'buyers'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">join</span><span class="punctuation">(</span><span class="string">'humans'</span><span class="punctuation">,</span> <span class="string">'sellerId'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'sellers'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/iterator/foreachresultrow/">forEachResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="operator">:</span> queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultrow/">getResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {buyer: 'Alice', seller: 'Bob'}}</span>
<span class="comment">// -> {felix: {buyer: 'Bob'}}</span>
<span class="comment">// -> {cujo: {buyer: 'Carol', seller: 'Alice'}}</span>
</code></pre><p>Because a <a href="/api/queries/type-aliases/definition/join/"><code>Join</code></a> clause is used to identify which unique <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> of the joined <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> will be joined to each <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> of the main <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>, queries follow the &#x27;left join&#x27; semantics you may be familiar with from SQL.</p><p>By default, each join is made from the main query <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to the joined table, but it is also possible to connect via an intermediate join <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to a more distant join <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>.</p><p>The <a href="/api/queries/type-aliases/definition/join/"><code>Join</code></a> type documentation provides many more examples of joining in queries.</p><h3 id="where"><a href="/api/queries/type-aliases/definition/where/"><code>Where</code></a></h3><p>The <a href="/api/queries/type-aliases/definition/where/"><code>Where</code></a> type describes the <code>where</code> function that lets you specify conditions to filter results, based on the underlying Cells of the main or joined <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a>.</p><p>Calling this function with two parameters is used to include only those Rows for which a specified <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> in the query&#x27;s main <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> has a specified value:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> where<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">where</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'dog'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {fido: {species: 'dog'}, cujo: {species: 'dog'}}</span>
</code></pre><p>A <a href="/api/queries/type-aliases/definition/where/"><code>Where</code></a> condition has to be true for a <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> to be included in the results. Each <a href="/api/queries/type-aliases/definition/where/"><code>Where</code></a> class is additive, as though combined with a logical &#x27;and&#x27;.</p><p>If you wish to create an &#x27;or&#x27; expression, or just create a more complex criterion, use the single parameter that allows arbitrary programmatic conditions:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> where<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">where</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">getCell</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getcell/">getCell</a></span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">)</span><span class="operator">?.</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {felix: {species: 'cat'}}</span>
</code></pre><h3 id="group"><a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a></h3><p>The <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> type describes the <code>group</code> function that lets you specify that the values of a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> in multiple result Rows should be aggregated together. This is applied after any joins or where-based filtering.</p><p>If you provide a <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> for every <a href="/api/queries/type-aliases/definition/select/"><code>Select</code></a>, the result will be a single <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> with every <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> having been aggregated. If you provide a <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> for only one, or some, of the <a href="/api/queries/type-aliases/definition/select/"><code>Select</code></a> clauses, the <em>others</em> will be automatically used as dimensional values (analogous to the &#x27;group by<code>semantics in SQL), within which the aggregations of [</code>Group`](/api/queries/type-aliases/definition/group/) Cells will be performed.</p><p>You can join the same underlying <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> multiple times, but in that case you will need to use the &#x27;as&#x27; function to distinguish them from each other.</p><pre><code>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">cujo</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">tom</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">carnaby</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'parrot'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">polly</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'parrot'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> group<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'count'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'count'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'avg'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'avgPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/iterator/foreachresultrow/">forEachResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="operator">:</span> queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultrow/">getResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {0: {species: 'dog', count: 2, avgPrice: 4.5}}</span>
<span class="comment">// -> {1: {species: 'cat', count: 2, avgPrice: 3.5}}</span>
<span class="comment">// -> {2: {species: 'parrot', count: 2, avgPrice: 3}}</span>
</code></pre><p>You can also provide your own aggregate function, with optional &#x27;shortcut&#x27; functions if you can avoid calculating the new value for the result without scanning every value again (much like you can with calculated <a href="/api/metrics/interfaces/metrics/metrics/"><code>Metrics</code></a>). See the <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> documentation for more details and examples.</p><h3 id="having"><a href="/api/queries/type-aliases/definition/having/"><code>Having</code></a></h3><p>The <a href="/api/queries/type-aliases/definition/having/"><code>Having</code></a> type describes the <code>having</code> function that lets you specify conditions to filter results, based on the grouped Cells resulting from a <a href="/api/queries/type-aliases/definition/group/"><code>Group</code></a> clause.</p><p>Like the <code>where</code> function, call this with two parameters is used to include only those Rows for which a specified <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> in the query&#x27;s main <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> has a specified value.</p><p><em>Unlike</em> the <code>where</code> function, this filtering is applied <em>after</em> the grouping has been performed, much like you would use <code>HAVING</code> instead of <code>WHERE</code> in a classic SQL environment.</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> group<span class="punctuation">,</span> having<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'price'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'min'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'minPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'max'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'maxPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">having</span><span class="punctuation">(</span><span class="string">'minPrice'</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/iterator/foreachresultrow/">forEachResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="operator">:</span> queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultrow/">getResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {0: {species: 'cat', minPrice: 3, maxPrice: 4}}</span>
<span class="comment">// -> {1: {species: 'parrot', minPrice: 3, maxPrice: 3}}</span>
</code></pre><p>(Note that you shouldn&#x27;t make any assumptions about the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> on a result <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> that has been grouped.)</p><p>Again, multiple <code>having</code> functions will behave as though combined with a logical &#x27;and&#x27;. If you wish to create an &#x27;or&#x27; expression, or just create a more complex criterion, use the single parameter version that allows arbitrary programmatic conditions</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> group<span class="punctuation">,</span> having<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">select</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'price'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'min'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'minPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">group</span><span class="punctuation">(</span><span class="string">'price'</span><span class="punctuation">,</span> <span class="string">'max'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'maxPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">having</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">getCell</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getcell/">getCell</a></span><span class="punctuation">(</span><span class="string">'minPrice'</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getcell/">getCell</a></span><span class="punctuation">(</span><span class="string">'maxPrice'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {0: {species: 'parrot', minPrice: 3, maxPrice: 3}}</span>
</code></pre><h3 id="putting-it-all-together">Putting It All Together</h3><p>To finish off, let&#x27;s look at a more complex complex TinyQL query that includes all the keywords in use together, and shows how something similar might have been expressed in SQL.</p><p>First let&#x27;s build an interesting dataset:</p><pre><code>store
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">rex</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'6'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">cujo</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">tom</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'5'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">lowly</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'4'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">smaug</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">speciesId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">,</span> <span class="literal-property">colorId</span><span class="operator">:</span> <span class="string">'4'</span><span class="punctuation">,</span> <span class="literal-property">ownerId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'worm'</span><span class="punctuation">,</span> <span class="literal-property">price</span><span class="operator">:</span> <span class="number">1</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'color'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'brown'</span><span class="punctuation">,</span> <span class="literal-property">premium</span><span class="operator">:</span> <span class="number">1.0</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'black'</span><span class="punctuation">,</span> <span class="literal-property">premium</span><span class="operator">:</span> <span class="number">1.5</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'white'</span><span class="punctuation">,</span> <span class="literal-property">premium</span><span class="operator">:</span> <span class="number">2</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">4</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'silver'</span><span class="punctuation">,</span> <span class="literal-property">premium</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'owner'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Alice'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Bob'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Carol'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">4</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Dennis'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'2'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">5</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Errol'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'3'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">6</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Fiona'</span><span class="punctuation">,</span> <span class="literal-property">regionId</span><span class="operator">:</span> <span class="string">'4'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settable/">setTable</a></span><span class="punctuation">(</span><span class="string">'region'</span><span class="punctuation">,</span> <span class="punctuation">{</span>
    <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'California'</span><span class="punctuation">,</span> <span class="literal-property">country</span><span class="operator">:</span> <span class="string">'US'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'New York'</span><span class="punctuation">,</span> <span class="literal-property">country</span><span class="operator">:</span> <span class="string">'US'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">3</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Washington'</span><span class="punctuation">,</span> <span class="literal-property">country</span><span class="operator">:</span> <span class="string">'US'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="number">4</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'British Columbia'</span><span class="punctuation">,</span> <span class="literal-property">country</span><span class="operator">:</span> <span class="string">'CA'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>And then an interesting query against it:</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span>
  <span class="string">'query'</span><span class="punctuation">,</span>
  <span class="string">'pets'</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> join<span class="punctuation">,</span> where<span class="punctuation">,</span> group<span class="punctuation">,</span> having<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="comment">// SELECT...</span>
    <span class="function">select</span><span class="punctuation">(</span><span class="string">'state'</span><span class="punctuation">,</span> <span class="string">'name'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'stateName'</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">select</span><span class="punctuation">(</span>
      <span class="punctuation">(</span><span class="parameter">getTableCell</span><span class="punctuation">)</span> <span class="operator">=></span>
        <span class="function">getTableCell</span><span class="punctuation">(</span><span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'price'</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="function">getTableCell</span><span class="punctuation">(</span><span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'premium'</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'fullPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="comment">// FROM...</span>
    <span class="punctuation">[</span><span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'owner'</span><span class="punctuation">]</span><span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">table</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">join</span><span class="punctuation">(</span>table<span class="punctuation">,</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>table<span class="interpolation-punctuation">}</span></span><span class="string">Id</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">join</span><span class="punctuation">(</span><span class="string">'region'</span><span class="punctuation">,</span> <span class="string">'owner'</span><span class="punctuation">,</span> <span class="string">'regionId'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'state'</span><span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="comment">// WHERE...</span>
    <span class="function">where</span><span class="punctuation">(</span><span class="string">'state'</span><span class="punctuation">,</span> <span class="string">'country'</span><span class="punctuation">,</span> <span class="string">'US'</span><span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="comment">// GROUP</span>
    <span class="function">group</span><span class="punctuation">(</span><span class="string">'fullPrice'</span><span class="punctuation">,</span> <span class="string">'avg'</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">as</span><span class="punctuation">(</span><span class="string">'avgFullPrice'</span><span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="comment">// HAVING</span>
    <span class="function">having</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">getCell</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getcell/">getCell</a></span><span class="punctuation">(</span><span class="string">'avgFullPrice'</span><span class="punctuation">)</span> <span class="operator">>=</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>(Notice how the joins to the <code>species</code>, <code>color</code>, and <code>owner</code> tables are performed programmatically here - just to prove a point! - because there&#x27;s a useful convention on the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> used. Also see the <a href="/demos/movie-database/">Movie Database</a> demo for an example of modular query composition.)</p><p>This query is roughly expressed in English as &quot;The average price of pets per state (based on their color and species) sold to owners who live in the US, for states where that average price is 5 or more, and listing the top three states in descending order&quot;</p><p>But for the &quot;top three states in descending order&quot; part, you&#x27;ve probably noticed by now that there is no TinyQL equivalent to SQL&#x27;s <code>ORDER BY</code> or <code>LIMIT</code>. Instead you perform sorting and optional pagination when you actually extract the data, using the <a href="/api/queries/interfaces/queries/queries/methods/result/getresultsortedrowids/"><code>getResultSortedRowIds</code></a> method:</p><pre><code>queries
  <span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultsortedrowids/">getResultSortedRowIds</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'avgFullPrice'</span><span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresultrow/">getResultRow</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {"stateName": "New York", "avgFullPrice": 5.5}</span>
<span class="comment">// -> {"stateName": "California", "avgFullPrice": 5}</span>
</code></pre><p>The results should check out: the owners who are in the US are Alice, Bob, Carol, Dennis, Errol. In California, the pets are Fido (a brown dog, costing 5), Felix (a black cat, costing 6) and Smaug (a silver worm, costing 4), averaging 5 for that state. In New York, the pets are Cujo (a white dog, costing 10) and Lowly (a brown worm, costing 1), averaging 5.5 for that state. In Washington, the only pet is Tom (a brown cat, costing 4), so that whole state fails the minimum average price.</p><p>The equivalent SQL for what we&#x27;ve just done here would be something like:</p><pre><code><span class="keyword">SELECT</span>
  state<span class="punctuation">.</span>name <span class="keyword">AS</span> stateName<span class="punctuation">,</span>
  <span class="function">AVG</span><span class="punctuation">(</span>species<span class="punctuation">.</span>price <span class="operator">*</span> color<span class="punctuation">.</span>premium<span class="punctuation">)</span> <span class="keyword">AS</span> avgFullPrice<span class="punctuation">,</span>
<span class="keyword">FROM</span>
  pets
  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> species
    <span class="keyword">ON</span> species<span class="punctuation">.</span>_rowId <span class="operator">=</span> pets<span class="punctuation">.</span>speciesId
  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> color
    <span class="keyword">ON</span> color<span class="punctuation">.</span>_rowId <span class="operator">=</span> pets<span class="punctuation">.</span>colorId
  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> owner
    <span class="keyword">ON</span> owner<span class="punctuation">.</span>_rowId <span class="operator">=</span> pets<span class="punctuation">.</span>ownerId
    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> region <span class="keyword">AS</span> state
      <span class="keyword">ON</span> region<span class="punctuation">.</span>_rowId <span class="operator">=</span> owner<span class="punctuation">.</span>regionId
<span class="keyword">WHERE</span>
  state<span class="punctuation">.</span>country <span class="operator">=</span> <span class="string">'US'</span>
<span class="keyword">GROUP</span> <span class="keyword">BY</span>
  stateName
<span class="keyword">HAVING</span>
  avgFullPrice <span class="operator">>=</span> <span class="number">5</span><span class="punctuation">;</span>
<span class="keyword">ORDER</span> <span class="keyword">BY</span>
  avgFullPrice <span class="keyword">DESC</span>
<span class="keyword">LIMIT</span>
  <span class="number">3</span>
</code></pre><p>Hopefully that makes sense!</p><p>Wait... did we mention it&#x27;s also reactive? It&#x27;s probably worth showcasing something that SQL struggles to do :)</p><pre><code>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/listener/addresultsortedrowidslistener/">addResultSortedRowIdsListener</a></span><span class="punctuation">(</span>
  <span class="string">'query'</span><span class="punctuation">,</span>
  <span class="string">'avgFullPrice'</span><span class="punctuation">,</span>
  <span class="boolean">true</span><span class="punctuation">,</span>
  <span class="number">0</span><span class="punctuation">,</span>
  <span class="number">3</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">_queries<span class="punctuation">,</span> _queryId<span class="punctuation">,</span> _cellId<span class="punctuation">,</span> _descending<span class="punctuation">,</span> _offset<span class="punctuation">,</span> _limit<span class="punctuation">,</span> rowIds</span><span class="punctuation">)</span> <span class="operator">=></span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>queries<span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/result/getresulttable/">getResultTable</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

<span class="comment">// Bob is actually in British Columbia!</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'owner'</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="string">'regionId'</span><span class="punctuation">,</span> <span class="string">'4'</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="comment">// -> {1: {"stateName": "New York", "avgFullPrice": 5.5}}</span>
</code></pre><p>Now that Bob is in Canada, removing Felix (cost 6) from California lowers its average to 4.5 - too low for our results, and we only see New York! Magic.</p><h3 id="summary">Summary</h3><p>Next, let&#x27;s find out how to include queries in a user interface in the <a href="/guides/making-queries/building-a-ui-with-queries/">Building A UI With Queries</a> guide.</p></section></article><aside></aside></main><footer><nav><a id="tw" href="https://twitter.com/tinybasejs" target="_blank">Twitter</a><a id="fb" href="https://facebook.com/tinybasejs" target="_blank">Facebook</a></nav><nav><a href="/">TinyBase 3.1.0-beta.0</a> Â© 2021- All Rights Reserved</nav></footer></body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ"></script><script>window.dataLayer=window.dataLayer||[];function g(){dataLayer.push(arguments);}g('js',new Date());g('config','G-D1MGR8VRWJ');</script></html>