<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a></li><li><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a></li></ul></nav><section class="s1" id="/guides/schemas-and-persistence/persisting-data/" data-id="PD"><h1>Persisting Data</h1><p>The persister module lets you save and load <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to and from different locations, or underlying storage types.</p><p>This is useful for preserving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data between browser sessions or reloads, saving or loading browser state to or from a server, or saving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to disk in a environment with filesystem access.</p><h3 id="types-of-persisters">Types Of Persisters</h3><p>Creating a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> for a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> depends on the choice of underlying storage where the data is to be stored. Options (in separately installed modules) include:</p><ul><li>The <a href="/api/persister-browser/functions/creation/createsessionpersister/"><code>createSessionPersister</code></a> function (in the <a href="/api/persister-browser/"><code>persister-browser</code></a> module) returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses the browser&#x27;s session storage.</li><li>The <a href="/api/persister-browser/functions/creation/createlocalpersister/"><code>createLocalPersister</code></a> function (in the <a href="/api/persister-browser/"><code>persister-browser</code></a> module) returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses the browser&#x27;s local storage.</li><li>The <a href="/api/persister-remote/functions/creation/createremotepersister/"><code>createRemotePersister</code></a> function (in the <a href="/api/persister-remote/"><code>persister-remote</code></a> module) returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses a remote server.</li><li>The <a href="/api/persister-file/functions/creation/createfilepersister/"><code>createFilePersister</code></a> function (in the <a href="/api/persister-file/"><code>persister-file</code></a> module) returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses a local file (in an appropriate environment).</li></ul><p>There is also a way to developer custom Persisters of your own, which we describe in the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p><p>For more complex synchronization, <a href="/">TinyBase</a> includes persisters for frameworks like Yjs:</p><ul><li>The <a href="/api/persister-yjs/functions/creation/createyjspersister/"><code>createYjsPersister</code></a> function (in the <a href="/api/persister-yjs/"><code>persister-yjs</code></a> module) returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that connects to a Yjs document.</li></ul><p>(See the <a href="/guides/schemas-and-persistence/synchronizing-data/">Synchronizing Data</a> guide for more details on those.)</p><h3 id="persister-operations"><a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> Operations</h3><p>A <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> lets you explicit save or load data, with the <a href="/api/persisters/interfaces/persister/persister/methods/save/save/"><code>save</code></a> method and the <a href="/api/persisters/interfaces/persister/persister/methods/load/load/"><code>load</code></a> method respectively. These methods are both asynchronous (since the underlying data storage may also be) and return promises. As a result you should use the <code>await</code> keyword to call them in a way that guarantees subsequent execution order.</p><p>In this example, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> saves data to, and loads it from, the browser&#x27;s session storage:</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setvalues/">setValues</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">employees</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> persister <span class="operator">=</span> <span class="function"><a href="/api/persister-browser/functions/creation/createsessionpersister/">createSessionPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"fido":{"species":"dog"}}},{"employees":3}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span>
  <span class="string">'petStore'</span><span class="punctuation">,</span>
  <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{"employees":4}]'</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: 'dog'}}}</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getvalues/">getValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {employees: 4}</span>

sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="automatic-loading-and-saving">Automatic Loading and Saving</h3><p>When you don&#x27;t want to deal with explicit persistence operations, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object also provides automatic saving and loading. Automatic saving listens for changes to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> and persists the data immediately. Automatic loading listens (or polls) for changes to the persisted data and reflects those changes in the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>.</p><p>You can start automatic saving or loading with the <a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/"><code>startAutoSave</code></a> method and <a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/"><code>startAutoLoad</code></a> method. Both are asynchronous since they will do an immediate save and load before starting to listen for subsequent changes. You can stop the behavior with the <a href="/api/persisters/interfaces/persister/persister/methods/save/stopautosave/"><code>stopAutoSave</code></a> method and <a href="/api/persisters/interfaces/persister/persister/methods/load/stopautoload/"><code>stopAutoLoad</code></a> method (which are synchronous).</p><p>In this example, both automatic loading and saving are configured:</p><pre><code><span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delvalues/">delValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"felix":{"species":"cat"}}},{}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">,</span> <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{}]'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> StorageEvent('storage', {storageArea: sessionStorage, key: 'petStore'})</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: "dog"}}}</span>

persister<span class="punctuation">.</span><span class="function">destroy</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Note that the <a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/"><code>startAutoLoad</code></a> method also takes a default set of <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> so that the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> can be instantiated with good data if the persistence layer is empty (such as when this is the first time the app has been executed).</p><h3 id="a-caveat">A Caveat</h3><p>You may often want to have both automatic saving and loading of a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> so that changes are constantly synchronized (allowing basic state preservation between browser tabs, for example). The framework has some basic provisions to prevent race conditions - for example it will not attempt to save data if it is currently loading it and vice-versa.</p><p>Be aware, however, that the default implementations do not provide complex synchronization heuristics and you should comprehensively test your persistence strategy to understand the opportunity for data loss (in the case of trying to save data to a server under poor network conditions, for example).</p><h3 id="summary">Summary</h3><p>Use the <a href="/api/persisters/"><code>persisters</code></a> module to load and save data from and to a variety of common persistence layers. When these don&#x27;t suffice, you can also develop custom Persisters of your own, for which we proceed to the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p></section>