<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a></li><li><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a></li></ul></nav><section class="s1" id="/guides/schemas-and-persistence/persisting-data/" data-id="PD"><h1>Persisting Data</h1><p>The persister module lets you save and load <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to and from different locations, or underlying storage types.</p><p>This is useful for preserving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data between browser sessions or reloads, saving or loading browser state to or from a server, saving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to disk in a environment with filesystem access, or, in v4.0 and above, to SQLite and CRDT frameworks like <a href="https://yjs.dev/">Yjs</a> and <a href="https://automerge.org/">Automerge</a>.</p><h3 id="types-of-persisters">Types of Persisters</h3><p>Several entry points are provided (in separately installed modules), each of which returns a new <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object that can load and save a <a href="/api/store/interfaces/store/store/"><code>Store</code></a>. Between them, these allow you to store your <a href="/">TinyBase</a> data locally, remotely, to SQLite databases, and across synchronization boundaries with CRDT frameworks.</p><div class="table"><table><thead><tr><th>Module</th><th>Function</th><th>Storage</th></tr></thead><tbody><tr><td><a href="/api/persister-browser/"><code>persister-browser</code></a></td><td><a href="/api/persister-browser/functions/creation/createsessionpersister/"><code>createSessionPersister</code></a></td><td>Browser session storage</td></tr><tr><td><a href="/api/persister-browser/"><code>persister-browser</code></a></td><td><a href="/api/persister-browser/functions/creation/createlocalpersister/"><code>createLocalPersister</code></a></td><td>Browser local storage</td></tr><tr><td><a href="/api/persister-indexed-db/"><code>persister-indexed-db</code></a></td><td><a href="/api/persister-indexed-db/functions/creation/createindexeddbpersister/"><code>createIndexedDbPersister</code></a></td><td>Browser IndexedDB</td></tr><tr><td><a href="/api/persister-remote/"><code>persister-remote</code></a></td><td><a href="/api/persister-remote/functions/creation/createremotepersister/"><code>createRemotePersister</code></a></td><td>Remote server</td></tr><tr><td><a href="/api/persister-file/"><code>persister-file</code></a></td><td><a href="/api/persister-file/functions/creation/createfilepersister/"><code>createFilePersister</code></a></td><td>Local file (where possible)</td></tr><tr><td><a href="/api/persister-partykit-client/"><code>persister-partykit-client</code></a></td><td><a href="/api/persister-partykit-client/functions/creation/createpartykitpersister/"><code>createPartyKitPersister</code></a></td><td>PartyKit with the <a href="/api/persister-partykit-server/"><code>persister-partykit-server</code></a> module</td></tr><tr><td><a href="/api/persister-sqlite3/"><code>persister-sqlite3</code></a></td><td><a href="/api/persister-sqlite3/functions/creation/createsqlite3persister/"><code>createSqlite3Persister</code></a></td><td>SQLite in Node, via <a href="https://github.com/TryGhost/node-sqlite3">sqlite3</a></td></tr><tr><td><a href="/api/persister-sqlite-wasm/"><code>persister-sqlite-wasm</code></a></td><td><a href="/api/persister-sqlite-wasm/functions/creation/createsqlitewasmpersister/"><code>createSqliteWasmPersister</code></a></td><td>SQLite in a browser, via <a href="https://github.com/tomayac/sqlite-wasm">sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-cr-sqlite-wasm/"><code>persister-cr-sqlite-wasm</code></a></td><td><a href="/api/persister-cr-sqlite-wasm/functions/creation/createcrsqlitewasmpersister/"><code>createCrSqliteWasmPersister</code></a></td><td>SQLite CRDTs, via <a href="https://github.com/vlcn-io/cr-sqlite">cr-sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-expo-sqlite/"><code>persister-expo-sqlite</code></a></td><td><a href="/api/persister-expo-sqlite/functions/creation/createexposqlitepersister/"><code>createExpoSqlitePersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/expo/expo/tree/main/packages/expo-sqlite">expo-sqlite</a></td></tr><tr><td><a href="/api/persister-expo-sqlite-next/"><code>persister-expo-sqlite-next</code></a></td><td><a href="/api/persister-expo-sqlite-next/functions/creation/createexposqlitenextpersister/"><code>createExpoSqliteNextPersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/expo/expo/tree/main/packages/expo-sqlite">expo-sqlite/next</a></td></tr><tr><td><a href="/api/persister-yjs/"><code>persister-yjs</code></a></td><td><a href="/api/persister-yjs/functions/creation/createyjspersister/"><code>createYjsPersister</code></a></td><td>Yjs CRDTs, via <a href="https://github.com/yjs/yjs">yjs</a></td></tr><tr><td><a href="/api/persister-automerge/"><code>persister-automerge</code></a></td><td><a href="/api/persister-sqlite-wasm/functions/creation/createsqlitewasmpersister/"><code>createSqliteWasmPersister</code></a></td><td>Automerge CRDTs, via <a href="https://github.com/automerge/automerge-repo">automerge-repo</a></td></tr></tbody></table></div><p>See the <a href="/guides/schemas-and-persistence/database-persistence/">Database Persistence</a> guide for details on how to work with SQLite databases, and the <a href="/guides/schemas-and-persistence/synchronizing-data/">Synchronizing Data</a> guide for more complex synchronization with the CRDT frameworks.</p><p>There is also a way to developer custom Persisters of your own, which we describe in the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p><h3 id="persister-operations"><a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> Operations</h3><p>A <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> lets you explicit save or load data, with the save method and the load method respectively. These methods are both asynchronous (since the underlying data storage may also be) and return promises. As a result you should use the <code>await</code> keyword to call them in a way that guarantees subsequent execution order.</p><p>In this example, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> saves data to, and loads it from, the browser&#x27;s session storage:</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setvalues/">setValues</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">employees</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> persister <span class="operator">=</span> <span class="function"><a href="/api/persister-browser/functions/creation/createsessionpersister/">createSessionPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function">save</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"fido":{"species":"dog"}}},{"employees":3}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span>
  <span class="string">'petStore'</span><span class="punctuation">,</span>
  <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{"employees":4}]'</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function">load</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: 'dog'}}}</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getvalues/">getValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {employees: 4}</span>

sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="automatic-loading-and-saving">Automatic Loading and Saving</h3><p>When you don&#x27;t want to deal with explicit persistence operations, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object also provides automatic saving and loading. Automatic saving listens for changes to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> and persists the data immediately. Automatic loading listens (or polls) for changes to the persisted data and reflects those changes in the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>.</p><p>You can start automatic saving or loading with the startAutoSave method and startAutoLoad method. Both are asynchronous since they will do an immediate save and load before starting to listen for subsequent changes. You can stop the behavior with the stopAutoSave method and stopAutoLoad method (which are synchronous).</p><p>In this example, both automatic loading and saving are configured:</p><pre><code><span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function">startAutoLoad</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function">startAutoSave</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delvalues/">delValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"felix":{"species":"cat"}}},{}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">,</span> <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{}]'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> StorageEvent('storage', {storageArea: sessionStorage, key: 'petStore'})</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: "dog"}}}</span>

persister<span class="punctuation">.</span><span class="function">destroy</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Note that the startAutoLoad method also takes a default set of <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> so that the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> can be instantiated with good data if the persistence layer is empty (such as when this is the first time the app has been executed).</p><h3 id="a-caveat">A Caveat</h3><p>You may often want to have both automatic saving and loading of a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> so that changes are constantly synchronized (allowing basic state preservation between browser tabs, for example). The framework has some basic provisions to prevent race conditions - for example it will not attempt to save data if it is currently loading it and vice-versa - and will sequentially schedule methods that could cause race conditions.</p><p>That said, be aware that you should always comprehensively test your persistence strategy to understand the opportunity for data loss (in the case of trying to save data to a server under poor network conditions, for example).</p><p>To help debug such issues, since v4.0.4, the create methods for all <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> objects take an optional <code>onIgnoredError</code> argument. This is a handler for the errors that the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> would otherwise ignore when trying to save or load data (such as when handling corrupted stored data). It&#x27;s recommended you use this for debugging persistence issues, but only in a development environment. Database-based <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> objects also take an optional <code>onSqlCommand</code> argument for logging commands and queries made to the underlying database.</p><h3 id="summary">Summary</h3><p>Use the <a href="/api/persisters/"><code>persisters</code></a> module to load and save data from and to a variety of common persistence layers. When these don&#x27;t suffice, you can also develop custom Persisters of your own, for which we proceed to the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p></section>