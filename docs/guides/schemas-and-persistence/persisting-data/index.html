<!DOCTYPE html><html lang="en"><head><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link href="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ" rel="preload" as="script"><link rel="preload" as="font" href="/fonts/inter.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/inconsolata.woff2" type="font/woff2" crossorigin="anonymous"><title>Persisting Data | TinyBase</title><meta name="description" content="The persister module lets you save and load Store data to and from different locations, or underlying storage types."><meta property="og:type" content="website"><meta property="og:title" content="Persisting Data | TinyBase"><meta property="og:description" content="The persister module lets you save and load Store data to and from different locations, or underlying storage types."><meta property="og:url" content="https://beta.tinybase.org/guides/schemas-and-persistence/persisting-data/"><meta property="og:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Persisting Data | TinyBase"><meta name="twitter:description" content="The persister module lets you save and load Store data to and from different locations, or underlying storage types."><meta name="twitter:site" content="@tinybasejs"><meta name="twitter:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css"><link rel="canonical" href="https://beta.tinybase.org/guides/schemas-and-persistence/persisting-data/"><script src="/js/app.js"></script></head><body><header><a href="/"><img src="/favicon.svg" alt="TinyBase logo"><span>TinyBase <em title="3.1.0-beta.0">β</em></span></a><nav><ul><li><a href="/guides/">Guides</a></li><li><a href="/demos/">Demos</a></li><li><a href="/api/">API</a></li><li><a href="https://github.com/tinyplex/tinybase">GitHub</a></li></ul></nav><span id="dark"></span></header><main><nav><ul><li id="root" class="parent open"><span></span><a href="/">TinyBase</a><ul><li id="G" class="parent open"><span></span><a href="/guides/">Guides</a><ul><li id="R"><span></span><a href="/guides/releases/">Releases</a></li><li id="TB" class="parent"><span></span><a href="/guides/the-basics/">The Basics</a></li><li id="BUI" class="parent"><span></span><a href="/guides/building-uis/">Building UIs</a></li><li id="SAP" class="parent open"><span></span><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a><ul><li id="US"><span></span><a href="/guides/schemas-and-persistence/using-schemas/">Using Schemas</a></li><li id="MDWL"><span></span><a href="/guides/schemas-and-persistence/mutating-data-with-listeners/">Mutating Data With Listeners</a></li><li id="PD" class="current"><span></span><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a></li><li id="CP"><span></span><a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a></li></ul></li><li id="MAI" class="parent"><span></span><a href="/guides/metrics-and-indexes/">Metrics And Indexes</a></li><li id="RAC" class="parent"><span></span><a href="/guides/relationships-and-checkpoints/">Relationships And Checkpoints</a></li><li id="MQ" class="parent"><span></span><a href="/guides/making-queries/">Making Queries</a></li><li id="DT" class="parent"><span></span><a href="/guides/developer-tools/">Developer Tools</a></li><li id="HTBIB" class="parent"><span></span><a href="/guides/how-tinybase-is-built/">How TinyBase Is Built</a></li><li id="FAQ"><span></span><a href="/guides/faq/">FAQ</a></li></ul></li><li id="D2" class="parent"><span></span><a href="/demos/">Demos</a></li><li id="api" class="parent"><span></span><a href="/api/">API</a></li></ul></li></ul></nav><article><nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a></li><li><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a></li></ul></nav><section class="s1" id="/guides/schemas-and-persistence/persisting-data/" data-id="PD"><h1>Persisting Data</h1><p>The persister module lets you save and load <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to and from different locations, or underlying storage types.</p><p>This is useful for preserving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data between browser sessions or reloads, saving or loading browser state to or from a server, or saving <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to disk in a environment with filesystem access.</p><h3 id="types-of-persisters">Types Of Persisters</h3><p>Creating a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> for a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> depends on the choice of underlying storage where the data is to be stored. Options include:</p><ul><li>The <a href="/api/persisters/functions/creation/createsessionpersister/"><code>createSessionPersister</code></a> function, which returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses the browser&#x27;s session storage.</li><li>The <a href="/api/persisters/functions/creation/createlocalpersister/"><code>createLocalPersister</code></a> function, which returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses the browser&#x27;s local storage.</li><li>The <a href="/api/persisters/functions/creation/createremotepersister/"><code>createRemotePersister</code></a> function, which returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses a remote server.</li><li>The <a href="/api/persisters/functions/creation/createfilepersister/"><code>createFilePersister</code></a> function, which returns a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> that uses a local file (in an appropriate environment).</li></ul><p>There is also a way to developer custom Persisters of your own, which we describe in the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p><h3 id="persister-operations"><a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> Operations</h3><p>A <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> lets you explicit save or load data, with the <a href="/api/persisters/interfaces/persister/persister/methods/save/save/"><code>save</code></a> method and the <a href="/api/persisters/interfaces/persister/persister/methods/load/load/"><code>load</code></a> method respectively. These methods are both asynchronous (since the underlying data storage may also be) and return promises. As a result you should use the <code>await</code> keyword to call them in a way that guarantees subsequent execution order.</p><p>In this example, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> saves data to, and loads it from, the browser&#x27;s session storage:</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setvalues/">setValues</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">employees</span><span class="operator">:</span> <span class="number">3</span><span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> persister <span class="operator">=</span> <span class="function"><a href="/api/persisters/functions/creation/createsessionpersister/">createSessionPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"fido":{"species":"dog"}}},{"employees":3}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span>
  <span class="string">'petStore'</span><span class="punctuation">,</span>
  <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{"employees":4}]'</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: 'dog'}}}</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getvalues/">getValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {employees: 4}</span>

sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="automatic-loading-and-saving">Automatic Loading and Saving</h3><p>When you don&#x27;t want to deal with explicit persistence operations, a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object also provides automatic saving and loading. Automatic saving listens for changes to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> and persists the data immediately. Automatic loading listens (or polls) for changes to the persisted data and reflects those changes in the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>.</p><p>You can start automatic saving or loading with the <a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/"><code>startAutoSave</code></a> method and <a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/"><code>startAutoLoad</code></a> method. Both are asynchronous since they will do an immediate save and load before starting to listen for subsequent changes. You can stop the behavior with the <a href="/api/persisters/interfaces/persister/persister/methods/save/stopautosave/"><code>stopAutoSave</code></a> method and <a href="/api/persisters/interfaces/persister/persister/methods/load/stopautoload/"><code>stopAutoLoad</code></a> method (which are synchronous).</p><p>In this example, both automatic loading and saving are configured:</p><pre><code><span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delvalues/">delValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>sessionStorage<span class="punctuation">.</span><span class="function">getItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '[{"pets":{"felix":{"species":"cat"}}},{}]'</span>

sessionStorage<span class="punctuation">.</span><span class="function">setItem</span><span class="punctuation">(</span><span class="string">'petStore'</span><span class="punctuation">,</span> <span class="string">'[{"pets":{"toto":{"species":"dog"}}},{}]'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> StorageEvent('storage', {storageArea: sessionStorage, key: 'petStore'})</span>
<span class="comment">// ...</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {toto: {species: "dog"}}}</span>

persister<span class="punctuation">.</span><span class="function">destroy</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
sessionStorage<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Note that the <a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/"><code>startAutoLoad</code></a> method also takes a default set of <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> so that the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> can be instantiated with good data if the persistence layer is empty (such as when this is the first time the app has been executed).</p><h3 id="a-caveat">A Caveat</h3><p>You may often want to have both automatic saving and loading of a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> so that changes are constantly synchronized (allowing basic state preservation between browser tabs, for example). The framework has some basic provisions to prevent race conditions - for example it will not attempt to save data if it is currently loading it and vice-versa.</p><p>Be aware, however, that the default implementations do not provide complex synchronization heuristics and you should comprehensively test your persistence strategy to understand the opportunity for data loss (in the case of trying to save data to a server under poor network conditions, for example).</p><h3 id="summary">Summary</h3><p>Use the <a href="/api/persisters/"><code>persisters</code></a> module to load and save data from and to a variety of common persistence layers. When these don&#x27;t suffice, you can also develop custom Persisters of your own, for which we proceed to the <a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a> guide.</p></section></article><aside></aside></main><footer><nav><a id="tw" href="https://twitter.com/tinybasejs" target="_blank">Twitter</a><a id="fb" href="https://facebook.com/tinybasejs" target="_blank">Facebook</a></nav><nav><a href="/">TinyBase 3.1.0-beta.0</a> © 2021- All Rights Reserved</nav></footer></body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ"></script><script>window.dataLayer=window.dataLayer||[];function g(){dataLayer.push(arguments);}g('js',new Date());g('config','G-D1MGR8VRWJ');</script></html>