<!DOCTYPE html><html lang="en"><head><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link href="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ" rel="preload" as="script"><link rel="preload" as="font" href="/fonts/inter.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/inconsolata.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/icons.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/shantell.woff2" type="font/woff2" crossorigin="anonymous"><title>Database Persistence | TinyBase</title><meta name="description" content="Since v4.0, there are various options for persisting Store data to and from SQLite databases, via a range of third-party modules."><meta property="og:type" content="website"><meta property="og:title" content="Database Persistence | TinyBase"><meta property="og:description" content="Since v4.0, there are various options for persisting Store data to and from SQLite databases, via a range of third-party modules."><meta property="og:url" content="https://beta.tinybase.org/guides/schemas-and-persistence/database-persistence/"><meta property="og:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Database Persistence | TinyBase"><meta name="twitter:description" content="Since v4.0, there are various options for persisting Store data to and from SQLite databases, via a range of third-party modules."><meta name="twitter:site" content="@tinybasejs"><meta name="twitter:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css"><link rel="canonical" href="https://beta.tinybase.org/guides/schemas-and-persistence/database-persistence/"><script src="/js/app.js"></script></head><body><header><a href="/"><img src="/favicon.svg" alt="TinyBase logo"><span>TinyBase <em title="5.0.0-beta.5">β</em></span></a><nav><ul><li><a href="/guides/">Guides</a></li><li><a href="/demos/">Demos</a></li><li><a href="/api/">API</a></li><li><a href="https://github.com/tinyplex/tinybase">GitHub</a></li></ul></nav><span id="dark"></span></header><main><nav><ul><li id="root" class="parent open"><span></span><a href="/">TinyBase</a><ul><li id="G" class="parent open"><span></span><a href="/guides/">Guides</a><ul><li id="TB" class="parent"><span></span><a href="/guides/the-basics/">The Basics</a></li><li id="BUI" class="parent"><span></span><a href="/guides/building-uis/">Building UIs</a></li><li id="SAP" class="parent open"><span></span><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a><ul><li id="US"><span></span><a href="/guides/schemas-and-persistence/using-schemas/">Using Schemas</a></li><li id="SBT"><span></span><a href="/guides/schemas-and-persistence/schema-based-typing/">Schema-Based Typing</a></li><li id="MDWL"><span></span><a href="/guides/schemas-and-persistence/mutating-data-with-listeners/">Mutating Data With Listeners</a></li><li id="PD"><span></span><a href="/guides/schemas-and-persistence/persisting-data/">Persisting Data</a></li><li id="CP"><span></span><a href="/guides/schemas-and-persistence/custom-persistence/">Custom Persistence</a></li><li id="DP" class="current"><span></span><a href="/guides/schemas-and-persistence/database-persistence/">Database Persistence</a></li><li id="SD"><span></span><a href="/guides/schemas-and-persistence/synchronizing-data/">Synchronizing Data</a></li></ul></li><li id="MAI" class="parent"><span></span><a href="/guides/metrics-and-indexes/">Metrics And Indexes</a></li><li id="RAC" class="parent"><span></span><a href="/guides/relationships-and-checkpoints/">Relationships And Checkpoints</a></li><li id="MQ" class="parent"><span></span><a href="/guides/making-queries/">Making Queries</a></li><li id="DT" class="parent"><span></span><a href="/guides/developer-tools/">Developer Tools</a></li><li id="HTBIB" class="parent"><span></span><a href="/guides/how-tinybase-is-built/">How TinyBase Is Built</a></li><li id="FAQ"><span></span><a href="/guides/faq/">FAQ</a></li><li id="R"><span></span><a href="/guides/releases/">Releases</a></li></ul></li><li id="D2" class="parent"><span></span><a href="/demos/">Demos</a></li><li id="api" class="parent"><span></span><a href="/api/">API</a></li></ul></li></ul></nav><article><nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/schemas-and-persistence/">Schemas And Persistence</a></li><li><a href="/guides/schemas-and-persistence/database-persistence/">Database Persistence</a></li></ul></nav><section class="s1" id="/guides/schemas-and-persistence/database-persistence/" data-id="DP"><h1>Database Persistence</h1><p>Since v4.0, there are various options for persisting <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data to and from SQLite databases, via a range of third-party modules.</p><p>There are currently eight SQLite-based persistence options:</p><div class="table"><table><thead><tr><th>Module</th><th>Function</th><th>Storage</th></tr></thead><tbody><tr><td><a href="/api/persister-sqlite3/"><code>persister-sqlite3</code></a></td><td><a href="/api/persister-sqlite3/functions/creation/createsqlite3persister/"><code>createSqlite3Persister</code></a></td><td>SQLite in Node, via <a href="https://github.com/TryGhost/node-sqlite3">sqlite3</a></td></tr><tr><td><a href="/api/persister-sqlite-wasm/"><code>persister-sqlite-wasm</code></a></td><td><a href="/api/persister-sqlite-wasm/functions/creation/createsqlitewasmpersister/"><code>createSqliteWasmPersister</code></a></td><td>SQLite in a browser, via <a href="https://github.com/tomayac/sqlite-wasm">sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-cr-sqlite-wasm/"><code>persister-cr-sqlite-wasm</code></a></td><td><a href="/api/persister-cr-sqlite-wasm/functions/creation/createcrsqlitewasmpersister/"><code>createCrSqliteWasmPersister</code></a></td><td>SQLite CRDTs, via <a href="https://github.com/vlcn-io/cr-sqlite">cr-sqlite-wasm</a></td></tr><tr><td><a href="/api/persister-expo-sqlite/"><code>persister-expo-sqlite</code></a></td><td><a href="/api/persister-expo-sqlite/functions/creation/createexposqlitepersister/"><code>createExpoSqlitePersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/expo/expo/tree/main/packages/expo-sqlite">expo-sqlite</a></td></tr><tr><td><a href="/api/persister-expo-sqlite-next/"><code>persister-expo-sqlite-next</code></a></td><td><a href="/api/persister-expo-sqlite-next/functions/creation/createexposqlitenextpersister/"><code>createExpoSqliteNextPersister</code></a></td><td>SQLite in React Native, via <a href="https://github.com/expo/expo/tree/main/packages/expo-sqlite">expo-sqlite/next</a></td></tr><tr><td><a href="/api/persister-electric-sql/"><code>persister-electric-sql</code></a></td><td><a href="/api/persister-electric-sql/functions/creation/createelectricsqlpersister/"><code>createElectricSqlPersister</code></a></td><td>Electric SQL, via <a href="https://github.com/electric-sql/electric">electric</a></td></tr><tr><td><a href="/api/persister-libsql/"><code>persister-libsql</code></a></td><td><a href="/api/persister-libsql/functions/creation/createlibsqlpersister/"><code>createLibSqlPersister</code></a></td><td>LibSQL for Turso, via <a href="https://github.com/tursodatabase/libsql-client-ts">libsql-client</a></td></tr><tr><td><a href="/api/persister-powersync/"><code>persister-powersync</code></a></td><td><a href="/api/persister-powersync/functions/creation/createpowersyncpersister/"><code>createPowerSyncPersister</code></a></td><td>PowerSync, via <a href="https://github.com/powersync-ja/powersync-js">powersync-sdk</a></td></tr></tbody></table></div><p>(Take a look at the <a href="https://github.com/tinyplex/vite-tinybase-ts-react-crsqlite">vite-tinybase-ts-react-crsqlite</a> template, for example, which demonstrates Vulcan&#x27;s cr-sqlite to provide persistence and synchronization via the third of these.)</p><p>Each creation function takes a database reference, and a <a href="/api/persisters/type-aliases/configuration/databasepersisterconfig/"><code>DatabasePersisterConfig</code></a> object to describe its configuration. There are two modes for persisting a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> with a database:</p><ul><li>A JSON serialization of the whole <a href="/api/store/interfaces/store/store/"><code>Store</code></a>, which is stored in a single row of a table (normally called <code>tinybase</code>) within the database. This is configured by providing a <a href="/api/persisters/type-aliases/configuration/dpcjson/"><code>DpcJson</code></a> object.</li><li>A tabular mapping of <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> to database table names (and vice-versa). <a href="/api/store/type-aliases/store/values/"><code>Values</code></a> are stored in a separate special table (normally called <code>tinybase_values</code>). This is configured by providing a <a href="/api/persisters/type-aliases/configuration/dpctabular/"><code>DpcTabular</code></a> object.</li></ul><p>Note that changes made to the database (outside of a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a>) are picked up immediately if they are made via the same connection or library that it is using. If the database is being changed by another client, the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> needs to poll for changes. Hence both configuration types also contain an <code>autoLoadIntervalSeconds</code> property which indicates how often it should do that. This defaults to 1 second.</p><h3 id="using-json-serialization">Using JSON Serialization</h3><p>To get started, we&#x27;ll use JSON serialization to save a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> to SQLite in the browser, via the <a href="https://github.com/tomayac/sqlite-wasm">sqlite-wasm</a> module.</p><p>Firstly, use the module to initiate a database. Here it will be created in memory, but typically you would use the origin private file system (OPFS) as a storage back-end.</p><pre><code><span class="keyword">const</span> sqlite3 <span class="operator">=</span> <span class="keyword">await</span> <span class="function">sqlite3InitModule</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">let</span> db <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">sqlite3<span class="punctuation">.</span>oo1<span class="punctuation">.</span>DB</span><span class="punctuation">(</span><span class="string">':memory:'</span><span class="punctuation">,</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Next create a simple <a href="/api/store/interfaces/store/store/"><code>Store</code></a> with a small amount of data:</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> itself is created with the createSqliteWasmPersister method. This requires a reference to the the <code>sqlite3</code> module itself and the database. We&#x27;re not providing any configuration so it will use JSON serialization into the default table (namely one called <code>tinybase</code>).</p><pre><code><span class="keyword">const</span> jsonPersister <span class="operator">=</span> <span class="function"><a href="/api/persister-sqlite-wasm/functions/creation/createsqlitewasmpersister/">createSqliteWasmPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> sqlite3<span class="punctuation">,</span> db<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Now we can use the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> to save data to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>. Of course you can also use the <a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/"><code>startAutoSave</code></a> method to make it automatic.</p><pre><code><span class="keyword">await</span> jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>And we can check the database to ensure the data has been stored:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM tinybase;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: '_', store: '[{"pets":{"fido":{"species":"dog"}}},{}]'}]</span>
</code></pre><p>If the data in the database is changed...</p><pre><code>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span>
  <span class="string">'UPDATE tinybase SET store = '</span> <span class="operator">+</span>
    <span class="template-string"><span class="template-punctuation">`</span><span class="string">'[{"pets":{"felix":{"species":"cat"}}},{}]' WHERE _id = '_';</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>...it can be picked up by loading it explicitly or with auto-loading:</p><pre><code><span class="keyword">await</span> jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {felix: {species: 'cat'}}}</span>

jsonPersister<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Please see the <a href="/api/persisters/type-aliases/configuration/dpcjson/"><code>DpcJson</code></a> documentation for more detail on configuring this type of persistence.</p><h3 id="using-tabular-mapping">Using Tabular Mapping</h3><p>More flexibly, you can map distinct <a href="/api/store/interfaces/store/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> to database tables and back again. This is likely a more suitable approach if you are binding <a href="/">TinyBase</a> to existing data.</p><p>To use this technique, you must provide a <a href="/api/persisters/type-aliases/configuration/databasepersisterconfig/"><code>DatabasePersisterConfig</code></a> object when you create the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a>, and specify how you would like <a href="/api/store/interfaces/store/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> (and <a href="/api/store/type-aliases/store/values/"><code>Values</code></a>) to correspond to tables in the database.</p><p>It is important to note that both the tabular mapping in (&#x27;save&#x27;) and out (&#x27;load&#x27;) of an underlying database are disabled by default. This is to ensure that if you pass in an existing populated database you don&#x27;t run the immediate risk of corrupting or losing all your data.</p><p>This configuration therefore takes a <code>tables</code> property object (with child <code>load</code> and <code>save</code> property objects) and a <code>values</code> property object. One of these at least is required for the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> to do anything!</p><p>Let&#x27;s demonstrate. We start by creating a new database and resetting the data in the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> to put into it:</p><pre><code>db <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">sqlite3<span class="punctuation">.</span>oo1<span class="punctuation">.</span>DB</span><span class="punctuation">(</span><span class="string">':memory:'</span><span class="punctuation">,</span> <span class="string">'c'</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span>
  <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">felix</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'cat'</span><span class="punctuation">}</span><span class="punctuation">,</span> <span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="literal-property">species</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">dog</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">price</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span> <span class="literal-property">cat</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">price</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The persister itself has a more complex configuration as described above:</p><pre><code><span class="keyword">const</span> tabularPersister <span class="operator">=</span> <span class="function"><a href="/api/persister-sqlite-wasm/functions/creation/createsqlitewasmpersister/">createSqliteWasmPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> sqlite3<span class="punctuation">,</span> db<span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">mode</span><span class="operator">:</span> <span class="string">'tabular'</span><span class="punctuation">,</span>
  <span class="literal-property">tables</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">save</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">species</span><span class="operator">:</span> <span class="string">'animal_species'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">load</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">animal_species</span><span class="operator">:</span> <span class="string">'species'</span><span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Notice how there is a symmetric mapping of <a href="/api/store/interfaces/store/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to database table and vice-versa. It is deliberate that this must be spelled out like this, so that your intent to connect to (or especially mutate) existing data is very explicit.</p><p>Again, we can save the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>...</p><pre><code><span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/save/">save</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>...and see the resulting data in the SQLite database:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM pets;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'felix', species: 'cat'}, {_id: 'fido', species: 'dog'}]</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="string">'SELECT * FROM animal_species;'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">rowMode</span><span class="operator">:</span> <span class="string">'object'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [{_id: 'dog', price: 5}, {_id: 'cat', price: 4}]</span>
</code></pre><p>And, as expected, making a change to the database and re-loading brings the changes back into the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>:</p><pre><code>db<span class="punctuation">.</span><span class="function">exec</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">INSERT INTO pets (_id, species) VALUES ('cujo', 'wolf')</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">await</span> tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/load/">load</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/gettable/">getTable</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {felix: {species: 'cat'}, fido: {species: 'dog'}, cujo: {species: 'wolf'}}</span>

tabularPersister<span class="punctuation">.</span><span class="function"><a href="/api/metrics/interfaces/metrics/metrics/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p><a href="/api/store/interfaces/store/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/values/"><code>Values</code></a> are saved into a separate table, normally called <code>tinybase_values</code>. See the <a href="/api/persisters/type-aliases/configuration/dpctabularvalues/"><code>DpcTabularValues</code></a> documentation for examples of how to use that.</p><h3 id="working-with-an-existing-database">Working With An Existing Database</h3><p>In theory, it&#x27;s possible to bind <a href="/">TinyBase</a> to a SQLite database that already exists. You will obviously want to list the tables of interest in the <code>load</code> section of the configuration.</p><p>Do be aware that <a href="/">TinyBase</a> is an in-memory data structure, and so you will not want to do this if your database tables are particularly large and complex.</p><p>Also be very careful when setting the <code>save</code> configuration, since it will mean that <a href="/">TinyBase</a> writes its version of the data back to the database (optionally removing empty columns). If there is data that does not survive the round trip (because of schema constraints or data typing), it will be lost.</p><p>The <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> maps a column in the database table to provide and store the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>&#x27;s <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a>. By default, this is a database column called <code>_id</code>, but you can set it to be something else, per table. It is required that this column is a primary or unique key in the database so that the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> knows how to update existing records.</p><p>So for example, imagine your existing database table looks like this, with the first column of each table being a primary key:</p><pre><code>&gt; SELECT * FROM the_pets_table;
+--------+---------+-------+
| pet_id | species | color |
+--------+---------+-------+
| fido   | dog     | brown |
| felix  | cat     | black |
+--------+---------+-------+

&gt; SELECT * FROM the_species_table;
+------------+-------+
| species_id | price |
+------------+-------+
| dog        | 5     |
| cat        | 4     |
+------------+-------+
</code></pre><p>For this, you may consider the following configuration for your <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a>:</p><pre><code><span class="keyword">const</span> <span class="literal-property">databasePersisterConfig</span><span class="operator">:</span> DatabasePersisterConfig <span class="operator">=</span> <span class="punctuation">{</span>
  <span class="literal-property">mode</span><span class="operator">:</span> <span class="string">'tabular'</span><span class="punctuation">,</span>
  <span class="literal-property">tables</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="literal-property">load</span><span class="operator">:</span> <span class="punctuation">{</span>
      <span class="literal-property">the_pets_table</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'pets'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'pet_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="literal-property">the_species_table</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'species_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="literal-property">save</span><span class="operator">:</span> <span class="punctuation">{</span>
      <span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'the_pets_table'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'pet_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="literal-property">species</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">tableId</span><span class="operator">:</span> <span class="string">'the_species_table'</span><span class="punctuation">,</span> <span class="literal-property">rowIdColumnName</span><span class="operator">:</span> <span class="string">'species_id'</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>This will load into a <a href="/api/store/interfaces/store/store/"><code>Store</code></a> (and save back again) with <a href="/api/store/type-aliases/store/tables/"><code>Tables</code></a> that look like this:</p><pre><code><span class="punctuation">{</span>
  <span class="property">"pets"</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="property">"fido"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"species"</span><span class="operator">:</span> <span class="string">"dog"</span><span class="punctuation">,</span> <span class="property">"color"</span><span class="operator">:</span> <span class="string">"brown"</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="property">"felix"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"species"</span><span class="operator">:</span> <span class="string">"cat"</span><span class="punctuation">,</span> <span class="property">"color"</span><span class="operator">:</span> <span class="string">"black"</span><span class="punctuation">}</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="property">"species"</span><span class="operator">:</span> <span class="punctuation">{</span>
    <span class="property">"dog"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"price"</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="property">"cat"</span><span class="operator">:</span> <span class="punctuation">{</span><span class="property">"price"</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><h3 id="summary">Summary</h3><p>With care, you can load and save <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data from and to a SQLite database in a variety of ways and via different modules. This is new in v4.0, so feedback on the functionality is welcomed!</p><p>Finally we move on to look at how to fully synchronize <a href="/">TinyBase</a> Stores using more complex CRDT frameworks, such as Yjs and Automerge, in the <a href="/guides/schemas-and-persistence/synchronizing-data/">Synchronizing Data</a> guide.</p></section></article><aside></aside></main><footer><nav><a id="tw" href="https://twitter.com/tinybasejs" target="_blank">Twitter</a><a id="fb" href="https://facebook.com/tinybasejs" target="_blank">Facebook</a></nav><nav><a href="/">TinyBase 5.0.0-beta.5</a> © 2021- All Rights Reserved</nav></footer></body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ"></script><script>window.dataLayer=window.dataLayer||[];function g(){dataLayer.push(arguments);}g('js',new Date());g('config','G-D1MGR8VRWJ');</script></html>