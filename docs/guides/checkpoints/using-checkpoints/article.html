<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/checkpoints/">Checkpoints</a></li><li><a href="/guides/checkpoints/using-checkpoints/">Using Checkpoints</a></li></ul></nav><section class="s1" id="/guides/checkpoints/using-checkpoints/" data-id="UC3"><h1>Using Checkpoints</h1><p>This guide describes how the checkpoints module gives you the ability to create and track changes to a Store&#x27;s data for the purposes of undo and redo functionality.</p><p>The main entry point to using the checkpoints module is the createCheckpoints function, which returns a new <a href="/guides/checkpoints/">Checkpoints</a> object. That object in turn has methods that let you set checkpoints, move between them (altering the underlying Store accordingly), and register listeners for when they change.</p><p><a href="/guides/checkpoints/">Checkpoints</a> let you undo and redo both keyed value and tabular data changes.</p><h3 id="the-basics"><a href="/guides/the-basics/">The Basics</a></h3><p>Here&#x27;s a simple example to show a <a href="/guides/checkpoints/">Checkpoints</a> object in action. The <code>fido</code> Row starts off with the <code>sold</code> Cell set to <code>false</code>. We set a checkpoint when this field changes, and which then allows us to return later to that initial state.</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createCheckpoints<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>

<span class="keyword">const</span> store <span class="operator">=</span> <span class="function">createStore</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">setTables</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">sold</span><span class="operator">:</span> <span class="boolean">false</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> checkpoints <span class="operator">=</span> <span class="function">createCheckpoints</span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>checkpoints<span class="punctuation">.</span><span class="function">getCheckpointIds</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [[], '0', []]</span>

store<span class="punctuation">.</span><span class="function">setCell</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
checkpoints<span class="punctuation">.</span><span class="function">addCheckpoint</span><span class="punctuation">(</span><span class="string">'sale'</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>checkpoints<span class="punctuation">.</span><span class="function">getCheckpointIds</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [['0'], '1', []]</span>

checkpoints<span class="punctuation">.</span><span class="function">goBackward</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function">getCell</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> false</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>checkpoints<span class="punctuation">.</span><span class="function">getCheckpointIds</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [[], '0', ['1']]</span>
</code></pre><p>The getCheckpointIds method deserves a quick explanation. It returns a CheckpointIds array which has three parts:</p><ul><li>The &#x27;backward&#x27; checkpoint Ids that can be rolled backward to (in other words, the checkpoints in the undo stack for this Store). They are in chronological order with the oldest checkpoint at the start of the array.</li><li>The current checkpoint Id of the Store&#x27;s state, or <code>undefined</code> if the current state has not been checkpointed.</li><li>The &#x27;forward&#x27; checkpoint Ids that can be rolled forward to (in other words, the checkpoints in the redo stack for this Store). They are in chronological order with the newest checkpoint at the end of the array.</li></ul><p>The goBackward method is only one of the ways to move around the checkpoint stack. The goForward method lets you redo changes, and the goTo method lets you skip multiple checkpoints to undo or redo many changes at once.</p><h3 id="checkpoint-reactivity">Checkpoint Reactivity</h3><p>As with Metrics, Indexes, and <a href="/guides/relationships/">Relationships</a> objects, you can add a listener to the <a href="/guides/checkpoints/">Checkpoints</a> object for whenever the checkpoint stack changes:</p><pre><code><span class="keyword">const</span> listenerId <span class="operator">=</span> checkpoints<span class="punctuation">.</span><span class="function">addCheckpointIdsListener</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>checkpoints<span class="punctuation">.</span><span class="function">getCheckpointIds</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function">setCell</span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'dog'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [['0'], undefined, []]</span>
checkpoints<span class="punctuation">.</span><span class="function">addCheckpoint</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [['0'], '2', []]</span>

checkpoints<span class="punctuation">.</span><span class="function">delListener</span><span class="punctuation">(</span>listenerId<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Also note that when a new change is layered onto the original state, the previous redo of checkpoint &#x27;1&#x27; is now not available.</p><p>A given Store can only have one <a href="/guides/checkpoints/">Checkpoints</a> object associated with it. If you call this function twice on the same Store, your second call will return a reference to the <a href="/guides/checkpoints/">Checkpoints</a> object created by the first.</p><p>Finally, let&#x27;s find out how to include checkpoints in a user interface in the <a href="/guides/checkpoints/building-a-ui-with-checkpoints/">Building A UI With Checkpoints</a> guide.</p></section>