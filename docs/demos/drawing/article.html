<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/drawing/">Drawing</a></li></ul></nav><section class="s1" id="/demos/drawing/" data-id="D3"><h1>Drawing</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script src=&quot;/umd/react.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/persisters/persister-browser/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react-inspector/index.js&quot;&gt;&lt;/script&gt;&lt;style&gt;@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}*{box-sizing:border-box;outline-color:#d81b60}body{user-select:none;display:grid;grid-template-rows:auto 1fr;grid-template-columns:1fr 10rem;font-family:Inter,sans-serif;letter-spacing:-.04rem;font-size:.8rem;margin:0;height:100vh}body #toolbar{z-index:2;grid-column:span 2;background:#ddd;display:flex;align-items:center;border-bottom:1px solid #aaa}body #toolbar&gt;.button{cursor:pointer;line-height:1rem;white-space:nowrap;border-right:1px solid #aaa;padding:.5rem}body #toolbar&gt;.button:hover{background:#ccc}body #toolbar&gt;.button::before{vertical-align:top;width:1rem;height:1rem;display:inline-block}body #toolbar&gt;.button.undo::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;path fill=&quot;none&quot; d=&quot;M25 50a42 42 0 0 1 60 0&quot; /&gt;&lt;path d=&quot;M14 41v20 h20z&quot; /&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.redo::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;path fill=&quot;none&quot; d=&quot;M15 50a42 42 0 0 1 60 0&quot; /&gt;&lt;path d=&quot;M86 41v20 h-20z&quot; /&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.add::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;20&quot; y=&quot;20&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;path d=&quot;M50 30v40M30 50h40&quot; /&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.front::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;2&quot; y=&quot;2&quot; width=&quot;40&quot; height=&quot;40&quot; fill=&quot;grey&quot;/&gt;&lt;rect x=&quot;58&quot; y=&quot;58&quot; width=&quot;40&quot; height=&quot;40&quot; fill=&quot;grey&quot;/&gt;&lt;rect x=&quot;20&quot; y=&quot;20&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.forward::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;11&quot; y=&quot;11&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;grey&quot;/&gt;&lt;rect x=&quot;29&quot; y=&quot;29&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.backward::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;11&quot; y=&quot;11&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;rect x=&quot;29&quot; y=&quot;29&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;grey&quot;/&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.back::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;20&quot; y=&quot;20&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;rect x=&quot;2&quot; y=&quot;2&quot; width=&quot;40&quot; height=&quot;40&quot; fill=&quot;grey&quot;/&gt;&lt;rect x=&quot;58&quot; y=&quot;58&quot; width=&quot;40&quot; height=&quot;40&quot; fill=&quot;grey&quot;/&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.delete::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; stroke-width=&quot;4&quot; stroke=&quot;black&quot;&gt;&lt;rect x=&quot;20&quot; y=&quot;20&quot; width=&quot;60&quot; height=&quot;60&quot; fill=&quot;white&quot;/&gt;&lt;path d=&quot;M30 30l40 40M30 70l40-40&quot; /&gt;&lt;/svg&gt;&#x27;)}body #toolbar&gt;.button.disabled{opacity:.5;cursor:default}body #toolbar&gt;.button.disabled:hover{background:0 0}body #sidebar{z-index:1;background:#eee;padding:.5rem;border-left:1px solid #aaa}body #sidebar .cell{height:2rem;text-align:right}body #sidebar .cell .spin,body #sidebar .cell input,body #sidebar .cell select{font:inherit;letter-spacing:-.05rem;margin-left:5px;width:4.5rem;height:1.4rem;display:inline-flex;justify-content:space-between;align-items:center}body #sidebar .cell .spin .button,body #sidebar .cell input .button,body #sidebar .cell select .button{cursor:pointer;border:1px solid #aaa;font:inherit;width:1rem;text-align:center}body #sidebar .cell .spin .button:hover,body #sidebar .cell input .button:hover,body #sidebar .cell select .button:hover{background:#ccc}body #canvas{position:relative;z-index:0}body #canvas .shape{align-items:center;background:#fff;border:1px solid #000;box-sizing:border-box;display:flex;justify-content:center;position:absolute;overflow:hidden;white-space:nowrap;z-index:1}body #canvas .shape.ellipse{border-radius:50%}body #canvas .shape.selected{cursor:move}body #canvas .shape input,body #canvas .shape span{background:0 0;border:none;font:inherit;width:100%;text-align:center;margin:.5rem;text-overflow:ellipsis;overflow:hidden}body #canvas .grip{background:#fff;border:1px solid #d81b60;box-sizing:border-box;height:6px;margin:-3px;position:absolute;width:6px;z-index:2}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script type=&quot;module&quot;&gt;const{createElement:s}=React,{createCheckpoints:oe,createRelationships:se,createStore:le}=TinyBase,{LinkedRowsView:ce,Provider:ae,useAddRowCallback:re,useCell:_,useCreateCheckpoints:de,useCreatePersister:ue,useCreateRelationships:ie,useCreateStore:pe,useLinkedRowIds:V,useLocalRowIds:M,useRedoInformation:xe,useRemoteRowId:$,useRow:H,useRowListener:he,useSetCellCallback:D,useSetCheckpointCallback:w,useSetPartialRowCallback:W,useStore:L,useUndoInformation:Ce}=TinyBaseUiReact,{createContext:ye,useCallback:C,useContext:me,useEffect:O,useLayoutEffect:fe,useRef:Y,useState:E}=React,{createLocalPersister:be}=TinyBasePersisterBrowser,{Inspector:Ie}=TinyBaseUiReactInspector,j=(e,t,o=null,n=null)=&gt;{const[l,r]=E(),u=C(a=&gt;{o?.(),r({x:a.clientX,y:a.clientY,initial:e()}),a.stopPropagation()},[e,o]),x=C(a=&gt;{l!=null&amp;&amp;t({dx:a.clientX-l.x,dy:a.clientY-l.y,initial:l.initial}),a.stopPropagation()},[t,l]),y=C(a=&gt;{r(null),n?.(),a.stopPropagation()},[n]),m=Y(null);return fe(()=&gt;{const{current:a}=m;return a.addEventListener(&quot;mousedown&quot;,u),()=&gt;a.removeEventListener(&quot;mousedown&quot;,u)},[m,u]),O(()=&gt;{if(l!=null)return addEventListener(&quot;mousemove&quot;,x),addEventListener(&quot;mouseup&quot;,y),()=&gt;{removeEventListener(&quot;mousemove&quot;,x),removeEventListener(&quot;mouseup&quot;,y)}},[l,x,y]),m},c=&quot;shapes&quot;,S=&quot;0&quot;,ke=50,we=30,X=[&quot;rectangle&quot;,&quot;ellipse&quot;],ge=(e,t,o,n,l)=&gt;{l!=null&amp;&amp;!X.includes(l)&amp;&amp;e.setCell(t,o,n,X[0])},q=(e,t,o,n,l)=&gt;{l!=null&amp;&amp;!/^#[a-f\d]{6}$/.test(l)&amp;&amp;e.setCell(t,o,n,&quot;#000000&quot;)},J=ye([null,()=&gt;{}]),b=()=&gt;me(J),ve=()=&gt;{const e=pe(()=&gt;{const n=le().setTablesSchema({[c]:{x1:{type:&quot;number&quot;,default:100},y1:{type:&quot;number&quot;,default:100},x2:{type:&quot;number&quot;,default:300},y2:{type:&quot;number&quot;,default:200},text:{type:&quot;string&quot;,default:&quot;text&quot;},type:{type:&quot;string&quot;},backColor:{type:&quot;string&quot;,default:&quot;#0077aa&quot;},textColor:{type:&quot;string&quot;,default:&quot;#ffffff&quot;},nextId:{type:&quot;string&quot;}}});return n.addCellListener(c,null,&quot;type&quot;,ge,!0),n.addCellListener(c,null,&quot;backColor&quot;,q,!0),n.addCellListener(c,null,&quot;textColor&quot;,q,!0),n},[]),t=de(e,oe);ue(e,n=&gt;be(n,&quot;drawing/store&quot;),[],async n=&gt;{await n.startAutoLoad([{shapes:{[S]:{x1:0,y1:0,nextId:&quot;1&quot;,text:&quot;[canvas]&quot;},1:{}}}]),t?.clear(),await n.startAutoSave()},[t]);const o=ie(e,n=&gt;se(n).setRelationshipDefinition(&quot;order&quot;,c,c,&quot;nextId&quot;));return s(ae,{store:e,relationships:o,checkpoints:t},s(J.Provider,{value:E()},s(Re,null),s(Te,null),s($e,null)),s(Ie,null))};addEventListener(&quot;load&quot;,()=&gt;ReactDOM.createRoot(document.body).render(s(ve,null)));const Re=()=&gt;{const[e]=b();return s(&quot;div&quot;,{id:&quot;toolbar&quot;},s(Se,null),s(De,null),e==null?null:s(React.Fragment,null,s(Le,null),s(Me,null)))},Se=()=&gt;{const[e,t,,o]=Ce(),[n,l,,r]=xe();return s(React.Fragment,null,s(&quot;div&quot;,{className:`button undo${e?&quot;&quot;:&quot; disabled&quot;}`,...e?{onClick:t,title:`Undo ${o}`}:{}}),s(&quot;div&quot;,{className:`button redo${n?&quot;&quot;:&quot; disabled&quot;}`,...n?{onClick:l,title:`Redo ${r}`}:{}}))},De=()=&gt;{const e=Z(),[,t]=b(),o=w(()=&gt;&quot;add shape&quot;,[]),n=C((r,u)=&gt;{u.setCell(c,e,&quot;nextId&quot;,r),t(r),o()},[e,t,o]),l=re(c,()=&gt;({}),[],null,n,[n]);return s(&quot;div&quot;,{className:&quot;button add&quot;,onClick:l},&quot;Add shape&quot;)},Q=()=&gt;V(&quot;order&quot;,S)[1],Z=()=&gt;V(&quot;order&quot;,S).slice(-1)[0],Le=()=&gt;{const[e]=b(),t=Z(),o=$(&quot;order&quot;,e),[n]=M(&quot;order&quot;,e),[l]=M(&quot;order&quot;,n),r=Q();return[[&quot;front&quot;,&quot;To front&quot;,t,T(t,&quot;to front&quot;)],[&quot;forward&quot;,&quot;Forward&quot;,t,T(o,&quot;forward&quot;)],[&quot;backward&quot;,&quot;Backward&quot;,r,T(l,&quot;backward&quot;)],[&quot;back&quot;,&quot;To back&quot;,r,T(S,&quot;to back&quot;)]].map(([u,x,y,m])=&gt;{const a=e==null||e==y;return s(&quot;div&quot;,{className:`button ${u} ${a?&quot; disabled&quot;:&quot;&quot;}`,onClick:a?null:m,key:u},x)})},T=(e,t)=&gt;{const o=L(),[n]=b(),[l]=M(&quot;order&quot;,n),r=$(&quot;order&quot;,n),u=$(&quot;order&quot;,e),x=w(()=&gt;`move ${t}`,[]);return C(()=&gt;{o.transaction(()=&gt;{r!=null?o.setCell(c,l,&quot;nextId&quot;,r):o.delCell(c,l,&quot;nextId&quot;),u!=null?o.setCell(c,n,&quot;nextId&quot;,u):o.delCell(c,n,&quot;nextId&quot;),o.setCell(c,e,&quot;nextId&quot;,n)}),x()},[n,e,o,l,r,u,x])},Me=()=&gt;{const e=L(),[t,o]=b(),[n]=M(&quot;order&quot;,t),l=$(&quot;order&quot;,t),r=w(()=&gt;&quot;delete&quot;,[]),u=C(()=&gt;{e.transaction(()=&gt;{l==null?e.delCell(c,n,&quot;nextId&quot;):e.setCell(c,n,&quot;nextId&quot;,l),e.delRow(c,t)}),r(),o()},[e,t,o,n,l,r]);return s(&quot;div&quot;,{className:&quot;button delete&quot;,onClick:u},&quot;Delete&quot;)},$e=()=&gt;{const[e]=b();return s(&quot;div&quot;,{id:&quot;sidebar&quot;},e==null?null:s(React.Fragment,null,s(Ee,null),s(ee,{label:&quot;Text&quot;,cellId:&quot;textColor&quot;}),s(ee,{label:&quot;Back&quot;,cellId:&quot;backColor&quot;}),s(N,{label:&quot;Left&quot;,cellId:&quot;x1&quot;}),s(N,{label:&quot;Top&quot;,cellId:&quot;y1&quot;}),s(N,{label:&quot;Right&quot;,cellId:&quot;x2&quot;}),s(N,{label:&quot;Bottom&quot;,cellId:&quot;y2&quot;})))},z=({label:e,children:t})=&gt;s(&quot;div&quot;,{className:&quot;cell&quot;},e,&quot;: &quot;,t),Ee=()=&gt;{const[e]=b(),t=w(()=&gt;&quot;change of type&quot;,[]);return s(z,{label:&quot;Shape&quot;},s(&quot;select&quot;,{value:_(c,e,&quot;type&quot;),onChange:D(c,e,&quot;type&quot;,o=&gt;o.target.value,[],null,t)},X.map(o=&gt;s(&quot;option&quot;,{key:o},o))))},ee=({label:e,cellId:t})=&gt;{const[o]=b(),n=w(()=&gt;`change of &#x27;${e.toLowerCase()}&#x27; color`,[e]);return s(z,{label:e},s(&quot;input&quot;,{type:&quot;color&quot;,value:_(c,o,t),onChange:D(c,o,t,l=&gt;l.target.value,[],null,n)}))},te=e=&gt;e+1,ne=e=&gt;e-1,N=({label:e,cellId:t})=&gt;{const[o]=b(),n=w(()=&gt;`nudge of &#x27;${e.toLowerCase()}&#x27; value`,[e]),l=D(c,o,t,()=&gt;ne,[ne],null,n),r=D(c,o,t,()=&gt;te,[te],null,n);return s(z,{label:e},s(&quot;div&quot;,{className:&quot;spin&quot;},s(&quot;div&quot;,{className:&quot;button&quot;,onClick:l},&quot;-&quot;),_(c,o,t),s(&quot;div&quot;,{className:&quot;button&quot;,onClick:r},&quot;+&quot;)),&quot; &quot;)},Te=()=&gt;{const e=Y(null),t=L(),[o,n]=E([0,0]),l=C((a,i,d)=&gt;{const{x1:p,x2:h,y1:f,y2:I}=t.getRow(c,a),k=Math.max(h-p,Math.min(ke,i)),v=Math.max(I-f,Math.min(we,d));return{x1:p,x2:h,y1:f,y2:I,w:k,h:v}},[t]);he(c,null,(a,i,d,p)=&gt;{const[h,f]=o;if(h==0||f==0)return;const[I]=p(c,d,&quot;x1&quot;),[k]=p(c,d,&quot;x2&quot;),[v]=p(c,d,&quot;y1&quot;),[R]=p(c,d,&quot;y2&quot;);if((I||k||v||R)&amp;&amp;d!=S){const{x1:A,x2:B,y1:U,y2:F,w:G,h:K}=l(d,h,f);I&amp;&amp;A!=null&amp;&amp;a.setCell(c,d,&quot;x1&quot;,P(A,0,Math.min(B,h)-G)),k&amp;&amp;B!=null&amp;&amp;a.setCell(c,d,&quot;x2&quot;,P(B,Math.max(A,0)+G,h)),v&amp;&amp;U!=null&amp;&amp;a.setCell(c,d,&quot;y1&quot;,P(U,0,Math.min(F,f)-K)),R&amp;&amp;F!=null&amp;&amp;a.setCell(c,d,&quot;y2&quot;,P(F,Math.max(U,0)+K,f))}},[...o,l],!0);const r=C(a=&gt;{const{clientWidth:i,clientHeight:d}=a;n([i,d]),t.forEachRow(c,p=&gt;{if(p!=S){const{x2:h,y2:f,w:I,h:k}=l(p,i,d);h&gt;i&amp;&amp;t.setPartialRow(c,p,{x1:Math.max(0,i-I),x2:i}),f&gt;d&amp;&amp;t.setPartialRow(c,p,{y1:Math.max(0,d-k),y2:d})}})},[t,l]);O(()=&gt;{const{current:a}=e,i=new ResizeObserver(()=&gt;r(a));return i.observe(a),r(a),()=&gt;i.disconnect()},[e,t,r]);const[,u]=b(),x=C(a=&gt;({id:a}),[]),y=C(()=&gt;u(),[u]),m=Q();return s(&quot;div&quot;,{id:&quot;canvas&quot;,onMouseDown:y,ref:e},m==null?null:s(ce,{relationshipId:&quot;order&quot;,firstRowId:m,rowComponent:Ne,getRowComponentProps:x}))},P=(e,t,o)=&gt;e&lt;t?t:e&gt;o?o:e,Ne=({id:e})=&gt;{const[t,o]=b(),n=e==t,{x1:l,y1:r,x2:u,y2:x,backColor:y,type:m}=H(c,e),a=L(),i=C(()=&gt;a.getRow(c,e),[a,e]),d=W(c,e,({dx:k,dy:v,initial:R})=&gt;({x1:R.x1+k,y1:R.y1+v,x2:R.x2+k,y2:R.y2+v}),[]),p=C(()=&gt;o(e),[o,e]),h=w(()=&gt;&quot;drag&quot;,[]),f=j(i,d,p,h),I={left:`${l}px`,top:`${r}px`,width:`${u-l}px`,height:`${x-r}px`,background:y};return s(React.Fragment,null,s(&quot;div&quot;,{ref:f,className:`shape ${m}${n?&quot; selected&quot;:&quot;&quot;}`,style:I},s(Pe,{id:e})),n?s(Ae,{id:e}):null)},Pe=({id:e})=&gt;{const{text:t,textColor:o}=H(c,e),n=Y(),[l,r]=E(!1),u=w(()=&gt;&quot;edit text&quot;,[]),x=C(()=&gt;r(!0),[]),y=C(()=&gt;{r(!1),u()},[u]),m=D(c,e,&quot;text&quot;,d=&gt;d.target.value,[]),a=C(d=&gt;{d.which==13&amp;&amp;d.target.blur()},[]);O(()=&gt;{l&amp;&amp;n.current.focus()},[l,n]);const i={color:o};return l?s(&quot;input&quot;,{ref:n,style:i,value:t,onChange:m,onKeyDown:a,onBlur:y}):s(&quot;span&quot;,{style:i,onDoubleClick:x},t!=&quot;&quot;?t:&quot;\xA0&quot;)},Ae=({id:e})=&gt;{const{x1:t,y1:o,x2:n,y2:l}=H(c,e),r=(t+n)/2,u=(o+l)/2;return s(React.Fragment,null,s(g,{m:[1,1,0,0],id:e,x:t,y:o,d:&quot;nwse&quot;}),s(g,{m:[0,1,0,0],id:e,x:r,y:o,d:&quot;ns&quot;}),s(g,{m:[0,1,1,0],id:e,x:n,y:o,d:&quot;nesw&quot;}),s(g,{m:[0,0,1,0],id:e,x:n,y:u,d:&quot;ew&quot;}),s(g,{m:[0,0,1,1],id:e,x:n,y:l,d:&quot;nwse&quot;}),s(g,{m:[0,0,0,1],id:e,x:r,y:l,d:&quot;ns&quot;}),s(g,{m:[1,0,0,1],id:e,x:t,y:l,d:&quot;nesw&quot;}),s(g,{m:[1,0,0,0],id:e,x:t,y:u,d:&quot;ew&quot;}))},g=({m:[e,t,o,n],id:l,x:r,y:u,d:x})=&gt;{const y=L(),m=C(()=&gt;y.getRow(c,l),[y,l]),a=W(c,l,({dx:d,dy:p,initial:h})=&gt;({x1:h.x1+d*e,y1:h.y1+p*t,x2:h.x2+d*o,y2:h.y2+p*n}),[e,t,o,n]),i=w(()=&gt;&quot;resize&quot;,[]);return s(&quot;div&quot;,{ref:j(m,a,null,i),className:&quot;grip&quot;,style:{left:`${r}px`,top:`${u}px`,cursor:`${x}-resize`}})};&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this demo, we build a more complex drawing app, using many of the features of TinyBase together.</p><p>Note that this demo does not work particularly well on mobile devices, given its use of drag and drop. Preferably try it out on a desktop browser.</p><h3 id="boilerplate">Boilerplate</h3><p>First, we pull in React, ReactDOM, and TinyBase:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/react.production.min.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/react-dom.production.min.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/persisters/persister-browser/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/ui-react/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/ui-react-inspector/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</code></pre><p>We&#x27;ll use a good selection of the TinyBase API and the <a href="/api/ui-react/"><code>ui-react</code></a> module:</p><pre><code><span class="keyword">const</span> <span class="punctuation">{</span>createCheckpoints<span class="punctuation">,</span> createRelationships<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>
  LinkedRowsView<span class="punctuation">,</span>
  Provider<span class="punctuation">,</span>
  useAddRowCallback<span class="punctuation">,</span>
  useCell<span class="punctuation">,</span>
  useCreateCheckpoints<span class="punctuation">,</span>
  useCreatePersister<span class="punctuation">,</span>
  useCreateRelationships<span class="punctuation">,</span>
  useCreateStore<span class="punctuation">,</span>
  useLinkedRowIds<span class="punctuation">,</span>
  useLocalRowIds<span class="punctuation">,</span>
  useRedoInformation<span class="punctuation">,</span>
  useRemoteRowId<span class="punctuation">,</span>
  useRow<span class="punctuation">,</span>
  useRowListener<span class="punctuation">,</span>
  useSetCellCallback<span class="punctuation">,</span>
  useSetCheckpointCallback<span class="punctuation">,</span>
  useSetPartialRowCallback<span class="punctuation">,</span>
  useStore<span class="punctuation">,</span>
  useUndoInformation<span class="punctuation">,</span>
<span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReact<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>
  createContext<span class="punctuation">,</span>
  useCallback<span class="punctuation">,</span>
  useContext<span class="punctuation">,</span>
  useEffect<span class="punctuation">,</span>
  useLayoutEffect<span class="punctuation">,</span>
  useRef<span class="punctuation">,</span>
  useState<span class="punctuation">,</span>
<span class="punctuation">}</span> <span class="operator">=</span> React<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>createLocalPersister<span class="punctuation">}</span> <span class="operator">=</span> TinyBasePersisterBrowser<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>Inspector<span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReactInspector<span class="punctuation">;</span>
</code></pre><p>The drawing app relies heavily on being able to drag and drop shapes and their resizing handles. We&#x27;ll create a React hook called <code>useDraggableObject</code> that returns a <code>ref</code> that can be used to attach this behavior to component. Nothing about this is TinyBase-specific, so let&#x27;s get it out of the way first.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useDraggableObject</span> <span class="operator">=</span> <span class="punctuation">(</span>
  <span class="parameter">getInitial<span class="punctuation">,</span>
  onDrag<span class="punctuation">,</span>
  onDragStart <span class="operator">=</span> <span class="keyword">null</span><span class="punctuation">,</span>
  onDragStop <span class="operator">=</span> <span class="keyword">null</span><span class="punctuation">,</span></span>
<span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>start<span class="punctuation">,</span> setStart<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> handleMouseDown <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">event</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      onDragStart<span class="operator">?.</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="function">setStart</span><span class="punctuation">(</span><span class="punctuation">{</span>
        <span class="literal-property">x</span><span class="operator">:</span> event<span class="punctuation">.</span>clientX<span class="punctuation">,</span>
        <span class="literal-property">y</span><span class="operator">:</span> event<span class="punctuation">.</span>clientY<span class="punctuation">,</span>
        <span class="literal-property">initial</span><span class="operator">:</span> <span class="function">getInitial</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
      event<span class="punctuation">.</span><span class="function">stopPropagation</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>getInitial<span class="punctuation">,</span> onDragStart<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleMouseMove <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">event</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>start <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="function">onDrag</span><span class="punctuation">(</span><span class="punctuation">{</span>
          <span class="literal-property">dx</span><span class="operator">:</span> event<span class="punctuation">.</span>clientX <span class="operator">-</span> start<span class="punctuation">.</span>x<span class="punctuation">,</span>
          <span class="literal-property">dy</span><span class="operator">:</span> event<span class="punctuation">.</span>clientY <span class="operator">-</span> start<span class="punctuation">.</span>y<span class="punctuation">,</span>
          <span class="literal-property">initial</span><span class="operator">:</span> start<span class="punctuation">.</span>initial<span class="punctuation">,</span>
        <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      event<span class="punctuation">.</span><span class="function">stopPropagation</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>onDrag<span class="punctuation">,</span> start<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleMouseUp <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">event</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="function">setStart</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">)</span><span class="punctuation">;</span>
      onDragStop<span class="operator">?.</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
      event<span class="punctuation">.</span><span class="function">stopPropagation</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>onDragStop<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useRef</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useLayoutEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> <span class="punctuation">{</span>current<span class="punctuation">}</span> <span class="operator">=</span> ref<span class="punctuation">;</span>
    current<span class="punctuation">.</span><span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'mousedown'</span><span class="punctuation">,</span> handleMouseDown<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> current<span class="punctuation">.</span><span class="function">removeEventListener</span><span class="punctuation">(</span><span class="string">'mousedown'</span><span class="punctuation">,</span> handleMouseDown<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>ref<span class="punctuation">,</span> handleMouseDown<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>start <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
      <span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'mousemove'</span><span class="punctuation">,</span> handleMouseMove<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'mouseup'</span><span class="punctuation">,</span> handleMouseUp<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">return</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        <span class="function">removeEventListener</span><span class="punctuation">(</span><span class="string">'mousemove'</span><span class="punctuation">,</span> handleMouseMove<span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="function">removeEventListener</span><span class="punctuation">(</span><span class="string">'mouseup'</span><span class="punctuation">,</span> handleMouseUp<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>start<span class="punctuation">,</span> handleMouseMove<span class="punctuation">,</span> handleMouseUp<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> ref<span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><h3 id="initialization">Initialization</h3><p>We have a selection of constants we will use throughout the app. The shapes will live in a TinyBase table called <code>shapes</code>, the background canvas itself will always be shape <code>0</code>, and shapes have a minimum size and one of two valid types:</p><pre><code><span class="keyword">const</span> <span class="constant">SHAPES</span> <span class="operator">=</span> <span class="string">'shapes'</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">CANVAS_ID</span> <span class="operator">=</span> <span class="string">'0'</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">MIN_WIDTH</span> <span class="operator">=</span> <span class="number">50</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">MIN_HEIGHT</span> <span class="operator">=</span> <span class="number">30</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">TYPES</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="string">'rectangle'</span><span class="punctuation">,</span> <span class="string">'ellipse'</span><span class="punctuation">]</span><span class="punctuation">;</span>
</code></pre><p>We will use mutator listeners to ensure that the type and color of the shapes are always valid if present. These are the two functions to do that:</p><pre><code><span class="keyword">const</span> <span class="function-variable">constrainType</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">store<span class="punctuation">,</span> tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> type</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>type <span class="operator">!=</span> <span class="keyword">null</span> <span class="operator">&amp;&amp;</span> <span class="operator">!</span><span class="constant">TYPES</span><span class="punctuation">.</span><span class="function">includes</span><span class="punctuation">(</span>type<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> <span class="constant">TYPES</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="function-variable">constrainColor</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">store<span class="punctuation">,</span> tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> color</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">if</span> <span class="punctuation">(</span>color <span class="operator">!=</span> <span class="keyword">null</span> <span class="operator">&amp;&amp;</span> <span class="operator">!</span><span class="regex"><span class="regex-delimiter">/</span><span class="regex-source">^#[a-f\d]{6}$</span><span class="regex-delimiter">/</span></span><span class="punctuation">.</span><span class="function">test</span><span class="punctuation">(</span>color<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> <span class="string">'#000000'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>At any given time, either a single shape is selected, or none are. We will set a context for the whole app that will provide the <code>useState</code> value and setter pair for the selected <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> across the whole app:</p><pre><code><span class="keyword">const</span> SelectedIdContext <span class="operator">=</span> <span class="function">createContext</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="keyword">null</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="function-variable">useSelectedIdState</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">useContext</span><span class="punctuation">(</span>SelectedIdContext<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>As for the application itself, we start off by initializing the store in the <a href="/api/ui-react/functions/store-hooks/usecreatestore/"><code>useCreateStore</code></a> hook (so that it is memoized across renders), and immediately set its schema. Every shape has two pairs of coordinates, text, a type, colors, and a reference to the &#x27;next&#x27; shape so they can be ordered in the z-index with a linked list. We also use the two mutator listeners to programmatically guarantee that types and colors are valid:</p><pre><code><span class="keyword">const</span> <span class="function-variable">App</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settablesschema/">setTablesSchema</a></span><span class="punctuation">(</span><span class="punctuation">{</span>
      <span class="punctuation">[</span><span class="constant">SHAPES</span><span class="punctuation">]</span><span class="operator">:</span> <span class="punctuation">{</span>
        <span class="literal-property">x1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'number'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="number">100</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">y1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'number'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="number">100</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">x2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'number'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="number">300</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">y2</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'number'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="number">200</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">text</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="string">'text'</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">type</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">backColor</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="string">'#0077aa'</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">textColor</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="string">'#ffffff'</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="literal-property">nextId</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/listener/addcelllistener/">addCellListener</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">'type'</span><span class="punctuation">,</span> constrainType<span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/listener/addcelllistener/">addCellListener</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">'backColor'</span><span class="punctuation">,</span> constrainColor<span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/listener/addcelllistener/">addCellListener</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">'textColor'</span><span class="punctuation">,</span> constrainColor<span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> store<span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>We want an undo stack, so we create a <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> objects for this store, again memoized with the <a href="/api/ui-react/functions/checkpoints-hooks/usecreatecheckpoints/"><code>useCreateCheckpoints</code></a> hook. We also persist the shapes data to local browser storage, and default it to a single shape on the canvas (which is the start of the linked list of all the shapes, modelled with the <a href="/api/relationships/interfaces/relationships/relationships/"><code>Relationships</code></a> object):</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> checkpoints <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usecreatecheckpoints/">useCreateCheckpoints</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> createCheckpoints<span class="punctuation">)</span><span class="punctuation">;</span>

<span class="function"><a href="/api/ui-react/functions/persister-hooks/usecreatepersister/">useCreatePersister</a></span><span class="punctuation">(</span>
  store<span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createlocalpersister/">createLocalPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'drawing/store'</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">persister</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">[</span>
      <span class="punctuation">{</span>
        <span class="literal-property">shapes</span><span class="operator">:</span> <span class="punctuation">{</span>
          <span class="punctuation">[</span><span class="constant">CANVAS_ID</span><span class="punctuation">]</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">x1</span><span class="operator">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="literal-property">y1</span><span class="operator">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="literal-property">nextId</span><span class="operator">:</span> <span class="string">'1'</span><span class="punctuation">,</span> <span class="literal-property">text</span><span class="operator">:</span> <span class="string">'[canvas]'</span><span class="punctuation">}</span><span class="punctuation">,</span>
          <span class="number">1</span><span class="operator">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span>
        <span class="punctuation">}</span><span class="punctuation">,</span>
      <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
    checkpoints<span class="operator">?.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="punctuation">[</span>checkpoints<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> relationships <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/usecreaterelationships/">useCreateRelationships</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function"><a href="/api/relationships/functions/creation/createrelationships/">createRelationships</a></span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/relationships/interfaces/relationships/relationships/methods/configuration/setrelationshipdefinition/">setRelationshipDefinition</a></span><span class="punctuation">(</span>
    <span class="string">'order'</span><span class="punctuation">,</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    <span class="string">'nextId'</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>Finally we render the app, comprising a toolbar, the canvas, and the sidebar, all wrapped in a <a href="/api/ui-react/functions/context-components/provider/"><code>Provider</code></a> component to make sure our top-level objects are defaulted throughout the app. The <code>SelectedIdContext</code> context provider also passes a <code>useState</code> value and setter pair into the app:</p><pre><code>  <span class="comment">// ...</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="operator">&lt;</span>Provider
      store<span class="operator">=</span><span class="punctuation">{</span>store<span class="punctuation">}</span>
      relationships<span class="operator">=</span><span class="punctuation">{</span>relationships<span class="punctuation">}</span>
      checkpoints<span class="operator">=</span><span class="punctuation">{</span>checkpoints<span class="punctuation">}</span>
    <span class="operator">></span>
      <span class="operator">&lt;</span>SelectedIdContext<span class="punctuation">.</span>Provider value<span class="operator">=</span><span class="punctuation">{</span><span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="operator">></span>
        <span class="operator">&lt;</span>Toolbar <span class="operator">/</span><span class="operator">></span>
        <span class="operator">&lt;</span>Canvas <span class="operator">/</span><span class="operator">></span>
        <span class="operator">&lt;</span>Sidebar <span class="operator">/</span><span class="operator">></span>
      <span class="operator">&lt;</span><span class="operator">/</span>SelectedIdContext<span class="punctuation">.</span>Provider<span class="operator">></span>
      <span class="operator">&lt;</span>Inspector <span class="operator">/</span><span class="operator">></span>
    <span class="operator">&lt;</span><span class="operator">/</span>Provider<span class="operator">></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>We also added the <a href="/api/ui-react-inspector/functions/development-components/inspector/"><code>Inspector</code></a> component at the end there so you can inspect what is going on with the data during this demo. Simply click the TinyBase logo in the corner.</p><p>Anyway, let&#x27;s mount it into the DOM...</p><pre><code><span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'load'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  ReactDOM<span class="punctuation">.</span><span class="function">createRoot</span><span class="punctuation">(</span>document<span class="punctuation">.</span>body<span class="punctuation">)</span><span class="punctuation">.</span><span class="function">render</span><span class="punctuation">(</span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">App</span></span> <span class="punctuation">/></span></span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>...and off we go.</p><h3 id="the-toolbar-component">The Toolbar Component</h3><p>The toolbar across the top of the app contains the undo and redo buttons, the button to add a new shape - and, when a shape is selected, the stack order and delete buttons</p><pre><code><span class="keyword">const</span> <span class="function-variable">Toolbar</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>useSelectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>toolbar<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">UndoRedo</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ShapeAdd</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>useSelectedId <span class="operator">==</span> <span class="keyword">null</span> <span class="operator">?</span> <span class="keyword">null</span> <span class="operator">:</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ShapeOrder</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ShapeDelete</span></span> <span class="punctuation">/></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The undo and redo buttons use the <a href="/api/ui-react/functions/checkpoints-hooks/useundoinformation/"><code>useUndoInformation</code></a> hook and <a href="/api/ui-react/functions/checkpoints-hooks/useredoinformation/"><code>useRedoInformation</code></a> hook to disable or enable themselves, and handle the checkpoint moves accordingly:</p><pre><code><span class="keyword">const</span> <span class="function-variable">UndoRedo</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>canUndo<span class="punctuation">,</span> handleUndo<span class="punctuation">,</span> <span class="punctuation">,</span> undoLabel<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/useundoinformation/">useUndoInformation</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>canRedo<span class="punctuation">,</span> handleRedo<span class="punctuation">,</span> <span class="punctuation">,</span> redoLabel<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/useredoinformation/">useRedoInformation</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span>
        <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">button undo</span><span class="interpolation"><span class="interpolation-punctuation">${</span>canUndo <span class="operator">?</span> <span class="string">''</span> <span class="operator">:</span> <span class="string">' disabled'</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="spread"><span class="punctuation">{</span><span class="operator">...</span><span class="punctuation">(</span>canUndo <span class="operator">?</span> <span class="punctuation">{</span><span class="literal-property">onClick</span><span class="operator">:</span> handleUndo<span class="punctuation">,</span> <span class="literal-property">title</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">Undo </span><span class="interpolation"><span class="interpolation-punctuation">${</span>undoLabel<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span> <span class="operator">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span>
        <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">button redo</span><span class="interpolation"><span class="interpolation-punctuation">${</span>canRedo <span class="operator">?</span> <span class="string">''</span> <span class="operator">:</span> <span class="string">' disabled'</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="spread"><span class="punctuation">{</span><span class="operator">...</span><span class="punctuation">(</span>canRedo <span class="operator">?</span> <span class="punctuation">{</span><span class="literal-property">onClick</span><span class="operator">:</span> handleRedo<span class="punctuation">,</span> <span class="literal-property">title</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">Redo </span><span class="interpolation"><span class="interpolation-punctuation">${</span>redoLabel<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span> <span class="operator">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The button to add a new shape needs to know the current top of the z-index stack (the <code>frontId</code>) upon which a new shape will be added, implemented by adding the new shape&#x27;s <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> as the <code>nextId</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> of the current top shape. It also selects the new shape with the <code>setSelectedId</code> function. The <a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/"><code>useSetCheckpointCallback</code></a> hook is used to add the shape creation to the undo stack after the new shape <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> has been added via the callback from the <a href="/api/ui-react/functions/store-hooks/useaddrowcallback/"><code>useAddRowCallback</code></a> hook:</p><pre><code><span class="keyword">const</span> <span class="function-variable">ShapeAdd</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> frontId <span class="operator">=</span> <span class="function">useFrontId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span><span class="punctuation">,</span> setSelectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'add shape'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> onAddRow <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">id<span class="punctuation">,</span> store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> frontId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="function">setSelectedId</span><span class="punctuation">(</span>id<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/setcheckpoint/">setCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>frontId<span class="punctuation">,</span> setSelectedId<span class="punctuation">,</span> setCheckpoint<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleClick <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/useaddrowcallback/">useAddRowCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="keyword">null</span><span class="punctuation">,</span>
    onAddRow<span class="punctuation">,</span>
    <span class="punctuation">[</span>onAddRow<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>button add<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleClick<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      Add shape
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>We&#x27;ll have these two hooks for getting the front and back shapes of the ordered stack.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useBackId</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselinkedrowids/">useLinkedRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> <span class="constant">CANVAS_ID</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="function-variable">useFrontId</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselinkedrowids/">useLinkedRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> <span class="constant">CANVAS_ID</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">slice</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">;</span>
</code></pre><p>There are four buttons for changing the shape order: move to back, move backward, move forward, and move to front. Each of these change the order of the linked list created by the <code>nextId</code> pointer in the <code>shapes</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>:</p><pre><code><span class="keyword">const</span> <span class="function-variable">ShapeOrder</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> frontId <span class="operator">=</span> <span class="function">useFrontId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> forwardId <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/useremoterowid/">useRemoteRowId</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>previousId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselocalrowids/">useLocalRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>backwardId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselocalrowids/">useLocalRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> previousId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> backId <span class="operator">=</span> <span class="function">useBackId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">[</span>
    <span class="punctuation">[</span><span class="string">'front'</span><span class="punctuation">,</span> <span class="string">'To front'</span><span class="punctuation">,</span> frontId<span class="punctuation">,</span> <span class="function">useOrderShape</span><span class="punctuation">(</span>frontId<span class="punctuation">,</span> <span class="string">'to front'</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">'forward'</span><span class="punctuation">,</span> <span class="string">'Forward'</span><span class="punctuation">,</span> frontId<span class="punctuation">,</span> <span class="function">useOrderShape</span><span class="punctuation">(</span>forwardId<span class="punctuation">,</span> <span class="string">'forward'</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">'backward'</span><span class="punctuation">,</span> <span class="string">'Backward'</span><span class="punctuation">,</span> backId<span class="punctuation">,</span> <span class="function">useOrderShape</span><span class="punctuation">(</span>backwardId<span class="punctuation">,</span> <span class="string">'backward'</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">'back'</span><span class="punctuation">,</span> <span class="string">'To back'</span><span class="punctuation">,</span> backId<span class="punctuation">,</span> <span class="function">useOrderShape</span><span class="punctuation">(</span><span class="constant">CANVAS_ID</span><span class="punctuation">,</span> <span class="string">'to back'</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">]</span><span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">[</span>className<span class="punctuation">,</span> label<span class="punctuation">,</span> disabledIfId<span class="punctuation">,</span> handleClick<span class="punctuation">]</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> disabled <span class="operator">=</span> selectedId <span class="operator">==</span> <span class="keyword">null</span> <span class="operator">||</span> selectedId <span class="operator">==</span> disabledIfId<span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span>
        <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">button </span><span class="interpolation"><span class="interpolation-punctuation">${</span>className<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>disabled <span class="operator">?</span> <span class="string">' disabled'</span> <span class="operator">:</span> <span class="string">''</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>disabled <span class="operator">?</span> <span class="keyword">null</span> <span class="operator">:</span> handleClick<span class="punctuation">}</span></span>
        <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>className<span class="punctuation">}</span></span>
      <span class="punctuation">></span></span><span class="plain-text">
        </span><span class="punctuation">{</span>label<span class="punctuation">}</span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>These changes are made with the <code>useOrderShape</code> hook. It batches the changes to the <code>nextId</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values in a single transaction, accounting for edge cases like moving a shape from the top of the stack, and sealing up the linked list after a shape has been moved:</p><pre><code><span class="keyword">const</span> <span class="function-variable">useOrderShape</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">toId<span class="punctuation">,</span> label</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usestore/">useStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>previousId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselocalrowids/">useLocalRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> nextId <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/useremoterowid/">useRemoteRowId</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> nextNextId <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/useremoterowid/">useRemoteRowId</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> toId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">move </span><span class="interpolation"><span class="interpolation-punctuation">${</span>label<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>nextId <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> previousId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">,</span> nextId<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delcell/">delCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> previousId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>nextNextId <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">,</span> nextNextId<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delcell/">delCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> toId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/setcheckpoint/">setCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>selectedId<span class="punctuation">,</span> toId<span class="punctuation">,</span> store<span class="punctuation">,</span> previousId<span class="punctuation">,</span> nextId<span class="punctuation">,</span> nextNextId<span class="punctuation">,</span> setCheckpoint<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The button to delete a shape needs to account for a shape being removed from the linked list (and making its next shape the previous shape&#x27;s next shape instead), but otherwise it simply uses the <a href="/api/store/interfaces/store/store/methods/deleter/delrow/"><code>delRow</code></a> method to remove the record from the table.</p><pre><code><span class="keyword">const</span> <span class="function-variable">ShapeDelete</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usestore/">useStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">,</span> setSelectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>previousId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/uselocalrowids/">useLocalRowIds</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> nextId <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/relationships-hooks/useremoterowid/">useRemoteRowId</a></span><span class="punctuation">(</span><span class="string">'order'</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'delete'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleClick <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>nextId <span class="operator">==</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delcell/">delCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> previousId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>
        store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> previousId<span class="punctuation">,</span> <span class="string">'nextId'</span><span class="punctuation">,</span> nextId<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/deleter/delrow/">delRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/setcheckpoint/">setCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">setSelectedId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>store<span class="punctuation">,</span> selectedId<span class="punctuation">,</span> setSelectedId<span class="punctuation">,</span> previousId<span class="punctuation">,</span> nextId<span class="punctuation">,</span> setCheckpoint<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>button delete<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleClick<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      Delete
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>That&#x27;s the top toolbar taken care of. Try selecting, unselecting, and moving a few shapes around to get a sense for what is happening with each of these components. You can observe the resulting data structures by inspecting your local storage with your browser developer tools.</p><h3 id="the-sidebar-component">The Sidebar Component</h3><p>The sidebar comprises controls to configure a shape&#x27;s type, color and position when selected:</p><pre><code><span class="keyword">const</span> <span class="function-variable">Sidebar</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>sidebar<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>selectedId <span class="operator">==</span> <span class="keyword">null</span> <span class="operator">?</span> <span class="keyword">null</span> <span class="operator">:</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarTypeCell</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarColorCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Text<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>textColor<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarColorCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Back<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>backColor<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarNumberCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Left<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>x1<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarNumberCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Top<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>y1<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarNumberCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Right<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>x2<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarNumberCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Bottom<span class="punctuation">"</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>y2<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Each of these controls will be nested in a component to allow the CSS to lay them out correctly:</p><pre><code><span class="keyword">const</span> <span class="function-variable">SidebarCell</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>label<span class="punctuation">,</span> children<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>cell<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="punctuation">{</span>label<span class="punctuation">}</span><span class="plain-text">: </span><span class="punctuation">{</span>children<span class="punctuation">}</span><span class="plain-text">
  </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>First up, the control to configure a shape&#x27;s type to be either a rectangle or an ellipse. This is a dropdown of the <code>TYPES</code> values, which when selected, fires a <a href="/api/store/interfaces/store/store/methods/setter/setcell/"><code>setCell</code></a> method wrapped in a callback from the <a href="/api/ui-react/functions/store-hooks/usesetcellcallback/"><code>useSetCellCallback</code></a> hook. The value to set the <code>type</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> is extracted from the event&#x27;s <code>target.value</code>, and the change is added to the undo stack after the change has been made, with the callback from the <a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/"><code>useSetCheckpointCallback</code></a> hook.</p><pre><code><span class="keyword">const</span> <span class="function-variable">SidebarTypeCell</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'change of type'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarCell</span></span> <span class="attr-name">label</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>Shape<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>select</span>
        <span class="attr-name">value</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function"><a href="/api/ui-react/functions/store-hooks/usecell/">useCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">,</span> <span class="string">'type'</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
        <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
          <span class="constant">SHAPES</span><span class="punctuation">,</span>
          selectedId<span class="punctuation">,</span>
          <span class="string">'type'</span><span class="punctuation">,</span>
          <span class="punctuation">(</span><span class="parameter">e</span><span class="punctuation">)</span> <span class="operator">=></span> e<span class="punctuation">.</span>target<span class="punctuation">.</span>value<span class="punctuation">,</span>
          <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
          <span class="keyword">null</span><span class="punctuation">,</span>
          setCheckpoint<span class="punctuation">,</span>
        <span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">></span></span><span class="plain-text">
        </span><span class="punctuation">{</span><span class="constant">TYPES</span><span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">type</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
          <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>option</span> <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>type<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="punctuation">{</span>type<span class="punctuation">}</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>option</span><span class="punctuation">></span></span>
        <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>select</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name">SidebarCell</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Setting the shape&#x27;s two colors (stored in the <code>textColor</code> and <code>backColor</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values) is done with the <code>SidebarColorCell</code> component. It also uses the <a href="/api/ui-react/functions/store-hooks/usesetcellcallback/"><code>useSetCellCallback</code></a> hook to get a callback that in this case uses the color picker event&#x27;s <code>target.value</code> - and again, the <a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/"><code>useSetCheckpointCallback</code></a> hook to add it to the undo stack after the change has been made:</p><pre><code><span class="keyword">const</span> <span class="function-variable">SidebarColorCell</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>label<span class="punctuation">,</span> cellId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">change of '</span><span class="interpolation"><span class="interpolation-punctuation">${</span>label<span class="punctuation">.</span><span class="function">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string">' color</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="punctuation">[</span>label<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarCell</span></span> <span class="attr-name">label</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>label<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>input</span>
        <span class="attr-name">type</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>color<span class="punctuation">"</span></span>
        <span class="attr-name">value</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function"><a href="/api/ui-react/functions/store-hooks/usecell/">useCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">,</span> cellId<span class="punctuation">)</span><span class="punctuation">}</span></span>
        <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
          <span class="constant">SHAPES</span><span class="punctuation">,</span>
          selectedId<span class="punctuation">,</span>
          cellId<span class="punctuation">,</span>
          <span class="punctuation">(</span><span class="parameter">e</span><span class="punctuation">)</span> <span class="operator">=></span> e<span class="punctuation">.</span>target<span class="punctuation">.</span>value<span class="punctuation">,</span>
          <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
          <span class="keyword">null</span><span class="punctuation">,</span>
          setCheckpoint<span class="punctuation">,</span>
        <span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name">SidebarCell</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>And finally (and similarly), the <code>SidebarNumberCell</code> component displays and lets you nudge the four numeric <code>x1</code>, <code>y1</code>, <code>x2</code>, and <code>y2</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values. One interesting difference here is that the <a href="/api/ui-react/functions/store-hooks/usesetcellcallback/"><code>useSetCellCallback</code></a> hook is passed not an absolute number for those values, but a function that will nudge the value.</p><pre><code><span class="keyword">const</span> <span class="function-variable">nudgeUp</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">cell</span><span class="punctuation">)</span> <span class="operator">=></span> cell <span class="operator">+</span> <span class="number">1</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="function-variable">nudgeDown</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">cell</span><span class="punctuation">)</span> <span class="operator">=></span> cell <span class="operator">-</span> <span class="number">1</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="function-variable">SidebarNumberCell</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>label<span class="punctuation">,</span> cellId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">nudge of '</span><span class="interpolation"><span class="interpolation-punctuation">${</span>label<span class="punctuation">.</span><span class="function">toLowerCase</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string">' value</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="punctuation">[</span>label<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleDown <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    selectedId<span class="punctuation">,</span>
    cellId<span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> nudgeDown<span class="punctuation">,</span>
    <span class="punctuation">[</span>nudgeDown<span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="keyword">null</span><span class="punctuation">,</span>
    setCheckpoint<span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleUp <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    selectedId<span class="punctuation">,</span>
    cellId<span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> nudgeUp<span class="punctuation">,</span>
    <span class="punctuation">[</span>nudgeUp<span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="keyword">null</span><span class="punctuation">,</span>
    setCheckpoint<span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">SidebarCell</span></span> <span class="attr-name">label</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>label<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>spin<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>button<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleDown<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
          -
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span><span class="plain-text">
        </span><span class="punctuation">{</span><span class="function"><a href="/api/ui-react/functions/store-hooks/usecell/">useCell</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> selectedId<span class="punctuation">,</span> cellId<span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>button<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleUp<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
          +
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span><span class="punctuation">{</span><span class="string">' '</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name">SidebarCell</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><h3 id="the-canvas-component">The Canvas Component</h3><p>The canvas component is the main part of the application upon which the other shapes appear. Its core implementation is essentially to render a <a href="/api/ui-react/functions/relationships-components/linkedrowsview/"><code>LinkedRowsView</code></a> component using ordered view of the shapes according to the <code>nextId</code>-based linked list.</p><p>However, it also includes additional complexity arising from the fact that we enforce shapes to fit within the bounds of the canvas. This means two things:</p><ul><li>Firstly the canvas itself attaches mutator listeners to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> with the <a href="/api/ui-react/functions/store-hooks/userowlistener/"><code>useRowListener</code></a> hook, so that shapes can never have <code>x</code> and <code>y</code> coordinates greater than its bounds when they change. The <code>getShapeDimensions</code> function also enforces the minimum width and height constraints for each shape.</li><li>Secondly, the canvas must respond to DOM changes that affect its own size. This is done with the <code>updateDimensions</code> function, tracking the DOM with a <code>ResizeObserver</code>. <a href="/api/store/type-aliases/transaction/changes/"><code>Changes</code></a> to the canvas size change both the mutator listeners for future shape moves, but also does a one-off sweep through the current objects to fit them into canvas in case it shrinks.</li></ul><p>While this may seem a little complicated to describe, it&#x27;s easier to see in action. Try moving an object (or its handles) off the edge of the canvas. You&#x27;ll discover that you can&#x27;t, since the mutator listeners are stopping any values from exceeding the bounds. And then if you move a shape to the far-right of the canvas and shrink your browser window, you will see the smaller canvas pulling the shape in to fit.</p><p>Finally, the canvas listens to the <code>handleMouseDown</code> event so that if you click anywhere on the app background, the current shape will get deselected.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Canvas</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useRef</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usestore/">useStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> <span class="punctuation">[</span>canvasDimensions<span class="punctuation">,</span> setCanvasDimensions<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> getShapeDimensions <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">id<span class="punctuation">,</span> maxX<span class="punctuation">,</span> maxY</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> <span class="punctuation">{</span>x1<span class="punctuation">,</span> x2<span class="punctuation">,</span> y1<span class="punctuation">,</span> y2<span class="punctuation">}</span> <span class="operator">=</span> store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getrow/">getRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">const</span> w <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span>x2 <span class="operator">-</span> x1<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">min</span><span class="punctuation">(</span><span class="constant">MIN_WIDTH</span><span class="punctuation">,</span> maxX<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">const</span> h <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span>y2 <span class="operator">-</span> y1<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">min</span><span class="punctuation">(</span><span class="constant">MIN_HEIGHT</span><span class="punctuation">,</span> maxY<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">return</span> <span class="punctuation">{</span>x1<span class="punctuation">,</span> x2<span class="punctuation">,</span> y1<span class="punctuation">,</span> y2<span class="punctuation">,</span> w<span class="punctuation">,</span> h<span class="punctuation">}</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>store<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="function"><a href="/api/ui-react/functions/store-hooks/userowlistener/">useRowListener</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    <span class="keyword">null</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="parameter">store<span class="punctuation">,</span> _tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> getCellChange</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> <span class="punctuation">[</span>maxX<span class="punctuation">,</span> maxY<span class="punctuation">]</span> <span class="operator">=</span> canvasDimensions<span class="punctuation">;</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>maxX <span class="operator">==</span> <span class="number">0</span> <span class="operator">||</span> maxY <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">return</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>

      <span class="keyword">const</span> <span class="punctuation">[</span>x1Changed<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">getCellChange</span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'x1'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">const</span> <span class="punctuation">[</span>x2Changed<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">getCellChange</span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'x2'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">const</span> <span class="punctuation">[</span>y1Changed<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">getCellChange</span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'y1'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">const</span> <span class="punctuation">[</span>y2Changed<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">getCellChange</span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'y2'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>
        <span class="punctuation">(</span>x1Changed <span class="operator">||</span> x2Changed <span class="operator">||</span> y1Changed <span class="operator">||</span> y2Changed<span class="punctuation">)</span> <span class="operator">&amp;&amp;</span>
        rowId <span class="operator">!=</span> <span class="constant">CANVAS_ID</span>
      <span class="punctuation">)</span> <span class="punctuation">{</span>
        <span class="keyword">const</span> <span class="punctuation">{</span>x1<span class="punctuation">,</span> x2<span class="punctuation">,</span> y1<span class="punctuation">,</span> y2<span class="punctuation">,</span> w<span class="punctuation">,</span> h<span class="punctuation">}</span> <span class="operator">=</span> <span class="function">getShapeDimensions</span><span class="punctuation">(</span>rowId<span class="punctuation">,</span> maxX<span class="punctuation">,</span> maxY<span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>x1Changed <span class="operator">&amp;&amp;</span> x1 <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>
            <span class="constant">SHAPES</span><span class="punctuation">,</span>
            rowId<span class="punctuation">,</span>
            <span class="string">'x1'</span><span class="punctuation">,</span>
            <span class="function">between</span><span class="punctuation">(</span>x1<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">min</span><span class="punctuation">(</span>x2<span class="punctuation">,</span> maxX<span class="punctuation">)</span> <span class="operator">-</span> w<span class="punctuation">)</span><span class="punctuation">,</span>
          <span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>x2Changed <span class="operator">&amp;&amp;</span> x2 <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>
            <span class="constant">SHAPES</span><span class="punctuation">,</span>
            rowId<span class="punctuation">,</span>
            <span class="string">'x2'</span><span class="punctuation">,</span>
            <span class="function">between</span><span class="punctuation">(</span>x2<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span>x1<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">+</span> w<span class="punctuation">,</span> maxX<span class="punctuation">)</span><span class="punctuation">,</span>
          <span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>y1Changed <span class="operator">&amp;&amp;</span> y1 <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>
            <span class="constant">SHAPES</span><span class="punctuation">,</span>
            rowId<span class="punctuation">,</span>
            <span class="string">'y1'</span><span class="punctuation">,</span>
            <span class="function">between</span><span class="punctuation">(</span>y1<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">min</span><span class="punctuation">(</span>y2<span class="punctuation">,</span> maxY<span class="punctuation">)</span> <span class="operator">-</span> h<span class="punctuation">)</span><span class="punctuation">,</span>
          <span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="punctuation">}</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>y2Changed <span class="operator">&amp;&amp;</span> y2 <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span>
            <span class="constant">SHAPES</span><span class="punctuation">,</span>
            rowId<span class="punctuation">,</span>
            <span class="string">'y2'</span><span class="punctuation">,</span>
            <span class="function">between</span><span class="punctuation">(</span>y2<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span>y1<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">+</span> h<span class="punctuation">,</span> maxY<span class="punctuation">)</span><span class="punctuation">,</span>
          <span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="operator">...</span>canvasDimensions<span class="punctuation">,</span> getShapeDimensions<span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="boolean">true</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> updateDimensions <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter">current</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> <span class="punctuation">{</span><span class="literal-property">clientWidth</span><span class="operator">:</span> maxX<span class="punctuation">,</span> <span class="literal-property">clientHeight</span><span class="operator">:</span> maxY<span class="punctuation">}</span> <span class="operator">=</span> current<span class="punctuation">;</span>
      <span class="function">setCanvasDimensions</span><span class="punctuation">(</span><span class="punctuation">[</span>maxX<span class="punctuation">,</span> maxY<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
      store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/iterator/foreachrow/">forEachRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">id</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        <span class="keyword">if</span> <span class="punctuation">(</span>id <span class="operator">!=</span> <span class="constant">CANVAS_ID</span><span class="punctuation">)</span> <span class="punctuation">{</span>
          <span class="keyword">const</span> <span class="punctuation">{</span>x2<span class="punctuation">,</span> y2<span class="punctuation">,</span> w<span class="punctuation">,</span> h<span class="punctuation">}</span> <span class="operator">=</span> <span class="function">getShapeDimensions</span><span class="punctuation">(</span>id<span class="punctuation">,</span> maxX<span class="punctuation">,</span> maxY<span class="punctuation">)</span><span class="punctuation">;</span>
          <span class="keyword">if</span> <span class="punctuation">(</span>x2 <span class="operator">></span> maxX<span class="punctuation">)</span> <span class="punctuation">{</span>
            store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setpartialrow/">setPartialRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">,</span> <span class="punctuation">{</span>
              <span class="literal-property">x1</span><span class="operator">:</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> maxX <span class="operator">-</span> w<span class="punctuation">)</span><span class="punctuation">,</span>
              <span class="literal-property">x2</span><span class="operator">:</span> maxX<span class="punctuation">,</span>
            <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
          <span class="punctuation">}</span>
          <span class="keyword">if</span> <span class="punctuation">(</span>y2 <span class="operator">></span> maxY<span class="punctuation">)</span> <span class="punctuation">{</span>
            store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setpartialrow/">setPartialRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">,</span> <span class="punctuation">{</span>
              <span class="literal-property">y1</span><span class="operator">:</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> maxY <span class="operator">-</span> h<span class="punctuation">)</span><span class="punctuation">,</span>
              <span class="literal-property">y2</span><span class="operator">:</span> maxY<span class="punctuation">,</span>
            <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>store<span class="punctuation">,</span> getShapeDimensions<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="function">useEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> <span class="punctuation">{</span>current<span class="punctuation">}</span> <span class="operator">=</span> ref<span class="punctuation">;</span>
    <span class="keyword">const</span> observer <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">ResizeObserver</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">updateDimensions</span><span class="punctuation">(</span>current<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    observer<span class="punctuation">.</span><span class="function">observe</span><span class="punctuation">(</span>current<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">updateDimensions</span><span class="punctuation">(</span>current<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> observer<span class="punctuation">.</span><span class="function">disconnect</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>ref<span class="punctuation">,</span> store<span class="punctuation">,</span> updateDimensions<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> <span class="punctuation">[</span><span class="punctuation">,</span> setSelectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> getRowComponentProps <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">id</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span><span class="punctuation">{</span>id<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleMouseDown <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setSelectedId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span>setSelectedId<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> backId <span class="operator">=</span> <span class="function">useBackId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>canvas<span class="punctuation">"</span></span> <span class="attr-name">onMouseDown</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleMouseDown<span class="punctuation">}</span></span> <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>backId <span class="operator">==</span> <span class="keyword">null</span> <span class="operator">?</span> <span class="keyword">null</span> <span class="operator">:</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react/functions/relationships-components/linkedrowsview/">LinkedRowsView</a></span></span>
          <span class="attr-name">relationshipId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>order<span class="punctuation">"</span></span>
          <span class="attr-name">firstRowId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>backId<span class="punctuation">}</span></span>
          <span class="attr-name">rowComponent</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>Shape<span class="punctuation">}</span></span>
          <span class="attr-name">getRowComponentProps</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>getRowComponentProps<span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="function-variable">between</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">value<span class="punctuation">,</span> min<span class="punctuation">,</span> max</span><span class="punctuation">)</span> <span class="operator">=></span>
  value <span class="operator">&lt;</span> min <span class="operator">?</span> min <span class="operator">:</span> value <span class="operator">></span> max <span class="operator">?</span> max <span class="operator">:</span> value<span class="punctuation">;</span>
</code></pre><h3 id="the-shape-component">The Shape Component</h3><p>Relatively speaking, each shape is quite a simple component. It uses the <code>useSelectedIdState</code> hook to identify if it is selected (and show the <code>ShapeGrips</code> resize handles if so).</p><p>It also uses the <code>useDraggableObject</code> hook we introduced at the start of the demo to make itself movable via the <code>handleDrag</code> callback. When you finish a drag, the <code>handleDragStop</code> callback records a checkpoint so that you can undo a whole dragging movement.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Shape</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>id<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>selectedId<span class="punctuation">,</span> setSelectedId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useSelectedIdState</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> selected <span class="operator">=</span> id <span class="operator">==</span> selectedId<span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">{</span>x1<span class="punctuation">,</span> y1<span class="punctuation">,</span> x2<span class="punctuation">,</span> y2<span class="punctuation">,</span> backColor<span class="punctuation">,</span> type<span class="punctuation">}</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/userow/">useRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usestore/">useStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> getInitial <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getrow/">getRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span>store<span class="punctuation">,</span> id<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> handleDrag <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetpartialrowcallback/">useSetPartialRowCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    id<span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>dx<span class="punctuation">,</span> dy<span class="punctuation">,</span> initial<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span><span class="punctuation">{</span>
      <span class="literal-property">x1</span><span class="operator">:</span> initial<span class="punctuation">.</span>x1 <span class="operator">+</span> dx<span class="punctuation">,</span>
      <span class="literal-property">y1</span><span class="operator">:</span> initial<span class="punctuation">.</span>y1 <span class="operator">+</span> dy<span class="punctuation">,</span>
      <span class="literal-property">x2</span><span class="operator">:</span> initial<span class="punctuation">.</span>x2 <span class="operator">+</span> dx<span class="punctuation">,</span>
      <span class="literal-property">y2</span><span class="operator">:</span> initial<span class="punctuation">.</span>y2 <span class="operator">+</span> dy<span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleDragStart <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setSelectedId</span><span class="punctuation">(</span>id<span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>setSelectedId<span class="punctuation">,</span> id<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleDragStop <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'drag'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useDraggableObject</span><span class="punctuation">(</span>
    getInitial<span class="punctuation">,</span>
    handleDrag<span class="punctuation">,</span>
    handleDragStart<span class="punctuation">,</span>
    handleDragStop<span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> style <span class="operator">=</span> <span class="punctuation">{</span>
    <span class="literal-property">left</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>x1<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="literal-property">top</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>y1<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="literal-property">width</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>x2 <span class="operator">-</span> x1<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="literal-property">height</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>y2 <span class="operator">-</span> y1<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
    <span class="literal-property">background</span><span class="operator">:</span> backColor<span class="punctuation">,</span>
  <span class="punctuation">}</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span>
        <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span>
        <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">shape </span><span class="interpolation"><span class="interpolation-punctuation">${</span>type<span class="interpolation-punctuation">}</span></span><span class="interpolation"><span class="interpolation-punctuation">${</span>selected <span class="operator">?</span> <span class="string">' selected'</span> <span class="operator">:</span> <span class="string">''</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="attr-name">style</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>style<span class="punctuation">}</span></span>
      <span class="punctuation">></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ShapeText</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>selected <span class="operator">?</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ShapeGrips</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="punctuation">/></span></span> <span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Inside the shape, the ShapeText component shows a text label, which, when double-clicked, sets the <code>editing</code> state to <code>true</code>, and becomes editable by turning into an <code>&lt;input&gt;</code> component. And once again, the <a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/"><code>useSetCheckpointCallback</code></a> hook provides a callback to add text changes to the undo stack.</p><pre><code><span class="keyword">const</span> <span class="function-variable">ShapeText</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>id<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">{</span>text<span class="punctuation">,</span> textColor<span class="punctuation">}</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/userow/">useRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useRef</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>editing<span class="punctuation">,</span> setEditing<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> setCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'edit text'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleDoubleClick <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setEditing</span><span class="punctuation">(</span><span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleBlur <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="function">setEditing</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/setcheckpoint/">setCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>setCheckpoint<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleChange <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    id<span class="punctuation">,</span>
    <span class="string">'text'</span><span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="parameter">e</span><span class="punctuation">)</span> <span class="operator">=></span> e<span class="punctuation">.</span>target<span class="punctuation">.</span>value<span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleKeyDown <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">e</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>e<span class="punctuation">.</span>which <span class="operator">==</span> <span class="number">13</span><span class="punctuation">)</span> <span class="punctuation">{</span>
      e<span class="punctuation">.</span>target<span class="punctuation">.</span><span class="function">blur</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="function">useEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>editing<span class="punctuation">)</span> <span class="punctuation">{</span>
      ref<span class="punctuation">.</span>current<span class="punctuation">.</span><span class="function">focus</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>editing<span class="punctuation">,</span> ref<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> style <span class="operator">=</span> <span class="punctuation">{</span><span class="literal-property">color</span><span class="operator">:</span> textColor<span class="punctuation">}</span><span class="punctuation">;</span>

  <span class="keyword">return</span> editing <span class="operator">?</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>input</span>
      <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span>
      <span class="attr-name">style</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>style<span class="punctuation">}</span></span>
      <span class="attr-name">value</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>text<span class="punctuation">}</span></span>
      <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleChange<span class="punctuation">}</span></span>
      <span class="attr-name">onKeyDown</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleKeyDown<span class="punctuation">}</span></span>
      <span class="attr-name">onBlur</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleBlur<span class="punctuation">}</span></span>
    <span class="punctuation">/></span></span>
  <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>span</span> <span class="attr-name">style</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>style<span class="punctuation">}</span></span> <span class="attr-name">onDoubleClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleDoubleClick<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>text <span class="operator">!=</span> <span class="string">''</span> <span class="operator">?</span> text <span class="operator">:</span> <span class="string">'\xa0'</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>span</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><h3 id="the-shape-grips">The Shape Grips</h3><p>When selected, a shape has eight handles for resizing it. Clockwise from top left, these adjust the <code>x1,y1</code> coordinates, the <code>y1</code> coordinate alone, the <code>y1,x2</code> coordinates, the <code>y2</code> coordinate alone, and so on. Each also has a different resizing cursor style to make it evident how they can move:</p><pre><code><span class="keyword">const</span> <span class="function-variable">ShapeGrips</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>id<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">{</span>x1<span class="punctuation">,</span> y1<span class="punctuation">,</span> x2<span class="punctuation">,</span> y2<span class="punctuation">}</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/userow/">useRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> xm <span class="operator">=</span> <span class="punctuation">(</span>x1 <span class="operator">+</span> x2<span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
  <span class="keyword">const</span> ym <span class="operator">=</span> <span class="punctuation">(</span>y1 <span class="operator">+</span> y2<span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x1<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y1<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>nwse<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>xm<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y1<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>ns<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x2<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y1<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>nesw<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x2<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ym<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>ew<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x2<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y2<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>nwse<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>xm<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y2<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>ns<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x1<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>y2<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>nesw<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Grip</span></span> <span class="attr-name">m</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">id</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>id<span class="punctuation">}</span></span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x1<span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ym<span class="punctuation">}</span></span> <span class="attr-name">d</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>ew<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Each grip itself is a small <code>&lt;div&gt;</code> element, made draggable with the <code>useDraggableObject</code> hook, and affecting the underlying shape&#x27;s coordinates according to the 4-item <code>m</code> array passed in from the <code>ShapeGrips</code> component. Of course, the <code>useSetCheckpointCallback</code> hook also means that resizes get added to the undo stack:</p><pre><code><span class="keyword">const</span> <span class="function-variable">Grip</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span><span class="literal-property">m</span><span class="operator">:</span> <span class="punctuation">[</span>mx1<span class="punctuation">,</span> my1<span class="punctuation">,</span> mx2<span class="punctuation">,</span> my2<span class="punctuation">]</span><span class="punctuation">,</span> id<span class="punctuation">,</span> x<span class="punctuation">,</span> y<span class="punctuation">,</span> d<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usestore/">useStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> getInitial <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/getter/getrow/">getRow</a></span><span class="punctuation">(</span><span class="constant">SHAPES</span><span class="punctuation">,</span> id<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span>store<span class="punctuation">,</span> id<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> handleDrag <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetpartialrowcallback/">useSetPartialRowCallback</a></span><span class="punctuation">(</span>
    <span class="constant">SHAPES</span><span class="punctuation">,</span>
    id<span class="punctuation">,</span>
    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>dx<span class="punctuation">,</span> dy<span class="punctuation">,</span> initial<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span><span class="punctuation">{</span>
      <span class="literal-property">x1</span><span class="operator">:</span> initial<span class="punctuation">.</span>x1 <span class="operator">+</span> dx <span class="operator">*</span> mx1<span class="punctuation">,</span>
      <span class="literal-property">y1</span><span class="operator">:</span> initial<span class="punctuation">.</span>y1 <span class="operator">+</span> dy <span class="operator">*</span> my1<span class="punctuation">,</span>
      <span class="literal-property">x2</span><span class="operator">:</span> initial<span class="punctuation">.</span>x2 <span class="operator">+</span> dx <span class="operator">*</span> mx2<span class="punctuation">,</span>
      <span class="literal-property">y2</span><span class="operator">:</span> initial<span class="punctuation">.</span>y2 <span class="operator">+</span> dy <span class="operator">*</span> my2<span class="punctuation">,</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>mx1<span class="punctuation">,</span> my1<span class="punctuation">,</span> mx2<span class="punctuation">,</span> my2<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> handleDragStop <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="string">'resize'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span>
      <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">useDraggableObject</span><span class="punctuation">(</span>getInitial<span class="punctuation">,</span> handleDrag<span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> handleDragStop<span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>grip<span class="punctuation">"</span></span>
      <span class="attr-name">style</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">{</span><span class="literal-property">left</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>x<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span> <span class="literal-property">top</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>y<span class="interpolation-punctuation">}</span></span><span class="string">px</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span> <span class="literal-property">cursor</span><span class="operator">:</span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>d<span class="interpolation-punctuation">}</span></span><span class="string">-resize</span><span class="template-punctuation">`</span></span><span class="punctuation">}</span><span class="punctuation">}</span></span>
    <span class="punctuation">/></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><h3 id="the-styling">The Styling</h3><p>Finally we style the app with some LESS. This should be mostly self-explanatory, including the SVG for the button icons.</p><pre><code><span class="variable">@accentColor<span class="punctuation">:</span></span> #d81b60<span class="punctuation">;</span>
<span class="atrule">@font-face</span> <span class="punctuation">{</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">;</span>
  <span class="property">src</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span>https://tinybase.org/fonts/inter.woff2<span class="punctuation">)</span></span> <span class="function">format</span><span class="punctuation">(</span><span class="string">'woff2'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">*</span> <span class="punctuation">{</span>
  <span class="property">box-sizing</span><span class="punctuation">:</span> border<span class="operator">-</span>box<span class="punctuation">;</span>
  <span class="property">outline-color</span><span class="punctuation">:</span> <span class="variable">@accentColor</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">body</span> <span class="punctuation">{</span>
  <span class="property">user-select</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
  <span class="property">display</span><span class="punctuation">:</span> grid<span class="punctuation">;</span>
  <span class="property">grid-template-rows</span><span class="punctuation">:</span> auto 1fr<span class="punctuation">;</span>
  <span class="property">grid-template-columns</span><span class="punctuation">:</span> 1fr 10rem<span class="punctuation">;</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">,</span> sans<span class="operator">-</span>serif<span class="punctuation">;</span>
  <span class="property">letter-spacing</span><span class="punctuation">:</span> <span class="operator">-</span>0.04rem<span class="punctuation">;</span>
  <span class="property">font-size</span><span class="punctuation">:</span> 0.8rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 100vh<span class="punctuation">;</span>

  <span class="selector">#toolbar</span> <span class="punctuation">{</span>
    <span class="property">z-index</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
    <span class="property">grid-column</span><span class="punctuation">:</span> span 2<span class="punctuation">;</span>
    <span class="property">background</span><span class="punctuation">:</span> #ddd<span class="punctuation">;</span>
    <span class="property">display</span><span class="punctuation">:</span> flex<span class="punctuation">;</span>
    <span class="property">align-items</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
    <span class="property">border-bottom</span><span class="punctuation">:</span> 1px solid #aaa<span class="punctuation">;</span>
    <span class="selector">> .button</span> <span class="punctuation">{</span>
      <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
      <span class="property">line-height</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
      <span class="property">white-space</span><span class="punctuation">:</span> nowrap<span class="punctuation">;</span>
      <span class="property">border-right</span><span class="punctuation">:</span> 1px solid #aaa<span class="punctuation">;</span>
      <span class="property">padding</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
      <span class="selector">&amp;:hover</span> <span class="punctuation">{</span>
        <span class="property">background</span><span class="punctuation">:</span> #ccc<span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
        <span class="property">vertical-align</span><span class="punctuation">:</span> top<span class="punctuation">;</span>
        <span class="property">width</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
        <span class="property">height</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
        <span class="property">display</span><span class="punctuation">:</span> inline<span class="operator">-</span>block<span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.undo::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;path fill="none" d="M25 50a42 42 0 0 1 60 0" />&lt;path d="M14 41v20 h20z" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.redo::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;path fill="none" d="M15 50a42 42 0 0 1 60 0" />&lt;path d="M86 41v20 h-20z" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.add::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="20" y="20" width="60" height="60" fill="white"/>&lt;path d="M50 30v40M30 50h40" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.front::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="2" y="2" width="40" height="40" fill="grey"/>&lt;rect x="58" y="58" width="40" height="40" fill="grey"/>&lt;rect x="20" y="20" width="60" height="60" fill="white"/>&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.forward::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="11" y="11" width="60" height="60" fill="grey"/>&lt;rect x="29" y="29" width="60" height="60" fill="white"/>&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.backward::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="11" y="11" width="60" height="60" fill="white"/>&lt;rect x="29" y="29" width="60" height="60" fill="grey"/>&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.back::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="20" y="20" width="60" height="60" fill="white"/>&lt;rect x="2" y="2" width="40" height="40" fill="grey"/>&lt;rect x="58" y="58" width="40" height="40" fill="grey"/>&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.delete::before</span> <span class="punctuation">{</span>
        <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" stroke-width="4" stroke="black">&lt;rect x="20" y="20" width="60" height="60" fill="white"/>&lt;path d="M30 30l40 40M30 70l40-40" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.disabled</span> <span class="punctuation">{</span>
        <span class="property">opacity</span><span class="punctuation">:</span> 0.5<span class="punctuation">;</span>
        <span class="property">cursor</span><span class="punctuation">:</span> default<span class="punctuation">;</span>
        <span class="selector">&amp;:hover</span> <span class="punctuation">{</span>
          <span class="property">background</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>

  <span class="selector">#sidebar</span> <span class="punctuation">{</span>
    <span class="property">z-index</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
    <span class="property">background</span><span class="punctuation">:</span> #eee<span class="punctuation">;</span>
    <span class="property">padding</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
    <span class="property">border-left</span><span class="punctuation">:</span> 1px solid #aaa<span class="punctuation">;</span>
    <span class="selector">.cell</span> <span class="punctuation">{</span>
      <span class="property">height</span><span class="punctuation">:</span> 2rem<span class="punctuation">;</span>
      <span class="property">text-align</span><span class="punctuation">:</span> right<span class="punctuation">;</span>
      <span class="selector">select,
      input,
      .spin</span> <span class="punctuation">{</span>
        <span class="property">font</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
        <span class="property">letter-spacing</span><span class="punctuation">:</span> <span class="operator">-</span>0.05rem<span class="punctuation">;</span>
        <span class="property">margin-left</span><span class="punctuation">:</span> 5px<span class="punctuation">;</span>
        <span class="property">width</span><span class="punctuation">:</span> 4.5rem<span class="punctuation">;</span>
        <span class="property">height</span><span class="punctuation">:</span> 1.4rem<span class="punctuation">;</span>
        <span class="property">display</span><span class="punctuation">:</span> inline<span class="operator">-</span>flex<span class="punctuation">;</span>
        <span class="property">justify-content</span><span class="punctuation">:</span> space<span class="operator">-</span>between<span class="punctuation">;</span>
        <span class="property">align-items</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
        <span class="selector">.button</span> <span class="punctuation">{</span>
          <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
          <span class="property">border</span><span class="punctuation">:</span> 1px solid #aaa<span class="punctuation">;</span>
          <span class="property">font</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
          <span class="property">width</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
          <span class="property">text-align</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
          <span class="selector">&amp;:hover</span> <span class="punctuation">{</span>
            <span class="property">background</span><span class="punctuation">:</span> #ccc<span class="punctuation">;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>

  <span class="selector">#canvas</span> <span class="punctuation">{</span>
    <span class="property">position</span><span class="punctuation">:</span> relative<span class="punctuation">;</span>
    <span class="property">z-index</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
    <span class="selector">.shape</span> <span class="punctuation">{</span>
      <span class="property">align-items</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
      <span class="property">background</span><span class="punctuation">:</span> white<span class="punctuation">;</span>
      <span class="property">border</span><span class="punctuation">:</span> 1px solid black<span class="punctuation">;</span>
      <span class="property">box-sizing</span><span class="punctuation">:</span> border<span class="operator">-</span>box<span class="punctuation">;</span>
      <span class="property">display</span><span class="punctuation">:</span> flex<span class="punctuation">;</span>
      <span class="property">justify-content</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
      <span class="property">position</span><span class="punctuation">:</span> absolute<span class="punctuation">;</span>
      <span class="property">overflow</span><span class="punctuation">:</span> hidden<span class="punctuation">;</span>
      <span class="property">white-space</span><span class="punctuation">:</span> nowrap<span class="punctuation">;</span>
      <span class="property">z-index</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
      <span class="selector">&amp;.ellipse</span> <span class="punctuation">{</span>
        <span class="property">border-radius</span><span class="punctuation">:</span> 50%<span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">&amp;.selected</span> <span class="punctuation">{</span>
        <span class="property">cursor</span><span class="punctuation">:</span> move<span class="punctuation">;</span>
      <span class="punctuation">}</span>
      <span class="selector">input,
      span</span> <span class="punctuation">{</span>
        <span class="property">background</span><span class="punctuation">:</span> transparent<span class="punctuation">;</span>
        <span class="property">border</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
        <span class="property">font</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
        <span class="property">width</span><span class="punctuation">:</span> 100%<span class="punctuation">;</span>
        <span class="property">text-align</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
        <span class="property">margin</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
        <span class="property">text-overflow</span><span class="punctuation">:</span> ellipsis<span class="punctuation">;</span>
        <span class="property">overflow</span><span class="punctuation">:</span> hidden<span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
    <span class="selector">.grip</span> <span class="punctuation">{</span>
      <span class="property">background</span><span class="punctuation">:</span> white<span class="punctuation">;</span>
      <span class="property">border</span><span class="punctuation">:</span> 1px solid <span class="variable">@accentColor</span><span class="punctuation">;</span>
      <span class="property">box-sizing</span><span class="punctuation">:</span> border<span class="operator">-</span>box<span class="punctuation">;</span>
      <span class="property">height</span><span class="punctuation">:</span> 6px<span class="punctuation">;</span>
      <span class="property">margin</span><span class="punctuation">:</span> <span class="operator">-</span>3px<span class="punctuation">;</span>
      <span class="property">position</span><span class="punctuation">:</span> absolute<span class="punctuation">;</span>
      <span class="property">width</span><span class="punctuation">:</span> 6px<span class="punctuation">;</span>
      <span class="property">z-index</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><h3 id="that-s-it">That&#x27;s It!</h3><p>That&#x27;s the drawing app.</p><p>Admittedly, there was a lot going on in here: a demonstration of a <a href="/api/relationships/interfaces/relationships/relationships/"><code>Relationships</code></a>-based linked list, an undo stack, plenty of callbacks, and React hooks galore. On the other hand, we have a fast, and functional drawing application that makes the most of the structured data store underneath. Hopefully that all made sense.</p></section>