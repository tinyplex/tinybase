<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/car-analysis/">Car Analysis</a></li></ul></nav><section class="s1" id="/demos/car-analysis/" data-id="CA"><h1>Car Analysis</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script type=&quot;importmap&quot;&gt;{
    &quot;imports&quot;: {
      &quot;tinybase&quot;: &quot;https://esm.sh/tinybase@6.0.0-beta.1&quot;,
      &quot;tinybase/ui-react&quot;: &quot;https://esm.sh/tinybase@6.0.0-beta.1/ui-react&quot;,
      &quot;tinybase/ui-react-dom&quot;: &quot;https://esm.sh/tinybase@6.0.0-beta.1/ui-react-dom&quot;,
      &quot;tinybase/ui-react-inspector&quot;: &quot;https://esm.sh/tinybase@6.0.0-beta.1/ui-react-inspector&quot;,
      &quot;react&quot;: &quot;https://esm.sh/react@19.0.0&quot;,
      &quot;react/jsx-runtime&quot;: &quot;https://esm.sh/react@19.0.0/jsx-runtime&quot;,
      &quot;react-dom/client&quot;: &quot;https://esm.sh/react-dom@19.0.0/client&quot;
    }
  }&lt;/script&gt;&lt;style&gt;#loading{animation:spin 1s infinite linear;height:2rem;margin:40vh auto;width:2rem}#loading::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;2rem&quot; viewBox=&quot;0 0 100 100&quot;&gt;&lt;path d=&quot;M50 10A40 40 0 1 1 10 50&quot; stroke=&quot;black&quot; fill=&quot;none&quot; stroke-width=&quot;4&quot; /&gt;&lt;/svg&gt;&#x27;)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}body{display:flex;height:100vh}aside{background:#ddd;flex:0;padding:.5rem .5rem 0}main{background:#fff;flex:1;max-height:100vh;padding:.5rem}input{height:1.5rem;margin:0 .25rem 0 0;vertical-align:bottom}hr{margin:.5rem 0 .1rem}table{width:100%;table-layout:fixed;font-size:inherit;line-height:inherit;border-collapse:collapse;align-self:flex-start;margin:.5rem}table caption{text-align:left;height:1.75rem}table caption button{border:0;margin-right:.25rem}table td,table th{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}table th{padding:.25rem;cursor:pointer;border:solid #ddd;border-width:1px 0;text-align:left}table td{border-bottom:1px solid #eee}table td span{border-left:2px solid transparent;padding:.25rem;line-height:1.75rem}svg{stroke:#666;stroke-width:1;fill:#333}svg text{stroke:#fff;stroke-width:4;paint-order:stroke;font-size:12}svg path{fill:none}svg circle{stroke-width:2;fill:#fff;opacity:0}svg circle+text{text-anchor:middle;display:none}svg circle:hover{opacity:1}svg circle:hover+text{display:block}.MPG{stroke-width:2;stroke:#ffb300;border-color:#ffb300;fill:#ffb300}.Cylinders{stroke-width:2;stroke:#803e75;border-color:#803e75;fill:#803e75}.Displacement{stroke-width:2;stroke:#ff6800;border-color:#ff6800;fill:#ff6800}.Horsepower{stroke-width:2;stroke:#a6bdd7;border-color:#a6bdd7;fill:#a6bdd7}.Weight{stroke-width:2;stroke:#c10020;border-color:#c10020;fill:#c10020}.Acceleration{stroke-width:2;stroke:#98ce62;border-color:#98ce62;fill:#98ce62}select{border:1px solid #ccc;display:block;font:inherit;letter-spacing:inherit;width:10rem}select option{border-left:2px solid transparent}@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}*{box-sizing:border-box}body{color:#333;font-family:Inter,sans-serif;letter-spacing:-.04rem;font-size:.8rem;line-height:1.4rem;margin:0;user-select:none}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script type=&quot;module&quot;&gt;import{Fragment as C,jsx as e,jsxs as b}from&quot;react/jsx-runtime&quot;;import{createQueries as G,createStore as O}from&quot;tinybase&quot;;import{Provider as T,useCreateQueries as D,useCreateStore as L,useQueries as N,useResultCell as k,useResultSortedRowIds as P,useResultTable as q}from&quot;tinybase/ui-react&quot;;import{useCallback as A,useEffect as H,useMemo as R,useRef as _,useState as y}from&quot;react&quot;;import{Inspector as j}from&quot;tinybase/ui-react-inspector&quot;;import{ResultSortedTableInHtmlTable as Q}from&quot;tinybase/ui-react-dom&quot;;import{createRoot as B}from&quot;react-dom/client&quot;;const F=[&quot;Manufacturer&quot;,&quot;Name&quot;,&quot;Year&quot;,&quot;Region&quot;],Y=[&quot;MPG&quot;,&quot;Cylinders&quot;,&quot;Displacement&quot;,&quot;Horsepower&quot;,&quot;Weight&quot;,&quot;Acceleration&quot;],I={Maximum:&quot;max&quot;,Average:&quot;avg&quot;,Minimum:&quot;min&quot;},w=11,M=5,z=/^[\d\.]+$/,$=s=&gt;Math.round(s*100)/100,U=()=&gt;{const s=L(O),a=D(s,G),[t,o]=y(!0);return R(async()=&gt;{await X(s),o(!1)},[]),b(T,{store:s,queries:a,children:[t?e(W,{}):e(V,{}),e(j,{})]})},W=()=&gt;e(&quot;div&quot;,{id:&quot;loading&quot;});addEventListener(&quot;load&quot;,()=&gt;B(document.body).render(e(U,{})));const X=async s=&gt;{const a=(await(await fetch(&quot;https://tinybase.org/assets/cars.tsv&quot;)).text()).split(`
`),t=a.shift().split(&quot;	&quot;);s.transaction(()=&gt;a.forEach((o,i)=&gt;{const n=o.split(&quot;	&quot;);n.length==t.length&amp;&amp;n.forEach((c,p)=&gt;{c!=&quot;&quot;&amp;&amp;(z.test(c)&amp;&amp;(c=parseFloat(c)),s.setCell(&quot;cars&quot;,i,t[p],c))})}))},V=()=&gt;{const[s,a]=y([&quot;Manufacturer&quot;]),[t,o]=y([&quot;MPG&quot;,&quot;Horsepower&quot;]),[i,n]=y(&quot;Average&quot;),[c,p]=y(!1),h=J(s,t,i);return b(C,{children:[b(&quot;aside&quot;,{children:[e(&quot;b&quot;,{children:&quot;Dimensions&quot;}),e(S,{options:F,selected:s,onOptionsChange:a}),e(&quot;hr&quot;,{}),e(&quot;b&quot;,{children:&quot;Measures&quot;}),e(S,{options:Y,selected:t,onOptionsChange:o}),e(&quot;hr&quot;,{}),e(&quot;b&quot;,{children:&quot;Aggregate&quot;}),e(S,{options:Object.keys(I),selected:[i],onOptionsChange:n,multiple:!1}),e(&quot;hr&quot;,{}),e(&quot;input&quot;,{id:&quot;showTable&quot;,type:&quot;checkbox&quot;,checked:c,onChange:A(({target:d})=&gt;p(d.checked),[])}),e(&quot;label&quot;,{for:&quot;showTable&quot;,children:&quot;Show table&quot;}),e(&quot;br&quot;,{}),e(&quot;small&quot;,{children:e(&quot;a&quot;,{href:&quot;https://github.com/vega/vega-datasets/blob/next/data/cars.json&quot;,children:&quot;Source&quot;})})]}),c?e(K,{queryId:h,columns:[...s,...t]}):e(ee,{queryId:h,dimensions:s,measures:t})]})},J=(s,a,t)=&gt;R(()=&gt;(N().setQueryDefinition(&quot;query&quot;,&quot;cars&quot;,({select:o,group:i})=&gt;{s.forEach(n=&gt;o(n)),a.forEach(n=&gt;{o(n),i(n,I[t])})}),&quot;query&quot;),[s,a,t]),K=({queryId:s,columns:a})=&gt;e(Q,{queryId:s,sortOnClick:!0,paginator:!0,limit:10,idColumn:!1,customCells:R(()=&gt;Object.fromEntries(a.map(t=&gt;[t,{component:Z}])),[...a])}),Z=({queryId:s,rowId:a,cellId:t})=&gt;{const o=k(s,a,t);return e(&quot;span&quot;,{className:t,children:Number.isFinite(o)?$(o):o})},ee=({queryId:s,dimensions:a,measures:t})=&gt;{const o=_(null),[{width:i=0,height:n=0},c]=y({});H(()=&gt;{const r=new ResizeObserver(([{contentRect:u}])=&gt;c(u));return r.observe(o.current),()=&gt;r.disconnect()},[o]);const[p,h,d]=te(s,a,t),[l,m,x,v,E]=se(i,n,p,d);return i==0||n==0?e(&quot;main&quot;,{ref:o}):e(&quot;main&quot;,{ref:o,children:b(&quot;svg&quot;,{xmlns:&quot;http://www.w3.org/2000/svg&quot;,viewBox:`0 0 ${i} ${n}`,children:[e(&quot;path&quot;,{d:`M${l(0)} ${m(0)}H${l(E)}`}),e(C,{children:x.map((r,u)=&gt;{const f=l(u)-w/2,g=m(0)+M;return r&amp;&amp;e(&quot;text&quot;,{transform:`translate(${f} ${g}) rotate(90)`,children:r},u)})}),e(C,{children:v.map(r=&gt;{const u=l(0)-M,f=m(r)+w/2;return e(&quot;text&quot;,{transform:`translate(${u} ${f})`,&quot;text-anchor&quot;:&quot;end&quot;,children:r},r)})}),h.map((r,u)=&gt;b(&quot;g&quot;,{className:t[u],children:[e(&quot;path&quot;,{d:r.map((f,g)=&gt;`${g==0?&quot;M&quot;:&quot;L&quot;}${l(g)} ${m(f)}`).join(&quot;&quot;)}),r.map((f,g)=&gt;b(C,{children:[e(&quot;circle&quot;,{cx:l(g),cy:m(f),r:M}),b(&quot;text&quot;,{x:l(g),y:m(f)-w,children:[p[g],&quot; &quot;,t[u],&quot;: &quot;,$(f)]})]}))]},u))]})})},te=(s,a,t)=&gt;{const o=q(s),i=P(s,t[0]??void 0);return R(()=&gt;{const n=[1],c=[],p=t.map(()=&gt;[]);return i.forEach(h=&gt;{const d=o[h];c.push(a.map(l=&gt;d[l]).join(&quot;, &quot;)),t.forEach((l,m)=&gt;{n.push(d[l]),p[m].push(d[l])})}),[c,p,Math.max(...n)]},[o,i,t,a])},se=(s,a,t,o)=&gt;R(()=&gt;{const i=a/4,n=s/15,c=s-n-M,p=a-i-M,h=t.length-1,d=t.map((r,u)=&gt;u%Math.ceil(w*h/c)==0?r:null),l=Math.pow(10,Math.floor(Math.log10(o))),m=Math.ceil(o/l)*l,x=Math.ceil(o/l),v=x&lt;=2?5:x&lt;=5?2:1,E=Array(v*x+1).fill().map((r,u)=&gt;u*l/v);return[r=&gt;n+r*c/h,r=&gt;M+p-r*p/m,d,E,h,m]},[s,a,t,o]),S=({options:s,selected:a,onOptionsChange:t,multiple:o=!0})=&gt;{const i=A(({target:n})=&gt;t(o?[...n.selectedOptions].map(c=&gt;c.value):n.value),[t]);return e(&quot;select&quot;,{multiple:o,size:s.length,onChange:i,children:s.map(n=&gt;e(&quot;option&quot;,{value:n,selected:a.includes(n),className:n,children:n}))})};&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this demo, we build an app that showcases the query capabilities of TinyBase v2.0, grouping and sorting dimensional data for lightweight analytical usage.</p><p>The data from this demo is derived from <code>cars.json</code> in the <a href="https://github.com/vega/vega-datasets">Vega datasets</a> - thank you <a href="https://idl.cs.washington.edu/">UW Interactive Data Lab</a>!</p><h3 id="an-overview-of-the-data">An Overview Of The Data</h3><p>Before looking at code, let&#x27;s familiarize ourselves with the data used in this application.</p><p>The raw data is loaded from a TSV file into one single <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> object: <code>cars</code>, and comprises almost 400 records of cars made in the 1970s and 1980s.</p><p>For each, the data includes the manufacturer, the car name, year, and region. These <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values are &#x27;dimensions&#x27; with which the data can be grouped.</p><p>Each record also includes a number of quantitative fields, including the car&#x27;s miles-per-gallon (MPG), the number of cylinders, their displacement, its horsepower, weight, and acceleration. These <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values are &#x27;measures&#x27; which can be aggregated together - in this basic app, to find their average, maximum, or minimum.</p><p>The app is oriented around one single query. As the user picks different dimensions or measures in the app&#x27;s sidebar, that query is re-run and the results (either in graphical or tabular form) reactively update immediately.</p><h3 id="boilerplate">Boilerplate</h3><p>First, we create the import aliases for TinyBase and React modules we&#x27;ll need:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">type</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>importmap<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"><span class="language-javascript">
  <span class="punctuation">{</span>
    <span class="string-property">"imports"</span><span class="operator">:</span> <span class="punctuation">{</span>
      <span class="string-property">"tinybase"</span><span class="operator">:</span> <span class="string">"https://esm.sh/tinybase@6.0.0-beta.1"</span><span class="punctuation">,</span>
      <span class="string-property">"tinybase/ui-react"</span><span class="operator">:</span> <span class="string">"https://esm.sh/tinybase@6.0.0-beta.1/ui-react"</span><span class="punctuation">,</span>
      <span class="string-property">"tinybase/ui-react-dom"</span><span class="operator">:</span> <span class="string">"https://esm.sh/tinybase@6.0.0-beta.1/ui-react-dom"</span><span class="punctuation">,</span>
      <span class="string-property">"tinybase/ui-react-inspector"</span><span class="operator">:</span> <span class="string">"https://esm.sh/tinybase@6.0.0-beta.1/ui-react-inspector"</span><span class="punctuation">,</span>
      <span class="string-property">"react"</span><span class="operator">:</span> <span class="string">"https://esm.sh/react@19.0.0"</span><span class="punctuation">,</span>
      <span class="string-property">"react/jsx-runtime"</span><span class="operator">:</span> <span class="string">"https://esm.sh/react@19.0.0/jsx-runtime"</span><span class="punctuation">,</span>
      <span class="string-property">"react-dom/client"</span><span class="operator">:</span> <span class="string">"https://esm.sh/react-dom@19.0.0/client"</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
</span></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</code></pre><p>We&#x27;re using the <a href="/api/ui-react-inspector/functions/development-components/inspector/"><code>Inspector</code></a> component for the purposes of seeing how the data is structured.</p><p>We need the following parts of the TinyBase API, the <a href="/api/ui-react/"><code>ui-react</code></a> module, and React itself:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createQueries<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>
  Provider<span class="punctuation">,</span>
  useCreateQueries<span class="punctuation">,</span>
  useCreateStore<span class="punctuation">,</span>
  useQueries<span class="punctuation">,</span>
  useResultCell<span class="punctuation">,</span>
  useResultSortedRowIds<span class="punctuation">,</span>
  useResultTable<span class="punctuation">,</span>
<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/ui-react'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>useCallback<span class="punctuation">,</span> useEffect<span class="punctuation">,</span> useMemo<span class="punctuation">,</span> useRef<span class="punctuation">,</span> useState<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'react'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>Inspector<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/ui-react-inspector'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>ResultSortedTableInHtmlTable<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/ui-react-dom'</span><span class="punctuation">;</span>
<span class="keyword">import</span> <span class="punctuation">{</span>createRoot<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'react-dom/client'</span><span class="punctuation">;</span>
<span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span><span class="punctuation">;</span>
</code></pre><p>For simplicity, we set up a few convenience arrays that distinguish the columns present in the data. In a more comprehensive app, these could certainly be programmatically determined.</p><pre><code><span class="keyword">const</span> <span class="constant">DIMENSION_CELL_IDS</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="string">'Manufacturer'</span><span class="punctuation">,</span> <span class="string">'Name'</span><span class="punctuation">,</span> <span class="string">'Year'</span><span class="punctuation">,</span> <span class="string">'Region'</span><span class="punctuation">]</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="constant">MEASURE_CELL_IDS</span> <span class="operator">=</span> <span class="punctuation">[</span>
  <span class="string">'MPG'</span><span class="punctuation">,</span>
  <span class="string">'Cylinders'</span><span class="punctuation">,</span>
  <span class="string">'Displacement'</span><span class="punctuation">,</span>
  <span class="string">'Horsepower'</span><span class="punctuation">,</span>
  <span class="string">'Weight'</span><span class="punctuation">,</span>
  <span class="string">'Acceleration'</span><span class="punctuation">,</span>
<span class="punctuation">]</span><span class="punctuation">;</span>
</code></pre><p>We also set up the list of aggregations that are available in the user interface:</p><pre><code><span class="keyword">const</span> <span class="constant">AGGREGATES</span> <span class="operator">=</span> <span class="punctuation">{</span>
  <span class="literal-property">Maximum</span><span class="operator">:</span> <span class="string">'max'</span><span class="punctuation">,</span>
  <span class="literal-property">Average</span><span class="operator">:</span> <span class="string">'avg'</span><span class="punctuation">,</span>
  <span class="literal-property">Minimum</span><span class="operator">:</span> <span class="string">'min'</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>We set up some constants that we&#x27;ll use in the app to help arrange the graph elements, and to detect numeric values in the imported files so that they can added to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> as numbers:</p><pre><code><span class="keyword">const</span> <span class="constant">GRAPH_FONT</span> <span class="operator">=</span> <span class="number">11</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">GRAPH_PADDING</span> <span class="operator">=</span> <span class="number">5</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">NUMERIC</span> <span class="operator">=</span> <span class="regex"><span class="regex-delimiter">/</span><span class="regex-source">^[\d\.]+$</span><span class="regex-delimiter">/</span></span><span class="punctuation">;</span>
</code></pre><p>And finally, while we are here, we create a handy little function to round down numbers to two significant figures. Nothing clever but sufficient for this basic application.</p><pre><code><span class="keyword">const</span> <span class="function-variable">round</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">value</span><span class="punctuation">)</span> <span class="operator">=></span> Math<span class="punctuation">.</span><span class="function">round</span><span class="punctuation">(</span>value <span class="operator">*</span> <span class="number">100</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="number">100</span><span class="punctuation">;</span>
</code></pre><h3 id="initializing-the-application">Initializing The Application</h3><p>In the main part of the application, we want to initialize a default <a href="/api/store/interfaces/store/store/"><code>Store</code></a> (called <code>store</code>) and a default <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> object. At this point, we are not configuring any queries yet.</p><p>The two <a href="/api/store/interfaces/store/store/"><code>Store</code></a> objects and the <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> object are memoized by the useCreateStore method and useCreateQueries method so they are only created the first time the app is rendered.</p><pre><code><span class="keyword">const</span> <span class="function-variable">App</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span>createStore<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> queries <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/usecreatequeries/">useCreateQueries</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> createQueries<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>This application depends on loading data into the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a> the first time it is rendered. We do this by having an <code>isLoading</code> flag in the application&#x27;s state, and setting it to <code>false</code> only once the asynchronous loading sequence in the (soon-to-be described) <code>loadStore</code> function has completed. Until then, a loading spinner is shown.</p><pre><code>  <span class="comment">// ...</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>isLoading<span class="punctuation">,</span> setIsLoading<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="keyword">async</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">await</span> <span class="function">loadTable</span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">setIsLoading</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react/functions/context-components/provider/">Provider</a></span></span> <span class="attr-name">store</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>store<span class="punctuation">}</span></span> <span class="attr-name">queries</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queries<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>isLoading <span class="operator">?</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Loading</span></span> <span class="punctuation">/></span></span> <span class="operator">:</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Body</span></span> <span class="punctuation">/></span></span><span class="punctuation">}</span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react-inspector/functions/development-components/inspector/">Inspector</a></span></span> <span class="punctuation">/></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name"><a href="/api/ui-react/functions/context-components/provider/">Provider</a></span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><p>We also added the <a href="/api/ui-react-inspector/functions/development-components/inspector/"><code>Inspector</code></a> component at the end there so you can inspect what is going on with the data during this demo. Simply click the TinyBase logo in the corner.</p><p>The loading spinner itself is a plain element with some CSS.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Loading</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>loading<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="punctuation">;</span>
</code></pre><p>This is styled as a 270° arc with a spinning animation:</p><pre><code><span class="selector">#loading</span> <span class="punctuation">{</span>
  <span class="property">animation</span><span class="punctuation">:</span> spin 1s infinite linear<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 2rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 40vh auto<span class="punctuation">;</span>
  <span class="property">width</span><span class="punctuation">:</span> 2rem<span class="punctuation">;</span>
  <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
    <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="2rem" viewBox="0 0 100 100">&lt;path d="M50 10A40 40 0 1 1 10 50" stroke="black" fill="none" stroke-width="4" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="atrule">@keyframes spin</span> <span class="punctuation">{</span>
  <span class="selector">from</span> <span class="punctuation">{</span>
    <span class="property">transform</span><span class="punctuation">:</span> <span class="function">rotate</span><span class="punctuation">(</span>0<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">to</span> <span class="punctuation">{</span>
    <span class="property">transform</span><span class="punctuation">:</span> <span class="function">rotate</span><span class="punctuation">(</span>360deg<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>And finally this simple boilerplate code loads the main <code>App</code> component to start things off:</p><pre><code><span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'load'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">createRoot</span><span class="punctuation">(</span>document<span class="punctuation">.</span>body<span class="punctuation">)</span><span class="punctuation">.</span><span class="function">render</span><span class="punctuation">(</span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">App</span></span> <span class="punctuation">/></span></span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="loading-the-data">Loading The Data</h3><p>The car data has been converted into a tab-separated variable format. TSV files are smaller and faster than JSON to load over the wire.</p><p>In this loading function, we extract the column names from the top of the TSV, check each row has a matching cardinality, use the first column as the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>, coerce numeric <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values, and load everything into a standard <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>.</p><pre><code><span class="keyword">const</span> <span class="function-variable">loadTable</span> <span class="operator">=</span> <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> rows <span class="operator">=</span> <span class="punctuation">(</span>
    <span class="keyword">await</span> <span class="punctuation">(</span><span class="keyword">await</span> <span class="function">fetch</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">https://tinybase.org/assets/cars.tsv</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">text</span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">)</span><span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\n'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> cellIds <span class="operator">=</span> rows<span class="punctuation">.</span><span class="function">shift</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\t'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
    rows<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">row<span class="punctuation">,</span> rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> cells <span class="operator">=</span> row<span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\t'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>cells<span class="punctuation">.</span>length <span class="operator">==</span> cellIds<span class="punctuation">.</span>length<span class="punctuation">)</span> <span class="punctuation">{</span>
        cells<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cell<span class="punctuation">,</span> c</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
          <span class="keyword">if</span> <span class="punctuation">(</span>cell <span class="operator">!=</span> <span class="string">''</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="constant">NUMERIC</span><span class="punctuation">.</span><span class="function">test</span><span class="punctuation">(</span>cell<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
              cell <span class="operator">=</span> <span class="function">parseFloat</span><span class="punctuation">(</span>cell<span class="punctuation">)</span><span class="punctuation">;</span>
            <span class="punctuation">}</span>
            store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'cars'</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellIds<span class="punctuation">[</span>c<span class="punctuation">]</span><span class="punctuation">,</span> cell<span class="punctuation">)</span><span class="punctuation">;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Remember, <code>loadStore</code> was the function referenced in the <a href="#initializing-the-application">main <code>App</code> component</a>, so once this completes, the data is loaded and we&#x27;re ready to go.</p><h3 id="the-body-component">The <code>Body</code> Component</h3><p>The user interface of the application has two modes: a graphical rendering of aggregated data, and a tabular one. In both cases there is a sidebar down the left hand side that allows the user to select dimensions, measures, and the aggregation to be used.</p><p>The <code>Body</code> component wraps the sidebar and the field selection state, and then the <code>ResultGraph</code> and <code>[</code>ResultTable<code>](/api/queries/type-aliases/result/resulttable/)</code> components render the two modes.</p><p>The state of the application is based on selected dimensions and measures, which aggregate is used, and whether the data is rendered as a table. This is set up with the following hooks:</p><pre><code><span class="keyword">const</span> <span class="function-variable">Body</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>dimensions<span class="punctuation">,</span> setDimensions<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="string">'Manufacturer'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>measures<span class="punctuation">,</span> setMeasures<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="string">'MPG'</span><span class="punctuation">,</span> <span class="string">'Horsepower'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>aggregate<span class="punctuation">,</span> setAggregate<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="string">'Average'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>showTable<span class="punctuation">,</span> setAsGraph<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>The first three of these state variables - <code>dimensions</code>, <code>measures</code>, and <code>aggregate</code> - are used to create a query from the <code>cars</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>, and group the fields accordingly. We run the memoized creation of the query in a separate hook (which we&#x27;ll come to shortly), and get its <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> so we can use it in the UI:</p><pre><code><span class="keyword">const</span> queryId <span class="operator">=</span> <span class="function">useBuildQuery</span><span class="punctuation">(</span>dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Here we render the left-hand sidebar, showing the available dimensions, measures, and aggregates. We also show a toggle for the tabular view, and offer a link to the source of the data. (We&#x27;ll also cover the simple <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component later.)</p><pre><code><span class="keyword">return</span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>aside</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Dimensions</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">DIMENSION_CELL_IDS</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>dimensions<span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setDimensions<span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Measures</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">MEASURE_CELL_IDS</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setMeasures<span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Aggregate</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>Object<span class="punctuation">.</span><span class="function">keys</span><span class="punctuation">(</span><span class="constant">AGGREGATES</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span>aggregate<span class="punctuation">]</span><span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setAggregate<span class="punctuation">}</span></span>
        <span class="attr-name">multiple</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="boolean">false</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>input</span>
        <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>showTable<span class="punctuation">"</span></span>
        <span class="attr-name">type</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>checkbox<span class="punctuation">"</span></span>
        <span class="attr-name">checked</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>showTable<span class="punctuation">}</span></span>
        <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>target<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setAsGraph</span><span class="punctuation">(</span>target<span class="punctuation">.</span>checked<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>label</span> <span class="attr-name">for</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>showTable<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">Show table</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>label</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>br</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>small</span><span class="punctuation">></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>a</span> <span class="attr-name">href</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>https://github.com/vega/vega-datasets/blob/next/data/cars.json<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
          Source
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>a</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>small</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>aside</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span><span class="plain-text">
</span></code></pre><p>We complete the <code>Body</code> component with a simple toggle between the two main views, which of course we will also shortly explore in detail. Both take the query <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> and the columns to display:</p><pre><code>      <span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span>
      <span class="punctuation">{</span>showTable <span class="operator">?</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ResultTable</span></span>
          <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
          <span class="attr-name">columns</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="operator">...</span>dimensions<span class="punctuation">,</span> <span class="operator">...</span>measures<span class="punctuation">]</span><span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span>
      <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ResultGraph</span></span>
          <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
          <span class="attr-name">dimensions</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>dimensions<span class="punctuation">}</span></span>
          <span class="attr-name">measures</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>That&#x27;s the main outer structure of the application, but a lot of the magic is in the <code>useBuildQuery</code> hook we mentioned earlier. Whenever the dimensions, measures, or aggregate selections change, we want to run a new query on the data accordingly. Here&#x27;s the implementation:</p><pre><code><span class="keyword">const</span> <span class="function-variable">useBuildQuery</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="function"><a href="/api/ui-react/functions/queries-hooks/usequeries/">useQueries</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'cars'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> group<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      dimensions<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">select</span><span class="punctuation">(</span>cellId<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
      measures<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        <span class="function">select</span><span class="punctuation">(</span>cellId<span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="function">group</span><span class="punctuation">(</span>cellId<span class="punctuation">,</span> <span class="constant">AGGREGATES</span><span class="punctuation">[</span>aggregate<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="string">'query'</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The whole hook is memoized so that the query is not run every time the <code>Body</code> component is run. The query is (imaginatively) called <code>query</code>, and is against the <code>cars</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> in the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a>. The query simply selects every selected dimension, and every selected measure. Each measure is then grouped with the selected aggregate.</p><p>And that&#x27;s it! Enough to query the dataset such that both the graphical and tabular views work. We&#x27;ll dive into <em>their</em> implementations next.</p><p>The styling for the main part of the application is simple:</p><pre><code><span class="selector">body</span> <span class="punctuation">{</span>
  <span class="property">display</span><span class="punctuation">:</span> flex<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 100vh<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">aside</span> <span class="punctuation">{</span>
  <span class="property">background</span><span class="punctuation">:</span> #ddd<span class="punctuation">;</span>
  <span class="property">flex</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">padding</span><span class="punctuation">:</span> 0.5rem 0.5rem 0<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">main</span> <span class="punctuation">{</span>
  <span class="property">background</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
  <span class="property">flex</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
  <span class="property">max-height</span><span class="punctuation">:</span> 100vh<span class="punctuation">;</span>
  <span class="property">padding</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">input</span> <span class="punctuation">{</span>
  <span class="property">height</span><span class="punctuation">:</span> 1.5rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0 0.25rem 0 0<span class="punctuation">;</span>
  <span class="property">vertical-align</span><span class="punctuation">:</span> bottom<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">hr</span> <span class="punctuation">{</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0.5rem 0 0.1rem<span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><h3 id="the-resulttable-api-queries-type-aliases-result-resulttable-component">The <code>[</code>ResultTable<code>](/api/queries/type-aliases/result/resulttable/)</code> Component</h3><p>We start with the tabular view since it&#x27;s a little simpler than the graph. There&#x27;s a slightly more generalized version of this component described in the <a href="/demos/tinymovies/">TinyMovies</a> demo. This one is quite simple.</p><p>Previously there was a whole table implementation in this demo, but as of TinyBase v4.1, we just use the <a href="/api/ui-react-dom/functions/queries-components/resultsortedtableinhtmltable/"><code>ResultSortedTableInHtmlTable</code></a> component from the new <a href="/api/ui-react-dom/"><code>ui-react-dom</code></a> module straight out of the box. The only extra step is transforming the array of selected columns into the customCells prop to render.</p><pre><code><span class="keyword">const</span> <span class="function-variable">ResultTable</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> columns<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react-dom/functions/queries-components/resultsortedtableinhtmltable/">ResultSortedTableInHtmlTable</a></span></span>
    <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
    <span class="attr-name">sortOnClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="boolean">true</span><span class="punctuation">}</span></span>
    <span class="attr-name">paginator</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="boolean">true</span><span class="punctuation">}</span></span>
    <span class="attr-name">limit</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="number">10</span><span class="punctuation">}</span></span>
    <span class="attr-name">idColumn</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="boolean">false</span><span class="punctuation">}</span></span>
    <span class="attr-name">customCells</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">useMemo</span><span class="punctuation">(</span>
      <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
        Object<span class="punctuation">.</span><span class="function">fromEntries</span><span class="punctuation">(</span>
          columns<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">column</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">[</span>column<span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">component</span><span class="operator">:</span> CustomCell<span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span>
        <span class="punctuation">)</span><span class="punctuation">,</span>
      <span class="punctuation">[</span><span class="operator">...</span>columns<span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">}</span></span>
  <span class="punctuation">/></span></span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>We&#x27;re using a slightly custom component for the table cells. If a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> has a numeric value, we crudely round it to two decimal places. Also we give it the cellId as className so we can color the left-hand border.</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> <span class="function-variable">CustomCell</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> cell <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresultcell/">useResultCell</a></span><span class="punctuation">(</span>queryId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>span</span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>cellId<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="punctuation">{</span>Number<span class="punctuation">.</span><span class="function">isFinite</span><span class="punctuation">(</span>cell<span class="punctuation">)</span> <span class="operator">?</span> <span class="function">round</span><span class="punctuation">(</span>cell<span class="punctuation">)</span> <span class="operator">:</span> cell<span class="punctuation">}</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>span</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The styling for the grid is as follows:</p><pre><code><span class="selector">table</span> <span class="punctuation">{</span>
  <span class="property">width</span><span class="punctuation">:</span> 100%<span class="punctuation">;</span>
  <span class="property">table-layout</span><span class="punctuation">:</span> fixed<span class="punctuation">;</span>
  <span class="property">font-size</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">line-height</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">border-collapse</span><span class="punctuation">:</span> collapse<span class="punctuation">;</span>
  <span class="property">align-self</span><span class="punctuation">:</span> flex<span class="operator">-</span>start<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
  <span class="selector">caption</span> <span class="punctuation">{</span>
    <span class="property">text-align</span><span class="punctuation">:</span> left<span class="punctuation">;</span>
    <span class="property">height</span><span class="punctuation">:</span> 1.75rem<span class="punctuation">;</span>
    <span class="selector">button</span> <span class="punctuation">{</span>
      <span class="property">border</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
      <span class="property">margin-right</span><span class="punctuation">:</span> 0.25rem<span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
  <span class="selector">th,
  td</span> <span class="punctuation">{</span>
    <span class="property">overflow</span><span class="punctuation">:</span> hidden<span class="punctuation">;</span>
    <span class="property">white-space</span><span class="punctuation">:</span> nowrap<span class="punctuation">;</span>
    <span class="property">text-overflow</span><span class="punctuation">:</span> ellipsis<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">th</span> <span class="punctuation">{</span>
    <span class="property">padding</span><span class="punctuation">:</span> 0.25rem<span class="punctuation">;</span>
    <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
    <span class="property">border</span><span class="punctuation">:</span> solid #ddd<span class="punctuation">;</span>
    <span class="property">border-width</span><span class="punctuation">:</span> 1px 0<span class="punctuation">;</span>
    <span class="property">text-align</span><span class="punctuation">:</span> left<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">td</span> <span class="punctuation">{</span>
    <span class="property">border-bottom</span><span class="punctuation">:</span> 1px solid #eee<span class="punctuation">;</span>
    <span class="selector">span</span> <span class="punctuation">{</span>
      <span class="property">border-left</span><span class="punctuation">:</span> 2px solid transparent<span class="punctuation">;</span>
      <span class="property">padding</span><span class="punctuation">:</span> 0.25rem<span class="punctuation">;</span>
      <span class="property">line-height</span><span class="punctuation">:</span> 1.75rem<span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>Before we go any further, click around in the tabular view to get a sense of how this component works.</p><h3 id="the-resultgraph-component">The <code>ResultGraph</code> Component</h3><p>The graph view has a little bit more going on, but has the same principle as the grid: it takes the query <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>, and the list of columns to use - this time distinguished as dimensions (for the x-axis) and measures (against the y-axis).</p><p>The graph is rendered in SVG, and to lay it out effectively, we need to know the size of the component on the screen. To track this, we use the browser&#x27;s <code>ResizeObserver</code> API, and set width and height state variables whenever it changes:</p><pre><code><span class="keyword">const</span> <span class="function-variable">ResultGraph</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> dimensions<span class="punctuation">,</span> measures<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useRef</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span><span class="punctuation">{</span>width <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0</span><span class="punctuation">}</span><span class="punctuation">,</span> setDimensions<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> observer <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">ResizeObserver</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">[</span><span class="punctuation">{</span>contentRect<span class="punctuation">}</span><span class="punctuation">]</span></span><span class="punctuation">)</span> <span class="operator">=></span>
      <span class="function">setDimensions</span><span class="punctuation">(</span>contentRect<span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
    observer<span class="punctuation">.</span><span class="function">observe</span><span class="punctuation">(</span>ref<span class="punctuation">.</span>current<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> observer<span class="punctuation">.</span><span class="function">disconnect</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>ref<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>Next we scan the data from the query to put it into the structure we need for the graph. We want a list of all the compound x-axis labels, and a series of y values for every measure. We also use this phase to get the maximum y value present so we can decide how high to make the y-axis:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> <span class="punctuation">[</span>xAllLabels<span class="punctuation">,</span> yValueSets<span class="punctuation">,</span> yMax<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useGraphData</span><span class="punctuation">(</span>
  queryId<span class="punctuation">,</span>
  dimensions<span class="punctuation">,</span>
  measures<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>We&#x27;ll look at the <code>useGraphData</code> implementation shortly.</p><p>Next we take those values and prepare the configuration of the graph itself. The <code>useGraphSetup</code> hook (which we will also look at shortly) returns two functions we&#x27;ll use to lay the SVG elements out. It also returns the exact labels to display on both axes, for example, which take into account how many can be shown, and at a suitable frequency.</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> <span class="punctuation">[</span>xToPixel<span class="punctuation">,</span> yToPixel<span class="punctuation">,</span> xLabels<span class="punctuation">,</span> yLabels<span class="punctuation">,</span> xRange<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useGraphSetup</span><span class="punctuation">(</span>
  width<span class="punctuation">,</span>
  height<span class="punctuation">,</span>
  xAllLabels<span class="punctuation">,</span>
  yMax<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>At this point, we can bail out if the page hasn&#x27;t fully rendered and the width and height aren&#x27;t set yet:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">if</span> <span class="punctuation">(</span>width <span class="operator">==</span> <span class="number">0</span> <span class="operator">||</span> height <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>main</span> <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="comment">// ...</span>
</code></pre><p>But if they are, we can go ahead and build the SVG chart. Firstly the bounding box and x-axis:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">return</span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>main</span> <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>svg</span>
      <span class="attr-name">xmlns</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>http://www.w3.org/2000/svg<span class="punctuation">"</span></span>
      <span class="attr-name">viewBox</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">0 0 </span><span class="interpolation"><span class="interpolation-punctuation">${</span>width<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>height<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
    <span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>path</span> <span class="attr-name">d</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">M</span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">yToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string">H</span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span>xRange<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="plain-text">
</span></code></pre><p>Next, the x-axis labels, offset a little and rotated 90°:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
  </span><span class="punctuation">{</span>xLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">xLabel<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> textX <span class="operator">=</span> <span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_FONT</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
    <span class="keyword">const</span> textY <span class="operator">=</span> <span class="function">yToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span>
      xLabel <span class="operator">&amp;&amp;</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span> <span class="attr-name">transform</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">translate(</span><span class="interpolation"><span class="interpolation-punctuation">${</span>textX<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>textY<span class="interpolation-punctuation">}</span></span><span class="string">) rotate(90)</span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span> <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
          </span><span class="punctuation">{</span>xLabel<span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span>
      <span class="punctuation">)</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
</code></pre><p>Then, the y-axis labels, right-aligned:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
  </span><span class="punctuation">{</span>yLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">yLabel</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> textX <span class="operator">=</span> <span class="function">xToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">const</span> textY <span class="operator">=</span> <span class="function">yToPixel</span><span class="punctuation">(</span>yLabel<span class="punctuation">)</span> <span class="operator">+</span> <span class="constant">GRAPH_FONT</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span>
        <span class="attr-name">transform</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">translate(</span><span class="interpolation"><span class="interpolation-punctuation">${</span>textX<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>textY<span class="interpolation-punctuation">}</span></span><span class="string">)</span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="attr-name">text-anchor</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>end<span class="punctuation">"</span></span>
        <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>yLabel<span class="punctuation">}</span></span>
      <span class="punctuation">></span></span><span class="plain-text">
        </span><span class="punctuation">{</span>yLabel<span class="punctuation">}</span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
</code></pre><p>And finally a <code>&lt;path /&gt;</code> for each measure, as well as series of (by default hidden) <code>&lt;circle /&gt;</code> and <code>&lt;text /&gt;</code> elements tht serve as hover-over labels for each data point:</p><pre><code>        <span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span>
        <span class="punctuation">{</span>yValueSets<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">yValueSet<span class="punctuation">,</span> s</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
          <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>g</span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">[</span>s<span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>s<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
            </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>path</span>
              <span class="attr-name">d</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>yValueSet
                <span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span>
                  <span class="punctuation">(</span><span class="parameter">y<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span>
                    <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>x <span class="operator">==</span> <span class="number">0</span> <span class="operator">?</span> <span class="string">'M'</span> <span class="operator">:</span> <span class="string">'L'</span><span class="interpolation-punctuation">}</span></span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
                <span class="punctuation">)</span>
                <span class="punctuation">.</span><span class="function">join</span><span class="punctuation">(</span><span class="string">''</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
            <span class="punctuation">/></span></span><span class="plain-text">
            </span><span class="punctuation">{</span>yValueSet<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">y<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
              <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>circle</span> <span class="attr-name">cx</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">cy</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">r</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">GRAPH_PADDING</span><span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_FONT</span><span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
                  </span><span class="punctuation">{</span>xAllLabels<span class="punctuation">[</span>x<span class="punctuation">]</span><span class="punctuation">}</span><span class="plain-text"> </span><span class="punctuation">{</span>measures<span class="punctuation">[</span>s<span class="punctuation">]</span><span class="punctuation">}</span><span class="plain-text">: </span><span class="punctuation">{</span><span class="function">round</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span><span class="plain-text">
              </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
            <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>g</span><span class="punctuation">></span></span>
        <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>svg</span><span class="punctuation">></span></span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>main</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>There&#x27;s some styling for the SVG chart, which also takes care of the behavior of the hover-over tooltips.</p><pre><code><span class="selector">svg</span> <span class="punctuation">{</span>
  <span class="property">stroke</span><span class="punctuation">:</span> #666<span class="punctuation">;</span>
  <span class="property">stroke-width</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
  <span class="property">fill</span><span class="punctuation">:</span> #333<span class="punctuation">;</span>
  <span class="selector">text</span> <span class="punctuation">{</span>
    <span class="property">stroke</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
    <span class="property">stroke-width</span><span class="punctuation">:</span> 4<span class="punctuation">;</span>
    <span class="property">paint-order</span><span class="punctuation">:</span> stroke<span class="punctuation">;</span>
    <span class="property">font-size</span><span class="punctuation">:</span> 12<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">path</span> <span class="punctuation">{</span>
    <span class="property">fill</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">circle</span> <span class="punctuation">{</span>
    <span class="property">stroke-width</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
    <span class="property">fill</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
    <span class="property">opacity</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
    <span class="selector">&amp; + text</span> <span class="punctuation">{</span>
      <span class="property">text-anchor</span><span class="punctuation">:</span> middle<span class="punctuation">;</span>
      <span class="property">display</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
    <span class="punctuation">}</span>
    <span class="selector">&amp;:hover</span> <span class="punctuation">{</span>
      <span class="property">opacity</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
      <span class="selector">&amp; + text</span> <span class="punctuation">{</span>
        <span class="property">display</span><span class="punctuation">:</span> block<span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>We have also had a cheeky convention of setting the CSS class names to be <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a>. This allows us to have a consistent color scheme for the measures, across both the sidebar, the table, and the graph:</p><pre><code><span class="selector">.measure(<span class="variable">@color</span>)</span> <span class="punctuation">{</span>
  <span class="property">stroke-width</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
  <span class="property">stroke</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
  <span class="property">border-color</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
  <span class="property">fill</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">.MPG</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#FFB300<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Cylinders</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#803e75<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Displacement</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#FF6800<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Horsepower</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#A6BDD7<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Weight</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#C10020<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Acceleration</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#98ce62<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><h3 id="structuring-the-graph-data">Structuring the Graph Data</h3><p>The following two hooks are needed to configure the data and layout for the graph.</p><p>The first takes the query and the two types of columns. For each <a href="/api/store/type-aliases/store/row/"><code>Row</code></a>, it concatenates the dimensional cells together (to create the labels on the x-axis) and puts the quantitative measure cells into columnar series so we can plot each line. It also determines the maximum y value to be displayed on the chart.</p><p>Note that the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> are sorted according to the values of the first measure selected. In a real analytical scenario, this would be better to be configurable.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useGraphData</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">queryId<span class="punctuation">,</span> dimensions<span class="punctuation">,</span> measures</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> table <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresulttable/">useResultTable</a></span><span class="punctuation">(</span>queryId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> sortedRowIds <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresultsortedrowids/">useResultSortedRowIds</a></span><span class="punctuation">(</span>queryId<span class="punctuation">,</span> measures<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">??</span> <span class="keyword">undefined</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> yAll <span class="operator">=</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xAllLabels <span class="operator">=</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yValueSets <span class="operator">=</span> measures<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
    sortedRowIds<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> row <span class="operator">=</span> table<span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="punctuation">;</span>
      xAllLabels<span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>
        dimensions<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">dimensionColumn</span><span class="punctuation">)</span> <span class="operator">=></span> row<span class="punctuation">[</span>dimensionColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">join</span><span class="punctuation">(</span><span class="string">', '</span><span class="punctuation">)</span><span class="punctuation">,</span>
      <span class="punctuation">)</span><span class="punctuation">;</span>
      measures<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">measureColumn<span class="punctuation">,</span> m</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        yAll<span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>row<span class="punctuation">[</span>measureColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
        yValueSets<span class="punctuation">[</span>m<span class="punctuation">]</span><span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>row<span class="punctuation">[</span>measureColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">[</span>xAllLabels<span class="punctuation">,</span> yValueSets<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span><span class="operator">...</span>yAll<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>table<span class="punctuation">,</span> sortedRowIds<span class="punctuation">,</span> measures<span class="punctuation">,</span> dimensions<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The second hook is responsible for configuring the graph&#x27;s layout. It takes the width and height of the containing element, all the available x-axis labels, and the maximum y value. It then returns two functions for mapping from x/y values to SVG pixels, the set of actual labels to display on each axis (taking into account spacing them so they don&#x27;t overlap), and the ranges of the two axes.</p><p>It&#x27;s not particularly important to understand the mathematics of this hook to understand TinyBase! These are mostly just to create well-spaced labels on the axes, and in a real-world application, you&#x27;d be more likely to use more powerful charting support from something like D3 or Vega.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useGraphSetup</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">width<span class="punctuation">,</span> height<span class="punctuation">,</span> xAllLabels<span class="punctuation">,</span> yMax</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> xOffset <span class="operator">=</span> height <span class="operator">/</span> <span class="number">4</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yOffset <span class="operator">=</span> width <span class="operator">/</span> <span class="number">15</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xWidth <span class="operator">=</span> width <span class="operator">-</span> yOffset <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yHeight <span class="operator">=</span> height <span class="operator">-</span> xOffset <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>

    <span class="keyword">const</span> xRange <span class="operator">=</span> xAllLabels<span class="punctuation">.</span>length <span class="operator">-</span> <span class="number">1</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xLabels <span class="operator">=</span> xAllLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">label<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span>
      x <span class="operator">%</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="constant">GRAPH_FONT</span> <span class="operator">*</span> xRange<span class="punctuation">)</span> <span class="operator">/</span> xWidth<span class="punctuation">)</span> <span class="operator">==</span> <span class="number">0</span> <span class="operator">?</span> label <span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="keyword">const</span> yMaxMagnitude <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">pow</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">floor</span><span class="punctuation">(</span>Math<span class="punctuation">.</span><span class="function">log10</span><span class="punctuation">(</span>yMax<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yRange <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span>yMax <span class="operator">/</span> yMaxMagnitude<span class="punctuation">)</span> <span class="operator">*</span> yMaxMagnitude<span class="punctuation">;</span>
    <span class="keyword">const</span> yMajorSteps <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span>yMax <span class="operator">/</span> yMaxMagnitude<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yMinorSteps <span class="operator">=</span> yMajorSteps <span class="operator">&lt;=</span> <span class="number">2</span> <span class="operator">?</span> <span class="number">5</span> <span class="operator">:</span> yMajorSteps <span class="operator">&lt;=</span> <span class="number">5</span> <span class="operator">?</span> <span class="number">2</span> <span class="operator">:</span> <span class="number">1</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yLabels <span class="operator">=</span> <span class="function">Array</span><span class="punctuation">(</span>yMinorSteps <span class="operator">*</span> yMajorSteps <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function">fill</span><span class="punctuation">(</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">_<span class="punctuation">,</span> i</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>i <span class="operator">*</span> yMaxMagnitude<span class="punctuation">)</span> <span class="operator">/</span> yMinorSteps<span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="keyword">return</span> <span class="punctuation">[</span>
      <span class="punctuation">(</span><span class="parameter">x</span><span class="punctuation">)</span> <span class="operator">=></span> yOffset <span class="operator">+</span> <span class="punctuation">(</span>x <span class="operator">*</span> xWidth<span class="punctuation">)</span> <span class="operator">/</span> xRange<span class="punctuation">,</span>
      <span class="punctuation">(</span><span class="parameter">y</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="constant">GRAPH_PADDING</span> <span class="operator">+</span> yHeight <span class="operator">-</span> <span class="punctuation">(</span>y <span class="operator">*</span> yHeight<span class="punctuation">)</span> <span class="operator">/</span> yRange<span class="punctuation">,</span>
      xLabels<span class="punctuation">,</span>
      yLabels<span class="punctuation">,</span>
      xRange<span class="punctuation">,</span>
      yRange<span class="punctuation">,</span>
    <span class="punctuation">]</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>width<span class="punctuation">,</span> height<span class="punctuation">,</span> xAllLabels<span class="punctuation">,</span> yMax<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="the-select-api-queries-type-aliases-definition-select-component">The <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> Component</h3><p>To build the <code>Body</code> application sidebar, we use some <code>&lt;select /&gt;</code> elements. This simple <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component provides a wrapper around that to callback with either the array of values, or a single value, when selected.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Select</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>options<span class="punctuation">,</span> selected<span class="punctuation">,</span> onOptionsChange<span class="punctuation">,</span> multiple <span class="operator">=</span> <span class="boolean">true</span><span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> handleOptionsChange <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>target<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span>
      <span class="function">onOptionsChange</span><span class="punctuation">(</span>
        multiple
          <span class="operator">?</span> <span class="punctuation">[</span><span class="operator">...</span>target<span class="punctuation">.</span>selectedOptions<span class="punctuation">]</span><span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">option</span><span class="punctuation">)</span> <span class="operator">=></span> option<span class="punctuation">.</span>value<span class="punctuation">)</span>
          <span class="operator">:</span> target<span class="punctuation">.</span>value<span class="punctuation">,</span>
      <span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>onOptionsChange<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>select</span>
      <span class="attr-name">multiple</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>multiple<span class="punctuation">}</span></span>
      <span class="attr-name">size</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>options<span class="punctuation">.</span>length<span class="punctuation">}</span></span>
      <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleOptionsChange<span class="punctuation">}</span></span>
    <span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>options<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">option</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>option</span>
          <span class="attr-name">value</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>option<span class="punctuation">}</span></span>
          <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>selected<span class="punctuation">.</span><span class="function">includes</span><span class="punctuation">(</span>option<span class="punctuation">)</span><span class="punctuation">}</span></span>
          <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>option<span class="punctuation">}</span></span>
        <span class="punctuation">></span></span><span class="plain-text">
          </span><span class="punctuation">{</span>option<span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>option</span><span class="punctuation">></span></span>
      <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>select</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Note that each option is given a CSS class so that we can display the consistent colors for each measure.</p><p>The <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component has some styling of its own:</p><pre><code><span class="selector">select</span> <span class="punctuation">{</span>
  <span class="property">border</span><span class="punctuation">:</span> 1px solid #ccc<span class="punctuation">;</span>
  <span class="property">display</span><span class="punctuation">:</span> block<span class="punctuation">;</span>
  <span class="property">font</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">letter-spacing</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">width</span><span class="punctuation">:</span> 10rem<span class="punctuation">;</span>
  <span class="selector">option</span> <span class="punctuation">{</span>
    <span class="property">border-left</span><span class="punctuation">:</span> 2px solid transparent<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><h3 id="default-styling">Default Styling</h3><p>We finish off with a few final pieces of CSS that are applied across the application.</p><pre><code><span class="atrule">@font-face</span> <span class="punctuation">{</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">;</span>
  <span class="property">src</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span>https://tinybase.org/fonts/inter.woff2<span class="punctuation">)</span></span> <span class="function">format</span><span class="punctuation">(</span><span class="string">'woff2'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">*</span> <span class="punctuation">{</span>
  <span class="property">box-sizing</span><span class="punctuation">:</span> border<span class="operator">-</span>box<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">body</span> <span class="punctuation">{</span>
  <span class="property">color</span><span class="punctuation">:</span> #333<span class="punctuation">;</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">,</span> sans<span class="operator">-</span>serif<span class="punctuation">;</span>
  <span class="property">letter-spacing</span><span class="punctuation">:</span> <span class="operator">-</span>0.04rem<span class="punctuation">;</span>
  <span class="property">font-size</span><span class="punctuation">:</span> 0.8rem<span class="punctuation">;</span>
  <span class="property">line-height</span><span class="punctuation">:</span> 1.4rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">user-select</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre></section>