<!DOCTYPE html><html lang="en"><head><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link href="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ" rel="preload" as="script"><link rel="preload" as="font" href="/fonts/inter.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/inconsolata.woff2" type="font/woff2" crossorigin="anonymous"><title>Car Analysis | TinyBase</title><meta name="description" content="In this demo, we build an app that showcases the query capabilities of TinyBase v2.0, grouping and sorting dimensional data for lightweight analytical usage."><meta property="og:type" content="website"><meta property="og:title" content="Car Analysis | TinyBase"><meta property="og:description" content="In this demo, we build an app that showcases the query capabilities of TinyBase v2.0, grouping and sorting dimensional data for lightweight analytical usage."><meta property="og:url" content="https://beta.tinybase.org/demos/car-analysis/"><meta property="og:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Car Analysis | TinyBase"><meta name="twitter:description" content="In this demo, we build an app that showcases the query capabilities of TinyBase v2.0, grouping and sorting dimensional data for lightweight analytical usage."><meta name="twitter:site" content="@tinybasejs"><meta name="twitter:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css"><link rel="canonical" href="https://beta.tinybase.org/demos/car-analysis/"><script src="/js/app.js"></script></head><body><header><a href="/"><img src="/favicon.svg" alt="TinyBase logo"><span>TinyBase <em title="3.1.0-beta.0">β</em></span></a><nav><ul><li><a href="/guides/">Guides</a></li><li><a href="/demos/">Demos</a></li><li><a href="/api/">API</a></li><li><a href="https://github.com/tinyplex/tinybase">GitHub</a></li></ul></nav><span id="dark"></span></header><main><nav><ul><li id="root" class="parent open"><span></span><a href="/">TinyBase</a><ul><li id="G" class="parent"><span></span><a href="/guides/">Guides</a></li><li id="D2" class="parent open"><span></span><a href="/demos/">Demos</a><ul><li id="HW" class="parent"><span></span><a href="/demos/hello-world/">Hello World</a></li><li id="RD" class="parent"><span></span><a href="/demos/rolling-dice/">Rolling Dice</a></li><li id="C2"><span></span><a href="/demos/countries/">Countries</a></li><li id="TA" class="parent"><span></span><a href="/demos/todo-app/">Todo App</a></li><li id="D3"><span></span><a href="/demos/drawing/">Drawing</a></li><li id="CD"><span></span><a href="/demos/city-database/">City Database</a></li><li id="CA" class="current"><span></span><a href="/demos/car-analysis/">Car Analysis</a></li><li id="MD"><span></span><a href="/demos/movie-database/">Movie Database</a></li><li id="WF"><span></span><a href="/demos/word-frequencies/">Word Frequencies</a></li></ul></li><li id="api" class="parent"><span></span><a href="/api/">API</a></li></ul></li></ul></nav><article><nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/car-analysis/">Car Analysis</a></li></ul></nav><section class="s1" id="/demos/car-analysis/" data-id="CA"><h1>Car Analysis</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script src=&quot;/umd/react.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/ui-react.js&quot;&gt;&lt;/script&gt;&lt;style&gt;#loading{animation:spin 1s infinite linear;height:2rem;margin:40vh auto;width:2rem}#loading::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;2rem&quot; viewBox=&quot;0 0 100 100&quot;&gt;&lt;path d=&quot;M50 10A40 40 0 1 1 10 50&quot; stroke=&quot;black&quot; fill=&quot;none&quot; stroke-width=&quot;4&quot; /&gt;&lt;/svg&gt;&#x27;)}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}body{display:flex;height:100vh}aside{background:#ddd;flex:0;padding:.5rem .5rem 0}main{background:#fff;flex:1;max-height:100vh;padding:.5rem}input{height:1.5rem;margin:0 .25rem 0 0;vertical-align:bottom}hr{margin:.5rem 0 .1rem}table{width:100%;table-layout:fixed;font-size:inherit;line-height:inherit;border-collapse:collapse}table td,table th{padding:.25rem .5rem .25rem 0;overflow:hidden;white-space:nowrap}table th{cursor:pointer;border:solid #ddd;border-width:0 0 2px;text-align:left}table td{border-bottom:1px solid #eee}button{border:0;cursor:pointer;height:1rem;padding:0;vertical-align:text-top;width:1rem}button.prev{margin-left:.5rem}button.prev::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; fill=&quot;black&quot;&gt;&lt;path d=&quot;M65 20v60l-30-30z&quot; /&gt;&lt;/svg&gt;&#x27;)}button.next{margin-right:.5rem}button.next::before{content:url(&#x27;data:image/svg+xml,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;1rem&quot; viewBox=&quot;0 0 100 100&quot; fill=&quot;black&quot;&gt;&lt;path d=&quot;M35 20v60l30-30z&quot; /&gt;&lt;/svg&gt;&#x27;)}button.disabled{cursor:default;opacity:.3}svg{stroke:#666;stroke-width:1;fill:#333}svg text{stroke:#fff;stroke-width:4;paint-order:stroke;font-size:12}svg path{fill:none}svg circle{stroke-width:2;fill:#fff;opacity:0}svg circle+text{text-anchor:middle;display:none}svg circle:hover{opacity:1}svg circle:hover+text{display:block}.MPG{stroke-width:2;stroke:#ffb300;border-color:#ffb300;fill:#ffb300}.Cylinders{stroke-width:2;stroke:#803e75;border-color:#803e75;fill:#803e75}.Displacement{stroke-width:2;stroke:#ff6800;border-color:#ff6800;fill:#ff6800}.Horsepower{stroke-width:2;stroke:#a6bdd7;border-color:#a6bdd7;fill:#a6bdd7}.Weight{stroke-width:2;stroke:#c10020;border-color:#c10020;fill:#c10020}.Acceleration{stroke-width:2;stroke:#98ce62;border-color:#98ce62;fill:#98ce62}select{border:1px solid #ccc;display:block;font:inherit;letter-spacing:inherit;width:10rem}select option{border-left:2px solid transparent}@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}*{box-sizing:border-box}body{color:#333;font-family:Inter,sans-serif;letter-spacing:-.04rem;font-size:.8rem;line-height:1.4rem;margin:0;user-select:none}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script&gt;(()=&gt;{const g=React[&quot;createElement&quot;],{createQueries:s,createStore:l}=TinyBase,{Provider:r,ResultSortedTableView:d,useCreateQueries:o,useCreateStore:u,useQueries:t,useResultCell:h,useResultRowIds:p,useResultSortedRowIds:n,useResultTable:c}=TinyBaseUiReact,{useCallback:b,useEffect:f,useMemo:i,useRef:v,useState:y}=React,m=[&quot;Manufacturer&quot;,&quot;Name&quot;,&quot;Year&quot;,&quot;Region&quot;],R=[&quot;MPG&quot;,&quot;Cylinders&quot;,&quot;Displacement&quot;,&quot;Horsepower&quot;,&quot;Weight&quot;,&quot;Acceleration&quot;],w={Maximum:&quot;max&quot;,Average:&quot;avg&quot;,Minimum:&quot;min&quot;},M=/^[\d\.]+$/,C=e=&gt;Math.round(100*e)/100,e=()=&gt;{const e=u(l),t=o(e,s),[a,n]=y(!0);return i(async()=&gt;{await k(e),n(!1)},[]),g(r,{store:e,queries:t},g(a?x:I,null))},x=()=&gt;g(&quot;div&quot;,{id:&quot;loading&quot;});addEventListener(&quot;load&quot;,()=&gt;ReactDOM.createRoot(document.body).render(g(e,null)));const k=async n=&gt;{const e=(await(await fetch(&quot;https://tinybase.org/assets/cars.tsv&quot;)).text()).split(`
`),s=e.shift().split(&quot;\t&quot;);n.transaction(()=&gt;e.forEach((e,a)=&gt;{const t=e.split(&quot;\t&quot;);t.length==s.length&amp;&amp;t.forEach((e,t)=&gt;{&quot;&quot;!=e&amp;&amp;(M.test(e)&amp;&amp;(e=parseFloat(e)),n.setCell(&quot;cars&quot;,a,s[t],e))})}))},I=()=&gt;{const[e,t]=y([&quot;Manufacturer&quot;]),[a,n]=y([&quot;MPG&quot;,&quot;Horsepower&quot;]),[s,l]=y(&quot;Average&quot;),[r,o]=y(!1),u=N(e,a,s);return g(React.Fragment,null,g(&quot;aside&quot;,null,g(&quot;b&quot;,null,&quot;Dimensions&quot;),g($,{options:m,selected:e,onOptionsChange:t}),g(&quot;hr&quot;,null),g(&quot;b&quot;,null,&quot;Measures&quot;),g($,{options:R,selected:a,onOptionsChange:n}),g(&quot;hr&quot;,null),g(&quot;b&quot;,null,&quot;Aggregate&quot;),g($,{options:Object.keys(w),selected:[s],onOptionsChange:l,multiple:!1}),g(&quot;hr&quot;,null),g(&quot;input&quot;,{id:&quot;showTable&quot;,type:&quot;checkbox&quot;,checked:r,onChange:b(({target:e})=&gt;o(e.checked),[])}),g(&quot;label&quot;,{for:&quot;showTable&quot;},&quot;Show table&quot;),g(&quot;br&quot;,null),g(&quot;small&quot;,null,g(&quot;a&quot;,{href:&quot;https://github.com/vega/vega-datasets/blob/next/data/cars.json&quot;},&quot;Source&quot;))),r?g(q,{queryId:u,columns:[...e,...a]}):g(E,{queryId:u,dimensions:e,measures:a}))},N=(e,n,s)=&gt;i(()=&gt;(t().setQueryDefinition(&quot;query&quot;,&quot;cars&quot;,({select:t,group:a})=&gt;{e.forEach(e=&gt;t(e)),n.forEach(e=&gt;{t(e),a(e,w[s])})}),&quot;query&quot;),[e,n,s]),q=({queryId:e,columns:n})=&gt;{const[t,a]=y(&quot;id&quot;),[s,l]=y(!1),[r,o]=y(0),u=p(e).length;r&gt;u&amp;&amp;o(0);var c=b(()=&gt;g(React.Fragment,null,u,&quot; record&quot;,1!=u?&quot;s&quot;:&quot;&quot;,10&lt;u&amp;&amp;g(React.Fragment,null,0&lt;r?g(&quot;button&quot;,{className:&quot;prev&quot;,onClick:()=&gt;o(r-10)}):g(&quot;button&quot;,{className:&quot;prev disabled&quot;}),r+10&lt;u?g(&quot;button&quot;,{className:&quot;next&quot;,onClick:()=&gt;o(r+10)}):g(&quot;button&quot;,{className:&quot;next disabled&quot;}),r+1,&quot; to &quot;,Math.min(u,r+10))),[u,r,10]),i=b(()=&gt;g(&quot;tr&quot;,null,n.map(e=&gt;e==t?g(&quot;th&quot;,{onClick:()=&gt;l(!s),className:e},s?&quot;↓&quot;:&quot;↑&quot;,&quot; &quot;,e):g(&quot;th&quot;,{onClick:()=&gt;a(e),className:e},e))),[t,s,...n]),m=b(({queryId:t,rowId:a})=&gt;g(&quot;tr&quot;,null,n.map(e=&gt;{e=h(t,a,e);return g(&quot;td&quot;,null,Number.isFinite(e)?C(e):e)})),n);return g(&quot;main&quot;,null,g(c,null),g(&quot;table&quot;,null,g(i,null),g(d,{queryId:e,cellId:t,descending:s,offset:r,limit:10,resultRowComponent:m})))},E=({queryId:e,dimensions:t,measures:n})=&gt;{const a=v(null),[{width:s=0,height:l=0},r]=y({});f(()=&gt;{const e=new ResizeObserver(([{contentRect:e}])=&gt;r(e));return e.observe(a.current),()=&gt;e.disconnect()},[a]);const[o,u,c]=F(e,t,n),[i,m,d,h,p]=O(s,l,o,c);return 0==s||0==l?g(&quot;main&quot;,{ref:a}):g(&quot;main&quot;,{ref:a},g(&quot;svg&quot;,{xmlns:&quot;http://www.w3.org/2000/svg&quot;,viewBox:`0 0 ${s} `+l},g(&quot;path&quot;,{d:`M${i(0)} ${m(0)}H`+i(p)}),g(React.Fragment,null,d.map((e,t)=&gt;{var a=i(t)-6,n=m(0)+6;return e&amp;&amp;g(&quot;text&quot;,{transform:`translate(${a} ${n}) rotate(90)`,key:t},e)})),g(React.Fragment,null,h.map(e=&gt;{var t=i(0)-6,a=m(e)+6;return g(&quot;text&quot;,{transform:`translate(${t} ${a})`,&quot;text-anchor&quot;:&quot;end&quot;,key:e},e)})),u.map((e,a)=&gt;g(&quot;g&quot;,{className:n[a],key:a},g(&quot;path&quot;,{d:e.map((e,t)=&gt;(0==t?&quot;M&quot;:&quot;L&quot;)+i(t)+&quot; &quot;+m(e)).join(&quot;&quot;)}),e.map((e,t)=&gt;g(React.Fragment,null,g(&quot;circle&quot;,{cx:i(t),cy:m(e),r:6}),g(&quot;text&quot;,{x:i(t),y:m(e)-12},o[t],&quot; &quot;,n[a],&quot;: &quot;,C(e))))))))},F=(e,l,r)=&gt;{const o=c(e),a=n(e,r[0]??void 0);return i(()=&gt;{const n=[1],t=[],s=r.map(()=&gt;[]);return a.forEach(e=&gt;{const a=o[e];t.push(l.map(e=&gt;a[e]).join(&quot;, &quot;)),r.forEach((e,t)=&gt;{n.push(a[e]),s[t].push(a[e])})}),[t,s,Math.max(...n)]},[o,a,r,l])},O=(m,d,h,p)=&gt;i(()=&gt;{const e=d/4,t=m/15,a=m-t-6,n=d-e-6,s=h.length-1,l=h.map((e,t)=&gt;t%Math.ceil(12*s/a)==0?e:null),r=Math.pow(10,Math.floor(Math.log10(p))),o=Math.ceil(p/r)*r,u=Math.ceil(p/r),c=u&lt;=2?5:u&lt;=5?2:1,i=Array(c*u+1).fill().map((e,t)=&gt;t*r/c);return[e=&gt;t+e*a/s,e=&gt;6+n-e*n/o,l,i,s,o]},[m,d,h,p]),$=({options:e,selected:t,onOptionsChange:a,multiple:n=!0})=&gt;{var s=b(({target:e})=&gt;a(n?[...e.selectedOptions].map(e=&gt;e.value):e.value),[a]);return g(&quot;select&quot;,{multiple:n,size:e.length,onChange:s},e.map(e=&gt;g(&quot;option&quot;,{value:e,selected:t.includes(e),className:e},e)))}})()&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this demo, we build an app that showcases the query capabilities of <a href="/">TinyBase</a> v2.0, grouping and sorting dimensional data for lightweight analytical usage.</p><p>The data from this demo is derived from <code>cars.json</code> in the <a href="https://github.com/vega/vega-datasets">Vega datasets</a> - thank you <a href="https://idl.cs.washington.edu/">UW Interactive Data Lab</a>!</p><h3 id="an-overview-of-the-data">An Overview Of The Data</h3><p>Before looking at code, let&#x27;s familiarize ourselves with the data used in this application.</p><p>The raw data is loaded from a TSV file into one single <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> object: <code>cars</code>, and comprises almost 400 records of cars made in the 1970s and 1980s.</p><p>For each, the data includes the manufacturer, the car name, year, and region. These <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values are &#x27;dimensions&#x27; with which the data can be grouped.</p><p>Each record also includes a number of quantitative fields, including the car&#x27;s miles-per-gallon (MPG), the number of cylinders, their displacement, its horsepower, weight, and acceleration. These <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values are &#x27;measures&#x27; which can be aggregated together - in this basic app, to find their average, maximum, or minimum.</p><p>The app is oriented around one single query. As the user picks different dimensions or measures in the app&#x27;s sidebar, that query is re-run and the results (either in graphical or tabular form) reactively update immediately.</p><h3 id="boilerplate">Boilerplate</h3><p>As per usual, we first pull in React, ReactDOM, and <a href="/">TinyBase</a>:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/react.production.min.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/react-dom.production.min.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
<span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/ui-react.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</code></pre><p>We need the following parts of the <a href="/">TinyBase</a> API, the <a href="/api/ui-react/"><code>ui-react</code></a> module, and React itself:</p><pre><code><span class="keyword">const</span> <span class="punctuation">{</span>createQueries<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>
  Provider<span class="punctuation">,</span>
  ResultSortedTableView<span class="punctuation">,</span>
  useCreateQueries<span class="punctuation">,</span>
  useCreateStore<span class="punctuation">,</span>
  useQueries<span class="punctuation">,</span>
  useResultCell<span class="punctuation">,</span>
  useResultRowIds<span class="punctuation">,</span>
  useResultSortedRowIds<span class="punctuation">,</span>
  useResultTable<span class="punctuation">,</span>
<span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReact<span class="punctuation">;</span>
<span class="keyword">const</span> <span class="punctuation">{</span>createElement<span class="punctuation">,</span> useCallback<span class="punctuation">,</span> useEffect<span class="punctuation">,</span> useMemo<span class="punctuation">,</span> useRef<span class="punctuation">,</span> useState<span class="punctuation">}</span> <span class="operator">=</span>
  React<span class="punctuation">;</span>
</code></pre><p>For simplicity, we set up a few convenience arrays that distinguish the columns present in the data. In a more comprehensive app, these could certainly be programmatically determined.</p><pre><code><span class="keyword">const</span> <span class="constant">DIMENSION_CELL_IDS</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="string">'Manufacturer'</span><span class="punctuation">,</span> <span class="string">'Name'</span><span class="punctuation">,</span> <span class="string">'Year'</span><span class="punctuation">,</span> <span class="string">'Region'</span><span class="punctuation">]</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="constant">MEASURE_CELL_IDS</span> <span class="operator">=</span> <span class="punctuation">[</span>
  <span class="string">'MPG'</span><span class="punctuation">,</span>
  <span class="string">'Cylinders'</span><span class="punctuation">,</span>
  <span class="string">'Displacement'</span><span class="punctuation">,</span>
  <span class="string">'Horsepower'</span><span class="punctuation">,</span>
  <span class="string">'Weight'</span><span class="punctuation">,</span>
  <span class="string">'Acceleration'</span><span class="punctuation">,</span>
<span class="punctuation">]</span><span class="punctuation">;</span>
</code></pre><p>We also set up the list of aggregations that are available in the user interface:</p><pre><code><span class="keyword">const</span> <span class="constant">AGGREGATES</span> <span class="operator">=</span> <span class="punctuation">{</span>
  <span class="literal-property">Maximum</span><span class="operator">:</span> <span class="string">'max'</span><span class="punctuation">,</span>
  <span class="literal-property">Average</span><span class="operator">:</span> <span class="string">'avg'</span><span class="punctuation">,</span>
  <span class="literal-property">Minimum</span><span class="operator">:</span> <span class="string">'min'</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>We set up some constants that we&#x27;ll use in the app to help arrange the graph elements, and to detect numeric values in the imported files so that they can added to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> as numbers:</p><pre><code><span class="keyword">const</span> <span class="constant">GRAPH_FONT</span> <span class="operator">=</span> <span class="number">12</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">GRAPH_PADDING</span> <span class="operator">=</span> <span class="number">6</span><span class="punctuation">;</span>
<span class="keyword">const</span> <span class="constant">NUMERIC</span> <span class="operator">=</span> <span class="regex"><span class="regex-delimiter">/</span><span class="regex-source">^[\d\.]+$</span><span class="regex-delimiter">/</span></span><span class="punctuation">;</span>
</code></pre><p>And finally, while we are here, we create a handy little function to round down numbers to two significant figures. Nothing clever but sufficient for this basic application.</p><pre><code><span class="keyword">const</span> <span class="function-variable">round</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">value</span><span class="punctuation">)</span> <span class="operator">=></span> Math<span class="punctuation">.</span><span class="function">round</span><span class="punctuation">(</span>value <span class="operator">*</span> <span class="number">100</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="number">100</span><span class="punctuation">;</span>
</code></pre><h3 id="initializing-the-application">Initializing The Application</h3><p>In the main part of the application, we want to initialize a default <a href="/api/store/interfaces/store/store/"><code>Store</code></a> (called <code>store</code>) and a default <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> object. At this point, we are not configuring any queries yet.</p><p>The two <a href="/api/store/interfaces/store/store/"><code>Store</code></a> objects and the <a href="/api/queries/interfaces/queries/queries/"><code>Queries</code></a> object are memoized by the useCreateStore method and useCreateQueries method so they are only created the first time the app is rendered.</p><pre><code><span class="keyword">const</span> <span class="function-variable">App</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span>createStore<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> queries <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/usecreatequeries/">useCreateQueries</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> createQueries<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>This application depends on loading data into the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a> the first time it is rendered. We do this by having an <code>isLoading</code> flag in the application&#x27;s state, and setting it to <code>false</code> only once the asynchronous loading sequence in the (soon-to-be described) <code>loadStore</code> function has completed. Until then, a loading spinner is shown.</p><pre><code>  <span class="comment">// ...</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>isLoading<span class="punctuation">,</span> setIsLoading<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="keyword">async</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">await</span> <span class="function">loadTable</span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="function">setIsLoading</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react/functions/context-components/provider/">Provider</a></span></span> <span class="attr-name">store</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>store<span class="punctuation">}</span></span> <span class="attr-name">queries</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queries<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>isLoading <span class="operator">?</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Loading</span></span> <span class="punctuation">/></span></span> <span class="operator">:</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Body</span></span> <span class="punctuation">/></span></span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name"><a href="/api/ui-react/functions/context-components/provider/">Provider</a></span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><p>The loading spinner itself is a plain element with some CSS.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Loading</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>loading<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="punctuation">;</span>
</code></pre><p>This is styled as a 270° arc with a spinning animation:</p><pre><code><span class="selector">#loading</span> <span class="punctuation">{</span>
  <span class="property">animation</span><span class="punctuation">:</span> spin 1s infinite linear<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 2rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 40vh auto<span class="punctuation">;</span>
  <span class="property">width</span><span class="punctuation">:</span> 2rem<span class="punctuation">;</span>
  <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
    <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="2rem" viewBox="0 0 100 100">&lt;path d="M50 10A40 40 0 1 1 10 50" stroke="black" fill="none" stroke-width="4" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>

<span class="atrule">@keyframes spin</span> <span class="punctuation">{</span>
  <span class="selector">from</span> <span class="punctuation">{</span>
    <span class="property">transform</span><span class="punctuation">:</span> <span class="function">rotate</span><span class="punctuation">(</span>0<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">to</span> <span class="punctuation">{</span>
    <span class="property">transform</span><span class="punctuation">:</span> <span class="function">rotate</span><span class="punctuation">(</span>360deg<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>And finally this simple boilerplate code loads the main <code>App</code> component to start things off:</p><pre><code><span class="function">addEventListener</span><span class="punctuation">(</span><span class="string">'load'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  ReactDOM<span class="punctuation">.</span><span class="function">createRoot</span><span class="punctuation">(</span>document<span class="punctuation">.</span>body<span class="punctuation">)</span><span class="punctuation">.</span><span class="function">render</span><span class="punctuation">(</span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">App</span></span> <span class="punctuation">/></span></span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="loading-the-data">Loading The Data</h3><p>The car data has been converted into a tab-separated variable format. TSV files are smaller and faster than JSON to load over the wire.</p><p>In this loading function, we extract the column names from the top of the TSV, check each row has a matching cardinality, use the first column as the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>, coerce numeric <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> values, and load everything into a standard <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>.</p><pre><code><span class="keyword">const</span> <span class="function-variable">loadTable</span> <span class="operator">=</span> <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> rows <span class="operator">=</span> <span class="punctuation">(</span>
    <span class="keyword">await</span> <span class="punctuation">(</span><span class="keyword">await</span> <span class="function">fetch</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">https://tinybase.org/assets/cars.tsv</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">text</span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">)</span><span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\n'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> cellIds <span class="operator">=</span> rows<span class="punctuation">.</span><span class="function">shift</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\t'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
    rows<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">row<span class="punctuation">,</span> rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> cells <span class="operator">=</span> row<span class="punctuation">.</span><span class="function">split</span><span class="punctuation">(</span><span class="string">'\t'</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">if</span> <span class="punctuation">(</span>cells<span class="punctuation">.</span>length <span class="operator">==</span> cellIds<span class="punctuation">.</span>length<span class="punctuation">)</span> <span class="punctuation">{</span>
        cells<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cell<span class="punctuation">,</span> c</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
          <span class="keyword">if</span> <span class="punctuation">(</span>cell <span class="operator">!=</span> <span class="string">''</span><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">if</span> <span class="punctuation">(</span><span class="constant">NUMERIC</span><span class="punctuation">.</span><span class="function">test</span><span class="punctuation">(</span>cell<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">{</span>
              cell <span class="operator">=</span> <span class="function">parseFloat</span><span class="punctuation">(</span>cell<span class="punctuation">)</span><span class="punctuation">;</span>
            <span class="punctuation">}</span>
            store<span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'cars'</span><span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellIds<span class="punctuation">[</span>c<span class="punctuation">]</span><span class="punctuation">,</span> cell<span class="punctuation">)</span><span class="punctuation">;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Remember, <code>loadStore</code> was the function referenced in the <a href="#initializing-the-application">main <code>App</code> component</a>, so once this completes, the data is loaded and we&#x27;re ready to go.</p><h3 id="the-body-component">The <code>Body</code> Component</h3><p>The user interface of the application has two modes: a graphical rendering of aggregated data, and a tabular one. In both cases there is a sidebar down the left hand side that allows the user to select dimensions, measures, and the aggregation to be used.</p><p>The <code>Body</code> component wraps the sidebar and the field selection state, and then the <code>ResultGraph</code> and <code>ResultSortableGrid</code> components render the two modes.</p><p>The state of the application is based on selected dimensions and measures, which aggregate is used, and whether the data is rendered as a table. This is set up with the following hooks:</p><pre><code><span class="keyword">const</span> <span class="function-variable">Body</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>dimensions<span class="punctuation">,</span> setDimensions<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="string">'Manufacturer'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>measures<span class="punctuation">,</span> setMeasures<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">[</span><span class="string">'MPG'</span><span class="punctuation">,</span> <span class="string">'Horsepower'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>aggregate<span class="punctuation">,</span> setAggregate<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="string">'Average'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>showTable<span class="punctuation">,</span> setAsGraph<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>The first three of these state variables - <code>dimensions</code>, <code>measures</code>, and <code>aggregate</code> - are used to create a query from the <code>cars</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>, and group the fields accordingly. We run the memoized creation of the query in a separate hook (which we&#x27;ll come to shortly), and get its <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> so we can use it in the UI:</p><pre><code><span class="keyword">const</span> queryId <span class="operator">=</span> <span class="function">useBuildQuery</span><span class="punctuation">(</span>dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Here we render the left-hand sidebar, showing the available dimensions, measures, and aggregates. We also show a toggle for the tabular view, and offer a link to the source of the data. (We&#x27;ll also cover the simple <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component later.)</p><pre><code><span class="keyword">return</span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>aside</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Dimensions</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">DIMENSION_CELL_IDS</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>dimensions<span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setDimensions<span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Measures</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">MEASURE_CELL_IDS</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setMeasures<span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>b</span><span class="punctuation">></span></span><span class="plain-text">Aggregate</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>b</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Select</span></span>
        <span class="attr-name">options</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>Object<span class="punctuation">.</span><span class="function">keys</span><span class="punctuation">(</span><span class="constant">AGGREGATES</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
        <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span>aggregate<span class="punctuation">]</span><span class="punctuation">}</span></span>
        <span class="attr-name">onOptionsChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>setAggregate<span class="punctuation">}</span></span>
        <span class="attr-name">multiple</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="boolean">false</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>hr</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>input</span>
        <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>showTable<span class="punctuation">"</span></span>
        <span class="attr-name">type</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>checkbox<span class="punctuation">"</span></span>
        <span class="attr-name">checked</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>showTable<span class="punctuation">}</span></span>
        <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>target<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setAsGraph</span><span class="punctuation">(</span>target<span class="punctuation">.</span>checked<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
      <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>label</span> <span class="attr-name">for</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>showTable<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">Show table</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>label</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>br</span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>small</span><span class="punctuation">></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>a</span> <span class="attr-name">href</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>https://github.com/vega/vega-datasets/blob/next/data/cars.json<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
          Source
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>a</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>small</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>aside</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span><span class="plain-text">
</span></code></pre><p>We complete the <code>Body</code> component with a simple toggle between the two main views, which of course we will also shortly explore in detail. Both take the query <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> and the columns to display:</p><pre><code>      <span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span>
      <span class="punctuation">{</span>showTable <span class="operator">?</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ResultSortableGrid</span></span>
          <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
          <span class="attr-name">columns</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">[</span><span class="operator">...</span>dimensions<span class="punctuation">,</span> <span class="operator">...</span>measures<span class="punctuation">]</span><span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span>
      <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">ResultGraph</span></span>
          <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
          <span class="attr-name">dimensions</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>dimensions<span class="punctuation">}</span></span>
          <span class="attr-name">measures</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>That&#x27;s the main outer structure of the application, but a lot of the magic is in the <code>useBuildQuery</code> hook we mentioned earlier. Whenever the dimensions, measures, or aggregate selections change, we want to run a new query on the data accordingly. Here&#x27;s the implementation:</p><pre><code><span class="keyword">const</span> <span class="function-variable">useBuildQuery</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="function"><a href="/api/ui-react/functions/queries-hooks/usequeries/">useQueries</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/queries/interfaces/queries/queries/methods/configuration/setquerydefinition/">setQueryDefinition</a></span><span class="punctuation">(</span><span class="string">'query'</span><span class="punctuation">,</span> <span class="string">'cars'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>select<span class="punctuation">,</span> group<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      dimensions<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">select</span><span class="punctuation">(</span>cellId<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
      measures<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        <span class="function">select</span><span class="punctuation">(</span>cellId<span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="function">group</span><span class="punctuation">(</span>cellId<span class="punctuation">,</span> <span class="constant">AGGREGATES</span><span class="punctuation">[</span>aggregate<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="string">'query'</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>dimensions<span class="punctuation">,</span> measures<span class="punctuation">,</span> aggregate<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The whole hook is memoized so that the query is not run every time the <code>Body</code> component is run. The query is (imaginatively) called <code>query</code>, and is against the <code>cars</code> <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> in the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a>. The query simply selects every selected dimension, and every selected measure. Each measure is then grouped with the selected aggregate.</p><p>And that&#x27;s it! Enough to query the dataset such that both the graphical and tabular views work. We&#x27;ll dive into <em>their</em> implementations next.</p><p>The styling for the main part of the application is simple:</p><pre><code><span class="selector">body</span> <span class="punctuation">{</span>
  <span class="property">display</span><span class="punctuation">:</span> flex<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 100vh<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">aside</span> <span class="punctuation">{</span>
  <span class="property">background</span><span class="punctuation">:</span> #ddd<span class="punctuation">;</span>
  <span class="property">flex</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">padding</span><span class="punctuation">:</span> 0.5rem 0.5rem 0<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">main</span> <span class="punctuation">{</span>
  <span class="property">background</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
  <span class="property">flex</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
  <span class="property">max-height</span><span class="punctuation">:</span> 100vh<span class="punctuation">;</span>
  <span class="property">padding</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">input</span> <span class="punctuation">{</span>
  <span class="property">height</span><span class="punctuation">:</span> 1.5rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0 0.25rem 0 0<span class="punctuation">;</span>
  <span class="property">vertical-align</span><span class="punctuation">:</span> bottom<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">hr</span> <span class="punctuation">{</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0.5rem 0 0.1rem<span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><h3 id="the-resultsortablegrid-component">The <code>ResultSortableGrid</code> Component</h3><p>We start with the tabular view since it&#x27;s a little simpler than the graph. There&#x27;s a slightly more generalized version of this component described in the <a href="/demos/tinymovies/">TinyMovies</a> demo. This one is quite simple.</p><p>The component takes the name of the query to render, and an array of the columns to render. The component also stores state for which column is being used to sort the results, in which direction, and whether the records to display are offset from the start of the results (in other words, due to pagination):</p><pre><code><span class="keyword">const</span> <span class="function-variable">ResultSortableGrid</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> columns<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="constant">LIMIT</span> <span class="operator">=</span> <span class="number">10</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>sortCellId<span class="punctuation">,</span> setSortCellId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="string">'id'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>descending<span class="punctuation">,</span> setDescending<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>offset<span class="punctuation">,</span> setOffset<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> count <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresultrowids/">useResultRowIds</a></span><span class="punctuation">(</span>queryId<span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>Since users can dramatically shorten the number of results of the grid by changing the fields to aggregate, we need to defend against previous pagination &#x27;overshooting&#x27; the number of rows now available:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">if</span> <span class="punctuation">(</span>offset <span class="operator">></span> count<span class="punctuation">)</span> <span class="punctuation">{</span>
  <span class="function">setOffset</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="comment">// ...</span>
</code></pre><p>The <code>Pagination</code> component shows the number of records, and offers buttons to paginate through them if more than 10:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> Pagination <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
  <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>count<span class="punctuation">}</span><span class="plain-text"> record</span><span class="punctuation">{</span>count <span class="operator">!=</span> <span class="number">1</span> <span class="operator">?</span> <span class="string">'s'</span> <span class="operator">:</span> <span class="string">''</span><span class="punctuation">}</span><span class="plain-text">
      </span><span class="punctuation">{</span>count <span class="operator">></span> <span class="constant">LIMIT</span> <span class="operator">&amp;&amp;</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
          </span><span class="punctuation">{</span>offset <span class="operator">></span> <span class="number">0</span> <span class="operator">?</span> <span class="punctuation">(</span>
            <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>button</span>
              <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>prev<span class="punctuation">"</span></span>
              <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setOffset</span><span class="punctuation">(</span>offset <span class="operator">-</span> <span class="constant">LIMIT</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
            <span class="punctuation">/></span></span>
          <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
            <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>button</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>prev disabled<span class="punctuation">"</span></span> <span class="punctuation">/></span></span>
          <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
          </span><span class="punctuation">{</span>offset <span class="operator">+</span> <span class="constant">LIMIT</span> <span class="operator">&lt;</span> count <span class="operator">?</span> <span class="punctuation">(</span>
            <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>button</span>
              <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>next<span class="punctuation">"</span></span>
              <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setOffset</span><span class="punctuation">(</span>offset <span class="operator">+</span> <span class="constant">LIMIT</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
            <span class="punctuation">/></span></span>
          <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
            <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>button</span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>next disabled<span class="punctuation">"</span></span> <span class="punctuation">/></span></span>
          <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
          </span><span class="punctuation">{</span>offset <span class="operator">+</span> <span class="number">1</span><span class="punctuation">}</span><span class="plain-text"> to </span><span class="punctuation">{</span>Math<span class="punctuation">.</span><span class="function">min</span><span class="punctuation">(</span>count<span class="punctuation">,</span> offset <span class="operator">+</span> <span class="constant">LIMIT</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
      <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">[</span>count<span class="punctuation">,</span> offset<span class="punctuation">,</span> <span class="constant">LIMIT</span><span class="punctuation">]</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>The <code>HeadingComponent</code> lists the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> and supports the user clicking on a new one to sort by that <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> (or clicking on the existing one to reverse the current sort):</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> HeadingComponent <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
  <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>tr</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>columns<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span>
        cellId <span class="operator">==</span> sortCellId <span class="operator">?</span> <span class="punctuation">(</span>
          <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>th</span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setDescending</span><span class="punctuation">(</span><span class="operator">!</span>descending<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>cellId<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
            </span><span class="punctuation">{</span>descending <span class="operator">?</span> <span class="string">'\u2193'</span> <span class="operator">:</span> <span class="string">'\u2191'</span><span class="punctuation">}</span><span class="plain-text"> </span><span class="punctuation">{</span>cellId<span class="punctuation">}</span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>th</span><span class="punctuation">></span></span>
        <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
          <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>th</span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setSortCellId</span><span class="punctuation">(</span>cellId<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>cellId<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
            </span><span class="punctuation">{</span>cellId<span class="punctuation">}</span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>th</span><span class="punctuation">></span></span>
        <span class="punctuation">)</span><span class="punctuation">,</span>
      <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>tr</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">[</span>sortCellId<span class="punctuation">,</span> descending<span class="punctuation">,</span> <span class="operator">...</span>columns<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>(We cheekily add the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> as a CSS class so that we can color the measure headings&#x27; borders.)</p><p>And finally we create a <code>RowComponent</code> for each row of the grid. If a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> is numeric, we crudely round it to two decimal places.</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> RowComponent <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
  <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> rowId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>tr</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>columns<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">cellId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        <span class="keyword">const</span> cell <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresultcell/">useResultCell</a></span><span class="punctuation">(</span>queryId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">)</span><span class="punctuation">;</span>
        <span class="keyword">return</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>td</span><span class="punctuation">></span></span><span class="punctuation">{</span>Number<span class="punctuation">.</span><span class="function">isFinite</span><span class="punctuation">(</span>cell<span class="punctuation">)</span> <span class="operator">?</span> <span class="function">round</span><span class="punctuation">(</span>cell<span class="punctuation">)</span> <span class="operator">:</span> cell<span class="punctuation">}</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>td</span><span class="punctuation">></span></span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>tr</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">,</span>
  columns<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>The final <code>ResultSortableGrid</code> component is rendered by placing the pagination next to the table, and using the <code>ResultSortedTableView</code> provided by the <a href="/">TinyBase</a> <a href="/api/ui-react/"><code>ui-react</code></a> module to render the rows according to the sorting.</p><pre><code>  <span class="comment">// ...</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>main</span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Pagination</span></span> <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>table</span><span class="punctuation">></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">HeadingComponent</span></span> <span class="punctuation">/></span></span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react/functions/queries-components/resultsortedtableview/">ResultSortedTableView</a></span></span>
          <span class="attr-name">queryId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>queryId<span class="punctuation">}</span></span>
          <span class="attr-name">cellId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>sortCellId<span class="punctuation">}</span></span>
          <span class="attr-name">descending</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>descending<span class="punctuation">}</span></span>
          <span class="attr-name">offset</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>offset<span class="punctuation">}</span></span>
          <span class="attr-name">limit</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">LIMIT</span><span class="punctuation">}</span></span>
          <span class="attr-name">resultRowComponent</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>RowComponent<span class="punctuation">}</span></span>
        <span class="punctuation">/></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>table</span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>main</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The styling for the grid is as follows:</p><pre><code><span class="selector">table</span> <span class="punctuation">{</span>
  <span class="property">width</span><span class="punctuation">:</span> 100%<span class="punctuation">;</span>
  <span class="property">table-layout</span><span class="punctuation">:</span> fixed<span class="punctuation">;</span>
  <span class="property">font-size</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">line-height</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">border-collapse</span><span class="punctuation">:</span> collapse<span class="punctuation">;</span>
  <span class="selector">th,
  td</span> <span class="punctuation">{</span>
    <span class="property">padding</span><span class="punctuation">:</span> 0.25rem 0.5rem 0.25rem 0<span class="punctuation">;</span>
    <span class="property">overflow</span><span class="punctuation">:</span> hidden<span class="punctuation">;</span>
    <span class="property">white-space</span><span class="punctuation">:</span> nowrap<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">th</span> <span class="punctuation">{</span>
    <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
    <span class="property">border</span><span class="punctuation">:</span> solid #ddd<span class="punctuation">;</span>
    <span class="property">border-width</span><span class="punctuation">:</span> 0 0 2px<span class="punctuation">;</span>
    <span class="property">text-align</span><span class="punctuation">:</span> left<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">td</span> <span class="punctuation">{</span>
    <span class="property">border-bottom</span><span class="punctuation">:</span> 1px solid #eee<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>The pagination buttons are formatted with some SVG of their own:</p><pre><code><span class="selector">button</span> <span class="punctuation">{</span>
  <span class="property">border</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
  <span class="property">height</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
  <span class="property">padding</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">vertical-align</span><span class="punctuation">:</span> text<span class="operator">-</span>top<span class="punctuation">;</span>
  <span class="property">width</span><span class="punctuation">:</span> 1rem<span class="punctuation">;</span>
  <span class="selector">&amp;.prev</span> <span class="punctuation">{</span>
    <span class="property">margin-left</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
    <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
      <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" fill="black">&lt;path d="M65 20v60l-30-30z" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
  <span class="selector">&amp;.next</span> <span class="punctuation">{</span>
    <span class="property">margin-right</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
    <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
      <span class="property">content</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span><span class="string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 100 100" fill="black">&lt;path d="M35 20v60l30-30z" />&lt;/svg>'</span><span class="punctuation">)</span></span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
  <span class="selector">&amp;.disabled</span> <span class="punctuation">{</span>
    <span class="property">cursor</span><span class="punctuation">:</span> default<span class="punctuation">;</span>
    <span class="property">opacity</span><span class="punctuation">:</span> 0.3<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>Before we go any further, click around in the tabular view to get a sense of how this component works.</p><h3 id="the-resultgraph-component">The <code>ResultGraph</code> Component</h3><p>The graph view has a little bit more going on, but has the same principle as the grid: it takes the query <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>, and the list of columns to use - this time distinguished as dimensions (for the x-axis) and measures (against the y-axis).</p><p>The graph is rendered in SVG, and to lay it out effectively, we need to know the size of the component on the screen. To track this, we use the browser&#x27;s <code>ResizeObserver</code> API, and set width and height state variables whenever it changes:</p><pre><code><span class="keyword">const</span> <span class="function-variable">ResultGraph</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>queryId<span class="punctuation">,</span> dimensions<span class="punctuation">,</span> measures<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> ref <span class="operator">=</span> <span class="function">useRef</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> <span class="punctuation">[</span><span class="punctuation">{</span>width <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0</span><span class="punctuation">}</span><span class="punctuation">,</span> setDimensions<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="function">useEffect</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> observer <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">ResizeObserver</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">[</span><span class="punctuation">{</span>contentRect<span class="punctuation">}</span><span class="punctuation">]</span></span><span class="punctuation">)</span> <span class="operator">=></span>
      <span class="function">setDimensions</span><span class="punctuation">(</span>contentRect<span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
    observer<span class="punctuation">.</span><span class="function">observe</span><span class="punctuation">(</span>ref<span class="punctuation">.</span>current<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> observer<span class="punctuation">.</span><span class="function">disconnect</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>ref<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="comment">// ...</span>
</code></pre><p>Next we scan the data from the query to put it into the structure we need for the graph. We want a list of all the compound x-axis labels, and a series of y values for every measure. We also use this phase to get the maximum y value present so we can decide how high to make the y-axis:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> <span class="punctuation">[</span>xAllLabels<span class="punctuation">,</span> yValueSets<span class="punctuation">,</span> yMax<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useGraphData</span><span class="punctuation">(</span>
  queryId<span class="punctuation">,</span>
  dimensions<span class="punctuation">,</span>
  measures<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>We&#x27;ll look at the <code>useGraphData</code> implementation shortly.</p><p>Next we take those values and prepare the configuration of the graph itself. The <code>useGraphSetup</code> hook (which we will also look at shortly) returns two functions we&#x27;ll use to lay the SVG elements out. It also returns the exact labels to display on both axes, for example, which take into account how many can be shown, and at a suitable frequency.</p><pre><code><span class="comment">// ...</span>
<span class="keyword">const</span> <span class="punctuation">[</span>xToPixel<span class="punctuation">,</span> yToPixel<span class="punctuation">,</span> xLabels<span class="punctuation">,</span> yLabels<span class="punctuation">,</span> xRange<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useGraphSetup</span><span class="punctuation">(</span>
  width<span class="punctuation">,</span>
  height<span class="punctuation">,</span>
  xAllLabels<span class="punctuation">,</span>
  yMax<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ...</span>
</code></pre><p>At this point, we can bail out if the page hasn&#x27;t fully rendered and the width and height aren&#x27;t set yet:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">if</span> <span class="punctuation">(</span>width <span class="operator">==</span> <span class="number">0</span> <span class="operator">||</span> height <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">{</span>
  <span class="keyword">return</span> <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>main</span> <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="comment">// ...</span>
</code></pre><p>But if they are, we can go ahead and build the SVG chart. Firstly the bounding box and x-axis:</p><pre><code><span class="comment">// ...</span>
<span class="keyword">return</span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>main</span> <span class="attr-name">ref</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>ref<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>svg</span>
      <span class="attr-name">xmlns</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>http://www.w3.org/2000/svg<span class="punctuation">"</span></span>
      <span class="attr-name">viewBox</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">0 0 </span><span class="interpolation"><span class="interpolation-punctuation">${</span>width<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>height<span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
    <span class="punctuation">></span></span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>path</span> <span class="attr-name">d</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">M</span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">yToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string">H</span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span>xRange<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="plain-text">
</span></code></pre><p>Next, the x-axis labels, offset a little and rotated 90°:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
  </span><span class="punctuation">{</span>xLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">xLabel<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> textX <span class="operator">=</span> <span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_FONT</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
    <span class="keyword">const</span> textY <span class="operator">=</span> <span class="function">yToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span>
      xLabel <span class="operator">&amp;&amp;</span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span> <span class="attr-name">transform</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">translate(</span><span class="interpolation"><span class="interpolation-punctuation">${</span>textX<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>textY<span class="interpolation-punctuation">}</span></span><span class="string">) rotate(90)</span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span> <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>x<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
          </span><span class="punctuation">{</span>xLabel<span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span>
      <span class="punctuation">)</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
</code></pre><p>Then, the y-axis labels, right-aligned:</p><pre><code><span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
  </span><span class="punctuation">{</span>yLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">yLabel</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> textX <span class="operator">=</span> <span class="function">xToPixel</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">const</span> textY <span class="operator">=</span> <span class="function">yToPixel</span><span class="punctuation">(</span>yLabel<span class="punctuation">)</span> <span class="operator">+</span> <span class="constant">GRAPH_FONT</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">(</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span>
        <span class="attr-name">transform</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">translate(</span><span class="interpolation"><span class="interpolation-punctuation">${</span>textX<span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span>textY<span class="interpolation-punctuation">}</span></span><span class="string">)</span><span class="template-punctuation">`</span></span><span class="punctuation">}</span></span>
        <span class="attr-name">text-anchor</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>end<span class="punctuation">"</span></span>
        <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>yLabel<span class="punctuation">}</span></span>
      <span class="punctuation">></span></span><span class="plain-text">
        </span><span class="punctuation">{</span>yLabel<span class="punctuation">}</span><span class="plain-text">
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span>
    <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
</code></pre><p>And finally a <code>&lt;path /&gt;</code> for each measure, as well as series of (by default hidden) <code>&lt;circle /&gt;</code> and <code>&lt;text /&gt;</code> elements tht serve as hover-over labels for each data point:</p><pre><code>        <span class="punctuation">{</span><span class="comment">/* ... */</span><span class="punctuation">}</span>
        <span class="punctuation">{</span>yValueSets<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">yValueSet<span class="punctuation">,</span> s</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
          <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>g</span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>measures<span class="punctuation">[</span>s<span class="punctuation">]</span><span class="punctuation">}</span></span> <span class="attr-name">key</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>s<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
            </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>path</span>
              <span class="attr-name">d</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>yValueSet
                <span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span>
                  <span class="punctuation">(</span><span class="parameter">y<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span>
                    <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>x <span class="operator">==</span> <span class="number">0</span> <span class="operator">?</span> <span class="string">'M'</span> <span class="operator">:</span> <span class="string">'L'</span><span class="interpolation-punctuation">}</span></span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="string"> </span><span class="interpolation"><span class="interpolation-punctuation">${</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="interpolation-punctuation">}</span></span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
                <span class="punctuation">)</span>
                <span class="punctuation">.</span><span class="function">join</span><span class="punctuation">(</span><span class="string">''</span><span class="punctuation">)</span><span class="punctuation">}</span></span>
            <span class="punctuation">/></span></span><span class="plain-text">
            </span><span class="punctuation">{</span>yValueSet<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">y<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
              <span class="tag"><span class="tag"><span class="punctuation">&lt;</span></span><span class="punctuation">></span></span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>circle</span> <span class="attr-name">cx</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">cy</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">r</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="constant">GRAPH_PADDING</span><span class="punctuation">}</span></span> <span class="punctuation">/></span></span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>text</span> <span class="attr-name">x</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">xToPixel</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">}</span></span> <span class="attr-name">y</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="function">yToPixel</span><span class="punctuation">(</span>y<span class="punctuation">)</span> <span class="operator">-</span> <span class="constant">GRAPH_FONT</span><span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
                  </span><span class="punctuation">{</span>xAllLabels<span class="punctuation">[</span>x<span class="punctuation">]</span><span class="punctuation">}</span><span class="plain-text"> </span><span class="punctuation">{</span>measures<span class="punctuation">[</span>s<span class="punctuation">]</span><span class="punctuation">}</span><span class="plain-text">: </span><span class="punctuation">{</span><span class="function">round</span><span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
                </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>text</span><span class="punctuation">></span></span><span class="plain-text">
              </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span></span><span class="punctuation">></span></span>
            <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
          </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>g</span><span class="punctuation">></span></span>
        <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>svg</span><span class="punctuation">></span></span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>main</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>There&#x27;s some styling for the SVG chart, which also takes care of the behavior of the hover-over tooltips.</p><pre><code><span class="selector">svg</span> <span class="punctuation">{</span>
  <span class="property">stroke</span><span class="punctuation">:</span> #666<span class="punctuation">;</span>
  <span class="property">stroke-width</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
  <span class="property">fill</span><span class="punctuation">:</span> #333<span class="punctuation">;</span>
  <span class="selector">text</span> <span class="punctuation">{</span>
    <span class="property">stroke</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
    <span class="property">stroke-width</span><span class="punctuation">:</span> 4<span class="punctuation">;</span>
    <span class="property">paint-order</span><span class="punctuation">:</span> stroke<span class="punctuation">;</span>
    <span class="property">font-size</span><span class="punctuation">:</span> 12<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">path</span> <span class="punctuation">{</span>
    <span class="property">fill</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">circle</span> <span class="punctuation">{</span>
    <span class="property">stroke-width</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
    <span class="property">fill</span><span class="punctuation">:</span> #fff<span class="punctuation">;</span>
    <span class="property">opacity</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
    <span class="selector">&amp; + text</span> <span class="punctuation">{</span>
      <span class="property">text-anchor</span><span class="punctuation">:</span> middle<span class="punctuation">;</span>
      <span class="property">display</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
    <span class="punctuation">}</span>
    <span class="selector">&amp;:hover</span> <span class="punctuation">{</span>
      <span class="property">opacity</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
      <span class="selector">&amp; + text</span> <span class="punctuation">{</span>
        <span class="property">display</span><span class="punctuation">:</span> block<span class="punctuation">;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>We have also had a cheeky convention of setting the CSS class names to be <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a>. This allows us to have a consistent color scheme for the measures, across both the sidebar, the table, and the graph:</p><pre><code><span class="selector">.measure(<span class="variable">@color</span>)</span> <span class="punctuation">{</span>
  <span class="property">stroke-width</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
  <span class="property">stroke</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
  <span class="property">border-color</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
  <span class="property">fill</span><span class="punctuation">:</span> <span class="variable">@color</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">.MPG</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#FFB300<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Cylinders</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#803e75<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Displacement</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#FF6800<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Horsepower</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#A6BDD7<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Weight</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#C10020<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="selector">.Acceleration</span> <span class="punctuation">{</span>
  <span class="mixin-usage">.measure</span><span class="punctuation">(</span>#98ce62<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre><h3 id="structuring-the-graph-data">Structuring the Graph Data</h3><p>The following two hooks are needed to configure the data and layout for the graph.</p><p>The first takes the query and the two types of columns. For each <a href="/api/store/type-aliases/store/row/"><code>Row</code></a>, it concatenates the dimensional cells together (to create the labels on the x-axis) and puts the quantitative measure cells into columnar series so we can plot each line. It also determines the maximum y value to be displayed on the chart.</p><p>Note that the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> <a href="/api/common/type-aliases/identity/ids/"><code>Ids</code></a> are sorted according to the values of the first measure selected. In a real analytical scenario, this would be better to be configurable.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useGraphData</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">queryId<span class="punctuation">,</span> dimensions<span class="punctuation">,</span> measures</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> table <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresulttable/">useResultTable</a></span><span class="punctuation">(</span>queryId<span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> sortedRowIds <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/queries-hooks/useresultsortedrowids/">useResultSortedRowIds</a></span><span class="punctuation">(</span>queryId<span class="punctuation">,</span> measures<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">??</span> <span class="keyword">undefined</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> yAll <span class="operator">=</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xAllLabels <span class="operator">=</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yValueSets <span class="operator">=</span> measures<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
    sortedRowIds<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">rowId</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> row <span class="operator">=</span> table<span class="punctuation">[</span>rowId<span class="punctuation">]</span><span class="punctuation">;</span>
      xAllLabels<span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>
        dimensions<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">dimensionColumn</span><span class="punctuation">)</span> <span class="operator">=></span> row<span class="punctuation">[</span>dimensionColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function">join</span><span class="punctuation">(</span><span class="string">', '</span><span class="punctuation">)</span><span class="punctuation">,</span>
      <span class="punctuation">)</span><span class="punctuation">;</span>
      measures<span class="punctuation">.</span><span class="function">forEach</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">measureColumn<span class="punctuation">,</span> m</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
        yAll<span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>row<span class="punctuation">[</span>measureColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
        yValueSets<span class="punctuation">[</span>m<span class="punctuation">]</span><span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span>row<span class="punctuation">[</span>measureColumn<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> <span class="punctuation">[</span>xAllLabels<span class="punctuation">,</span> yValueSets<span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">max</span><span class="punctuation">(</span><span class="operator">...</span>yAll<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>table<span class="punctuation">,</span> sortedRowIds<span class="punctuation">,</span> measures<span class="punctuation">,</span> dimensions<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>The second hook is responsible for configuring the graph&#x27;s layout. It takes the width and height of the containing element, all the available x-axis labels, and the maximum y value. It then returns two functions for mapping from x/y values to SVG pixels, the set of actual labels to display on each axis (taking into account spacing them so they don&#x27;t overlap), and the ranges of the two axes.</p><p>It&#x27;s not particularly important to understand the mathematics of this hook to understand <a href="/">TinyBase</a>! These are mostly just to create well-spaced labels on the axes, and in a real-world application, you&#x27;d be more likely to use more powerful charting support from something like D3 or Vega.</p><pre><code><span class="keyword">const</span> <span class="function-variable">useGraphSetup</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter">width<span class="punctuation">,</span> height<span class="punctuation">,</span> xAllLabels<span class="punctuation">,</span> yMax</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="function">useMemo</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> xOffset <span class="operator">=</span> height <span class="operator">/</span> <span class="number">4</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yOffset <span class="operator">=</span> width <span class="operator">/</span> <span class="number">15</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xWidth <span class="operator">=</span> width <span class="operator">-</span> yOffset <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yHeight <span class="operator">=</span> height <span class="operator">-</span> xOffset <span class="operator">-</span> <span class="constant">GRAPH_PADDING</span><span class="punctuation">;</span>

    <span class="keyword">const</span> xRange <span class="operator">=</span> xAllLabels<span class="punctuation">.</span>length <span class="operator">-</span> <span class="number">1</span><span class="punctuation">;</span>
    <span class="keyword">const</span> xLabels <span class="operator">=</span> xAllLabels<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">label<span class="punctuation">,</span> x</span><span class="punctuation">)</span> <span class="operator">=></span>
      x <span class="operator">%</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="constant">GRAPH_FONT</span> <span class="operator">*</span> xRange<span class="punctuation">)</span> <span class="operator">/</span> xWidth<span class="punctuation">)</span> <span class="operator">==</span> <span class="number">0</span> <span class="operator">?</span> label <span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">,</span>
    <span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="keyword">const</span> yMaxMagnitude <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">pow</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> Math<span class="punctuation">.</span><span class="function">floor</span><span class="punctuation">(</span>Math<span class="punctuation">.</span><span class="function">log10</span><span class="punctuation">(</span>yMax<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yRange <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span>yMax <span class="operator">/</span> yMaxMagnitude<span class="punctuation">)</span> <span class="operator">*</span> yMaxMagnitude<span class="punctuation">;</span>
    <span class="keyword">const</span> yMajorSteps <span class="operator">=</span> Math<span class="punctuation">.</span><span class="function">ceil</span><span class="punctuation">(</span>yMax <span class="operator">/</span> yMaxMagnitude<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yMinorSteps <span class="operator">=</span> yMajorSteps <span class="operator">&lt;=</span> <span class="number">2</span> <span class="operator">?</span> <span class="number">5</span> <span class="operator">:</span> yMajorSteps <span class="operator">&lt;=</span> <span class="number">5</span> <span class="operator">?</span> <span class="number">2</span> <span class="operator">:</span> <span class="number">1</span><span class="punctuation">;</span>
    <span class="keyword">const</span> yLabels <span class="operator">=</span> <span class="function">Array</span><span class="punctuation">(</span>yMinorSteps <span class="operator">*</span> yMajorSteps <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function">fill</span><span class="punctuation">(</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">_<span class="punctuation">,</span> i</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>i <span class="operator">*</span> yMaxMagnitude<span class="punctuation">)</span> <span class="operator">/</span> yMinorSteps<span class="punctuation">)</span><span class="punctuation">;</span>

    <span class="keyword">return</span> <span class="punctuation">[</span>
      <span class="punctuation">(</span><span class="parameter">x</span><span class="punctuation">)</span> <span class="operator">=></span> yOffset <span class="operator">+</span> <span class="punctuation">(</span>x <span class="operator">*</span> xWidth<span class="punctuation">)</span> <span class="operator">/</span> xRange<span class="punctuation">,</span>
      <span class="punctuation">(</span><span class="parameter">y</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="constant">GRAPH_PADDING</span> <span class="operator">+</span> yHeight <span class="operator">-</span> <span class="punctuation">(</span>y <span class="operator">*</span> yHeight<span class="punctuation">)</span> <span class="operator">/</span> yRange<span class="punctuation">,</span>
      xLabels<span class="punctuation">,</span>
      yLabels<span class="punctuation">,</span>
      xRange<span class="punctuation">,</span>
      yRange<span class="punctuation">,</span>
    <span class="punctuation">]</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>width<span class="punctuation">,</span> height<span class="punctuation">,</span> xAllLabels<span class="punctuation">,</span> yMax<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><h3 id="the-select-api-queries-type-aliases-definition-select-component">The <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> Component</h3><p>To build the <code>Body</code> application sidebar, we use some <code>&lt;select /&gt;</code> elements. This simple <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component provides a wrapper around that to callback with either the array of values, or a single value, when selected.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Select</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>options<span class="punctuation">,</span> selected<span class="punctuation">,</span> onOptionsChange<span class="punctuation">,</span> multiple <span class="operator">=</span> <span class="boolean">true</span><span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> handleOptionsChange <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span>
    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>target<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span>
      <span class="function">onOptionsChange</span><span class="punctuation">(</span>
        multiple
          <span class="operator">?</span> <span class="punctuation">[</span><span class="operator">...</span>target<span class="punctuation">.</span>selectedOptions<span class="punctuation">]</span><span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">option</span><span class="punctuation">)</span> <span class="operator">=></span> option<span class="punctuation">.</span>value<span class="punctuation">)</span>
          <span class="operator">:</span> target<span class="punctuation">.</span>value<span class="punctuation">,</span>
      <span class="punctuation">)</span><span class="punctuation">,</span>
    <span class="punctuation">[</span>onOptionsChange<span class="punctuation">]</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>select</span>
      <span class="attr-name">multiple</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>multiple<span class="punctuation">}</span></span>
      <span class="attr-name">size</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>options<span class="punctuation">.</span>length<span class="punctuation">}</span></span>
      <span class="attr-name">onChange</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleOptionsChange<span class="punctuation">}</span></span>
    <span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>options<span class="punctuation">.</span><span class="function">map</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter">option</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
        <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>option</span>
          <span class="attr-name">value</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>option<span class="punctuation">}</span></span>
          <span class="attr-name">selected</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>selected<span class="punctuation">.</span><span class="function">includes</span><span class="punctuation">(</span>option<span class="punctuation">)</span><span class="punctuation">}</span></span>
          <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>option<span class="punctuation">}</span></span>
        <span class="punctuation">></span></span><span class="plain-text">
          </span><span class="punctuation">{</span>option<span class="punctuation">}</span><span class="plain-text">
        </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>option</span><span class="punctuation">></span></span>
      <span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>select</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Note that each option is given a CSS class so that we can display the consistent colors for each measure.</p><p>The <code>[</code>Select<code>](/api/queries/type-aliases/definition/select/)</code> component has some styling of its own:</p><pre><code><span class="selector">select</span> <span class="punctuation">{</span>
  <span class="property">border</span><span class="punctuation">:</span> 1px solid #ccc<span class="punctuation">;</span>
  <span class="property">display</span><span class="punctuation">:</span> block<span class="punctuation">;</span>
  <span class="property">font</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">letter-spacing</span><span class="punctuation">:</span> inherit<span class="punctuation">;</span>
  <span class="property">width</span><span class="punctuation">:</span> 10rem<span class="punctuation">;</span>
  <span class="selector">option</span> <span class="punctuation">{</span>
    <span class="property">border-left</span><span class="punctuation">:</span> 2px solid transparent<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><h3 id="default-styling">Default Styling</h3><p>We finish off with a few final pieces of CSS that are applied across the application.</p><pre><code><span class="atrule">@font-face</span> <span class="punctuation">{</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">;</span>
  <span class="property">src</span><span class="punctuation">:</span> <span class="url"><span class="function">url</span><span class="punctuation">(</span>https://tinybase.org/fonts/inter.woff2<span class="punctuation">)</span></span> <span class="function">format</span><span class="punctuation">(</span><span class="string">'woff2'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">*</span> <span class="punctuation">{</span>
  <span class="property">box-sizing</span><span class="punctuation">:</span> border<span class="operator">-</span>box<span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="selector">body</span> <span class="punctuation">{</span>
  <span class="property">color</span><span class="punctuation">:</span> #333<span class="punctuation">;</span>
  <span class="property">font-family</span><span class="punctuation">:</span> Inter<span class="punctuation">,</span> sans<span class="operator">-</span>serif<span class="punctuation">;</span>
  <span class="property">letter-spacing</span><span class="punctuation">:</span> <span class="operator">-</span>0.04rem<span class="punctuation">;</span>
  <span class="property">font-size</span><span class="punctuation">:</span> 0.8rem<span class="punctuation">;</span>
  <span class="property">line-height</span><span class="punctuation">:</span> 1.4rem<span class="punctuation">;</span>
  <span class="property">margin</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
  <span class="property">user-select</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre></section></article><aside></aside></main><footer><nav><a id="tw" href="https://twitter.com/tinybasejs" target="_blank">Twitter</a><a id="fb" href="https://facebook.com/tinybasejs" target="_blank">Facebook</a></nav><nav><a href="/">TinyBase 3.1.0-beta.0</a> © 2021- All Rights Reserved</nav></footer></body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ"></script><script>window.dataLayer=window.dataLayer||[];function g(){dataLayer.push(arguments);}g('js',new Date());g('config','G-D1MGR8VRWJ');</script></html>