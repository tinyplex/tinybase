<!DOCTYPE html><html lang="en"><head><link rel="dns-prefetch" href="https://www.googletagmanager.com/"><link href="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ" rel="preload" as="script"><link rel="preload" as="font" href="/fonts/inter.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/inconsolata.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/icons.woff2" type="font/woff2" crossorigin="anonymous"><link rel="preload" as="font" href="/fonts/shantell.woff2" type="font/woff2" crossorigin="anonymous"><title>Todo App v6 (collaboration) | TinyBase</title><meta name="description" content="In this version of the Todo app, we use a Synchronizer to make the application collaborative."><meta property="og:type" content="website"><meta property="og:title" content="Todo App v6 (collaboration) | TinyBase"><meta property="og:description" content="In this version of the Todo app, we use a Synchronizer to make the application collaborative."><meta property="og:url" content="https://beta.tinybase.org/demos/todo-app/todo-app-v6-collaboration/"><meta property="og:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Todo App v6 (collaboration) | TinyBase"><meta name="twitter:description" content="In this version of the Todo app, we use a Synchronizer to make the application collaborative."><meta name="twitter:site" content="@tinybasejs"><meta name="twitter:image" content="https://beta.tinybase.org/favicon_pad.png"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="stylesheet" href="/css/index.css"><link rel="canonical" href="https://beta.tinybase.org/demos/todo-app/todo-app-v6-collaboration/"><script src="/js/app.js"></script></head><body><header><a href="/"><img src="/favicon.svg" alt="TinyBase logo"><span>TinyBase <em title="5.0.0-beta.25">Î²</em></span></a><nav><ul><li><a href="/guides/">Guides</a></li><li><a href="/demos/">Demos</a></li><li><a href="/api/">API</a></li><li><a href="https://github.com/tinyplex/tinybase">GitHub</a></li></ul></nav><span id="dark"></span></header><main><nav><ul><li id="root" class="parent open"><span></span><a href="/">TinyBase</a><ul><li id="G" class="parent"><span></span><a href="/guides/">Guides</a></li><li id="D2" class="parent open"><span></span><a href="/demos/">Demos</a><ul><li id="HW" class="parent"><span></span><a href="/demos/hello-world/">Hello World</a></li><li id="RD" class="parent"><span></span><a href="/demos/rolling-dice/">Rolling Dice</a></li><li id="C2"><span></span><a href="/demos/countries/">Countries</a></li><li id="TA" class="parent open"><span></span><a href="/demos/todo-app/">Todo App</a><ul><li id="TA2"><span></span><a href="/demos/todo-app/todo-app-v1-the-basics/">Todo App v1 (the basics)</a></li><li id="TA3"><span></span><a href="/demos/todo-app/todo-app-v2-indexes/">Todo App v2 (indexes)</a></li><li id="TA4"><span></span><a href="/demos/todo-app/todo-app-v3-persistence/">Todo App v3 (persistence)</a></li><li id="TA5"><span></span><a href="/demos/todo-app/todo-app-v4-metrics/">Todo App v4 (metrics)</a></li><li id="TA6"><span></span><a href="/demos/todo-app/todo-app-v5-checkpoints/">Todo App v5 (checkpoints)</a></li><li id="TA7" class="current"><span></span><a href="/demos/todo-app/todo-app-v6-collaboration/">Todo App v6 (collaboration)</a></li></ul></li><li id="D3"><span></span><a href="/demos/drawing/">Drawing</a></li><li id="CD"><span></span><a href="/demos/city-database/">City Database</a></li><li id="CA"><span></span><a href="/demos/car-analysis/">Car Analysis</a></li><li id="MD"><span></span><a href="/demos/movie-database/">Movie Database</a></li><li id="WF"><span></span><a href="/demos/word-frequencies/">Word Frequencies</a></li><li id="UIC" class="parent"><span></span><a href="/demos/ui-components/">UI Components</a></li></ul></li><li id="api" class="parent"><span></span><a href="/api/">API</a></li></ul></li></ul></nav><article><nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/todo-app/">Todo App</a></li><li><a href="/demos/todo-app/todo-app-v6-collaboration/">Todo App v6 (collaboration)</a></li></ul></nav><section class="s1" id="/demos/todo-app/todo-app-v6-collaboration/" data-id="TA7"><h1>Todo App v6 (collaboration)</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script src=&quot;/umd/react.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/persisters/persister-browser/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/synchronizers/synchronizer-ws-client/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react-inspector/index.js&quot;&gt;&lt;/script&gt;&lt;style&gt;@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}body{display:grid;grid-template-columns:35% minmax(0,1fr);grid-template-rows:auto auto 1fr;box-sizing:border-box;font-family:Inter,sans-serif;letter-spacing:-.04rem;grid-gap:1rem .5rem;margin:0;min-height:100vh;padding:1rem}body *{box-sizing:border-box;outline-color:#d81b60}#newTodo{border:1px solid #ccc;display:block;font:inherit;letter-spacing:inherit;padding:.5rem;width:100%}#todos{grid-column:2;grid-row:2/span 2;margin:0;padding:0}#todos .todo{background:#fff;border:1px solid #ccc;display:flex;margin-bottom:.5rem;padding:.5rem}#todos .todo .text{cursor:pointer;flex:1;overflow:hidden;text-overflow:ellipsis;user-select:none;white-space:nowrap}#todos .todo .text::before{content:&#x27;\1F7E0&#x27;;padding:0 .5rem 0 .25rem}#todos .todo .text.done{color:#ccc}#todos .todo .text.done::before{content:&#x27;\2705&#x27;}#types{margin:0}#types .type{cursor:pointer;margin-bottom:.5rem;user-select:none}#types .type.current{color:#d81b60}#todos .todo .type{border:none;color:#777;font:inherit;font-size:.8rem;margin-top:.1rem}#undoRedo{grid-column:1;grid-row:3}#undoRedo #redo,#undoRedo #undo{cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;user-select:none}#undoRedo #redo::before,#undoRedo #undo::before{padding-right:.5rem;vertical-align:middle}#undoRedo #redo.disabled,#undoRedo #undo.disabled{cursor:default;opacity:.3}#undoRedo #undo::before{content:&#x27;\21A9&#x27;}#undoRedo #redo::before{content:&#x27;\21AA&#x27;}#share a,#share span{background:#eee;border:1px solid #ccc;color:#000;cursor:pointer;display:inline-block;padding:.5rem 1rem;text-align:center;text-decoration:none;width:10rem}#share a{border-color:#d81b60;background:#ddd}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script&gt;(()=&gt;{const l=React[&quot;createElement&quot;],{createCheckpoints:i,createIndexes:c,createMergeableStore:d,createMetrics:u,createStore:p,getUniqueId:a}=TinyBase,{createLocalPersister:y,createSessionPersister:h}=TinyBasePersisterBrowser,S=TinyBaseSynchronizerWsClient[&quot;createWsSynchronizer&quot;],{CellView:w,Provider:v,SliceView:e,useAddRowCallback:s,useCell:n,useCheckpoints:C,useCreateCheckpoints:g,useCreateIndexes:m,useCreateMergeableStore:k,useCreateMetrics:I,useCreatePersister:b,useCreateStore:x,useCreateSynchronizer:f,useMetric:o,useRow:T,useSetCellCallback:B,useSetCheckpointCallback:P,useSetValueCallback:A,useValue:M}=TinyBaseUiReact,{useCallback:R,useState:D}=React,N=TinyBaseUiReactInspector[&quot;Inspector&quot;],V=[&quot;Home&quot;,&quot;Work&quot;,&quot;Archived&quot;],W={todos:{text:{type:&quot;string&quot;},done:{type:&quot;boolean&quot;,default:!1},type:{type:&quot;string&quot;,default:&quot;Home&quot;,allow:V}}},$={todos:{0:{text:&quot;Clean the floor&quot;,type:&quot;Home&quot;},1:{text:&quot;Install TinyBase&quot;,type:&quot;Work&quot;},2:{text:&quot;Book holiday&quot;,type:&quot;Archived&quot;}}},t=()=&gt;{const e=k(()=&gt;d().setTablesSchema(W)),t=g(e,i),[a,r]=(b(e,e=&gt;y(e,&quot;todos/mergeableStore&quot;),[],async e=&gt;{await e.startAutoLoad([$]),t?.clear(),await e.startAutoSave()},[t]),_());f(e,async e=&gt;{if(a)return await(e=await S(e,new WebSocket(O+a))).startSync(),t?.clear(),e},[a,t]);var o=x(()=&gt;p().setValuesSchema({type:{type:&quot;string&quot;,default:&quot;Home&quot;}})),n=(b(o,e=&gt;h(e,&quot;todos/viewStore&quot;),[],async e=&gt;{await e.startAutoLoad(),await e.startAutoSave()}),m(e,e=&gt;c(e).setIndexDefinition(&quot;types&quot;,&quot;todos&quot;,&quot;type&quot;))),s=I(e,e=&gt;{const a=u(e);return a.setMetricDefinition(&quot;pending&quot;,&quot;todos&quot;,&quot;sum&quot;,e=&gt;e(&quot;done&quot;)?0:1),V.forEach(t=&gt;{a.setMetricDefinition(t,&quot;todos&quot;,&quot;sum&quot;,e=&gt;e(&quot;type&quot;)!=t||e(&quot;done&quot;)?0:1)}),a});return l(v,{store:e,storesById:{viewStore:o},indexes:n,metrics:s,checkpoints:t},l(j,{serverPathId:a,createServerPathId:r}),l(L,null),l(U,null),l(z,null),l(H,null),l(N,null))},H=(window.addEventListener(&quot;load&quot;,()=&gt;ReactDOM.createRoot(document.body).render(l(t,null))),()=&gt;{var e=o(&quot;pending&quot;);return 0&lt;e?&quot;Todo: &quot;+e:&quot;All done!&quot;}),L=()=&gt;{const[e,t]=D(&quot;&quot;),a=M(&quot;type&quot;,&quot;viewStore&quot;),r=R(({target:{value:e}})=&gt;t(e),[]),o=P(()=&gt;`adding &#x27;${e}&#x27;`,[e]),n=s(&quot;todos&quot;,({which:e,target:{value:t}})=&gt;13==e&amp;&amp;&quot;&quot;!=t?{text:t,type:a}:null,[a],void 0,()=&gt;{t(&quot;&quot;),o()},[t,o]);return l(&quot;input&quot;,{id:&quot;newTodo&quot;,onChange:r,onKeyDown:n,placeholder:&quot;New Todo&quot;,value:e})},z=()=&gt;l(&quot;ul&quot;,{id:&quot;todos&quot;},l(e,{indexId:&quot;types&quot;,sliceId:M(&quot;type&quot;,&quot;viewStore&quot;),rowComponent:r})),r=e=&gt;l(&quot;li&quot;,{className:&quot;todo&quot;},l(E,{...e}),l(K,{...e})),E=({tableId:e,rowId:t})=&gt;{const{done:a,text:r}=T(e,t),o=&quot;text&quot;+(a?&quot; done&quot;:&quot;&quot;),n=B(e,t,&quot;done&quot;,()=&gt;!a,[a]),s=P(()=&gt;`${a?&quot;resuming&quot;:&quot;completing&quot;} &#x27;${r}&#x27;`,[a]),i=R(()=&gt;{n(),s()},[n,s]);return l(&quot;span&quot;,{className:o,onClick:i},l(w,{tableId:e,rowId:t,cellId:&quot;text&quot;}))},U=()=&gt;l(&quot;ul&quot;,{id:&quot;types&quot;},V.map(e=&gt;l(q,{key:e,type:e}))),q=({type:e})=&gt;{var t=o(e),a=M(&quot;type&quot;,&quot;viewStore&quot;),r=A(&quot;type&quot;,()=&gt;e,[e],&quot;viewStore&quot;),a=&quot;type&quot;+(e==a?&quot; current&quot;:&quot;&quot;);return l(&quot;li&quot;,{className:a,onClick:r},e,0&lt;t?` (${t})`:&quot;&quot;)},K=({tableId:e,rowId:t})=&gt;{const a=n(e,t,&quot;type&quot;),r=C(),o=B(e,t,&quot;type&quot;,({target:{value:e}})=&gt;e,[],void 0,(e,t)=&gt;r.addCheckpoint(`changing to &#x27;${t}&#x27;`),[r]);return l(&quot;select&quot;,{className:&quot;type&quot;,onChange:o,value:a},V.map(e=&gt;l(&quot;option&quot;,null,e)))},O=&quot;wss://todo.demo.tinybase.org/&quot;,_=()=&gt;{const[e,t]=D(parent.location.search.substring(1));return[e,R(()=&gt;{var e=a();parent.history.replaceState(null,null,&quot;?&quot;+e),t(e)},[])]},j=({serverPathId:e,createServerPathId:t})=&gt;l(&quot;div&quot;,{id:&quot;share&quot;},e?l(&quot;a&quot;,{href:&quot;?&quot;+e,target:&quot;_blank&quot;},&quot;ðŸ”— Share link&quot;):l(&quot;span&quot;,{onClick:t},&quot;ðŸ“¤ Start sharing&quot;))})()&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this version of the Todo app, we use a <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> to make the application collaborative.</p><p>We&#x27;re making changes to the <a href="/demos/todo-app/todo-app-v5-checkpoints/">Todo App v5 (checkpoints)</a> demo.</p><h3 id="server-implementation">Server Implementation</h3><p>To have a collaborative experience, you need to deploy a server that can forward the WebSocket messages between multiple clients. <a href="/">TinyBase</a> provides a ready-made server for this purpose called <a href="/api/synchronizer-ws-server/interfaces/other/wsserver/"><code>WsServer</code></a>, available in the <a href="/api/synchronizer-ws-server/"><code>synchronizer-ws-server</code></a> module.</p><p>The server implementation for this demo is in the top level &#x27;support&#x27; directory of the <a href="/">TinyBase</a> repo for reference. At its heart, it is as simple as this:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>WsServer<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase/synchronizers/synchronizer-ws-server'</span><span class="punctuation">;</span>
<span class="keyword">const</span> server <span class="operator">=</span> <span class="function"><a href="/api/synchronizer-ws-server/functions/creation/createwsserver/">createWsServer</a></span><span class="punctuation">(</span><span class="keyword">new</span> <span class="class-name">ws<span class="punctuation">.</span>WebSocketServer</span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">port</span><span class="operator">:</span> <span class="number">8043</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The <a href="/api/synchronizer-ws-server/functions/creation/createwsserver/"><code>createWsServer</code></a> function takes an instance of a WebSocketServer (from the well known <a href="https://github.com/websockets/ws">ws</a> library). This allows you to configure the underlying server in whatever ways you like.</p><p>Note that in this demo, the server is not saving a copy of the data itself - it is merely acting as a broker between clients. Nevertheless, such a configuration would be possible if you were building an application that needed a server &#x27;source-of-truth&#x27;.</p><p>For the purposes of this demo, this server has been deployed to <code>todo.demo.tinybase.org</code>, and exposed on the HTTPS port of 443. On the client, we need to configure its address:</p><pre><code><span class="keyword">const</span> <span class="constant">WS_SERVER</span> <span class="operator">=</span> <span class="string">'wss://todo.demo.tinybase.org/'</span><span class="punctuation">;</span>
</code></pre><p>With our server deployed, let&#x27;s go back to the rest of the client app...</p><h3 id="only-a-mergeablestore-can-be-synchronized">Only A <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> Can Be Synchronized</h3><p>Up until now, we have been using a regular <a href="/">TinyBase</a> <a href="/api/store/interfaces/store/store/"><code>Store</code></a>. But in order to synchronize data between clients, we need to upgrade that to be a <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> so that it tracks the metadata required to merge without conflicts.</p><p>There is a simple change to the hook that creates the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>:</p><pre><code><span class="deleted-sign"><span class="prefix">-</span><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settablesschema/">setTablesSchema</a></span><span class="punctuation">(</span><span class="constant">SCHEMA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/other/usecreatemergeablestore/">useCreateMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
<span class="prefix">+</span>  <span class="function"><a href="/api/mergeable-store/functions/creation/createmergeablestore/">createMergeableStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settablesschema/">setTablesSchema</a></span><span class="punctuation">(</span><span class="constant">SCHEMA</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>Since a <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> is fully compatible with the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> API, there are no other changes required within the app to accommodate this upgrade.</p><h3 id="additional-imports">Additional Imports</h3><p>To communicate with the server, we use a <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a>. This is in the <a href="/api/synchronizer-ws-client/"><code>synchronizer-ws-client</code></a> module, and so we need to add that to our app:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/persisters/persister-browser/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase/synchronizers/synchronizer-ws-client/index.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</span></code></pre><p>We import the function to create it accordingly:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>createLocalPersister<span class="punctuation">,</span> createSessionPersister<span class="punctuation">}</span> <span class="operator">=</span> TinyBasePersisterBrowser<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> <span class="punctuation">{</span>createWsSynchronizer<span class="punctuation">}</span> <span class="operator">=</span> TinyBaseSynchronizerWsClient<span class="punctuation">;</span>
</span></code></pre><p>In turn, the <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a> is initialized with a WebSocket. This can be the browser&#x27;s default implementation.</p><p>We need to add in the new <a href="/api/store/interfaces/store/store/"><code>Store</code></a> creation function as described above (as well as a unique <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> generator we&#x27;ll be using):</p><pre><code><span class="deleted-sign"><span class="prefix">-</span><span class="keyword">const</span> <span class="punctuation">{</span>createCheckpoints<span class="punctuation">,</span> createIndexes<span class="punctuation">,</span> createMetrics<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> <span class="punctuation">{</span>
<span class="prefix">+</span>  createCheckpoints<span class="punctuation">,</span>
<span class="prefix">+</span>  createIndexes<span class="punctuation">,</span>
<span class="prefix">+</span>  createMergeableStore<span class="punctuation">,</span>
<span class="prefix">+</span>  createMetrics<span class="punctuation">,</span>
<span class="prefix">+</span>  createStore<span class="punctuation">,</span>
<span class="prefix">+</span>  getUniqueId<span class="punctuation">,</span>
<span class="prefix">+</span><span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
</span></code></pre><p>And we do the same for the creation hook, as well as making sure we add the <a href="/api/ui-react/functions/synchronizer-hooks/usecreatesynchronizer/"><code>useCreateSynchronizer</code></a> hook:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>
<span class="prefix"> </span>  CellView<span class="punctuation">,</span>
<span class="prefix"> </span>  CheckpointView<span class="punctuation">,</span>
<span class="prefix"> </span>  Provider<span class="punctuation">,</span>
<span class="prefix"> </span>  SliceView<span class="punctuation">,</span>
<span class="prefix"> </span>  useAddRowCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useCell<span class="punctuation">,</span>
<span class="prefix"> </span>  useCheckpoints<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateCheckpoints<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateIndexes<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useCreateMergeableStore<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useCreateMetrics<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreatePersister<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateStore<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useCreateSynchronizer<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useMetric<span class="punctuation">,</span>
<span class="prefix"> </span>  useRedoInformation<span class="punctuation">,</span>
<span class="prefix"> </span>  useRow<span class="punctuation">,</span>
<span class="prefix"> </span>  useSetCellCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useSetCheckpointCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useSetValueCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useUndoInformation<span class="punctuation">,</span>
<span class="prefix"> </span>  useValue<span class="punctuation">,</span>
<span class="prefix"> </span><span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReact<span class="punctuation">;</span>
</span></code></pre><h3 id="getting-and-creating-a-collaborative-space">Getting And Creating A Collaborative Space</h3><p>To make our application shareable, we need a unique space on the server where multiple clients can see the same todo list. The server supports multiple of these spaces, and distinguishes between them simply by the path used when the WebSocket connects.</p><p>For example, one set of people might collaborate on a todo list brokered by <code>wss://todo.demo.tinybase.org/1234</code>, others on a todo list brokered by <code>wss://todo.demo.tinybase.org/5678</code> - and so on.</p><p>We want to be able to create a unique <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> from this app that can be used for the connection, and which updates the demo&#x27;s browser URL so that it can be shared with others.</p><p>There are many more sophisticated ways to do this, but we are going for a simple approach of using the URL query string to store our unique <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a>. We use a hook to store the path in the App&#x27;s state, and which gets the initial value. It also provides a function that creates a new room and updates the URL accordingly.</p><p>Helpfully, <a href="/">TinyBase</a> provides a URL-safe unique <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> generator, the <a href="/api/common/functions/convenience/getuniqueid/"><code>getUniqueId</code></a> function, that we can use:</p><pre><code><span class="keyword">const</span> <span class="function-variable">useServerPathId</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>serverPathId<span class="punctuation">,</span> setServerPathId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span>
    parent<span class="punctuation">.</span>location<span class="punctuation">.</span>search<span class="punctuation">.</span><span class="function">substring</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> <span class="punctuation">[</span>
    serverPathId<span class="punctuation">,</span>
    <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
      <span class="keyword">const</span> newServerPathId <span class="operator">=</span> <span class="function"><a href="/api/common/functions/convenience/getuniqueid/">getUniqueId</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
      parent<span class="punctuation">.</span>history<span class="punctuation">.</span><span class="function">replaceState</span><span class="punctuation">(</span><span class="keyword">null</span><span class="punctuation">,</span> <span class="keyword">null</span><span class="punctuation">,</span> <span class="string">'?'</span> <span class="operator">+</span> newServerPathId<span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="function">setServerPathId</span><span class="punctuation">(</span>newServerPathId<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">]</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>Note that we work with the <code>parent</code> location, rather than the <code>window</code> object. This is simply because the <a href="/">TinyBase</a> demo runs in a trusted iframe and needs to get the URL from the outer page. Fortunately <code>parent</code> still resolves to <code>window</code> even when this <em>isn&#x27;t</em> running in an iframe.</p><h3 id="synchronizing-to-the-server">Synchronizing to the server</h3><p>We use this new hook in the top level of the App component, and then create the <a href="/api/synchronizer-ws-client/interfaces/synchronizer/wssynchronizer/"><code>WsSynchronizer</code></a>. We make this conditional: if there is no server path <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> (yet), the useCreateSynchronizer method returns nothing. Once a server path <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> exists, it will instead create the <a href="/api/synchronizers/interfaces/synchronizer/synchronizer/"><code>Synchronizer</code></a> asynchronously, using the address formed by combining the host and the path itself.</p><p>Note that we are still persisting the data locally to local storage, but we put the <a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a> in a different key to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> from the previous demos (in case you go back to previous chapters and want the simpler <a href="/api/store/interfaces/store/store/"><code>Store</code></a>&#x27;s serialization to be still present).</p><pre><code><span class="unchanged"><span class="prefix"> </span>  <span class="function"><a href="/api/ui-react/functions/persister-hooks/usecreatepersister/">useCreatePersister</a></span><span class="punctuation">(</span>
<span class="prefix"> </span>    store<span class="punctuation">,</span>
</span><span class="deleted-sign"><span class="prefix">-</span>    <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createlocalpersister/">createLocalPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'todos/store'</span><span class="punctuation">)</span><span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>    <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createlocalpersister/">createLocalPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'todos/mergeableStore'</span><span class="punctuation">)</span><span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">persister</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix"> </span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">[</span><span class="constant">INITIAL_TODOS</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>      checkpoints<span class="operator">?.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>    <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">[</span>checkpoints<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> <span class="punctuation">[</span>serverPathId<span class="punctuation">,</span> createServerPathId<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useServerPathId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="function"><a href="/api/ui-react/functions/synchronizer-hooks/usecreatesynchronizer/">useCreateSynchronizer</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>    store<span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix">+</span>      <span class="keyword">if</span> <span class="punctuation">(</span>serverPathId<span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="prefix">+</span>        <span class="keyword">const</span> synchronizer <span class="operator">=</span> <span class="keyword">await</span> <span class="function"><a href="/api/synchronizer-ws-client/functions/creation/createwssynchronizer/">createWsSynchronizer</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>          store<span class="punctuation">,</span>
<span class="prefix">+</span>          <span class="keyword">new</span> <span class="class-name">WebSocket</span><span class="punctuation">(</span><span class="constant">WS_SERVER</span> <span class="operator">+</span> serverPathId<span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span>        <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>        <span class="keyword">await</span> synchronizer<span class="punctuation">.</span><span class="function"><a href="/api/synchronizers/interfaces/synchronizer/synchronizer/methods/synchronization/startsync/">startSync</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>        checkpoints<span class="operator">?.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>        <span class="keyword">return</span> synchronizer<span class="punctuation">;</span>
<span class="prefix">+</span>      <span class="punctuation">}</span>
<span class="prefix">+</span>    <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span>serverPathId<span class="punctuation">,</span> checkpoints<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>As we did for local storage, we also reset the checkpoints so this process does not appear on the undo stack.</p><h3 id="adding-a-share-button">Adding A Share Button</h3><p>All that remains is to give the user a way to create the server path to start sharing! Let&#x27;s add a single component called Share to do that. It takes the server path <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> value and function from the app-level state, and renders either a button to create a room and start sharing, or a link to the room that is already being shared to.</p><pre><code><span class="keyword">const</span> <span class="function-variable">Share</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>serverPathId<span class="punctuation">,</span> createServerPathId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">(</span>
  <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>share<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
    </span><span class="punctuation">{</span>serverPathId <span class="operator">?</span> <span class="punctuation">(</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>a</span> <span class="attr-name">href</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span><span class="string">'?'</span> <span class="operator">+</span> serverPathId<span class="punctuation">}</span></span> <span class="attr-name">target</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>_blank<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
        &amp;#128279; Share link
      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>a</span><span class="punctuation">></span></span>
    <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>span</span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>createServerPathId<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">&amp;#128228; Start sharing</span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>span</span><span class="punctuation">></span></span>
    <span class="punctuation">)</span><span class="punctuation">}</span><span class="plain-text">
  </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>We can add this to the top of the left-hand side of the app. For the sake of clarity, we remove the undo buttons for now:</p><pre><code><span class="deleted-sign"><span class="prefix">-</span>      <span class="operator">&lt;</span>Title <span class="operator">/</span><span class="operator">></span>
</span><span class="inserted-sign"><span class="prefix">+</span>      <span class="operator">&lt;</span>Share
<span class="prefix">+</span>        serverPathId<span class="operator">=</span><span class="punctuation">{</span>serverPathId<span class="punctuation">}</span>
<span class="prefix">+</span>        createServerPathId<span class="operator">=</span><span class="punctuation">{</span>createServerPathId<span class="punctuation">}</span>
<span class="prefix">+</span>      <span class="operator">/</span><span class="operator">></span>
</span><span class="unchanged"><span class="prefix"> </span>      <span class="operator">&lt;</span>NewTodo <span class="operator">/</span><span class="operator">></span>
<span class="prefix"> </span>      <span class="operator">&lt;</span>Types <span class="operator">/</span><span class="operator">></span>
</span><span class="deleted-sign"><span class="prefix">-</span>      <span class="operator">&lt;</span>UndoRedo <span class="operator">/</span><span class="operator">></span>
</span><span class="unchanged"><span class="prefix"> </span>      <span class="operator">&lt;</span>Todos <span class="operator">/</span><span class="operator">></span>
</span><span class="inserted-sign"><span class="prefix">+</span>      <span class="operator">&lt;</span>Title <span class="operator">/</span><span class="operator">></span>
</span><span class="unchanged"><span class="prefix"> </span>      <span class="operator">&lt;</span>Inspector <span class="operator">/</span><span class="operator">></span>
</span></code></pre><p>Let&#x27;s give it this share button some styling to make it prominent for this demo:</p><pre><code><span class="selector">#share</span> <span class="punctuation">{</span>
  <span class="selector">a,
  span</span> <span class="punctuation">{</span>
    <span class="property">background</span><span class="punctuation">:</span> #eee<span class="punctuation">;</span>
    <span class="property">border</span><span class="punctuation">:</span> <span class="variable">@border</span><span class="punctuation">;</span>
    <span class="property">color</span><span class="punctuation">:</span> #000<span class="punctuation">;</span>
    <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
    <span class="property">display</span><span class="punctuation">:</span> inline<span class="operator">-</span>block<span class="punctuation">;</span>
    <span class="property">padding</span><span class="punctuation">:</span> 0.5rem 1rem<span class="punctuation">;</span>
    <span class="property">text-align</span><span class="punctuation">:</span> center<span class="punctuation">;</span>
    <span class="property">text-decoration</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
    <span class="property">width</span><span class="punctuation">:</span> 10rem<span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">a</span> <span class="punctuation">{</span>
    <span class="property">border-color</span><span class="punctuation">:</span> <span class="variable">@accentColor</span><span class="punctuation">;</span>
    <span class="property">background</span><span class="punctuation">:</span> #ddd<span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>And we are good to go! Clicking the &#x27;Start sharing&#x27; button will add a query string to the URL and start sharing to the WebSocket server. Clicking the &#x27;Share link&#x27; button will launch a new browser window with the same server path <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> in it.</p><p>As you can see, the results are synchronized, but that&#x27;s also because the tabs of your browser are sharing the local storage we set up in a previous demo. A better demo is to launch a new window in incognito mode or even a completely different browser! If all goes well, you will still see the shared todo list.</p><h3 id="summary">Summary</h3><p>We went from local-first to collaboration with just a few additions of code and the magic of <a href="/">TinyBase</a> synchronization.</p></section></article><aside></aside></main><footer><nav><a id="tw" href="https://twitter.com/tinybasejs" target="_blank">Twitter</a><a id="fb" href="https://facebook.com/tinybasejs" target="_blank">Facebook</a></nav><nav><a href="/">TinyBase 5.0.0-beta.25</a> Â© 2021- All Rights Reserved</nav></footer></body><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1MGR8VRWJ"></script><script>window.dataLayer=window.dataLayer||[];function g(){dataLayer.push(arguments);}g('js',new Date());g('config','G-D1MGR8VRWJ');</script></html>