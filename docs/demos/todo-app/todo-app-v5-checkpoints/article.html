<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/todo-app/">Todo App</a></li><li><a href="/demos/todo-app/todo-app-v5-checkpoints/">Todo App v5 (checkpoints)</a></li></ul></nav><section class="s1" id="/demos/todo-app/todo-app-v5-checkpoints/" data-id="TA6"><h1>Todo App v5 (checkpoints)</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script src=&quot;/umd/react.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/persisters/persister-browser/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react/index.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase/ui-react-inspector/index.js&quot;&gt;&lt;/script&gt;&lt;style&gt;@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}body{display:grid;grid-template-columns:35% minmax(0,1fr);grid-template-rows:auto auto 1fr;box-sizing:border-box;font-family:Inter,sans-serif;letter-spacing:-.04rem;grid-gap:1rem .5rem;margin:0;min-height:100vh;padding:1rem}body *{box-sizing:border-box;outline-color:#d81b60}#newTodo{border:1px solid #ccc;display:block;font:inherit;letter-spacing:inherit;padding:.5rem;width:100%}#todos{grid-column:2;grid-row:2/span 2;margin:0;padding:0}#todos .todo{background:#fff;border:1px solid #ccc;display:flex;margin-bottom:.5rem;padding:.5rem}#todos .todo .text{cursor:pointer;flex:1;overflow:hidden;text-overflow:ellipsis;user-select:none;white-space:nowrap}#todos .todo .text::before{content:&#x27;\1F7E0&#x27;;padding:0 .5rem 0 .25rem}#todos .todo .text.done{color:#ccc}#todos .todo .text.done::before{content:&#x27;\2705&#x27;}#types{margin:0}#types .type{cursor:pointer;margin-bottom:.5rem;user-select:none}#types .type.current{color:#d81b60}#todos .todo .type{border:none;color:#777;font:inherit;font-size:.8rem;margin-top:.1rem}#undoRedo{grid-column:1;grid-row:3}#undoRedo #redo,#undoRedo #undo{cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;user-select:none}#undoRedo #redo::before,#undoRedo #undo::before{padding-right:.5rem;vertical-align:middle}#undoRedo #redo.disabled,#undoRedo #undo.disabled{cursor:default;opacity:.3}#undoRedo #undo::before{content:&#x27;\21A9&#x27;}#undoRedo #redo::before{content:&#x27;\21AA&#x27;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script type=&quot;module&quot;&gt;const{createElement:t}=React,{createCheckpoints:v,createIndexes:w,createMetrics:S,createStore:p}=TinyBase,{createLocalPersister:g,createSessionPersister:x}=TinyBasePersisterBrowser,{CellView:R,CheckpointView:Q,Provider:f,SliceView:A,useAddRowCallback:b,useCell:I,useCheckpoints:N,useCreateCheckpoints:B,useCreateIndexes:D,useCreateMetrics:L,useCreatePersister:y,useCreateStore:C,useMetric:h,useRedoInformation:M,useRow:E,useSetCellCallback:m,useSetCheckpointCallback:k,useSetValueCallback:P,useUndoInformation:U,useValue:r}=TinyBaseUiReact,{useCallback:T,useState:V}=React,{Inspector:$}=TinyBaseUiReactInspector,l=[&quot;Home&quot;,&quot;Work&quot;,&quot;Archived&quot;],H={todos:{text:{type:&quot;string&quot;},done:{type:&quot;boolean&quot;,default:!1},type:{type:&quot;string&quot;,default:&quot;Home&quot;,allow:l}}},_={todos:{0:{text:&quot;Clean the floor&quot;,type:&quot;Home&quot;},1:{text:&quot;Install TinyBase&quot;,type:&quot;Work&quot;},2:{text:&quot;Book holiday&quot;,type:&quot;Archived&quot;}}},O=()=&gt;{const e=C(()=&gt;p().setTablesSchema(H)),n=B(e,v);y(e,o=&gt;g(o,&quot;todos/store&quot;),[],async o=&gt;{await o.startAutoLoad([_]),n?.clear(),await o.startAutoSave()},[n]);const s=C(()=&gt;p().setValuesSchema({type:{type:&quot;string&quot;,default:&quot;Home&quot;}}));y(s,o=&gt;x(o,&quot;todos/viewStore&quot;),[],async o=&gt;{await o.startAutoLoad(),await o.startAutoSave()});const a=D(e,o=&gt;w(o).setIndexDefinition(&quot;types&quot;,&quot;todos&quot;,&quot;type&quot;)),d=L(e,o=&gt;{const c=S(o);return c.setMetricDefinition(&quot;pending&quot;,&quot;todos&quot;,&quot;sum&quot;,i=&gt;i(&quot;done&quot;)?0:1),l.forEach(i=&gt;{c.setMetricDefinition(i,&quot;todos&quot;,&quot;sum&quot;,u=&gt;u(&quot;type&quot;)==i&amp;&amp;!u(&quot;done&quot;)?1:0)}),c});return t(f,{store:e,storesById:{viewStore:s},indexes:a,metrics:d,checkpoints:n},t(K,null),t(W,null),t(z,null),t(J,null),t(Y,null),t($,null))};window.addEventListener(&quot;load&quot;,()=&gt;ReactDOM.createRoot(document.body).render(t(O,null)));const K=()=&gt;{const e=h(&quot;pending&quot;);return e&gt;0?`Todo: ${e}`:&quot;All done!&quot;},W=()=&gt;{const[e,n]=V(&quot;&quot;),s=r(&quot;type&quot;,&quot;viewStore&quot;),a=T(({target:{value:c}})=&gt;n(c),[]),d=k(()=&gt;`adding &#x27;${e}&#x27;`,[e]),o=b(&quot;todos&quot;,({which:c,target:{value:i}})=&gt;c==13&amp;&amp;i!=&quot;&quot;?{text:i,type:s}:null,[s],void 0,()=&gt;{n(&quot;&quot;),d()},[n,d]);return t(&quot;input&quot;,{id:&quot;newTodo&quot;,onChange:a,onKeyDown:o,placeholder:&quot;New Todo&quot;,value:e})},Y=()=&gt;t(&quot;ul&quot;,{id:&quot;todos&quot;},t(A,{indexId:&quot;types&quot;,sliceId:r(&quot;type&quot;,&quot;viewStore&quot;),rowComponent:j})),j=e=&gt;t(&quot;li&quot;,{className:&quot;todo&quot;},t(q,{...e}),t(G,{...e})),q=({tableId:e,rowId:n})=&gt;{const{done:s,text:a}=E(e,n),d=&quot;text&quot;+(s?&quot; done&quot;:&quot;&quot;),o=m(e,n,&quot;done&quot;,()=&gt;!s,[s]),c=k(()=&gt;`${s?&quot;resuming&quot;:&quot;completing&quot;} &#x27;${a}&#x27;`,[s]),i=T(()=&gt;{o(),c()},[o,c]);return t(&quot;span&quot;,{className:d,onClick:i},t(R,{tableId:e,rowId:n,cellId:&quot;text&quot;}))},z=()=&gt;t(&quot;ul&quot;,{id:&quot;types&quot;},l.map(e=&gt;t(F,{key:e,type:e}))),F=({type:e})=&gt;{const n=h(e),s=r(&quot;type&quot;,&quot;viewStore&quot;),a=P(&quot;type&quot;,()=&gt;e,[e],&quot;viewStore&quot;),d=&quot;type&quot;+(e==s?&quot; current&quot;:&quot;&quot;);return t(&quot;li&quot;,{className:d,onClick:a},e,n&gt;0?` (${n})`:&quot;&quot;)},G=({tableId:e,rowId:n})=&gt;{const s=I(e,n,&quot;type&quot;),a=N(),d=m(e,n,&quot;type&quot;,({target:{value:o}})=&gt;o,[],void 0,(o,c)=&gt;a.addCheckpoint(`changing to &#x27;${c}&#x27;`),[a]);return t(&quot;select&quot;,{className:&quot;type&quot;,onChange:d,value:s},l.map(o=&gt;t(&quot;option&quot;,null,o)))},J=()=&gt;{const[e,n,,s]=U(),a=e?t(&quot;div&quot;,{id:&quot;undo&quot;,onClick:n},&quot;undo &quot;,s):t(&quot;div&quot;,{id:&quot;undo&quot;,className:&quot;disabled&quot;}),[d,o,,c]=M();return t(&quot;div&quot;,{id:&quot;undoRedo&quot;},a,d?t(&quot;div&quot;,{id:&quot;redo&quot;,onClick:o},&quot;redo &quot;,c):t(&quot;div&quot;,{id:&quot;redo&quot;,className:&quot;disabled&quot;}))};&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this version of the Todo app, we add a <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> object that provides us with an undo and redo stack as the main store changes.</p><p>We&#x27;re making changes to the <a href="/demos/todo-app/todo-app-v4-metrics/">Todo App v4 (metrics)</a> demo.</p><h3 id="additional-initialization">Additional Initialization</h3><p>We will create a <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> object with the <a href="/api/ui-react/functions/checkpoints-hooks/usecreatecheckpoints/"><code>useCreateCheckpoints</code></a> hook, and will need the <a href="/api/ui-react/functions/checkpoints-hooks/usecheckpoints/"><code>useCheckpoints</code></a> hook to use it throughout the application. The <a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/"><code>useSetCheckpointCallback</code></a> hook provides a callback to set a new checkpoint whenever something changes in the application that we would like to undo.</p><p>The useUndo hook and useRedo hook provide convenient ways to check whether an undo action or a redo action is available:</p><pre><code><span class="deleted-sign"><span class="prefix">-</span><span class="keyword">const</span> <span class="punctuation">{</span>createIndexes<span class="punctuation">,</span> createMetrics<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> <span class="punctuation">{</span>createCheckpoints<span class="punctuation">,</span> createIndexes<span class="punctuation">,</span> createMetrics<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>createLocalPersister<span class="punctuation">,</span> createSessionPersister<span class="punctuation">}</span> <span class="operator">=</span> TinyBasePersisterBrowser<span class="punctuation">;</span>
<span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>
<span class="prefix"> </span>  CellView<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  CheckpointView<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  Provider<span class="punctuation">,</span>
<span class="prefix"> </span>  SliceView<span class="punctuation">,</span>
<span class="prefix"> </span>  useAddRowCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useCell<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useCheckpoints<span class="punctuation">,</span>
<span class="prefix">+</span>  useCreateCheckpoints<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useCreateIndexes<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateMetrics<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreatePersister<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateStore<span class="punctuation">,</span>
<span class="prefix"> </span>  useMetric<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useRedoInformation<span class="punctuation">,</span>
<span class="prefix">+</span>  useRow<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useSetCellCallback<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useSetCheckpointCallback<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useSetValueCallback<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useUndoInformation<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useValue<span class="punctuation">,</span>
<span class="prefix"> </span><span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReact<span class="punctuation">;</span>
</span></code></pre><p>As before, we make this <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> object available though the <code>Provider</code> component as the default for the app. We choose to also clear the <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> object once the persister has completed its initial load so that there isn&#x27;t the option to &#x27;undo&#x27; that first load:</p><pre><code><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> checkpoints <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usecreatecheckpoints/">useCreateCheckpoints</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> createCheckpoints<span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="function"><a href="/api/ui-react/functions/persister-hooks/usecreatepersister/">useCreatePersister</a></span><span class="punctuation">(</span>
<span class="prefix"> </span>    store<span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createlocalpersister/">createLocalPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'todos/store'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">persister</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix"> </span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">[</span><span class="constant">INITIAL_TODOS</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>      checkpoints<span class="operator">?.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/lifecycle/clear/">clear</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>    <span class="punctuation">}</span><span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>    <span class="punctuation">[</span>checkpoints<span class="punctuation">]</span><span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>And as before, we make this <a href="/api/checkpoints/interfaces/checkpoints/checkpoints/"><code>Checkpoints</code></a> object available though the <code>Provider</code> component as the default for the app:</p><pre><code><span class="unchanged"><span class="prefix"> </span>  <span class="keyword">return</span> <span class="punctuation">(</span>
<span class="prefix"> </span>    <span class="operator">&lt;</span>Provider
<span class="prefix"> </span>      store<span class="operator">=</span><span class="punctuation">{</span>store<span class="punctuation">}</span>
<span class="prefix"> </span>      storesById<span class="operator">=</span><span class="punctuation">{</span><span class="punctuation">{</span>viewStore<span class="punctuation">}</span><span class="punctuation">}</span>
<span class="prefix"> </span>      indexes<span class="operator">=</span><span class="punctuation">{</span>indexes<span class="punctuation">}</span>
<span class="prefix"> </span>      metrics<span class="operator">=</span><span class="punctuation">{</span>metrics<span class="punctuation">}</span>
</span><span class="inserted-sign"><span class="prefix">+</span>      checkpoints<span class="operator">=</span><span class="punctuation">{</span>checkpoints<span class="punctuation">}</span>
</span><span class="unchanged"><span class="prefix"> </span>    <span class="operator">></span>
<span class="prefix"> </span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Title</span></span> <span class="punctuation">/></span></span>
<span class="prefix"> </span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">NewTodo</span></span> <span class="punctuation">/></span></span>
<span class="prefix"> </span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Types</span></span> <span class="punctuation">/></span></span>
</span><span class="inserted-sign"><span class="prefix">+</span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">UndoRedo</span></span> <span class="punctuation">/></span></span>
</span><span class="unchanged"><span class="prefix"> </span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name">Todos</span></span> <span class="punctuation">/></span></span>
<span class="prefix"> </span>      <span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react-inspector/functions/development-components/inspector/">Inspector</a></span></span> <span class="punctuation">/></span></span>
<span class="prefix"> </span>    <span class="tag"><span class="tag"><span class="punctuation">&lt;/</span><span class="class-name"><a href="/api/ui-react/functions/context-components/provider/">Provider</a></span></span><span class="punctuation">></span></span>
<span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span><span class="punctuation">}</span><span class="punctuation">;</span>
</span></code></pre><h3 id="upgrading-usenewtodocallback">Upgrading <code>useNewTodoCallback</code></h3><p>We need to set checkpoints every time something happens in the app that the user might want to undo. One of the actions we want to checkpoint is when a user creates a new todo:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="function-variable">NewTodo</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix"> </span>  <span class="keyword">const</span> <span class="punctuation">[</span>text<span class="punctuation">,</span> setText<span class="punctuation">]</span> <span class="operator">=</span> <span class="function">useState</span><span class="punctuation">(</span><span class="string">''</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>  <span class="keyword">const</span> type <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usevalue/">useValue</a></span><span class="punctuation">(</span><span class="string">'type'</span><span class="punctuation">,</span> <span class="string">'viewStore'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span>  <span class="keyword">const</span> handleChange <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span><span class="literal-property">target</span><span class="operator">:</span> <span class="punctuation">{</span>value<span class="punctuation">}</span><span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setText</span><span class="punctuation">(</span>value<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> addCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="template-string"><span class="template-punctuation">`</span><span class="string">adding '</span><span class="interpolation"><span class="interpolation-punctuation">${</span>text<span class="interpolation-punctuation">}</span></span><span class="string">'</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span>text<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="keyword">const</span> handleKeyDown <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/useaddrowcallback/">useAddRowCallback</a></span><span class="punctuation">(</span>
<span class="prefix"> </span>    <span class="string">'todos'</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>which<span class="punctuation">,</span> <span class="literal-property">target</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">value</span><span class="operator">:</span> text<span class="punctuation">}</span><span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span>
<span class="prefix"> </span>      which <span class="operator">==</span> <span class="number">13</span> <span class="operator">&amp;&amp;</span> text <span class="operator">!=</span> <span class="string">''</span> <span class="operator">?</span> <span class="punctuation">{</span>text<span class="punctuation">,</span> type<span class="punctuation">}</span> <span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">[</span>type<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="keyword">undefined</span><span class="punctuation">,</span>
</span><span class="deleted-sign"><span class="prefix">-</span>    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function">setText</span><span class="punctuation">(</span><span class="string">''</span><span class="punctuation">)</span><span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix">+</span>      <span class="function">setText</span><span class="punctuation">(</span><span class="string">''</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>      <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/addcheckpoint/">addCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>    <span class="punctuation">}</span><span class="punctuation">,</span>
</span><span class="deleted-sign"><span class="prefix">-</span>    <span class="punctuation">[</span>setText<span class="punctuation">]</span><span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>    <span class="punctuation">[</span>setText<span class="punctuation">,</span> addCheckpoint<span class="punctuation">]</span><span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><h3 id="upgrading-todotype">Upgrading <code>TodoType</code></h3><p>When a type is changed for a todo, we also create a checkpoint:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="function-variable">TodoType</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix"> </span>  <span class="keyword">const</span> type <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecell/">useCell</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'type'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> checkpoints <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usecheckpoints/">useCheckpoints</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="keyword">const</span> handleChange <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>
<span class="prefix"> </span>    tableId<span class="punctuation">,</span>
<span class="prefix"> </span>    rowId<span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="string">'type'</span><span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span><span class="literal-property">target</span><span class="operator">:</span> <span class="punctuation">{</span>value<span class="punctuation">}</span><span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> value<span class="punctuation">,</span>
<span class="prefix"> </span>    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>    <span class="keyword">undefined</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">(</span><span class="parameter">_store<span class="punctuation">,</span> type</span><span class="punctuation">)</span> <span class="operator">=></span> checkpoints<span class="punctuation">.</span><span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/addcheckpoint/">addCheckpoint</a></span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">changing to '</span><span class="interpolation"><span class="interpolation-punctuation">${</span>type<span class="interpolation-punctuation">}</span></span><span class="string">'</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span>checkpoints<span class="punctuation">]</span><span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>The sixth parameter is left <code>undefined</code> so that the default store is used. Following that, we are using the &#x27;then&#x27; callback that fires after the <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> has been set. It depends on <code>checkpoints</code>, so the final array parameter ensures it is memoized correctly.</p><h3 id="upgrading-todotext">Upgrading <code>TodoText</code></h3><p>And finally, we create a checkpoint whenever a todo is marked as completed or is being resumed. Our <code>handleClick</code> function now calls both the previous <code>setCell</code> function and a new <code>addCheckpoint</code> function, both from hooks that gave us the default <a href="/api/store/interfaces/store/store/"><code>Store</code></a> and Checkpoint objects:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="function-variable">TodoText</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="parameter"><span class="punctuation">{</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
</span><span class="deleted-sign"><span class="prefix">-</span>  <span class="keyword">const</span> done <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecell/">useCell</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'done'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> <span class="punctuation">{</span>done<span class="punctuation">,</span> text<span class="punctuation">}</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/userow/">useRow</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="keyword">const</span> className <span class="operator">=</span> <span class="string">'text'</span> <span class="operator">+</span> <span class="punctuation">(</span>done <span class="operator">?</span> <span class="string">' done'</span> <span class="operator">:</span> <span class="string">''</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="deleted-sign"><span class="prefix">-</span>  <span class="keyword">const</span> handleClick <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'done'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="operator">!</span>done<span class="punctuation">,</span> <span class="punctuation">[</span>
<span class="prefix">-</span>    done<span class="punctuation">,</span>
<span class="prefix">-</span>  <span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> setCell <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usesetcellcallback/">useSetCellCallback</a></span><span class="punctuation">(</span>tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> <span class="string">'done'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="operator">!</span>done<span class="punctuation">,</span> <span class="punctuation">[</span>
<span class="prefix">+</span>    done<span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="keyword">const</span> addCheckpoint <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/usesetcheckpointcallback/">useSetCheckpointCallback</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>    <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="template-string"><span class="template-punctuation">`</span><span class="interpolation"><span class="interpolation-punctuation">${</span>done <span class="operator">?</span> <span class="string">'resuming'</span> <span class="operator">:</span> <span class="string">'completing'</span><span class="interpolation-punctuation">}</span></span><span class="string"> '</span><span class="interpolation"><span class="interpolation-punctuation">${</span>text<span class="interpolation-punctuation">}</span></span><span class="string">'</span><span class="template-punctuation">`</span></span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span>done<span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="keyword">const</span> handleClick <span class="operator">=</span> <span class="function">useCallback</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix">+</span>    <span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>    <span class="function"><a href="/api/checkpoints/interfaces/checkpoints/checkpoints/methods/setter/addcheckpoint/">addCheckpoint</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="punctuation">}</span><span class="punctuation">,</span> <span class="punctuation">[</span>setCell<span class="punctuation">,</span> addCheckpoint<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span>
<span class="unchanged"><span class="prefix"> </span>  <span class="keyword">return</span> <span class="punctuation">(</span>
<span class="prefix"> </span>    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>span</span> <span class="attr-name">className</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>className<span class="punctuation">}</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleClick<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
<span class="prefix"> </span>      </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span><span class="class-name"><a href="/api/ui-react/functions/store-components/cellview/">CellView</a></span></span> <span class="attr-name">tableId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>tableId<span class="punctuation">}</span></span> <span class="attr-name">rowId</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>rowId<span class="punctuation">}</span></span> <span class="attr-name">cellId</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>text<span class="punctuation">"</span></span> <span class="punctuation">/></span></span><span class="plain-text">
<span class="prefix"> </span>    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>span</span><span class="punctuation">></span></span>
<span class="prefix"> </span>  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix"> </span><span class="punctuation">}</span><span class="punctuation">;</span>
</span></code></pre><h3 id="the-undoredo-components">The <code>UndoRedo</code> Components</h3><p>To provide a way to undo the checkpoints, we create two small affordances on the left of the application. Each is only enabled when there is at least one item to undo or redo:</p><pre><code><span class="keyword">const</span> <span class="function-variable">UndoRedo</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  <span class="keyword">const</span> <span class="punctuation">[</span>canUndo<span class="punctuation">,</span> handleUndo<span class="punctuation">,</span> <span class="punctuation">,</span> undoLabel<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/useundoinformation/">useUndoInformation</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> undo <span class="operator">=</span> canUndo <span class="operator">?</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>undo<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleUndo<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      undo </span><span class="punctuation">{</span>undoLabel<span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>undo<span class="punctuation">"</span></span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>disabled<span class="punctuation">"</span></span> <span class="punctuation">/></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">const</span> <span class="punctuation">[</span>canRedo<span class="punctuation">,</span> handleRedo<span class="punctuation">,</span> <span class="punctuation">,</span> redoLabel<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/checkpoints-hooks/useredoinformation/">useRedoInformation</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">const</span> redo <span class="operator">=</span> canRedo <span class="operator">?</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>redo<span class="punctuation">"</span></span> <span class="attr-name">onClick</span><span class="script"><span class="script-punctuation">=</span><span class="punctuation">{</span>handleRedo<span class="punctuation">}</span></span><span class="punctuation">></span></span><span class="plain-text">
      redo </span><span class="punctuation">{</span>redoLabel<span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span> <span class="operator">:</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>redo<span class="punctuation">"</span></span> <span class="attr-name">className</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>disabled<span class="punctuation">"</span></span> <span class="punctuation">/></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>

  <span class="keyword">return</span> <span class="punctuation">(</span>
    <span class="tag"><span class="tag"><span class="punctuation">&lt;</span>div</span> <span class="attr-name">id</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>undoRedo<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="plain-text">
      </span><span class="punctuation">{</span>undo<span class="punctuation">}</span><span class="plain-text">
      </span><span class="punctuation">{</span>redo<span class="punctuation">}</span><span class="plain-text">
    </span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>div</span><span class="punctuation">></span></span>
  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">;</span>
</code></pre><p>We extend the grid slightly so these components are placed below the type lists, and add some styling:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="selector">body</span> <span class="punctuation">{</span>
<span class="prefix"> </span>  <span class="property">display</span><span class="punctuation">:</span> grid<span class="punctuation">;</span>
<span class="prefix"> </span>  <span class="property">grid-template-columns</span><span class="punctuation">:</span> 35% <span class="function">minmax</span><span class="punctuation">(</span>0<span class="punctuation">,</span> 1fr<span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="deleted-sign"><span class="prefix">-</span>  <span class="property">grid-template-rows</span><span class="punctuation">:</span> auto 1fr<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="property">grid-template-rows</span><span class="punctuation">:</span> auto auto 1fr<span class="punctuation">;</span>
</span></code></pre><pre><code><span class="selector">#undoRedo</span> <span class="punctuation">{</span>
  <span class="property">grid-column</span><span class="punctuation">:</span> 1<span class="punctuation">;</span>
  <span class="property">grid-row</span><span class="punctuation">:</span> 3<span class="punctuation">;</span>
  <span class="selector">#undo,
  #redo</span> <span class="punctuation">{</span>
    <span class="property">cursor</span><span class="punctuation">:</span> pointer<span class="punctuation">;</span>
    <span class="property">overflow</span><span class="punctuation">:</span> hidden<span class="punctuation">;</span>
    <span class="property">white-space</span><span class="punctuation">:</span> nowrap<span class="punctuation">;</span>
    <span class="property">text-overflow</span><span class="punctuation">:</span> ellipsis<span class="punctuation">;</span>
    <span class="property">user-select</span><span class="punctuation">:</span> none<span class="punctuation">;</span>
    <span class="selector">&amp;::before</span> <span class="punctuation">{</span>
      <span class="property">padding-right</span><span class="punctuation">:</span> 0.5rem<span class="punctuation">;</span>
      <span class="property">vertical-align</span><span class="punctuation">:</span> middle<span class="punctuation">;</span>
    <span class="punctuation">}</span>
    <span class="selector">&amp;.disabled</span> <span class="punctuation">{</span>
      <span class="property">cursor</span><span class="punctuation">:</span> default<span class="punctuation">;</span>
      <span class="property">opacity</span><span class="punctuation">:</span> 0.3<span class="punctuation">;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
  <span class="selector">#undo::before</span> <span class="punctuation">{</span>
    <span class="property">content</span><span class="punctuation">:</span> <span class="string">'\21A9'</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
  <span class="selector">#redo::before</span> <span class="punctuation">{</span>
    <span class="property">content</span><span class="punctuation">:</span> <span class="string">'\21AA'</span><span class="punctuation">;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre><p>Since we added an extra row to the grid we also make the right hand list of todos span two:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="selector">#todos</span> <span class="punctuation">{</span>
<span class="prefix"> </span>  <span class="property">grid-column</span><span class="punctuation">:</span> 2<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="property">grid-row</span><span class="punctuation">:</span> 2 <span class="operator">/</span> span 2<span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span>  <span class="property">margin</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
<span class="prefix"> </span>  <span class="property">padding</span><span class="punctuation">:</span> 0<span class="punctuation">;</span>
<span class="prefix"> </span><span class="punctuation">}</span>
</span></code></pre><h3 id="summary">Summary</h3><p>It&#x27;s been very straightforward to add a comprehensive undo and redo stack to our app. We could now declare it complete! But wouldn&#x27;t is <em>also</em> be cool to make it collaborative? If you agree, let&#x27;s move on to the <a href="/demos/todo-app/todo-app-v6-collaboration/">Todo App v6 (collaboration)</a> demo...</p></section>