{"title":"Todo App v3 (persistence)","description":"In this demo, we build a yet more complex 'Todo' app, complete with persistence\nand a schema.","html":"","css":"@accentColor: #d81b60;\n@spacing: 0.5rem;\n@border: 1px solid #ccc;\n@font-face {\n  font-family: Inter;\n  src: url(https://tinybase.org/fonts/inter.woff2) format(\"woff2\");\n}\n\nbody {\n  display: grid;\n  grid-template-columns: 35% minmax(0, 1fr);\n  grid-template-rows: auto 1fr;\n  box-sizing: border-box;\n  font-family: Inter, sans-serif;\n  letter-spacing: -0.04rem;\n  grid-gap: @spacing * 2 @spacing;\n  margin: 0;\n  min-height: 100vh;\n  padding: @spacing * 2;\n  * {\n    box-sizing: border-box;\n    outline-color: @accentColor;\n  }\n}\n\n#newTodo {\n  border: @border;\n  display: block;\n  font: inherit;\n  letter-spacing: inherit;\n  padding: @spacing;\n  width: 100%;\n}\n\n#todos {\n  grid-column: 2;\n  margin: 0;\n  padding: 0;\n}\n\n#todos .todo {\n  background: #fff;\n  border: @border;\n  display: flex;\n  margin-bottom: @spacing;\n  padding: @spacing;\n  .text {\n    cursor: pointer;\n    flex: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    user-select: none;\n    white-space: nowrap;\n    &::before {\n      content: \"\\1F7E0\";\n      padding: 0 0.5rem 0 0.25rem;\n    }\n    &.done {\n      color: #ccc;\n      &::before {\n        content: \"\\2705\";\n      }\n    }\n  }\n}\n\n#types {\n  margin: 0;\n}\n\n#types .type {\n  cursor: pointer;\n  margin-bottom: @spacing;\n  user-select: none;\n  &.current {\n    color: @accentColor;\n  }\n}\n\n#todos .todo .type {\n  border: none;\n  color: #777;\n  font: inherit;\n  font-size: 0.8rem;\n  margin-top: 0.1rem;\n}","js":"const {\n  createIndexes,\n  createLocalPersister,\n  createSessionPersister,\n  createStore,\n} = TinyBase;\nconst {\n  CellView,\n  Provider,\n  SliceView,\n  useAddRowCallback,\n  useCell,\n  useCreateIndexes,\n  useCreatePersister,\n  useCreateStore,\n  useSetCellCallback,\n  useSetValueCallback,\n  useValue,\n} = TinyBaseUiReact;\nconst {useCallback, useState} = React;\n\nconst TYPES = ['Home', 'Work', 'Archived'];\nconst SCHEMA = {\n  todos: {\n    text: {type: 'string'},\n    done: {type: 'boolean', default: false},\n    type: {type: 'string', default: 'Home', allow: TYPES},\n  },\n};\nconst INITIAL_TODOS = {\n  todos: {\n    0: {text: 'Clean the floor', type: 'Home'},\n    1: {text: 'Install TinyBase', type: 'Work'},\n    2: {text: 'Book holiday', type: 'Archived'},\n  },\n};\n\nconst App = () => {\n  const store = useCreateStore(() => createStore().setTablesSchema(SCHEMA));\n  useCreatePersister(\n    store,\n    (store) => createLocalPersister(store, 'todos/store'),\n    [],\n    async (persister) => {\n      await persister.startAutoLoad(INITIAL_TODOS);\n      await persister.startAutoSave();\n    },\n  );\n  const viewStore = useCreateStore(() => createStore());\n  useCreatePersister(\n    viewStore,\n    (store) => createSessionPersister(store, 'todos/viewStore'),\n    [],\n    async (persister) => {\n      await persister.startAutoLoad({}, {type: 'Home'});\n      await persister.startAutoSave();\n    },\n  );\n  const indexes = useCreateIndexes(store, (store) =>\n    createIndexes(store).setIndexDefinition('types', 'todos', 'type'),\n  );\n\n  return (\n    <Provider store={store} storesById={{viewStore}} indexes={indexes}>\n      <Title />\n      <NewTodo />\n      <Types />\n      <Todos />\n    </Provider>\n  );\n};\n\nwindow.addEventListener('load', () =>\n  ReactDOM.createRoot(document.body).render(<App />),\n);\n\nconst Title = () => 'Todos';\n\nconst NewTodo = () => {\n  const [text, setText] = useState('');\n  const type = useValue('type', 'viewStore');\n  const handleChange = useCallback(({target: {value}}) => setText(value), []);\n  const handleKeyDown = useAddRowCallback(\n    'todos',\n    ({which, target: {value: text}}) =>\n      which == 13 && text != '' ? {text, type} : null,\n    [type],\n    undefined,\n    () => setText(''),\n    [setText],\n  );\n\n  return (\n    <input\n      id=\"newTodo\"\n      onChange={handleChange}\n      onKeyDown={handleKeyDown}\n      placeholder=\"New Todo\"\n      value={text}\n    />\n  );\n};\n\nconst Todos = () => (\n  <ul id=\"todos\">\n    <SliceView\n      indexId=\"types\"\n      sliceId={useValue('type', 'viewStore')}\n      rowComponent={Todo}\n    />\n  </ul>\n);\n\nconst Todo = (props) => (\n  <li className=\"todo\">\n    <TodoText {...props} />\n    <TodoType {...props} />\n  </li>\n);\n\nconst TodoText = ({tableId, rowId}) => {\n  const done = useCell(tableId, rowId, 'done');\n  const className = 'text' + (done ? ' done' : '');\n  const handleClick = useSetCellCallback(tableId, rowId, 'done', () => !done, [\n    done,\n  ]);\n\n  return (\n    <span className={className} onClick={handleClick}>\n      <CellView tableId={tableId} rowId={rowId} cellId=\"text\" />\n    </span>\n  );\n};\n\nconst Types = () => (\n  <ul id=\"types\">\n    {TYPES.map((type) => (\n      <Type key={type} type={type} />\n    ))}\n  </ul>\n);\n\nconst Type = ({type}) => {\n  const currentType = useValue('type', 'viewStore');\n  const handleClick = useSetValueCallback(\n    'type',\n    () => type,\n    [type],\n    'viewStore',\n  );\n  const className = 'type' + (type == currentType ? ' current' : '');\n\n  return (\n    <li className={className} onClick={handleClick}>\n      {type}\n    </li>\n  );\n};\n\nconst TodoType = ({tableId, rowId}) => {\n  const type = useCell(tableId, rowId, 'type');\n  const handleChange = useSetCellCallback(\n    tableId,\n    rowId,\n    'type',\n    ({target: {value}}) => value,\n    [],\n  );\n\n  return (\n    <select className=\"type\" onChange={handleChange} value={type}>\n      {TYPES.map((type) => (\n        <option>{type}</option>\n      ))}\n    </select>\n  );\n};","css_pre_processor":"less","js_pre_processor":"typescript","js_external":"https://beta.tinybase.org/umd/react.production.min.js;https://beta.tinybase.org/umd/react-dom.production.min.js;https://beta.tinybase.org/umd/tinybase.js;https://beta.tinybase.org/umd/ui-react.js","editors":"012","tags":["tinybase"]}