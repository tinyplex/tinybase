<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/demos/">Demos</a></li><li><a href="/demos/todo-app/">Todo App</a></li><li><a href="/demos/todo-app/todo-app-v3-persistence/">Todo App v3 (persistence)</a></li></ul></nav><section class="s1" id="/demos/todo-app/todo-app-v3-persistence/" data-id="TA4"><h1>Todo App v3 (persistence)</h1><iframe srcdoc="&lt;html&gt;&lt;head&gt;&lt;script src=&quot;/umd/react.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/tinybase.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/persister-browser.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/ui-react.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;/umd/ui-react-dom-debug.js&quot;&gt;&lt;/script&gt;&lt;style&gt;@font-face{font-family:Inter;src:url(https://tinybase.org/fonts/inter.woff2) format(&#x27;woff2&#x27;)}body{display:grid;grid-template-columns:35% minmax(0,1fr);grid-template-rows:auto 1fr;box-sizing:border-box;font-family:Inter,sans-serif;letter-spacing:-.04rem;grid-gap:1rem .5rem;margin:0;min-height:100vh;padding:1rem}body *{box-sizing:border-box;outline-color:#d81b60}#newTodo{border:1px solid #ccc;display:block;font:inherit;letter-spacing:inherit;padding:.5rem;width:100%}#todos{grid-column:2;margin:0;padding:0}#todos .todo{background:#fff;border:1px solid #ccc;display:flex;margin-bottom:.5rem;padding:.5rem}#todos .todo .text{cursor:pointer;flex:1;overflow:hidden;text-overflow:ellipsis;user-select:none;white-space:nowrap}#todos .todo .text::before{content:&#x27;\1F7E0&#x27;;padding:0 .5rem 0 .25rem}#todos .todo .text.done{color:#ccc}#todos .todo .text.done::before{content:&#x27;\2705&#x27;}#types{margin:0}#types .type{cursor:pointer;margin-bottom:.5rem;user-select:none}#types .type.current{color:#d81b60}#todos .todo .type{border:none;color:#777;font:inherit;font-size:.8rem;margin-top:.1rem}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;script&gt;(()=&gt;{let r=React[&quot;createElement&quot;],{createIndexes:o,createStore:l}=TinyBase,{createLocalPersister:s,createSessionPersister:n}=TinyBasePersisterBrowser,{CellView:d,Provider:i,SliceView:e,useAddRowCallback:u,useCell:c,useCreateIndexes:y,useCreatePersister:p,useCreateStore:w,useSetCellCallback:v,useSetValueCallback:S,useValue:m}=TinyBaseUiReact,{useCallback:C,useState:I}=React,x=TinyBaseUiReactDomDebug[&quot;StoreInspector&quot;],b=[&quot;Home&quot;,&quot;Work&quot;,&quot;Archived&quot;],h={todos:{text:{type:&quot;string&quot;},done:{type:&quot;boolean&quot;,default:!1},type:{type:&quot;string&quot;,default:&quot;Home&quot;,allow:b}}},k={todos:{0:{text:&quot;Clean the floor&quot;,type:&quot;Home&quot;},1:{text:&quot;Install TinyBase&quot;,type:&quot;Work&quot;},2:{text:&quot;Book holiday&quot;,type:&quot;Archived&quot;}}},t=()=&gt;{var e=w(()=&gt;l().setTablesSchema(h)),t=(p(e,e=&gt;s(e,&quot;todos/store&quot;),[],async e=&gt;{await e.startAutoLoad(k),await e.startAutoSave()}),w(()=&gt;l().setValuesSchema({type:{type:&quot;string&quot;,default:&quot;Home&quot;}}))),a=(p(t,e=&gt;n(e,&quot;todos/viewStore&quot;),[],async e=&gt;{await e.startAutoLoad(),await e.startAutoSave()}),y(e,e=&gt;o(e).setIndexDefinition(&quot;types&quot;,&quot;todos&quot;,&quot;type&quot;)));return r(i,{store:e,storesById:{viewStore:t},indexes:a},r(g,null),r(T,null),r(R,null),r(B,null),r(x,null))},g=(window.addEventListener(&quot;load&quot;,()=&gt;ReactDOM.createRoot(document.body).render(r(t,null))),()=&gt;&quot;Todos&quot;),T=()=&gt;{let[e,t]=I(&quot;&quot;),a=m(&quot;type&quot;,&quot;viewStore&quot;),o=C(({target:{value:e}})=&gt;t(e),[]),l=u(&quot;todos&quot;,({which:e,target:{value:t}})=&gt;13==e&amp;&amp;&quot;&quot;!=t?{text:t,type:a}:null,[a],void 0,()=&gt;t(&quot;&quot;),[t]);return r(&quot;input&quot;,{id:&quot;newTodo&quot;,onChange:o,onKeyDown:l,placeholder:&quot;New Todo&quot;,value:e})},B=()=&gt;r(&quot;ul&quot;,{id:&quot;todos&quot;},r(e,{indexId:&quot;types&quot;,sliceId:m(&quot;type&quot;,&quot;viewStore&quot;),rowComponent:a})),a=e=&gt;r(&quot;li&quot;,{className:&quot;todo&quot;},r(A,{...e}),r(D,{...e})),A=({tableId:e,rowId:t})=&gt;{let a=c(e,t,&quot;done&quot;),o=&quot;text&quot;+(a?&quot; done&quot;:&quot;&quot;),l=v(e,t,&quot;done&quot;,()=&gt;!a,[a]);return r(&quot;span&quot;,{className:o,onClick:l},r(d,{tableId:e,rowId:t,cellId:&quot;text&quot;}))},R=()=&gt;r(&quot;ul&quot;,{id:&quot;types&quot;},b.map(e=&gt;r(f,{key:e,type:e}))),f=({type:e})=&gt;{var t=m(&quot;type&quot;,&quot;viewStore&quot;),a=S(&quot;type&quot;,()=&gt;e,[e],&quot;viewStore&quot;),t=&quot;type&quot;+(e==t?&quot; current&quot;:&quot;&quot;);return r(&quot;li&quot;,{className:t,onClick:a},e)},D=({tableId:e,rowId:t})=&gt;{var a=c(e,t,&quot;type&quot;),e=v(e,t,&quot;type&quot;,({target:{value:e}})=&gt;e,[]);return r(&quot;select&quot;,{className:&quot;type&quot;,onChange:e,value:a},b.map(e=&gt;r(&quot;option&quot;,null,e)))}})()&lt;/script&gt;&lt;/html&gt;"></iframe><p>In this demo, we build a yet more complex &#x27;Todo&#x27; app, complete with persistence and a schema.</p><p>In the <a href="/demos/todo-app/todo-app-v1-the-basics/">Todo App v1 (the basics)</a> demo and the <a href="/demos/todo-app/todo-app-v2-indexes/">Todo App v2 (indexes)</a> demo, refreshing the page reset all the todos, which didn&#x27;t make it very useful. In this version, we demonstrate the basics of how to persist data from a <a href="/api/store/interfaces/store/store/"><code>Store</code></a>.</p><p>When data is persisted, it also valuable to have a schema for it, so in this demo we also add a simple schema for the todos.</p><p>We&#x27;re making changes to the <a href="/demos/todo-app/todo-app-v2-indexes/">Todo App v2 (indexes)</a> demo.</p><h3 id="additional-initialization">Additional Initialization</h3><p>We will call the <a href="/api/persister-browser/functions/creation/createlocalpersister/"><code>createLocalPersister</code></a> function to create a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object that persists the the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a> object in the browser&#x27;s local store. Similarly, the <a href="/api/persister-browser/functions/creation/createsessionpersister/"><code>createSessionPersister</code></a> function will create a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object that persists the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> object containing the user&#x27;s current view:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/tinybase.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/persister-browser.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</span><span class="unchanged"><span class="prefix"> </span><span class="tag"><span class="tag"><span class="punctuation">&lt;</span>script</span> <span class="attr-name">src</span><span class="attr-value"><span class="punctuation">=</span><span class="punctuation">"</span>/umd/ui-react.js<span class="punctuation">"</span></span><span class="punctuation">></span></span><span class="script"></span><span class="tag"><span class="tag"><span class="punctuation">&lt;/</span>script</span><span class="punctuation">></span></span>
</span></code></pre><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>createIndexes<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="operator">=</span> TinyBase<span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> <span class="punctuation">{</span>createLocalPersister<span class="punctuation">,</span> createSessionPersister<span class="punctuation">}</span> <span class="operator">=</span> TinyBasePersisterBrowser<span class="punctuation">;</span>
</span><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="punctuation">{</span>
<span class="prefix"> </span>  CellView<span class="punctuation">,</span>
<span class="prefix"> </span>  Provider<span class="punctuation">,</span>
<span class="prefix"> </span>  SliceView<span class="punctuation">,</span>
<span class="prefix"> </span>  useAddRowCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useCell<span class="punctuation">,</span>
<span class="prefix"> </span>  useCreateIndexes<span class="punctuation">,</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  useCreatePersister<span class="punctuation">,</span>
</span><span class="unchanged"><span class="prefix"> </span>  useCreateStore<span class="punctuation">,</span>
<span class="prefix"> </span>  useSetCellCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useSetValueCallback<span class="punctuation">,</span>
<span class="prefix"> </span>  useValue<span class="punctuation">,</span>
<span class="prefix"> </span><span class="punctuation">}</span> <span class="operator">=</span> TinyBaseUiReact<span class="punctuation">;</span>
</span></code></pre><h3 id="adding-a-tablesschema">Adding a <a href="/api/store/type-aliases/schema/tablesschema/"><code>TablesSchema</code></a></h3><p>A <a href="/api/store/interfaces/store/store/"><code>Store</code></a> has a <a href="/api/store/interfaces/store/store/methods/setter/settablesschema/"><code>setTablesSchema</code></a> method which can be used to describe a schema of each <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> present in each <a href="/api/store/type-aliases/store/table/"><code>Table</code></a>. Here we will indicate that the <code>text</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> and <code>type</code> <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> are strings, and we default the <code>done</code> field to <code>false</code>. The <code>type</code> can only be one of the values of the <code>TYPES</code> array:</p><pre><code><span class="unchanged"><span class="prefix"> </span><span class="keyword">const</span> <span class="constant">TYPES</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="string">'Home'</span><span class="punctuation">,</span> <span class="string">'Work'</span><span class="punctuation">,</span> <span class="string">'Archived'</span><span class="punctuation">]</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span><span class="keyword">const</span> <span class="constant">SCHEMA</span> <span class="operator">=</span> <span class="punctuation">{</span>
<span class="prefix">+</span>  <span class="literal-property">todos</span><span class="operator">:</span> <span class="punctuation">{</span>
<span class="prefix">+</span>    <span class="literal-property">text</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="literal-property">done</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'boolean'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="boolean">false</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="literal-property">type</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="string">'Home'</span><span class="punctuation">,</span> <span class="literal-property">allow</span><span class="operator">:</span> <span class="constant">TYPES</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span><span class="punctuation">}</span><span class="punctuation">;</span>
</span></code></pre><h3 id="persisting-the-store">Persisting the <a href="/api/store/interfaces/store/store/"><code>Store</code></a></h3><p>We create and memoize a <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object for the main <a href="/api/store/interfaces/store/store/"><code>Store</code></a> object. We&#x27;ll start it auto-loading from the browser&#x27;s local storage immediately, but we can also provide <code>INITIAL_TODOS</code> as a default if nothing has been previously saved. We also set the <a href="/api/persisters/interfaces/persister/persister/"><code>Persister</code></a> object to auto-save, creating a continuous synchronization between the in-memory version of the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> object and the copy of it in the browser&#x27;s local storage.</p><p>Note that we don&#x27;t set the initial data of the <a href="/api/store/interfaces/store/store/"><code>Store</code></a> object when we first create it, since it might have been persisted into the browser&#x27;s local storage from a previous session, and we want to pick it up with the first load. We do configure the schema on creation though:</p><pre><code><span class="deleted-sign"><span class="prefix">-</span>  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="constant">INITIAL_TODOS</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/settablesschema/">setTablesSchema</a></span><span class="punctuation">(</span><span class="constant">SCHEMA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="function"><a href="/api/ui-react/functions/persister-hooks/usecreatepersister/">useCreatePersister</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>    store<span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createlocalpersister/">createLocalPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'todos/store'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">persister</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix">+</span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="constant">INITIAL_TODOS</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>    <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>We do something similar for the <code>viewStore</code>, so that reloads preserve the type currently being viewed. Instead of local storage, we&#x27;ll use the browser&#x27;s session storage. This means that if the user has two browser windows open, the UI changes to one won&#x27;t mysteriously affect the other:</p><pre><code><span class="deleted-sign"><span class="prefix">-</span>  <span class="keyword">const</span> viewStore <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
<span class="prefix">-</span>    <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setvalue/">setValue</a></span><span class="punctuation">(</span><span class="string">'type'</span><span class="punctuation">,</span> <span class="string">'Home'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">-</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span><span class="inserted-sign"><span class="prefix">+</span>  <span class="keyword">const</span> viewStore <span class="operator">=</span> <span class="function"><a href="/api/ui-react/functions/store-hooks/usecreatestore/">useCreateStore</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
<span class="prefix">+</span>    <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/store/interfaces/store/store/methods/setter/setvaluesschema/">setValuesSchema</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">type</span><span class="operator">:</span> <span class="string">'string'</span><span class="punctuation">,</span> <span class="keyword">default</span><span class="operator">:</span> <span class="string">'Home'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>  <span class="function"><a href="/api/ui-react/functions/persister-hooks/usecreatepersister/">useCreatePersister</a></span><span class="punctuation">(</span>
<span class="prefix">+</span>    viewStore<span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">(</span><span class="parameter">store</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="function"><a href="/api/persister-browser/functions/creation/createsessionpersister/">createSessionPersister</a></span><span class="punctuation">(</span>store<span class="punctuation">,</span> <span class="string">'todos/viewStore'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>
<span class="prefix">+</span>    <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">persister</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
<span class="prefix">+</span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/load/startautoload/">startAutoLoad</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>      <span class="keyword">await</span> persister<span class="punctuation">.</span><span class="function"><a href="/api/persisters/interfaces/persister/persister/methods/save/startautosave/">startAutoSave</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="prefix">+</span>    <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="prefix">+</span>  <span class="punctuation">)</span><span class="punctuation">;</span>
</span></code></pre><p>Make some changes to the todos and then reload your browser!</p><p>We now have a fairly useful app for tracking todos and persisting the state. Please continue to the <a href="/demos/todo-app/todo-app-v4-metrics/">Todo App v4 (metrics)</a> demo.</p></section>