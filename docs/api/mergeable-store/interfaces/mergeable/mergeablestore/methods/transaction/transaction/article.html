<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/api/">API</a></li><li><a href="/api/mergeable-store/"><code>mergeable-store</code></a></li><li><a href="/api/mergeable-store/interfaces/">Interfaces</a></li><li><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/"><code>MergeableStore</code></a></li><li><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/">Transaction methods</a></li><li><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/"><code>transaction</code></a></li></ul></nav><section class="s1" id="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/" data-id="t2"><h1><code>transaction</code></h1><p>The <code>transaction</code> method takes a function that makes multiple mutations to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>, buffering all calls to the relevant listeners until it completes.</p><pre><code><span class="generic-function"><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/">transaction</a></span><span class="generic"><span class="operator">&lt;</span>Return<span class="operator">></span></span></span><span class="punctuation">(</span>
  <span class="function-variable">actions</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> Return<span class="punctuation">,</span>
  doRollback<span class="operator">?</span><span class="operator">:</span> <span class="type"><a href="/api/store/type-aliases/callback/dorollback/">DoRollback</a></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="operator">:</span> Return</code></pre><div class="table"><table><tr><th></th><th>Type</th><th>Description</th></tr><tr><th><code>actions</code></th><td><code><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> Return</code></td><td><p>The function to be executed as a transaction.</p></td></tr><tr><th><code>doRollback<span class="operator">?</span></code></th><td><code><span class="type"><a href="/api/store/type-aliases/callback/dorollback/">DoRollback</a></span></code></td><td><p>An optional callback that should return <code>true</code> if you want to rollback the transaction at the end. Since v1.2.</p></td></tr><tr><th class="right">returns</th><td><code>Return</code></td><td><p></p><p>Whatever value the provided transaction function returns.</p><p></p></td></tr></table></div><p>This method is useful for making bulk changes to the data in a <a href="/api/store/interfaces/store/store/"><code>Store</code></a>, and when you don&#x27;t want listeners to be called as you make each change. <a href="/api/store/type-aliases/transaction/changes/"><code>Changes</code></a> are made silently during the transaction, and listeners relevant to the changes you have made will instead only be called when the whole transaction is complete.</p><p>If multiple changes are made to a piece of <a href="/api/store/interfaces/store/store/"><code>Store</code></a> data throughout the transaction, a relevant listener will only be called with the final value (assuming it is different to the value at the start of the transaction), regardless of the changes that happened in between. For example, if a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> had a value <code>&#x27;a&#x27;</code> and then, within a transaction, it was changed to <code>&#x27;b&#x27;</code> and then <code>&#x27;c&#x27;</code>, any <a href="/api/store/type-aliases/listener/celllistener/"><code>CellListener</code></a> registered for that cell would be called once as if there had been a single change from <code>&#x27;a&#x27;</code> to <code>&#x27;c&#x27;</code>.</p><p><a href="/guides/the-basics/transactions/">Transactions</a> can be nested. Relevant listeners will be called only when the outermost one completes.</p><p>The second, optional parameter, <code>doRollback</code> is a <a href="/api/store/type-aliases/callback/dorollback/"><code>DoRollback</code></a> callback that you can use to rollback the transaction if it did not complete to your satisfaction. See the <a href="/api/store/type-aliases/callback/dorollback/"><code>DoRollback</code></a> documentation for more details.</p><section class="s2"><h2>Examples</h2><p>This example makes changes to two Cells, first outside, and secondly within, a transaction. In the second case, the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> listener is only called once.</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/listener/addrowlistener/">addRowListener</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="string">'Fido changed'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>

store
  <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'brown'</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="boolean">false</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'Fido changed'</span>
<span class="comment">// -> 'Fido changed'</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  store
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'walnut'</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'sold'</span><span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'Fido changed'</span>
</code></pre><p>This example makes multiple changes to one <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a>. The <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> listener is called once - and with the final value - only if there is a net overall change.</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/listener/addcelllistener/">addCellListener</a></span><span class="punctuation">(</span>
  <span class="string">'pets'</span><span class="punctuation">,</span>
  <span class="string">'fido'</span><span class="punctuation">,</span>
  <span class="string">'color'</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="parameter">store<span class="punctuation">,</span> tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> cellId<span class="punctuation">,</span> newCell</span><span class="punctuation">)</span> <span class="operator">=></span> console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>newCell<span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  store
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'black'</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'brown'</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'walnut'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'walnut'</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
  store
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'black'</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'walnut'</span><span class="punctuation">)</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> undefined</span>
<span class="comment">// No net change during the transaction, so the listener is not called.</span>
</code></pre><p>This example makes multiple changes to the <a href="/api/store/interfaces/store/store/"><code>Store</code></a>, including some attempts to update a <a href="/api/store/type-aliases/store/cell/"><code>Cell</code></a> and <a href="/api/store/type-aliases/store/value/"><code>Value</code></a> with invalid values. The <code>doRollback</code> callback receives information about the changes and invalid attempts, and then judges that the transaction should be rolled back to its original state.</p><pre><code><span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/store/functions/creation/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/settables/">setTables</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">pets</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">fido</span><span class="operator">:</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">color</span><span class="operator">:</span> <span class="string">'brown'</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span>
  <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setvalues/">setValues</a></span><span class="punctuation">(</span><span class="punctuation">{</span><span class="literal-property">open</span><span class="operator">:</span> <span class="boolean">true</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/transaction/">transaction</a></span><span class="punctuation">(</span>
  <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span>
    store
      <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'color'</span><span class="punctuation">,</span> <span class="string">'black'</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'eyes'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="string">'left'</span><span class="punctuation">,</span> <span class="string">'right'</span><span class="punctuation">]</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'info'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">sold</span><span class="operator">:</span> <span class="keyword">null</span><span class="punctuation">}</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setvalue/">setValue</a></span><span class="punctuation">(</span><span class="string">'open'</span><span class="punctuation">,</span> <span class="boolean">false</span><span class="punctuation">)</span>
      <span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/setter/setvalue/">setValue</a></span><span class="punctuation">(</span><span class="string">'employees'</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="string">'alice'</span><span class="punctuation">,</span> <span class="string">'bob'</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span>
  <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">const</span> <span class="punctuation">[</span><span class="punctuation">,</span> <span class="punctuation">,</span> changedCells<span class="punctuation">,</span> invalidCells<span class="punctuation">,</span> changedValues<span class="punctuation">,</span> invalidValues<span class="punctuation">]</span> <span class="operator">=</span>
      store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/transaction/gettransactionlog/">getTransactionLog</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>changedCells<span class="punctuation">)</span><span class="punctuation">;</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>invalidCells<span class="punctuation">)</span><span class="punctuation">;</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>changedValues<span class="punctuation">)</span><span class="punctuation">;</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>invalidValues<span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="keyword">return</span> invalidCells<span class="punctuation">[</span><span class="string">'pets'</span><span class="punctuation">]</span> <span class="operator">!=</span> <span class="keyword">null</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog', color: 'black'}}}</span>
<span class="comment">// -> {pets: {fido: {color: ['brown', 'black']}}}</span>
<span class="comment">// -> {pets: {fido: {eyes: [['left', 'right']], info: [{sold: null}]}}}</span>
<span class="comment">// -> {open: [true, false]}</span>
<span class="comment">// -> {employees: [['alice', 'bob']]}</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/getter/gettables/">getTables</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {pets: {fido: {species: 'dog', color: 'brown'}}}</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/mergeable-store/interfaces/mergeable/mergeablestore/methods/getter/getvalues/">getValues</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {open: true}</span>
</code></pre></section></section>