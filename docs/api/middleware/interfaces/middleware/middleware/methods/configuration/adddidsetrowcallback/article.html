<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/api/">API</a></li><li><a href="/api/middleware/"><code>middleware</code></a></li><li><a href="/api/middleware/interfaces/">Interfaces</a></li><li><a href="/api/middleware/interfaces/middleware/middleware/"><code>Middleware</code></a></li><li><a href="/api/middleware/interfaces/middleware/middleware/methods/configuration/">Configuration methods</a></li><li><a href="/api/middleware/interfaces/middleware/middleware/methods/configuration/adddidsetrowcallback/"><code>addDidSetRowCallback</code></a></li></ul></nav><section class="s1" id="/api/middleware/interfaces/middleware/middleware/methods/configuration/adddidsetrowcallback/" data-id="aDSRC"><h1><code>addDidSetRowCallback</code></h1><p>The <code>addDidSetRowCallback</code> method registers a <a href="/api/middleware/type-aliases/callback/didsetrowcallback/"><code>DidSetRowCallback</code></a> for a specific table that will be called after any <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> in that table is changed during a transaction, after mutator listeners have fired.</p><pre><code><span class="function"><a href="/api/middleware/interfaces/middleware/middleware/methods/configuration/adddidsetrowcallback/">addDidSetRowCallback</a></span><span class="punctuation">(</span>
  tableId<span class="operator">:</span> <span class="builtin">string</span><span class="punctuation">,</span>
  callback<span class="operator">:</span> <span class="type"><a href="/api/middleware/type-aliases/callback/didsetrowcallback/">DidSetRowCallback</a></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="operator">:</span> <span class="type"><a href="/api/middleware/interfaces/middleware/middleware/">Middleware</a></span></code></pre><div class="table"><table><tr><th></th><th>Type</th><th>Description</th></tr><tr><th><code>tableId</code></th><td><code><span class="builtin">string</span></code></td><td><p>The <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> of the <a href="/api/store/type-aliases/store/table/"><code>Table</code></a> to watch.</p></td></tr><tr><th><code>callback</code></th><td><code><span class="type"><a href="/api/middleware/type-aliases/callback/didsetrowcallback/">DidSetRowCallback</a></span></code></td><td><p>The <a href="/api/middleware/type-aliases/callback/didsetrowcallback/"><code>DidSetRowCallback</code></a> to register.</p></td></tr><tr><th class="right">returns</th><td><code><span class="type"><a href="/api/middleware/interfaces/middleware/middleware/">Middleware</a></span></code></td><td><p></p><p>A reference to the <a href="/api/middleware/interfaces/middleware/middleware/"><code>Middleware</code></a> object, for chaining.</p><p></p></td></tr></table></div><p>Unlike <code>willSetRow</code>, which fires synchronously during each write, this callback fires once per changed <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> after all cell writes in the transaction have landed. Multiple cell changes to the same <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> within a transaction produce a single callback with the full before/after <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> states.</p><p>The callback receives <code>oldRow</code> (the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> at the start of the transaction) and <code>newRow</code> (the <a href="/api/store/type-aliases/store/row/"><code>Row</code></a> after all writes). Return <code>newRow</code> to accept, a different <code>[</code>Row<code>](/api/store/type-aliases/store/row/)</code> to replace, <code>oldRow</code> to revert, or an empty object to delete.</p><section class="s2"><h2>Examples</h2><p>This example registers a callback that validates the &#x27;pets&#x27; table, reverting any row that ends up without a required &#x27;species&#x27; cell.</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createMiddleware<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>

<span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/creating-stores/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> middleware <span class="operator">=</span> <span class="function"><a href="/api/middleware/functions/creation/createmiddleware/">createMiddleware</a></span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>

middleware<span class="punctuation">.</span><span class="function"><a href="/api/middleware/interfaces/middleware/middleware/methods/configuration/adddidsetrowcallback/">addDidSetRowCallback</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">_tableId<span class="punctuation">,</span> _rowId<span class="punctuation">,</span> oldRow<span class="punctuation">,</span> newRow</span><span class="punctuation">)</span> <span class="operator">=></span>
  <span class="string">'species'</span> <span class="keyword">in</span> newRow <span class="operator">?</span> newRow <span class="operator">:</span> oldRow<span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setrow/">setRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">species</span><span class="operator">:</span> <span class="string">'dog'</span><span class="punctuation">,</span> <span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Fido'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/getting-data/getrow/">getRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {species: 'dog', name: 'Fido'}</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setrow/">setRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'nemo'</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">name</span><span class="operator">:</span> <span class="string">'Nemo'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/getting-data/getrow/">getRow</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'nemo'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {}</span>

middleware<span class="punctuation">.</span><span class="function"><a href="/api/middleware/interfaces/middleware/middleware/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This example shows that multiple cell changes in one transaction result in a single didSetRow callback with the full before/after row states.</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createMiddleware<span class="punctuation">,</span> createStore<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>

<span class="keyword">const</span> store <span class="operator">=</span> <span class="function"><a href="/api/the-essentials/creating-stores/createstore/">createStore</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">const</span> middleware <span class="operator">=</span> <span class="function"><a href="/api/middleware/functions/creation/createmiddleware/">createMiddleware</a></span><span class="punctuation">(</span>store<span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> seen <span class="operator">=</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">;</span>
middleware<span class="punctuation">.</span><span class="function"><a href="/api/middleware/interfaces/middleware/middleware/methods/configuration/adddidsetrowcallback/">addDidSetRowCallback</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="parameter">_tableId<span class="punctuation">,</span> rowId<span class="punctuation">,</span> oldRow<span class="punctuation">,</span> newRow</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  seen<span class="punctuation">.</span><span class="function">push</span><span class="punctuation">(</span><span class="punctuation">{</span>rowId<span class="punctuation">,</span> <span class="literal-property">oldRow</span><span class="operator">:</span> <span class="punctuation">{</span><span class="operator">...</span>oldRow<span class="punctuation">}</span><span class="punctuation">,</span> <span class="literal-property">newRow</span><span class="operator">:</span> <span class="punctuation">{</span><span class="operator">...</span>newRow<span class="punctuation">}</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="keyword">return</span> newRow<span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>

store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/transaction/">transaction</a></span><span class="punctuation">(</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'name'</span><span class="punctuation">,</span> <span class="string">'Fido'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  store<span class="punctuation">.</span><span class="function"><a href="/api/the-essentials/setting-data/setcell/">setCell</a></span><span class="punctuation">(</span><span class="string">'pets'</span><span class="punctuation">,</span> <span class="string">'fido'</span><span class="punctuation">,</span> <span class="string">'species'</span><span class="punctuation">,</span> <span class="string">'dog'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>seen<span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 1</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>seen<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span>rowId<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'fido'</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>seen<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">.</span>newRow<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {name: 'Fido', species: 'dog'}</span>

middleware<span class="punctuation">.</span><span class="function"><a href="/api/middleware/interfaces/middleware/middleware/methods/lifecycle/destroy/">destroy</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre></section><section class="s2"><h2>Since</h2><p>v8.0.0</p></section></section>