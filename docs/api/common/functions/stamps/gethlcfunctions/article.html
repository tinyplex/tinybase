<nav><ul><li><a href="/">TinyBase</a></li><li><a href="/api/">API</a></li><li><a href="/api/common/"><code>common</code></a></li><li><a href="/api/common/functions/">Functions</a></li><li><a href="/api/common/functions/stamps/">Stamps functions</a></li><li><a href="/api/common/functions/stamps/gethlcfunctions/"><code>getHlcFunctions</code></a></li></ul></nav><section class="s1" id="/api/common/functions/stamps/gethlcfunctions/" data-id="gHF"><h1><code>getHlcFunctions</code></h1><p>The <code>getHlcFunctions</code> function returns a set of utility functions for working with the TinyBase Hybrid Logical Clock (HLC).</p><pre><code><span class="function"><a href="/api/common/functions/stamps/gethlcfunctions/">getHlcFunctions</a></span><span class="punctuation">(</span>
  uniqueId<span class="operator">?</span><span class="operator">:</span> <span class="builtin">string</span><span class="punctuation">,</span>
  getNow<span class="operator">?</span><span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/stamps/getnow/">GetNow</a></span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="operator">:</span> <span class="punctuation">[</span><span class="function-variable">getNextHlc</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">,</span> <span class="function-variable">seenHlc</span><span class="operator">:</span> <span class="punctuation">(</span>remoteHlc<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="keyword">void</span><span class="punctuation">,</span> <span class="function-variable">encodeHlc</span><span class="operator">:</span> <span class="punctuation">(</span>logicalTime<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> counter<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> clientId<span class="operator">?</span><span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">,</span> <span class="function-variable">decodeHlc</span><span class="operator">:</span> <span class="punctuation">(</span>hlc<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">[</span>logicalTime<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> counter<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> clientId<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="function-variable">getLastLogicalTime</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="builtin">number</span><span class="punctuation">,</span> <span class="function-variable">getLastCounter</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="builtin">number</span><span class="punctuation">,</span> <span class="function-variable">getClientId</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">]</span></code></pre><div class="table"><table><tr><th></th><th>Type</th><th>Description</th></tr><tr><th><code>uniqueId<span class="operator">?</span></code></th><td><code><span class="builtin">string</span></code></td><td><p>An optional unique <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> for the client.</p></td></tr><tr><th><code>getNow<span class="operator">?</span></code></th><td><code><span class="type"><a href="/api/common/type-aliases/stamps/getnow/">GetNow</a></span></code></td><td><p>An optional function that generates millisecond timestamps, defaulting to <code>Date.now</code>.</p></td></tr><tr><th class="right">returns</th><td><code><span class="punctuation">[</span><span class="function-variable">getNextHlc</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">,</span> <span class="function-variable">seenHlc</span><span class="operator">:</span> <span class="punctuation">(</span>remoteHlc<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="keyword">void</span><span class="punctuation">,</span> <span class="function-variable">encodeHlc</span><span class="operator">:</span> <span class="punctuation">(</span>logicalTime<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> counter<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> clientId<span class="operator">?</span><span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">,</span> <span class="function-variable">decodeHlc</span><span class="operator">:</span> <span class="punctuation">(</span>hlc<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/stamps/hlc/">Hlc</a></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">[</span>logicalTime<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> counter<span class="operator">:</span> <span class="builtin">number</span><span class="punctuation">,</span> clientId<span class="operator">:</span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="function-variable">getLastLogicalTime</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="builtin">number</span><span class="punctuation">,</span> <span class="function-variable">getLastCounter</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="builtin">number</span><span class="punctuation">,</span> <span class="function-variable">getClientId</span><span class="operator">:</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="type"><a href="/api/common/type-aliases/identity/id/">Id</a></span><span class="punctuation">]</span></code></td><td><p></p><p>An array of seven stateful functions as described above.</p><p></p></td></tr></table></div><p>An HLC is a sortable 16 character string that encodes a timestamp, a counter, and the hash of a unique client identifier. You should provide that unique client identifier as the <code>uniqueId</code> parameter to the function. Otherwise it will be defaulted and the client suffix of the HLCs the <code>getNextHlc</code> function generates will be non-deterministic.</p><p>You can also provide a <code>getNow</code> function that returns the current time in milliseconds, which is useful for testing purposes where fully deterministic HLCs are required, rather than the current time.</p><p>The stateful functions returned by this function are as follows.</p><ul><li><code>getNextHlc</code>: a function that returns the next HLC for this client based on the time and any other HLC values from other clients that have been seen.</li><li><code>seenHlc</code>: a function that takes an HLC and updates the internal state of the functions to ensure that the next HLC returned by <code>getNextHlc</code> is greater than the given seen HLC.</li><li><code>encodeHlc</code>: a function that takes a timestamp, a counter (and optionally a different <code>clientId</code>) and encodes the them into an HLC string.</li><li><code>decodeHlc</code>: a function that takes an HLC and returns an array containing the logical time, counter, and client <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> parts.</li><li><code>getLastLogicalTime</code>: a function that returns the last logical time either generated or seen by this client.</li><li><code>getLastCounter</code>: a function that returns the last counter either generated or seen by this client.</li><li><code>getClientId</code>: a function that returns the client <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> for this client; either uniquely generated or derived from the <code>uniqueId</code> parameter.</li></ul><section class="s2"><h2>Example</h2><p>This example gets the HLC functions (for a given client <a href="/api/common/type-aliases/identity/id/"><code>Id</code></a> and a fixed time; both for illustrative purposes), and then uses them:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>getHlcFunctions<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinybase'</span><span class="punctuation">;</span>

<span class="keyword">const</span> <span class="punctuation">[</span>
  getNextHlc<span class="punctuation">,</span>
  seenHlc<span class="punctuation">,</span>
  encodeHlc<span class="punctuation">,</span>
  decodeHlc<span class="punctuation">,</span>
  getLastLogicalTime<span class="punctuation">,</span>
  getLastCounter<span class="punctuation">,</span>
  getClientId<span class="punctuation">,</span>
<span class="punctuation">]</span> <span class="operator">=</span> <span class="function"><a href="/api/common/functions/stamps/gethlcfunctions/">getHlcFunctions</a></span><span class="punctuation">(</span><span class="string">'client1'</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="number">73267200000</span><span class="punctuation">)</span><span class="punctuation">;</span> <span class="comment">// This client is in 1972.</span>

<span class="comment">// Generate an HLC based on the fixed time and the client Id.</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">getNextHlc</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '03E3B------mmxrx'</span>

<span class="comment">// Generate the next HLC. The time has not changed, so the counter does.</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">getNextHlc</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '03E3B-----0mmxrx'</span>

<span class="comment">// Another client thinks it is 1973.</span>
<span class="function">seenHlc</span><span class="punctuation">(</span><span class="string">'0WakTk-----jmx_3'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// Generate the next HLC.</span>

<span class="comment">// What is the state for the current client?</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">getLastLogicalTime</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 104803200000</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">getLastCounter</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">getClientId</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'mmxrx'</span>

<span class="comment">// Encode an arbitrary HLC.</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">encodeHlc</span><span class="punctuation">(</span><span class="number">73267203600</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="string">'client3'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> '03E3BsF---6kmxfM'</span>

<span class="comment">// Decode it again.</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="function">decodeHlc</span><span class="punctuation">(</span><span class="string">'03E3BsF---6kmxfM'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> [73267203600, 7, 'kmxfM']</span>
</code></pre></section><section class="s2"><h2>Since</h2><p>v6.2.0</p></section></section>