var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n=t(""),s=(e,t)=>((e,t)=>e.every(t))(e,((n,s)=>0==s||t(e[s-1],n)<=0)),o=(e,t)=>e.sort(t),d=(e,t)=>e.forEach(t),r=e=>e.length,i=e=>0==r(e),c=(e,t,n)=>e.slice(t,n),l=e=>null==e,a=(e,t,n)=>l(e)?n?.():t(e),f=(e,t)=>e?.has(t)??!1,u=e=>l(e)||0==(e=>e.size)(e),h=e=>[...e?.values()??[]],p=e=>e.clear(),I=(e,t)=>e?.forEach(t),g=(e,t)=>e?.delete(t),x=e=>new Map(e),y=e=>[...e?.keys()??[]],S=(e,t)=>e?.get(t),b=(e,t)=>I(e,((e,n)=>t(n,e))),w=(e,t,n)=>l(n)?(g(e,t),e):e?.set(t,n),L=(e,t,n)=>(f(e,t)||e.set(t,n()),S(e,t)),v=e=>new Set(e),T=(e,t)=>e?.add(t),E=(e,s)=>t(e)==n?t=>t(e):e??(()=>s??""),R=(e,t)=>e<t?-1:1,j=(e,t,n)=>r(n)<2?T(i(n)?e:L(e,n[0],v),t):j(L(e,n[0],x),t,c(n,1)),M=e=>{const t=(n,s,...o)=>a(n,(n=>i(o)?e(n,s):d([o[0],null],(e=>t(S(n,e),s,...c(o,1))))));return t},k=Object.freeze,m=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=x(),n=x(),[c,m,z,C,D,O,_,,B,P,W]=((e,t,n)=>{const s=e.hasRow,o=x(),r=x(),c=x(),E=x(),R=x(),j=(t,n,...s)=>{const o=L(R,t,v);return d(s,(t=>T(o,t)&&n&&e.callListener(t))),s},M=(t,...n)=>a(S(R,t),(s=>{d(i(n)?h(s):n,(t=>{e.delListener(t),g(s,t)})),u(s)&&w(R,t)})),k=(e,n)=>{w(o,e,n),f(r,e)||(w(r,e,t()),w(c,e,x()),w(E,e,x()))},m=e=>{w(o,e),w(r,e),w(c,e),w(E,e),M(e)};return[()=>e,()=>y(o),e=>b(r,e),e=>f(r,e),e=>S(o,e),e=>S(r,e),(e,t)=>w(r,e,t),k,(t,o,r,i,a)=>{k(t,o);const u=x(),h=x(),g=S(c,t),y=S(E,t),L=t=>{const d=n=>e.getCell(o,t,n),r=S(g,t),c=s(o,t)?n(i(d,t)):void 0;if(r!=c&&w(u,t,[r,c]),!l(a)){const e=S(y,t),n=s(o,t)?a(d,t):void 0;e!=n&&w(h,t,n)}},v=e=>{r((()=>{I(u,(([,e],t)=>w(g,t,e))),I(h,((e,t)=>w(y,t,e)))}),u,h,g,y,e),p(u),p(h)};b(g,L),e.hasTable(o)&&d(e.getRowIds(o),(e=>{f(g,e)||L(e)})),v(!0),M(t),j(t,0,e.addRowListener(o,null,((e,t,n)=>L(n))),e.addTableListener(o,(()=>v())))},m,()=>b(R,m),j,M]})(e,x,(e=>l(e)?"":e+"")),[q,A,F]=(e=>{let t,n=0;const s=[],o=x();return[(d,r,i=[])=>{t??=e();const c=s.pop()??""+n++;return w(o,c,[d,r,i]),j(r,c,i),c},(e,n=[],...s)=>M(I)(e,(e=>a(S(o,e),(([e])=>e(t,...n,...s)))),...n),e=>a(S(o,e),(([,t,n])=>(M(g)(t,e,...n),w(o,e),r(s)<1e3&&((e,...t)=>{e.push(...t)})(s,e),n)),(()=>[])),(e,n,s)=>a(S(o,e),(([e,,o])=>{const i=(...c)=>{const a=r(c);a==r(o)?e(t,...c,...s(c)):l(o[a])?d(n[a](...c),(e=>i(...c,e))):i(...c,o[a])};i()}))]})((()=>H)),G=(t,n,s)=>{const o=D(t);I(s,((t,s)=>n(s,(n=>I(t,(t=>n(t,(n=>e.forEachCell(o,t,n)))))))))},H={setIndexDefinition:(e,d,r,i,c,h=R)=>{const p=l(c)?void 0:([e],[t])=>c(e,t);return B(e,d,((d,r,c,y,L,E)=>{let R=0;const j=v(),M=v(),k=O(e);if(I(r,(([e,t],n)=>{l(e)||(T(j,e),a(S(k,e),(t=>{g(t,n),u(t)&&(w(k,e),R=1)}))),l(t)||(T(j,t),f(k,t)||(w(k,t,v()),R=1),T(S(k,t),n),l(i)||T(M,t))})),d(),u(L)||(E?b(k,(e=>T(M,e))):b(c,(e=>a(S(y,e),(e=>T(M,e))))),I(M,(e=>{const t=(t,n)=>h(S(L,t),S(L,n),e),n=[...S(k,e)];s(n,t)||(w(k,e,v(o(n,t))),T(j,e))}))),(R||E)&&!l(p)){const t=[...k];s(t,p)||(_(e,x(o(t,p))),R=1)}R&&A(t,[e]),I(j,(t=>A(n,[e,t])))}),E(r),a(i,E)),H},delIndexDefinition:e=>(P(e),H),getStore:c,getIndexIds:m,forEachIndex:e=>z(((t,n)=>e(t,(e=>G(t,e,n))))),forEachSlice:(e,t)=>G(e,t,O(e)),hasIndex:C,hasSlice:(e,t)=>f(O(e),t),getTableId:D,getSliceIds:e=>y(O(e)),getSliceRowIds:(e,t)=>h(S(O(e),t)),addSliceIdsListener:(e,n)=>q(n,t,[e]),addSliceRowIdsListener:(e,t,s)=>q(s,n,[e,t]),delListener:e=>(F(e),H),destroy:W,getListenerStats:()=>({})};return k(H)}));e.createIndexes=m,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
