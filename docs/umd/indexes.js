var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),o=e=>n+e,r=e=>null==e,d=(e,t,n)=>r(e)?n?.():t(e),i=e=>Array.isArray(e),l=e=>e.length,c=(e,t)=>e.every(t),a=(e,t)=>c(e,((n,s)=>0==s||t(e[s-1],n)<=0)),f=(e,t)=>e.sort(t),u=(e,t)=>e.forEach(t),h=(e,t)=>e.map(t),I=(e,...t)=>e.push(...t),g=Object.freeze,p=(e,t)=>e?.has(t)??!1,x=e=>r(e)||0==(e=>e?.size??0)(e),y=e=>[...e?.values()??[]],L=e=>e.clear(),S=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),w=e=>new Map(e),b=e=>[...e?.keys()??[]],T=(e,t)=>e?.get(t),E=(e,t)=>S(e,((e,n)=>t(n,e))),R=(e,t,n)=>r(n)?(v(e,t),e):e?.set(t,n),m=(e,t,n,s)=>(p(e,t)?s?.(T(e,t)):R(e,t,n()),T(e,t)),j=(e,t,n,s,o=0)=>d((n?m:T)(e,t[o],o>l(t)-2?n:w),(r=>{if(o>l(t)-2)return s?.(r)&&R(e,t[o]),r;const d=j(r,t,n,s,o+1);return x(r)&&R(e,t[o]),d})),k=e=>new Set(i(e)||r(e)?e:[e]),z=(e,t)=>e?.add(t),A=(e,o)=>t(e)==s?t=>t(e):e??(()=>o??n);w(h("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(n),((e,t)=>[e,t])));const C=(e,t)=>(e??0)<(t??0)?-1:1,D=/^\d+$/,M=((e,t)=>{const s=new WeakMap;return e=>(s.has(e)||s.set(e,(e=>{const t=w(),s=w(),[M,B,O]=(e=>{let t;const[s,o]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{D.test(t)&&l(e)<1e3&&I(e,t)}]})(),i=w();return[(e,o,r,d=[],l=(()=>[]))=>{t??=X;const c=s(1);return R(i,c,[e,o,r,d,l]),z(j(o,r??[n],k),c),c},(e,s,...o)=>u(((e,t=[n])=>{const s=[],o=(e,n)=>n==l(t)?I(s,e):null===t[n]?S(e,(e=>o(e,n+1))):u([t[n],null],(t=>o(T(e,t),n+1)));return o(e,0),s})(e,s),(e=>S(e,(e=>T(i,e)[0](t,...s??[],...o))))),e=>d(T(i,e),(([,t,s])=>(j(t,s??[n],void 0,(t=>(v(t,e),x(t)?1:0))),R(i,e),o(e),s))),e=>d(T(i,e),(([e,,n=[],s,o])=>{const d=(...i)=>{const c=l(i);c==l(n)?e(t,...i,...o(i)):r(n[c])?u(s[c]?.(...i)??[],(e=>d(...i,e))):d(...i,n[c])};d()}))]})(),[W,q,F,G,H,J,K,,N,P,Q,U]=((e,t,n,s,o)=>{const a=e.hasRow,f=w(),h=w(),I=w(),g=w(),j=w(),A=w(),C=(t,n,...s)=>{const o=m(A,t,k);return u(s,(t=>z(o,t)&&n&&e.callListener(t))),s},D=(t,...n)=>d(T(A,t),(s=>{u(0==l(n)?y(s):n,(t=>{e.delListener(t),v(s,t)})),x(s)&&R(A,t)})),M=(e,n)=>{R(f,e,n),p(h,e)||(R(h,e,t()),R(g,e,w()),R(j,e,w()),o(I))},B=e=>{R(f,e),R(h,e),R(g,e),R(j,e),D(e),o(I)};return[()=>e,()=>b(f),e=>E(h,e),e=>p(h,e),e=>T(f,e),e=>T(h,e),(e,t)=>R(h,e,t),M,(t,s,o,d,f)=>{M(t,s);const h=w(),I=w(),x=T(g,t),y=T(j,t),v=t=>{const o=n=>e.getCell(s,t,n),u=T(x,t),g=a(s,t)?n(d(o,t)):void 0;var p,L;if(u===g||i(u)&&i(g)&&(L=g,l(p=u)===l(L)&&c(p,((e,t)=>L[t]===e)))||R(h,t,[u,g]),!r(f)){const e=T(y,t),n=a(s,t)?f(o,t):void 0;e!=n&&R(I,t,n)}},b=e=>{o((()=>{S(h,(([,e],t)=>R(x,t,e))),S(I,((e,t)=>R(y,t,e)))}),h,I,x,y,e),L(h),L(I)};E(x,v),e.hasTable(s)&&u(e.getRowIds(s),(e=>{p(x,e)||v(e)})),b(!0),D(t),C(t,0,e.addRowListener(s,null,((e,t,n)=>v(n))),e.addTableListener(s,(()=>b())))},B,e=>s(e,I),()=>E(A,B),C,D]})(e,w,(e=>r(e)?n:i(e)?h(e,o):o(e)),M,B),V=(t,n,s)=>{const o=H(t);S(s,((t,s)=>n(s,(n=>S(t,(t=>n(t,(n=>e.forEachCell(o,t,n)))))))))},X={setIndexDefinition:(e,n,o,i,l,c=C)=>{const u=r(l)?void 0:([e],[t])=>l(e,t);return N(e,n,((n,o,l,h,I,g)=>{let y=0;const L=k(),b=k(),m=J(e);if(S(o,(([e,t],n)=>{const s=k(e),o=k(t);S(s,(e=>v(o,e)?v(s,e):0)),S(s,(e=>{z(L,e),d(T(m,e),(t=>{v(t,n),x(t)&&(R(m,e),y=1)}))})),S(o,(e=>{z(L,e),p(m,e)||(R(m,e,k()),y=1),z(T(m,e),n),r(i)||z(b,e)}))})),n(),x(I)||(g?E(m,(e=>z(b,e))):E(l,(e=>d(T(h,e),(e=>z(b,e))))),S(b,(e=>{const t=(t,n)=>c(T(I,t),T(I,n),e),n=[...T(m,e)];a(n,t)||(R(m,e,k(f(n,t))),z(L,e))}))),(y||g)&&!r(u)){const t=[...m];a(t,u)||(K(e,w(f(t,u))),y=1)}y&&B(t,[e]),S(L,(t=>B(s,[e,t])))}),A(o),d(i,A)),X},delIndexDefinition:e=>(P(e),X),getStore:W,getIndexIds:q,forEachIndex:e=>F(((t,n)=>e(t,(e=>V(t,e,n))))),forEachSlice:(e,t)=>V(e,t,J(e)),hasIndex:G,hasSlice:(e,t)=>p(J(e),t),getTableId:H,getSliceIds:e=>b(J(e)),getSliceRowIds:(e,t)=>y(T(J(e),t)),addIndexIdsListener:Q,addSliceIdsListener:(e,n)=>M(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>M(n,s,[e,t]),delListener:e=>(O(e),X),destroy:U,getListenerStats:()=>({})};return g(X)})(e)),s.get(e))})();e.createIndexes=M},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
