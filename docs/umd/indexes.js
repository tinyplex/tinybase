var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),o=(e,t)=>((e,t)=>e.every(t))(e,((n,s)=>0==s||t(e[s-1],n)<=0)),r=(e,t)=>e.sort(t),d=(e,t)=>e.forEach(t),i=e=>e.length,l=(e,...t)=>e.push(...t),c=e=>null==e,a=(e,t,n)=>c(e)?n?.():t(e),f=(e,t)=>e?.has(t)??!1,u=e=>c(e)||0==(e=>e.size)(e),h=e=>[...e?.values()??[]],p=e=>e.clear(),I=(e,t)=>e?.forEach(t),g=(e,t)=>e?.delete(t),x=e=>new Map(e),y=e=>[...e?.keys()??[]],S=(e,t)=>e?.get(t),b=(e,t)=>I(e,((e,n)=>t(n,e))),v=(e,t,n)=>c(n)?(g(e,t),e):e?.set(t,n),w=(e,t,n)=>(f(e,t)||v(e,t,n()),S(e,t)),L=(e,t,n,s,o=0)=>a((n?w:S)(e,t[o],o>i(t)-2?n:x),(r=>{if(o>i(t)-2)return s?.(r)&&v(e,t[o]),r;const d=L(r,t,n,s,o+1);return u(r)&&v(e,t[o]),d})),T=e=>new Set(e),E=(e,t)=>e?.add(t),R=(e,t,n)=>{const s=e.hasRow,o=x(),r=x(),l=x(),L=x(),R=x(),j=(t,n,...s)=>{const o=w(R,t,T);return d(s,(t=>E(o,t)&&n&&e.callListener(t))),s},M=(t,...n)=>a(S(R,t),(s=>{d(0==i(n)?h(s):n,(t=>{e.delListener(t),g(s,t)})),u(s)&&v(R,t)})),k=(e,n)=>{v(o,e,n),f(r,e)||(v(r,e,t()),v(l,e,x()),v(L,e,x()))},m=e=>{v(o,e),v(r,e),v(l,e),v(L,e),M(e)};return[()=>e,()=>y(o),e=>b(r,e),e=>f(r,e),e=>S(o,e),e=>S(r,e),(e,t)=>v(r,e,t),k,(t,o,r,i,a)=>{k(t,o);const u=x(),h=x(),g=S(l,t),y=S(L,t),w=t=>{const r=n=>e.getCell(o,t,n),d=S(g,t),l=s(o,t)?n(i(r,t)):void 0;if(d!=l&&v(u,t,[d,l]),!c(a)){const e=S(y,t),n=s(o,t)?a(r,t):void 0;e!=n&&v(h,t,n)}},T=e=>{r((()=>{I(u,(([,e],t)=>v(g,t,e))),I(h,((e,t)=>v(y,t,e)))}),u,h,g,y,e),p(u),p(h)};b(g,w),e.hasTable(o)&&d(e.getRowIds(o),(e=>{f(g,e)||w(e)})),T(!0),M(t),j(t,0,e.addRowListener(o,null,((e,t,n)=>w(n))),e.addTableListener(o,(()=>T())))},m,()=>b(R,m),j,M]},j=(e,o)=>t(e)==s?t=>t(e):e??(()=>o??n),M=(e,t)=>e<t?-1:1,k=e=>{let t,s=0;const o=[],r=x();return[(d,i,l)=>{t??=e();const c=o.pop()??n+s++;return v(r,c,[d,i,l]),E(L(i,l??[n],T),c),c},(e,s,...o)=>d(((e,t=[n])=>{const s=[],o=(e,n)=>n==i(t)?l(s,e):null===t[n]?I(e,(e=>o(e,n+1))):d([t[n],null],(t=>o(S(e,t),n+1)));return o(e,0),s})(e,s),(e=>I(e,(e=>S(r,e)[0](t,...s??[],...o))))),e=>a(S(r,e),(([,t,s])=>(L(t,s??[n],void 0,(t=>(g(t,e),u(t)?1:0))),v(r,e),i(o)<1e3&&l(o,e),s))),(e,n,s)=>a(S(r,e),(([e,,o=[]])=>{const r=(...l)=>{const a=i(l);a==i(o)?e(t,...l,...s(l)):c(o[a])?d(n[a](...l),(e=>r(...l,e))):r(...l,o[a])};r()}))]},m=Object.freeze,z=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=x(),s=x(),[d,i,l,p,w,L,z,,C,D,O]=R(e,x,(e=>c(e)?n:e+n)),[_,B,P]=k((()=>q)),W=(t,n,s)=>{const o=w(t);I(s,((t,s)=>n(s,(n=>I(t,(t=>n(t,(n=>e.forEachCell(o,t,n)))))))))},q={setIndexDefinition:(e,n,d,i,l,h=M)=>{const p=c(l)?void 0:([e],[t])=>l(e,t);return C(e,n,((n,d,l,y,w,R)=>{let j=0;const M=T(),k=T(),m=L(e);if(I(d,(([e,t],n)=>{c(e)||(E(M,e),a(S(m,e),(t=>{g(t,n),u(t)&&(v(m,e),j=1)}))),c(t)||(E(M,t),f(m,t)||(v(m,t,T()),j=1),E(S(m,t),n),c(i)||E(k,t))})),n(),u(w)||(R?b(m,(e=>E(k,e))):b(l,(e=>a(S(y,e),(e=>E(k,e))))),I(k,(e=>{const t=(t,n)=>h(S(w,t),S(w,n),e),n=[...S(m,e)];o(n,t)||(v(m,e,T(r(n,t))),E(M,e))}))),(j||R)&&!c(p)){const t=[...m];o(t,p)||(z(e,x(r(t,p))),j=1)}j&&B(t,[e]),I(M,(t=>B(s,[e,t])))}),j(d),a(i,j)),q},delIndexDefinition:e=>(D(e),q),getStore:d,getIndexIds:i,forEachIndex:e=>l(((t,n)=>e(t,(e=>W(t,e,n))))),forEachSlice:(e,t)=>W(e,t,L(e)),hasIndex:p,hasSlice:(e,t)=>f(L(e),t),getTableId:w,getSliceIds:e=>y(L(e)),getSliceRowIds:(e,t)=>h(S(L(e),t)),addSliceIdsListener:(e,n)=>_(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>_(n,s,[e,t]),delListener:e=>(P(e),q),destroy:O,getListenerStats:()=>({})};return m(q)}));e.createIndexes=z,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
