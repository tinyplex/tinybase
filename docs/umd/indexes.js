var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=e=>n+e,o=(e,t)=>e.every(t),d=(e,t)=>o(e,((n,s)=>0==s||t(e[s-1],n)<=0)),i=(e,t)=>e.sort(t),c=(e,t)=>e.forEach(t),l=e=>e.length,a=(e,...t)=>e.push(...t),f=e=>null==e,u=(e,t,n)=>f(e)?n?.():t(e),h=e=>Array.isArray(e),I=(e,t)=>e?.has(t)??!1,g=e=>f(e)||0==(e=>e.size)(e),p=e=>[...e?.values()??[]],y=e=>e.clear(),v=(e,t)=>e?.forEach(t),x=(e,t)=>e?.delete(t),S=e=>new Map(e),b=e=>[...e?.keys()??[]],w=(e,t)=>e?.get(t),L=(e,t)=>v(e,((e,n)=>t(n,e))),T=(e,t,n)=>f(n)?(x(e,t),e):e?.set(t,n),E=(e,t,n)=>(I(e,t)||T(e,t,n()),w(e,t)),R=(e,t,n,s,r=0)=>u((n?E:w)(e,t[r],r>l(t)-2?n:S),(o=>{if(r>l(t)-2)return s?.(o)&&T(e,t[r]),o;const d=R(o,t,n,s,r+1);return g(o)&&T(e,t[r]),d})),j=e=>new Set(h(e)||f(e)?e:[e]),m=(e,t)=>e?.add(t),M=(e,t,n)=>{const s=e.hasRow,r=S(),d=S(),i=S(),a=S(),R=S(),M=(t,n,...s)=>{const r=E(R,t,j);return c(s,(t=>m(r,t)&&n&&e.callListener(t))),s},k=(t,...n)=>u(w(R,t),(s=>{c(0==l(n)?p(s):n,(t=>{e.delListener(t),x(s,t)})),g(s)&&T(R,t)})),z=(e,n)=>{T(r,e,n),I(d,e)||(T(d,e,t()),T(i,e,S()),T(a,e,S()))},A=e=>{T(r,e),T(d,e),T(i,e),T(a,e),k(e)};return[()=>e,()=>b(r),e=>L(d,e),e=>I(d,e),e=>w(r,e),e=>w(d,e),(e,t)=>T(d,e,t),z,(t,r,d,u,g)=>{z(t,r);const p=S(),x=S(),b=w(i,t),E=w(a,t),R=t=>{const d=n=>e.getCell(r,t,n),i=w(b,t),c=s(r,t)?n(u(d,t)):void 0;var a,I;if(i===c||h(i)&&h(c)&&(I=c,l(a=i)===l(I)&&o(a,((e,t)=>I[t]===e)))||T(p,t,[i,c]),!f(g)){const e=w(E,t),n=s(r,t)?g(d,t):void 0;e!=n&&T(x,t,n)}},j=e=>{d((()=>{v(p,(([,e],t)=>T(b,t,e))),v(x,((e,t)=>T(E,t,e)))}),p,x,b,E,e),y(p),y(x)};L(b,R),e.hasTable(r)&&c(e.getRowIds(r),(e=>{I(b,e)||R(e)})),j(!0),k(t),M(t,0,e.addRowListener(r,null,((e,t,n)=>R(n))),e.addTableListener(r,(()=>j())))},A,()=>L(R,A),M,k]},k=(e,r)=>t(e)==s?t=>t(e):e??(()=>r??n),z=(e,t)=>e<t?-1:1,A=/^\d+$/,C=e=>{let t;const[s,r]=(()=>{const e=[];let t=0;return[()=>e.shift()??n+t++,t=>{A.test(t)&&l(e)<1e3&&a(e,t)}]})(),o=S();return[(r,d,i)=>{t??=e();const c=s();return T(o,c,[r,d,i]),m(R(d,i??[n],j),c),c},(e,s,...r)=>c(((e,t=[n])=>{const s=[],r=(e,n)=>n==l(t)?a(s,e):null===t[n]?v(e,(e=>r(e,n+1))):c([t[n],null],(t=>r(w(e,t),n+1)));return r(e,0),s})(e,s),(e=>v(e,(e=>w(o,e)[0](t,...s??[],...r))))),e=>u(w(o,e),(([,t,s])=>(R(t,s??[n],void 0,(t=>(x(t,e),g(t)?1:0))),T(o,e),r(e),s))),(e,n,s)=>u(w(o,e),(([e,,r=[]])=>{const o=(...d)=>{const i=l(d);i==l(r)?e(t,...d,...s(d)):f(r[i])?c(n[i](...d),(e=>o(...d,e))):o(...d,r[i])};o()}))]},D=Object.freeze,O=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=S(),s=S(),[o,c,l,a,y,E,R,,A,O,_]=M(e,S,(e=>{return f(e)?n:h(e)?(t=r,e.map(t)):r(e);var t})),[B,P,W]=C((()=>q)),$=(t,n,s)=>{const r=y(t);v(s,((t,s)=>n(s,(n=>v(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},q={setIndexDefinition:(e,n,r,o,c,l=z)=>{const a=f(c)?void 0:([e],[t])=>c(e,t);return A(e,n,((n,r,c,h,p,y)=>{let b=0;const M=j(),k=j(),z=E(e);if(v(r,(([e,t],n)=>{const s=j(e),r=j(t);v(s,(e=>x(r,e)?x(s,e):0)),v(s,(e=>{m(M,e),u(w(z,e),(t=>{x(t,n),g(t)&&(T(z,e),b=1)}))})),v(r,(e=>{m(M,e),I(z,e)||(T(z,e,j()),b=1),m(w(z,e),n),f(o)||m(k,e)}))})),n(),g(p)||(y?L(z,(e=>m(k,e))):L(c,(e=>u(w(h,e),(e=>m(k,e))))),v(k,(e=>{const t=(t,n)=>l(w(p,t),w(p,n),e),n=[...w(z,e)];d(n,t)||(T(z,e,j(i(n,t))),m(M,e))}))),(b||y)&&!f(a)){const t=[...z];d(t,a)||(R(e,S(i(t,a))),b=1)}b&&P(t,[e]),v(M,(t=>P(s,[e,t])))}),k(r),u(o,k)),q},delIndexDefinition:e=>(O(e),q),getStore:o,getIndexIds:c,forEachIndex:e=>l(((t,n)=>e(t,(e=>$(t,e,n))))),forEachSlice:(e,t)=>$(e,t,E(e)),hasIndex:a,hasSlice:(e,t)=>I(E(e),t),getTableId:y,getSliceIds:e=>b(E(e)),getSliceRowIds:(e,t)=>p(w(E(e),t)),addSliceIdsListener:(e,n)=>B(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>B(n,s,[e,t]),delListener:e=>(W(e),q),destroy:_,getListenerStats:()=>({})};return D(q)}));e.createIndexes=O,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
