var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=e=>n+e,o=(e,t)=>e.every(t),d=(e,t)=>o(e,((n,s)=>0==s||t(e[s-1],n)<=0)),i=(e,t)=>e.sort(t),c=(e,t)=>e.forEach(t),l=e=>e.length,a=(e,...t)=>e.push(...t),f=e=>null==e,u=(e,t,n)=>f(e)?n?.():t(e),h=e=>Array.isArray(e),I=(e,t)=>e?.has(t)??!1,g=e=>f(e)||0==(e=>e.size)(e),p=e=>[...e?.values()??[]],y=e=>e.clear(),x=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),S=e=>new Map(e),w=e=>[...e?.keys()??[]],L=(e,t)=>e?.get(t),b=(e,t)=>x(e,((e,n)=>t(n,e))),T=(e,t,n)=>f(n)?(v(e,t),e):e?.set(t,n),E=(e,t,n)=>(I(e,t)||T(e,t,n()),L(e,t)),R=(e,t,n,s,r=0)=>u((n?E:L)(e,t[r],r>l(t)-2?n:S),(o=>{if(r>l(t)-2)return s?.(o)&&T(e,t[r]),o;const d=R(o,t,n,s,r+1);return g(o)&&T(e,t[r]),d})),m=e=>new Set(h(e)||f(e)?e:[e]),j=(e,t)=>e?.add(t),k=(e,r)=>t(e)==s?t=>t(e):e??(()=>r??n),z=(e,t)=>e<t?-1:1,A=/^\d+$/,C=Object.freeze,D=(e=>{const t=new WeakMap;return e=>(t.has(e)||t.set(e,(e=>{const t=S(),s=S(),[D,M,B,O,W,$,q,,F,G,H]=((e,t,n)=>{const s=e.hasRow,r=S(),d=S(),i=S(),a=S(),R=S(),k=(t,n,...s)=>{const r=E(R,t,m);return c(s,(t=>j(r,t)&&n&&e.callListener(t))),s},z=(t,...n)=>u(L(R,t),(s=>{c(0==l(n)?p(s):n,(t=>{e.delListener(t),v(s,t)})),g(s)&&T(R,t)})),A=(e,n)=>{T(r,e,n),I(d,e)||(T(d,e,t()),T(i,e,S()),T(a,e,S()))},C=e=>{T(r,e),T(d,e),T(i,e),T(a,e),z(e)};return[()=>e,()=>w(r),e=>b(d,e),e=>I(d,e),e=>L(r,e),e=>L(d,e),(e,t)=>T(d,e,t),A,(t,r,d,u,g)=>{A(t,r);const p=S(),v=S(),w=L(i,t),E=L(a,t),R=t=>{const d=n=>e.getCell(r,t,n),i=L(w,t),c=s(r,t)?n(u(d,t)):void 0;var a,I;if(i===c||h(i)&&h(c)&&(I=c,l(a=i)===l(I)&&o(a,((e,t)=>I[t]===e)))||T(p,t,[i,c]),!f(g)){const e=L(E,t),n=s(r,t)?g(d,t):void 0;e!=n&&T(v,t,n)}},m=e=>{d((()=>{x(p,(([,e],t)=>T(w,t,e))),x(v,((e,t)=>T(E,t,e)))}),p,v,w,E,e),y(p),y(v)};b(w,R),e.hasTable(r)&&c(e.getRowIds(r),(e=>{I(w,e)||R(e)})),m(!0),z(t),k(t,0,e.addRowListener(r,null,((e,t,n)=>R(n))),e.addTableListener(r,(()=>m())))},C,()=>b(R,C),k,z]})(e,S,(e=>{return f(e)?n:h(e)?(t=r,e.map(t)):r(e);var t})),[J,K,N]=(e=>{let t;const[s,r]=(()=>{const e=[];let t=0;return[()=>e.shift()??n+t++,t=>{A.test(t)&&l(e)<1e3&&a(e,t)}]})(),o=S();return[(e,r,d,i=[],c=(()=>[]))=>{t??=Q;const l=s();return T(o,l,[e,r,d,i,c]),j(R(r,d??[n],m),l),l},(e,s,...r)=>c(((e,t=[n])=>{const s=[],r=(e,n)=>n==l(t)?a(s,e):null===t[n]?x(e,(e=>r(e,n+1))):c([t[n],null],(t=>r(L(e,t),n+1)));return r(e,0),s})(e,s),(e=>x(e,(e=>L(o,e)[0](t,...s??[],...r))))),e=>u(L(o,e),(([,t,s])=>(R(t,s??[n],void 0,(t=>(v(t,e),g(t)?1:0))),T(o,e),r(e),s))),e=>u(L(o,e),(([e,,n=[],s,r])=>{const o=(...d)=>{const i=l(d);i==l(n)?e(t,...d,...r(d)):f(n[i])?c(s[i]?.(...d)??[],(e=>o(...d,e))):o(...d,n[i])};o()}))]})(),P=(t,n,s)=>{const r=W(t);x(s,((t,s)=>n(s,(n=>x(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},Q={setIndexDefinition:(e,n,r,o,c,l=z)=>{const a=f(c)?void 0:([e],[t])=>c(e,t);return F(e,n,((n,r,c,h,p,y)=>{let w=0;const E=m(),R=m(),k=$(e);if(x(r,(([e,t],n)=>{const s=m(e),r=m(t);x(s,(e=>v(r,e)?v(s,e):0)),x(s,(e=>{j(E,e),u(L(k,e),(t=>{v(t,n),g(t)&&(T(k,e),w=1)}))})),x(r,(e=>{j(E,e),I(k,e)||(T(k,e,m()),w=1),j(L(k,e),n),f(o)||j(R,e)}))})),n(),g(p)||(y?b(k,(e=>j(R,e))):b(c,(e=>u(L(h,e),(e=>j(R,e))))),x(R,(e=>{const t=(t,n)=>l(L(p,t),L(p,n),e),n=[...L(k,e)];d(n,t)||(T(k,e,m(i(n,t))),j(E,e))}))),(w||y)&&!f(a)){const t=[...k];d(t,a)||(q(e,S(i(t,a))),w=1)}w&&K(t,[e]),x(E,(t=>K(s,[e,t])))}),k(r),u(o,k)),Q},delIndexDefinition:e=>(G(e),Q),getStore:D,getIndexIds:M,forEachIndex:e=>B(((t,n)=>e(t,(e=>P(t,e,n))))),forEachSlice:(e,t)=>P(e,t,$(e)),hasIndex:O,hasSlice:(e,t)=>I($(e),t),getTableId:W,getSliceIds:e=>w($(e)),getSliceRowIds:(e,t)=>p(L($(e),t)),addSliceIdsListener:(e,n)=>J(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>J(n,s,[e,t]),delListener:e=>(N(e),Q),destroy:H,getListenerStats:()=>({})};return C(Q)})(e)),t.get(e))})();e.createIndexes=D},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
