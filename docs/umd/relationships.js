var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",o=t(n),s=(e,t)=>e.forEach(t),i=e=>e.length,r=(e,...t)=>e.push(...t),a=e=>null==e,d=(e,t,n)=>a(e)?n?.():t(e),l=(e,t)=>e?.has(t)??!1,c=e=>a(e)||0==(e=>e.size)(e),f=e=>[...e?.values()??[]],u=e=>e.clear(),h=(e,t)=>e?.forEach(t),p=(e,t)=>e?.delete(t),R=e=>new Map(e),g=(e,t)=>e?.get(t),L=(e,t)=>h(e,((e,n)=>t(n,e))),w=(e,t,n)=>a(n)?(p(e,t),e):e?.set(t,n),y=(e,t,n)=>(l(e,t)||e.set(t,n()),g(e,t)),I=(e,t,n,o,s=0)=>d((n?y:g)(e,t[s],s>i(t)-2?n:R),(r=>{if(s>i(t)-2)return o?.(r)&&w(e,t[s]),r;const a=I(r,t,n,o,s+1);return c(r)&&w(e,t[s]),a})),b=e=>new Set(e),v=(e,t)=>e?.add(t),T=(e,t,n)=>{const o=e.hasRow,r=R(),I=R(),T=R(),m=R(),k=R(),E=(t,n,...o)=>{const i=y(k,t,b);return s(o,(t=>v(i,t)&&n&&e.callListener(t))),o},j=(t,...n)=>d(g(k,t),(o=>{s(0==i(n)?f(o):n,(t=>{e.delListener(t),p(o,t)})),c(o)&&w(k,t)})),x=(e,n)=>{w(r,e,n),l(I,e)||(w(I,e,t()),w(T,e,R()),w(m,e,R()))},M=e=>{w(r,e),w(I,e),w(T,e),w(m,e),j(e)};return[()=>e,()=>[...r?.keys()??[]],e=>L(I,e),e=>l(I,e),e=>g(r,e),e=>g(I,e),(e,t)=>w(I,e,t),x,(t,i,r,d,c)=>{x(t,i);const f=R(),p=R(),y=g(T,t),I=g(m,t),b=t=>{const s=n=>e.getCell(i,t,n),r=g(y,t),l=o(i,t)?n(d(s,t)):void 0;if(r!=l&&w(f,t,[r,l]),!a(c)){const e=g(I,t),n=o(i,t)?c(s,t):void 0;e!=n&&w(p,t,n)}},v=e=>{r((()=>{h(f,(([,e],t)=>w(y,t,e))),h(p,((e,t)=>w(I,t,e)))}),f,p,y,I,e),u(f),u(p)};L(y,b),e.hasTable(i)&&s(e.getRowIds(i),(e=>{l(y,e)||b(e)})),v(!0),j(t),E(t,0,e.addRowListener(i,null,((e,t,n)=>b(n))),e.addTableListener(i,(()=>v())))},M,()=>L(k,M),E,j]},m=(e,s)=>t(e)==o?t=>t(e):e??(()=>s??n),k=(e,t=[n])=>{const o=[],a=(e,n)=>n==i(t)?r(o,e):s([t[n],null],(t=>a(g(e,t),n+1)));return a(e,0),o},E=Object.freeze,j=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=R(),o=R(),u=R(),y=R(),[j,x,M,S,z,D,,,O,_,B]=T(e,(()=>[R(),R(),R(),R()]),(e=>a(e)?void 0:e+n)),[C,P,W]=(e=>{let t,o=0;const l=[],f=R();return[(s,i,r)=>{t??=e();const a=l.pop()??n+o++;return w(f,a,[s,i,r]),v(I(i,r??[n],b),a),a},(e,n,...o)=>s(k(e,n),(e=>h(e,(e=>d(g(f,e),(([e])=>e(t,...n??[],...o))))))),e=>d(g(f,e),(([,t,o])=>(I(t,o??[n],void 0,(t=>(p(t,e),c(t)?1:0))),w(f,e),i(l)<1e3&&r(l,e),o))),(e,t)=>{return n=k(e,t),o=a,!n.every(o);var n,o},(e,n,o)=>d(g(f,e),(([e,,r=[]])=>{const d=(...l)=>{const c=i(l);c==i(r)?e(t,...l,...o(l)):a(r[c])?s(n[c](...l),(e=>d(...l,e))):d(...l,r[c])};d()}))]})((()=>G)),q=(e,t,n)=>d(D(e),(([o,,s])=>{if(!l(s,t)){const i=b();if(z(e)!=F(e))v(i,t);else{let e=t;for(;!a(e)&&!l(i,e);)v(i,e),e=g(o,e)}if(n)return i;w(s,t,i)}return g(s,t)})),A=(e,t)=>d(D(e),(([,,e])=>w(e,t))),F=e=>g(t,e),G={setRelationshipDefinition:(e,n,s,i)=>(w(t,e,s),O(e,n,((t,n)=>{const s=b(),i=b(),r=b(),[f,R]=D(e);h(n,(([t,n],o)=>{a(t)||(v(i,t),d(g(R,t),(e=>{p(e,o),c(e)&&w(R,t)}))),a(n)||(v(i,n),l(R,n)||w(R,n,b()),v(g(R,n),o)),v(s,o),w(f,o,n),L(g(y,e),(t=>{l(q(e,t),o)&&v(r,t)}))})),t(),h(s,(t=>P(o,[e,t]))),h(i,(t=>P(u,[e,t]))),h(r,(t=>{A(e,t),P(y,[e,t])}))}),m(i)),G),delRelationshipDefinition:e=>(w(t,e),_(e),G),getStore:j,getRelationshipIds:x,forEachRelationship:t=>M((n=>t(n,(t=>e.forEachRow(z(n),t))))),hasRelationship:S,getLocalTableId:z,getRemoteTableId:F,getRemoteRowId:(e,t)=>g(D(e)?.[0],t),getLocalRowIds:(e,t)=>f(g(D(e)?.[1],t)),getLinkedRowIds:(e,t)=>a(D(e))?[t]:f(q(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>C(n,o,[e,t]),addLocalRowIdsListener:(e,t,n)=>C(n,u,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(q(e,t),C(n,y,[e,t])),delListener:e=>(A(...W(e)),G),destroy:B,getListenerStats:()=>({})};return E(G)}));e.createRelationships=j,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
