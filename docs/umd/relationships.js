var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),o=e=>null==e,r=(e,t,n)=>o(e)?n?.():t(e),i=e=>Array.isArray(e),a=e=>e.length,d=(e,t)=>e.forEach(t),l=(e,...t)=>e.push(...t),c=Object.freeze,f=(e,t)=>e?.has(t)??!1,u=e=>o(e)||0==(e=>e?.size??0)(e),h=e=>[...e?.values()??[]],R=e=>e.clear(),p=(e,t)=>e?.forEach(t),g=(e,t)=>e?.delete(t),L=e=>new Map(e),w=(e,t)=>e?.get(t),y=(e,t)=>p(e,((e,n)=>t(n,e))),I=(e,t,n)=>o(n)?(g(e,t),e):e?.set(t,n),v=(e,t,n,s)=>(f(e,t)?s?.(w(e,t)):I(e,t,n()),w(e,t)),b=(e,t,n,s,o=0)=>r((n?v:w)(e,t[o],o>a(t)-2?n:L),(r=>{if(o>a(t)-2)return s?.(r)&&I(e,t[o]),r;const i=b(r,t,n,s,o+1);return u(r)&&I(e,t[o]),i})),T=e=>new Set(i(e)||o(e)?e:[e]),m=(e,t)=>e?.add(t),k=/^\d+$/,E=((e,E)=>{const x=new WeakMap;return e=>(x.has(e)||x.set(e,(e=>{const E=L(),x=L(),S=L(),j=L(),[z,A,D]=(e=>{let t;const[s,i]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{k.test(t)&&a(e)<1e3&&l(e,t)}]})(),c=L();return[(e,o,r,i=[],a=(()=>[]))=>{t??=P;const d=s(1);return I(c,d,[e,o,r,i,a]),m(b(o,r??[n],T),d),d},(e,s,...o)=>d(((e,t=[n])=>{const s=[],o=(e,n)=>n==a(t)?l(s,e):null===t[n]?p(e,(e=>o(e,n+1))):d([t[n],null],(t=>o(w(e,t),n+1)));return o(e,0),s})(e,s),(e=>p(e,(e=>w(c,e)[0](t,...s??[],...o))))),e=>r(w(c,e),(([,t,s])=>(b(t,s??[n],void 0,(t=>(g(t,e),u(t)?1:0))),I(c,e),i(e),s))),e=>r(w(c,e),(([e,,n=[],s,r])=>{const i=(...l)=>{const c=a(l);c==a(n)?e(t,...l,...r(l)):o(n[c])?d(s[c]?.(...l)??[],(e=>i(...l,e))):i(...l,n[c])};i()}))]})(),[M,B,C,O,W,$,,,q,F,G,H]=((e,t,s,l,c)=>{const b=e.hasRow,k=L(),E=L(),x=L(),S=L(),j=L(),z=L(),A=(t,n,...s)=>{const o=v(z,t,T);return d(s,(t=>m(o,t)&&n&&e.callListener(t))),s},D=(t,...n)=>r(w(z,t),(s=>{d(0==a(n)?h(s):n,(t=>{e.delListener(t),g(s,t)})),u(s)&&I(z,t)})),M=(e,t)=>{I(k,e,t),f(E,e)||(I(E,e,[L(),L(),L(),L()]),I(S,e,L()),I(j,e,L()),c(x))},B=e=>{I(k,e),I(E,e),I(S,e),I(j,e),D(e),c(x)};return[()=>e,()=>{return e=k,[...e?.keys()??[]];var e},e=>y(E,e),e=>f(E,e),e=>w(k,e),e=>w(E,e),(e,t)=>I(E,e,t),M,(t,s,r,l,c)=>{M(t,s);const u=L(),h=L(),g=w(S,t),v=w(j,t),T=t=>{const r=n=>e.getCell(s,t,n),d=w(g,t),f=b(s,t)?(R=l(r,t),o(R)?void 0:R+n):void 0;var R,p,L,y;if(d===f||i(d)&&i(f)&&(L=f,a(p=d)===a(L)&&(y=(e,t)=>L[t]===e,p.every(y)))||I(u,t,[d,f]),!o(c)){const e=w(v,t),n=b(s,t)?c(r,t):void 0;e!=n&&I(h,t,n)}},m=e=>{r((()=>{p(u,(([,e],t)=>I(g,t,e))),p(h,((e,t)=>I(v,t,e)))}),u,h,g,v,e),R(u),R(h)};y(g,T),e.hasTable(s)&&d(e.getRowIds(s),(e=>{f(g,e)||T(e)})),m(!0),D(t),A(t,0,e.addRowListener(s,null,((e,t,n)=>T(n))),e.addTableListener(s,(()=>m())))},B,e=>l(e,x),()=>y(z,B),A,D]})(e,0,0,z,A),J=(e,t,n)=>r($(e),(([s,,r])=>{if(!f(r,t)){const i=T();if(W(e)!=N(e))m(i,t);else{let e=t;for(;!o(e)&&!f(i,e);)m(i,e),e=w(s,e)}if(n)return i;I(r,t,i)}return w(r,t)})),K=(e,t)=>r($(e),(([,,e])=>I(e,t))),N=e=>w(E,e),P={setRelationshipDefinition:(e,i,a,d)=>{return I(E,e,a),q(e,i,((t,n)=>{const s=T(),i=T(),a=T(),[d,l]=$(e);p(n,(([t,n],c)=>{o(t)||(m(i,t),r(w(l,t),(e=>{g(e,c),u(e)&&I(l,t)}))),o(n)||(m(i,n),f(l,n)||I(l,n,T()),m(w(l,n),c)),m(s,c),I(d,c,n),y(w(j,e),(t=>{f(J(e,t),c)&&m(a,t)}))})),t(),p(s,(t=>A(x,[e,t]))),p(i,(t=>A(S,[e,t]))),p(a,(t=>{K(e,t),A(j,[e,t])}))}),t(l=d)==s?e=>e(l):l??(()=>n)),P;var l},delRelationshipDefinition:e=>(I(E,e),F(e),P),getStore:M,getRelationshipIds:B,forEachRelationship:t=>C((n=>t(n,(t=>e.forEachRow(W(n),t))))),hasRelationship:O,getLocalTableId:W,getRemoteTableId:N,getRemoteRowId:(e,t)=>w($(e)?.[0],t),getLocalRowIds:(e,t)=>h(w($(e)?.[1],t)),getLinkedRowIds:(e,t)=>o($(e))?[t]:h(J(e,t,!0)),addRelationshipIdsListener:G,addRemoteRowIdListener:(e,t,n)=>z(n,x,[e,t]),addLocalRowIdsListener:(e,t,n)=>z(n,S,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(J(e,t),z(n,j,[e,t])),delListener:e=>(K(...D(e)??[]),P),destroy:H,getListenerStats:()=>({})};return c(P)})(e)),x.get(e))})();e.createRelationships=E},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
