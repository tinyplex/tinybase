var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,o=t(""),s=(e,t)=>e.forEach(t),n=e=>e.length,i=e=>0==n(e),r=(e,t,o)=>e.slice(t,o),a=e=>null==e,d=(e,t,o)=>a(e)?o?.():t(e),l=(e,t)=>e?.has(t)??!1,c=e=>a(e)||0==(e=>e.size)(e),f=e=>[...e?.values()??[]],u=e=>e.clear(),h=(e,t)=>e?.forEach(t),p=(e,t)=>e?.delete(t),R=e=>new Map(e),g=(e,t)=>e?.get(t),L=(e,t)=>h(e,((e,o)=>t(o,e))),w=(e,t,o)=>a(o)?(p(e,t),e):e?.set(t,o),I=(e,t,o)=>(l(e,t)||e.set(t,o()),g(e,t)),b=e=>new Set(e),y=(e,t)=>e?.add(t),T=(e,s)=>t(e)==o?t=>t(e):e??(()=>s??""),v=(e,t,o)=>n(o)<2?y(i(o)?e:I(e,o[0],b),t):v(I(e,o[0],R),t,r(o,1)),m=e=>{const t=(o,n,...a)=>d(o,(o=>i(a)?e(o,n):s([a[0],null],(e=>t(g(o,e),n,...r(a,1))))));return t},k=Object.freeze,E=(e=>{const t=new WeakMap;return o=>(t.has(o)||t.set(o,e(o)),t.get(o))})((e=>{const t=R(),o=R(),r=R(),E=R(),[j,x,M,S,z,D,,,O,_,B]=((e,t,o)=>{const n=e.hasRow,r=R(),T=R(),v=R(),m=R(),k=R(),E=(t,o,...n)=>{const i=I(k,t,b);return s(n,(t=>y(i,t)&&o&&e.callListener(t))),n},j=(t,...o)=>d(g(k,t),(n=>{s(i(o)?f(n):o,(t=>{e.delListener(t),p(n,t)})),c(n)&&w(k,t)})),x=(e,o)=>{w(r,e,o),l(T,e)||(w(T,e,t()),w(v,e,R()),w(m,e,R()))},M=e=>{w(r,e),w(T,e),w(v,e),w(m,e),j(e)};return[()=>e,()=>[...r?.keys()??[]],e=>L(T,e),e=>l(T,e),e=>g(r,e),e=>g(T,e),(e,t)=>w(T,e,t),x,(t,i,r,d,c)=>{x(t,i);const f=R(),p=R(),I=g(v,t),b=g(m,t),y=t=>{const s=o=>e.getCell(i,t,o),r=g(I,t),l=n(i,t)?o(d(s,t)):void 0;if(r!=l&&w(f,t,[r,l]),!a(c)){const e=g(b,t),o=n(i,t)?c(s,t):void 0;e!=o&&w(p,t,o)}},T=e=>{r((()=>{h(f,(([,e],t)=>w(I,t,e))),h(p,((e,t)=>w(b,t,e)))}),f,p,I,b,e),u(f),u(p)};L(I,y),e.hasTable(i)&&s(e.getRowIds(i),(e=>{l(I,e)||y(e)})),T(!0),j(t),E(t,0,e.addRowListener(i,null,((e,t,o)=>y(o))),e.addTableListener(i,(()=>T())))},M,()=>L(k,M),E,j]})(e,(()=>[R(),R(),R(),R()]),(e=>a(e)?void 0:e+"")),[C,P,W]=(e=>{let t,o=0;const i=[],r=R();return[(s,n,a=[])=>{t??=e();const d=i.pop()??""+o++;return w(r,d,[s,n,a]),v(n,d,a),d},(e,o=[],...s)=>m(h)(e,(e=>d(g(r,e),(([e])=>e(t,...o,...s)))),...o),e=>d(g(r,e),(([,t,o])=>(m(p)(t,e,...o),w(r,e),n(i)<1e3&&((e,...t)=>{e.push(...t)})(i,e),o)),(()=>[])),(e,o,i)=>d(g(r,e),(([e,,r])=>{const d=(...l)=>{const c=n(l);c==n(r)?e(t,...l,...i(l)):a(r[c])?s(o[c](...l),(e=>d(...l,e))):d(...l,r[c])};d()}))]})((()=>G)),q=(e,t,o)=>d(D(e),(([s,,n])=>{if(!l(n,t)){const i=b();if(z(e)!=F(e))y(i,t);else{let e=t;for(;!a(e)&&!l(i,e);)y(i,e),e=g(s,e)}if(o)return i;w(n,t,i)}return g(n,t)})),A=(e,t)=>d(D(e),(([,,e])=>w(e,t))),F=e=>g(t,e),G={setRelationshipDefinition:(e,s,n,i)=>(w(t,e,n),O(e,s,((t,s)=>{const n=b(),i=b(),f=b(),[u,R]=D(e);h(s,(([t,o],s)=>{a(t)||(y(i,t),d(g(R,t),(e=>{p(e,s),c(e)&&w(R,t)}))),a(o)||(y(i,o),l(R,o)||w(R,o,b()),y(g(R,o),s)),y(n,s),w(u,s,o),L(g(E,e),(t=>{l(q(e,t),s)&&y(f,t)}))})),t(),h(n,(t=>P(o,[e,t]))),h(i,(t=>P(r,[e,t]))),h(f,(t=>{A(e,t),P(E,[e,t])}))}),T(i)),G),delRelationshipDefinition:e=>(w(t,e),_(e),G),getStore:j,getRelationshipIds:x,forEachRelationship:t=>M((o=>t(o,(t=>e.forEachRow(z(o),t))))),hasRelationship:S,getLocalTableId:z,getRemoteTableId:F,getRemoteRowId:(e,t)=>g(D(e)?.[0],t),getLocalRowIds:(e,t)=>f(g(D(e)?.[1],t)),getLinkedRowIds:(e,t)=>a(D(e))?[t]:f(q(e,t,!0)),addRemoteRowIdListener:(e,t,s)=>C(s,o,[e,t]),addLocalRowIdsListener:(e,t,o)=>C(o,r,[e,t]),addLinkedRowIdsListener:(e,t,o)=>(q(e,t),C(o,E,[e,t])),delListener:e=>(A(...W(e)),G),destroy:B,getListenerStats:()=>({})};return k(G)}));e.createRelationships=E,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
