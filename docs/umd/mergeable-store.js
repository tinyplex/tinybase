var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),l=t(0),r=t(t),o="type",c="default",i="Has",u="Ids",d="Table",g=d+"s",h=d+u,f="Row",b=f+"Count",T=f+u,C="Cell",p=C+u,v="Value",V=v+"s",y=v+u,w=e=>s+e,M=(e,t)=>e.startsWith(t),S=(e,t)=>e.endsWith(t),R=Math.max,m=isFinite,I=e=>null==e,L=(e,t,s)=>I(e)?s?.():t(e),H=e=>e==n||e==a,J=e=>t(e)==r,E=e=>Array.isArray(e),D=(e,t,s)=>e.slice(t,s),x=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),z=(e,...t)=>e.push(...t),A=Object,P=e=>A.getPrototypeOf(e),W=A.entries,j=A.isFrozen,k=e=>!I(e)&&L(P(e),(e=>e==A.prototype||I(P(e))),(()=>!0)),N=A.keys,B=A.freeze,U=(e=[])=>A.fromEntries(e),q=(e,t)=>t in e,G=(e,t)=>(delete e[t],e),K=(e,t)=>F(W(e),(([e,s])=>t(s,e))),Q=(e,t)=>O(W(e),(([e,s])=>t(s,e))),X=e=>k(e)&&0==(e=>x(N(e)))(e),Y=(e,t,s)=>(q(e,t)||(e[t]=s()),e[t]),Z=(e,t,s,n=0)=>I(e)||!k(e)||!n&&X(e)||j(e)?(s?.(),!1):(Q(e,((s,n)=>{t(s,n)||G(e,n)})),!!n||!X(e)),$=e=>new Set(E(e)||I(e)?e:[e]),_=(e,t)=>e?.add(t),ee=e=>e?.size??0,te=(e,t)=>e?.has(t)??!1,se=e=>I(e)||0==ee(e),ne=e=>e.clear(),ae=(e,t)=>e?.forEach(t),le=(e,t)=>e?.delete(t),re=e=>new Map(e),oe=e=>[...e?.keys()??[]],ce=(e,t)=>e?.get(t),ie=(e,t)=>ae(e,((e,s)=>t(s,e))),ue=(e,t,s)=>I(s)?(le(e,t),e):e?.set(t,s),de=(e,t,s,n)=>(te(e,t)?n?.(ce(e,t)):ue(e,t,s()),ce(e,t)),ge=(e,t,s,n=ue)=>(Q(t,((t,n)=>s(e,n,t))),ie(e,(s=>q(t,s)?0:n(e,s))),e),he=(e,t,s,n)=>{const a={};return ae(e,((e,l)=>{if(!s?.(e,l)){const s=t?t(e,l):e;!n?.(s)&&(a[l]=s)}})),a},fe=(e,t,s)=>he(e,(e=>he(e,t,s)),se,X),be=(e,t,s)=>he(e,(e=>fe(e,t,s)),se,X),Te=(e,t)=>{const s=re();return ae(e,((e,n)=>s.set(n,t?.(e)??e))),s},Ce=e=>Te(e,Te),pe=e=>Te(e,Ce),ve=(e,t,s,n,a=0)=>L((s?de:ce)(e,t[a],a>x(t)-2?s:re),(l=>{if(a>x(t)-2)return n?.(l)&&ue(e,t[a]),l;const r=ve(l,t,s,n,a+1);return se(l)&&ue(e,t[a]),r})),Ve=new globalThis.TextEncoder,ye=e=>{let t=2166136261;return F(Ve.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},we=([e,t,s])=>[e,t,s],Me=([e,t])=>Se(e,t),Se=(e,t)=>t?[e,t]:[e],Re=e=>e[2],me=(e,t)=>ye(e+":"+t),Ie=(e,t)=>t>e?(e?ye(e):0)^ye(t):0,Le=(e,t)=>((e??"")>(t??"")?e:t)??"",He=(e,t,s)=>{e[2]=t>>>0,s>e[1]&&(e[1]=s)},Je=(e=s)=>Se(U(),e),Ee=(e=s)=>[re(),e,0],De=([e,t,s],n=we)=>[he(e,n),t,s],xe=([e,t],s=Me)=>Se(he(e,s),t),Fe=(e,s)=>{return E(e)&&3==x(e)&&(a=e[1],t(a)==n)&&t(e[2])==l&&m(e[2])&&s(e[0]);var a},Oe=/^\d+$/,ze=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{Oe.test(t)&&x(e)<1e3&&z(e,t)}]},Ae=e=>[e,e],Pe=()=>[re(),re()],We=e=>[...e],je=([e,t])=>e===t,ke=e=>{const s=t(e);return H(s)||s==l&&m(e)?s:void 0},Ne=e=>I(e)||!I(ke(e)),Be=(e,t,s,n,a)=>I(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a),Ue=(e,t,s)=>I(s)?e.delValue(t):e.setValue(t,s),qe=e=>JSON.stringify(e,((e,t)=>t instanceof Map?A.fromEntries([...t]):t)),Ge=JSON.parse,Ke="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(s),Qe=re(O(Ke,((e,t)=>[e,t]))),Xe=e=>Ke[63&e],Ye=(e,t)=>ce(Qe,e[t])??0,Ze=(e,t,s)=>ue(e,t,ce(e,t)==-s?void 0:s),$e=()=>{let e,t,n=!1,a=!1,r=0,u=[];const M=re(),S=re(),R=re(),m=re(),E=re(),A=re(),P=re(),W=re(),j=re(),k=re(),N=re(),U=re(),K=re(),Y=re(),Ve=$(),ye=re(),we=re(),Me=re(),Se=re(),Re=Pe(),me=Pe(),Ie=Pe(),Le=Pe(),He=Pe(),Je=Pe(),Ee=Pe(),De=Pe(),xe=Pe(),Fe=Pe(),Oe=Pe(),Ne=Pe(),Ke=Pe(),Qe=Pe(),Xe=Pe(),Ye=Pe(),_e=Pe(),et=Pe(),tt=Pe(),st=Pe(),nt=Pe(),at=Pe(),lt=re(),rt=Pe(),[ot,ct,it,ut]=(e=>{let t;const[n,a]=ze(),l=re();return[(e,a,r,o=[],c=(()=>[]))=>{t??=Js;const i=n(1);return ue(l,i,[e,a,r,o,c]),_(ve(a,r??[s],$),i),i},(e,n,...a)=>F(((e,t=[s])=>{const n=[],a=(e,s)=>s==x(t)?z(n,e):null===t[s]?ae(e,(e=>a(e,s+1))):F([t[s],null],(t=>a(ce(e,t),s+1)));return a(e,0),n})(e,n),(e=>ae(e,(e=>ce(l,e)[0](t,...n??[],...a))))),e=>L(ce(l,e),(([,t,n])=>(ve(t,n??[s],void 0,(t=>(le(t,e),se(t)?1:0))),ue(l,e),a(e),n))),e=>L(ce(l,e),(([e,,s=[],n,a])=>{const l=(...r)=>{const o=x(r);o==x(s)?e(t,...r,...a(r)):I(s[o])?F(n[o]?.(...r)??[],(e=>l(...r,e))):l(...r,s[o])};l()}))]})(),dt=e=>{if(!Z(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!H(t)&&t!=l||(ke(e[c])!=t&&G(e,c),0))},gt=(t,s)=>(!e||te(N,s)||Nt(s))&&Z(t,((e,t)=>ht(s,t,e)),(()=>Nt(s))),ht=(e,t,s,n)=>Z(n?s:Ct(s,e,t),((n,a)=>L(ft(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>Nt(e,t))),ft=(t,s,n,a)=>e?L(ce(ce(N,t),n),(e=>ke(a)!=e[o]?Nt(t,s,n,a,e[c]):a),(()=>Nt(t,s,n,a))):I(ke(a))?Nt(t,s,n,a):a,bt=(e,t)=>Z(t?e:pt(e),((t,s)=>L(Tt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Bt())),Tt=(e,s)=>t?L(ce(K,e),(t=>ke(s)!=t[o]?Bt(e,s,t[c]):s),(()=>Bt(e,s))):I(ke(s))?Bt(e,s):s,Ct=(e,t,s)=>(L(ce(U,t),(([n,a])=>{ae(n,((t,s)=>{q(e,s)||(e[s]=t)})),ae(a,(n=>{q(e,n)||Nt(t,s,n)}))})),e),pt=e=>(t&&(ae(Y,((t,s)=>{q(e,s)||(e[s]=t)})),ae(Ve,(t=>{q(e,t)||Bt(t)}))),e),vt=e=>ge(N,e,((e,t,s)=>{const n=re(),a=$();ge(de(N,t,re),s,((e,t,s)=>{ue(e,t,s),L(s[c],(e=>ue(n,t,e)),(()=>_(a,t)))})),ue(U,t,[n,a])}),((e,t)=>{ue(N,t),ue(U,t)})),Vt=e=>ge(K,e,((e,t,s)=>{ue(K,t,s),L(s[c],(e=>ue(Y,t,e)),(()=>_(Ve,t)))}),((e,t)=>{ue(K,t),ue(Y,t),le(Ve,t)})),yt=e=>X(e)?ys():Ts(e),wt=e=>ge(Me,e,((e,t,s)=>Mt(t,s)),((e,t)=>Dt(t))),Mt=(e,t)=>ge(de(Me,e,(()=>(zt(e,1),ue(ye,e,ze()),ue(we,e,re()),re()))),t,((t,s,n)=>St(e,t,s,n)),((t,s)=>xt(e,t,s))),St=(e,t,s,n,a)=>ge(de(t,s,(()=>(At(e,s,1),re()))),n,((t,n,a)=>Rt(e,s,t,n,a)),((n,l)=>Ft(e,t,s,n,l,a))),Rt=(e,t,s,n,a)=>{te(s,n)||Pt(e,t,n,1);const l=ce(s,n);a!==l&&(Wt(e,t,n,l,a),ue(s,n,a))},mt=(e,t,s,n,a)=>L(ce(t,s),(t=>Rt(e,s,t,n,a)),(()=>St(e,t,s,Ct({[n]:a},e,s)))),It=e=>X(e)?Ss():Cs(e),Lt=e=>ge(Se,e,((e,t,s)=>Ht(t,s)),((e,t)=>Ot(t))),Ht=(e,t)=>{te(Se,e)||jt(e,1);const s=ce(Se,e);t!==s&&(kt(e,s,t),ue(Se,e,t))},Jt=(e,t)=>{const[s]=ce(ye,e),n=s(t);return te(ce(Me,e),n)?Jt(e,t):n},Et=e=>ce(Me,e)??Mt(e,{}),Dt=e=>Mt(e,{}),xt=(e,t,s)=>{const[,n]=ce(ye,e);n(s),St(e,t,s,{},!0)},Ft=(e,t,s,n,a,l)=>{const r=ce(ce(U,e)?.[0],a);if(!I(r)&&!l)return Rt(e,s,n,a,r);const o=t=>{Wt(e,s,t,ce(n,t)),Pt(e,s,t,-1),ue(n,t)};I(r)?o(a):ie(n,o),se(n)&&(At(e,s,-1),se(ue(t,s))&&(zt(e,-1),ue(Me,e),ue(ye,e),ue(we,e)))},Ot=e=>{const t=ce(Y,e);if(!I(t))return Ht(e,t);kt(e,ce(Se,e)),jt(e,-1),ue(Se,e)},zt=(e,t)=>Ze(M,e,t),At=(e,t,s)=>Ze(de(m,e,re),t,s)&&ue(R,e,de(R,e,(()=>0))+s),Pt=(e,t,s,n)=>{const a=ce(we,e),l=ce(a,s)??0;(0==l&&1==n||1==l&&-1==n)&&Ze(de(S,e,re),s,n),ue(a,s,l!=-n?l+n:null),Ze(de(de(E,e,re),t,re),s,n)},Wt=(e,t,s,n,a)=>{de(de(de(A,e,re),t,re),s,(()=>[n,0]))[1]=a,u[3]?.(e,t,s,a)},jt=(e,t)=>Ze(P,e,t),kt=(e,t,s)=>{de(W,e,(()=>[t,0]))[1]=s,u[4]?.(e,s)},Nt=(e,t,s,n,a)=>(z(de(de(de(j,e,re),t,re),s,(()=>[])),n),a),Bt=(e,t,s)=>(z(de(k,e,(()=>[])),t),s),Ut=(e,t,s)=>L(ce(ce(ce(A,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Ae(ls(e,t,s))])),qt=e=>L(ce(W,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Ae(cs(e))])),Gt=e=>se(j)||se(Ye[e])?0:ae(e?pe(j):j,((t,s)=>ae(t,((t,n)=>ae(t,((t,a)=>ct(Ye[e],[s,n,a],t))))))),Kt=e=>se(k)||se(_e[e])?0:ae(e?Te(k):k,((t,s)=>ct(_e[e],[s],t))),Qt=(e,t,s,n)=>{if(!se(e))return ct(t,n,(()=>he(e))),ie(e,((e,t)=>ct(s,[...n??[],e],1==t))),1},Xt=e=>{const t=is();t!=n&&ct(Re[e],void 0,t);const s=se(Fe[e]),a=se(Ke[e])&&se(Qe[e])&&se(xe[e])&&se(Oe[e])&&se(Je[e])&&se(Ee[e])&&se(De[e])&&s&&se(Ie[e])&&se(Le[e]),l=se(Xe[e])&&se(Ne[e])&&se(He[e])&&se(me[e]);if(!a||!l){const t=e?[Te(M),Ce(S),Te(R),Ce(m),pe(E),pe(A)]:[M,S,R,m,E,A];if(!a){Qt(t[0],Ie[e],Le[e]),ae(t[1],((t,s)=>Qt(t,Je[e],Ee[e],[s]))),ae(t[2],((t,s)=>{0!=t&&ct(De[e],[s],ts(s))}));const n=$();ae(t[3],((t,a)=>{Qt(t,xe[e],Oe[e],[a])&&!s&&(ct(Fe[e],[a,null]),_(n,a))})),s||ae(t[5],((t,s)=>{if(!te(n,s)){const n=$();ae(t,(e=>ae(e,(([t,s],a)=>s!==t?_(n,a):le(e,a))))),ae(n,(t=>ct(Fe[e],[s,t])))}})),ae(t[4],((t,s)=>ae(t,((t,n)=>Qt(t,Ke[e],Qe[e],[s,n])))))}if(!l){let s;ae(t[5],((t,n)=>{let a;ae(t,((t,l)=>{let r;ae(t,(([t,o],c)=>{o!==t&&(ct(Xe[e],[n,l,c],o,t,Ut),s=a=r=1)})),r&&ct(Ne[e],[n,l],Ut)})),a&&ct(He[e],[n],Ut)})),s&&ct(me[e],void 0,Ut)}}},Yt=e=>{const t=fs();t!=a&&ct(et[e],void 0,t);const s=se(st[e])&&se(nt[e]),n=se(at[e])&&se(tt[e]);if(!s||!n){const t=e?[Te(P),Te(W)]:[P,W];if(s||Qt(t[0],st[e],nt[e]),!n){let s;ae(t[1],(([t,n],a)=>{n!==t&&(ct(at[e],[a],n,t,qt),s=1)})),s&&ct(tt[e],void 0,qt)}}},Zt=(e,...t)=>(Is((()=>e(...O(t,w)))),Js),$t=()=>be(Me),_t=()=>oe(Me),es=e=>oe(ce(we,w(e))),ts=e=>ee(ce(Me,w(e))),ss=e=>oe(ce(Me,w(e))),ns=(e,t,s,n=0,a)=>{return O(D((r=ce(Me,w(e)),o=(e,s)=>[I(t)?s:ce(e,w(t)),s],l=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(l)),n,I(a)?a:n+a),(([,e])=>e));var l,r,o},as=(e,t)=>oe(ce(ce(Me,w(e)),w(t))),ls=(e,t,s)=>ce(ce(ce(Me,w(e)),w(t)),w(s)),rs=()=>he(Se),os=()=>oe(Se),cs=e=>ce(Se,w(e)),is=()=>!se(Me),us=e=>te(Me,w(e)),ds=(e,t)=>te(ce(we,w(e)),w(t)),gs=(e,t)=>te(ce(Me,w(e)),w(t)),hs=(e,t,s)=>te(ce(ce(Me,w(e)),w(t)),w(s)),fs=()=>!se(Se),bs=e=>te(Se,w(e)),Ts=e=>Zt((()=>(e=>Z(e,gt,Nt))(e)?wt(e):0)),Cs=e=>Zt((()=>bt(e)?Lt(e):0)),ps=e=>{try{yt(Ge(e))}catch{}return Js},vs=t=>Zt((()=>{if((e=Z(t,(e=>Z(e,dt))))&&(vt(t),!se(Me))){const e=$t();ys(),Ts(e)}})),Vs=e=>Zt((()=>{if(t=(e=>Z(e,dt))(e)){const s=rs();ms(),Ss(),t=!0,Vt(e),Cs(s)}})),ys=()=>Zt((()=>wt({}))),ws=e=>Zt((e=>te(Me,e)?Dt(e):0),e),Ms=(e,t)=>Zt(((e,t)=>L(ce(Me,e),(s=>te(s,t)?xt(e,s,t):0))),e,t),Ss=()=>Zt((()=>Lt({}))),Rs=()=>Zt((()=>{vt({}),e=!1})),ms=()=>Zt((()=>{Vt({}),t=!1})),Is=(e,t)=>{if(-1!=r){Ls();const s=e();return Hs(t),s}},Ls=()=>(-1!=r&&r++,1==r&&(u[0]?.(),ct(lt)),Js),Hs=e=>(r>0&&(r--,0==r&&(r=1,Gt(1),se(A)||Xt(1),Kt(1),se(W)||Yt(1),e?.(Js)&&(ae(A,((e,t)=>ae(e,((e,s)=>ae(e,(([e],n)=>Be(Js,t,s,n,e))))))),ne(A),ae(W,(([e],t)=>Ue(Js,t,e))),ne(W)),ct(rt[0],void 0),r=-1,Gt(0),se(A)||Xt(0),Kt(0),se(W)||Yt(0),u[1]?.(),ct(rt[1],void 0),u[2]?.(),r=0,n=is(),a=fs(),F([M,S,R,m,E,A,j,P,W,k],ne))),Js),Js={getContent:()=>[$t(),rs()],getTables:$t,getTableIds:_t,getTable:e=>fe(ce(Me,w(e))),getTableCellIds:es,getRowCount:ts,getRowIds:ss,getSortedRowIds:ns,getRow:(e,t)=>he(ce(ce(Me,w(e)),w(t))),getCellIds:as,getCell:ls,getValues:rs,getValueIds:os,getValue:cs,hasTables:is,hasTable:us,hasTableCell:ds,hasRow:gs,hasCell:hs,hasValues:fs,hasValue:bs,getTablesJson:()=>qe(Me),getValuesJson:()=>qe(Se),getJson:()=>qe([Me,Se]),getTablesSchemaJson:()=>qe(N),getValuesSchemaJson:()=>qe(K),getSchemaJson:()=>qe([N,K]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>Zt((()=>{(X(e)?ys:Ts)(e),(X(t)?Ss:Cs)(t)})),setTables:Ts,setTable:(e,t)=>Zt((e=>gt(t,e)?Mt(e,t):0),e),setRow:(e,t,s)=>Zt(((e,t)=>ht(e,t,s)?St(e,Et(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Is((()=>{let n;return ht(e,n,t)&&(e=w(e),St(e,Et(e),n=Jt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Zt(((e,t)=>{if(ht(e,t,s,1)){const n=Et(e);Q(s,((s,a)=>mt(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>Zt(((e,t,s)=>L(ft(e,t,s,J(n)?n(ls(e,t,s)):n),(n=>mt(e,Et(e),t,s,n)))),e,t,s),setValues:Cs,setPartialValues:e=>Zt((()=>bt(e,1)?Q(e,((e,t)=>Ht(t,e))):0)),setValue:(e,t)=>Zt((e=>L(Tt(e,J(t)?t(cs(e)):t),(t=>Ht(e,t)))),e),applyChanges:e=>Zt((()=>{Q(e[0],((e,t)=>I(e)?ws(t):Q(e,((e,s)=>I(e)?Ms(t,s):Q(e,((e,n)=>Be(Js,t,s,n,e))))))),Q(e[1],((e,t)=>Ue(Js,t,e)))})),setTablesJson:ps,setValuesJson:e=>{try{It(Ge(e))}catch{}return Js},setJson:e=>Zt((()=>{try{const[t,s]=Ge(e);yt(t),It(s)}catch{ps(e)}})),setTablesSchema:vs,setValuesSchema:Vs,setSchema:(e,t)=>Zt((()=>{vs(e),Vs(t)})),delTables:ys,delTable:ws,delRow:Ms,delCell:(e,t,s,n)=>Zt(((e,t,s)=>L(ce(Me,e),(a=>L(ce(a,t),(l=>te(l,s)?Ft(e,a,t,l,s,n):0))))),e,t,s),delValues:Ss,delValue:e=>Zt((e=>te(Se,e)?Ot(e):0),e),delTablesSchema:Rs,delValuesSchema:ms,delSchema:()=>Zt((()=>{Rs(),ms()})),transaction:Is,startTransaction:Ls,getTransactionChanges:()=>[he(A,((e,t)=>-1===ce(M,t)?void 0:he(e,((e,s)=>-1===ce(ce(m,t),s)?void 0:he(e,(([,e])=>e),(e=>je(e)))),se,X)),se,X),he(W,(([,e])=>e),(e=>je(e))),1],getTransactionLog:()=>[!se(A),!se(W),be(A,We,je),be(j),he(W,We,je),he(k),he(M),fe(m),be(E),he(P)],finishTransaction:Hs,forEachTable:e=>ae(Me,((t,s)=>e(s,(e=>ae(t,((t,s)=>e(s,(e=>ie(t,e))))))))),forEachTableCell:(e,t)=>ie(ce(we,w(e)),t),forEachRow:(e,t)=>ae(ce(Me,w(e)),((e,s)=>t(s,(t=>ie(e,t))))),forEachCell:(e,t,s)=>ie(ce(ce(Me,w(e)),w(t)),s),forEachValue:e=>ie(Se,e),addSortedRowIdsListener:(e,t,s,n,a,l,r)=>{let o=ns(e,t,s,n,a);return ot((()=>{const r=ns(e,t,s,n,a);var c,i,u;i=o,x(c=r)===x(i)&&(u=(e,t)=>i[t]===e,c.every(u))||(o=r,l(Js,e,t,s,n,a,o))}),Fe[r?1:0],[e,t],[_t])},addStartTransactionListener:e=>ot(e,lt),addWillFinishTransactionListener:e=>ot(e,rt[0]),addDidFinishTransactionListener:e=>ot(e,rt[1]),callListener:e=>(ut(e),Js),delListener:e=>(it(e),Js),getListenerStats:()=>({}),isMergeable:()=>!1,createStore:$e,addListener:ot,callListeners:ct,setInternalListeners:(e,t,s,n,a)=>u=[e,t,s,n,a]};return Q({[i+g]:[0,Re,[],()=>[is()]],[g]:[0,me],[h]:[0,Ie],[i+d]:[1,Le,[_t],e=>[us(...e)]],[d]:[1,He,[_t]],[d+p]:[1,Je,[_t]],[i+d+C]:[2,Ee,[_t,es],e=>[ds(...e)]],[b]:[1,De,[_t]],[T]:[1,xe,[_t]],[i+f]:[2,Oe,[_t,ss],e=>[gs(...e)]],[f]:[2,Ne,[_t,ss]],[p]:[2,Ke,[_t,ss]],[i+C]:[3,Qe,[_t,ss,as],e=>[hs(...e)]],[C]:[3,Xe,[_t,ss,as],e=>Ae(ls(...e))],InvalidCell:[3,Ye],[i+V]:[0,et,[],()=>[fs()]],[V]:[0,tt],[y]:[0,st],[i+v]:[1,nt,[os],e=>[bs(...e)]],[v]:[1,at,[os],e=>Ae(cs(e[0]))],InvalidValue:[1,_e]},(([e,t,s,n],a)=>{Js["add"+a+"Listener"]=(...a)=>ot(a[e],t[a[e+1]?1:0],e>0?D(a,0,e):void 0,s,n)})),B(Js)},_e=2**36,et=2**30,tt=2**24,st=2**18,nt=4096,at={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},lt=(e=s)=>[Ee(e),Ee(e)];e.createMergeableStore=e=>{let t=1,n=lt(),a=0;const l=re(),r=$(),[o,c]=(e=>{let t=0,s=-1;const n=L(e,(e=>{const t=ye(e);return Xe(t/tt)+Xe(t/st)+Xe(t/nt)+Xe(t/64)+Xe(t)}),(()=>((e=16)=>{return t=(e,t)=>e+Xe(t),crypto.getRandomValues(new Uint8Array(e)).reduce(t,"");var t})(5))),a=e=>{const n=t,[a,l]=I(e)||""==e?[0,0]:[Ye(r=e,0)*_e+Ye(r,1)*et+Ye(r,2)*tt+Ye(r,3)*st+Ye(r,4)*nt+64*Ye(r,5)+Ye(r,6),Ye(r,7)*st+Ye(r,8)*nt+64*Ye(r,9)+Ye(r,10)];var r;t=R(n,a,Date.now()),s=t==n?t==a?R(s,l):s:t==a?l:-1};return[()=>{return a(),l=++s,Xe((e=t)/_e)+Xe(e/et)+Xe(e/tt)+Xe(e/st)+Xe(e/nt)+Xe(e/64)+Xe(e)+Xe(l/st)+Xe(l/nt)+Xe(l/64)+Xe(l)+n;var e,l},a]})(e),i=$e(),u=e=>{const s=t;return t=0,e(),t=s,b},d=(e,t=0)=>{const a={},l={},[[r,o=s,i=0],u]=e,[d,h]=n,[f,b,T]=d;let C=t?i:T,p=o;K(r,(([e,n=s,l=0],r)=>{const o=de(f,r,Ee),[c,i,u]=o;let d=t?l:u,h=n;K(e,((e,s)=>{const[n,l,o]=g(e,de(c,s,Ee),Y(Y(a,r,U),s,U),t);d^=t?0:(l?me(s,l):0)^me(s,o),h=Le(h,n)})),d^=t?0:Ie(i,n),He(o,d,n),C^=t?0:(u?me(r,u):0)^me(r,o[2]),p=Le(p,h)})),C^=t?0:Ie(b,o),He(d,C,o);const[v]=g(u,h,l,t);return c(Le(p,v)),[a,l,1]},g=(e,t,n,a)=>{const[l,r=s,o=0]=e,[c,i,u]=t;let d=r,g=a?o:u;return K(l,(([e,t,l=0],r)=>{const o=de(c,r,(()=>[void 0,s,0])),[,i,u]=o;(!i||t>i)&&(He(o,a?l:ye(qe(e??null)+":"+t),t),o[0]=e,n[r]=e,g^=a?0:me(r,u)^me(r,o[2]),d=Le(d,t))})),g^=a?0:Ie(i,r),He(t,g,r),[d,u,t[2]]},h=()=>[De(n[0],(e=>De(e,(e=>De(e))))),De(n[1])],f=e=>u((()=>i.applyChanges(d(e)))),b={getMergeableContent:h,getMergeableContentHashes:()=>[n[0][2],n[1][2]],getMergeableTableHashes:()=>he(n[0][0],Re),getMergeableTableDiff:e=>{const t=Je(n[0][1]),s={};return ie(n[0][0],((n,[a,l,r])=>q(e,n)?r!=e[n]?s[n]=r:0:t[0][n]=xe([a,l],(e=>xe(e))))),[t,s]},getMergeableRowHashes:e=>{const t={};return K(e,((e,s)=>L(ce(n[0][0],s),(([n,,a])=>a!=e?ie(n,((e,[,,n])=>Y(t,s,U)[e]=n)):0)))),t},getMergeableRowDiff:e=>{const t=Je(n[0][1]),s={};return K(e,((e,a)=>ie(ce(n[0][0],a)?.[0],((n,[l,r,o])=>q(e,n)?o!==e[n]?Y(s,a,U)[n]=o:0:Y(t[0],a,Je)[0][n]=xe([l,r]))))),[t,s]},getMergeableCellHashes:e=>{const t={};return K(e,((e,s)=>L(ce(n[0][0],s),(([n])=>K(e,((e,a)=>L(ce(n,a),(([n,,l])=>l!==e?ie(n,((e,[,,n])=>Y(Y(t,s,U),a,U)[e]=n)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,s]]=n,a={};return K(e,((e,s)=>K(e,((e,n)=>L(ce(t,s),(([t,l])=>L(ce(t,n),(([t,r])=>ie(t,((t,[o,c,i])=>i!==e[t]?Y(Y(a,s,(()=>Je(l)))[0],n,(()=>Je(r)))[0][t]=[o,c]:0)))))))))),Se(a,s)},getMergeableValuesHashes:()=>he(n[1][0],Re),getMergeableValueDiff:e=>{const[,[t,s]]=n,a=he(t,Me,(([,,t],s)=>t==e?.[s]));return Se(a,s)},setMergeableContent:e=>u((()=>(e=>E(e)&&2==x(e)&&Fe(e[0],(e=>Z(e,(e=>Fe(e,(e=>Z(e,(e=>Fe(e,(e=>Z(e,(e=>Fe(e,Ne)),void 0,1)))),void 0,1)))),void 0,1)))&&Fe(e[1],(e=>Z(e,(e=>Fe(e,Ne)),void 0,1))))(e)?i.transaction((()=>{i.delTables().delValues(),n=lt(),i.applyChanges(d(e,1))})):0)),setDefaultContent:e=>(i.transaction((()=>{a=1,i.setContent(e),a=0})),b),getTransactionMergeableChanges:()=>{const[[e,t],[s,a]]=n,o={};ae(l,((t,s)=>L(ce(e,s),(([e,n])=>{const a={};ae(t,((t,s)=>L(ce(e,s),(([e,n])=>{const l={};ae(t,(t=>{L(ce(e,t),(([e,s])=>l[t]=Se(e,s)))})),a[s]=Se(l,n)})))),o[s]=Se(a,n)}))));const c={};return ae(r,(e=>L(ce(s,e),(([t,s])=>c[e]=Se(t,s))))),[Se(o,t),Se(c,a),1]},applyMergeableChanges:f,merge:e=>{const t=h(),s=e.getMergeableContent();return e.applyMergeableChanges(t),f(s)}};return i.setInternalListeners((()=>{}),(()=>{}),(()=>{ne(l),ne(r)}),((e,n,r,c)=>{_(de(de(l,e,re),n,$),r),t&&d([[{[e]:[{[n]:[{[r]:[c,a?s:o()]}]}]}],[{}],1])}),((e,n)=>{_(r,e),t&&d([[{}],[{[e]:[n,a?s:o()]}],1])})),Q(i,((e,t)=>b[t]=M(t,"set")||M(t,"del")||M(t,"apply")||S(t,"Transaction")||"callListener"==t?(...t)=>(e(...t),b):M(t,"add")&&S(t,"Listener")?(...s)=>{const n=at[D(t,3,-8)]??0,a=s[n];return s[n]=(e,...t)=>a(b,...t),e(...s)}:"isMergeable"==t?()=>!0:e)),B(b)}},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseMergeableStore={});
