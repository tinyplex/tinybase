var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),l=t(0),r=t(t),o="type",i="default",c="Has",d="Ids",u="Table",g=u+"s",h=u+d,f="Row",b=f+"Count",C=f+d,T="Cell",v=T+d,p="Value",V=p+"s",y=p+d,w=e=>s+e,S=(e,t)=>e.startsWith(t),I=(e,t)=>e.endsWith(t),M=Math.max,m=isFinite,R=e=>null==e,L=(e,t,s)=>R(e)?s?.():t(e),H=e=>e==n||e==a,J=e=>t(e)==r,E=e=>Array.isArray(e),x=(e,t,s)=>e.slice(t,s),D=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),z=(e,...t)=>e.push(...t),A=Object,P=e=>A.getPrototypeOf(e),W=A.entries,j=A.isFrozen,k=e=>!R(e)&&L(P(e),(e=>e==A.prototype||R(P(e))),(()=>!0)),N=A.keys,B=A.freeze,$=(e=[])=>A.fromEntries(e),q=(e,t)=>t in e,G=(e,t)=>(delete e[t],e),K=(e,t)=>F(W(e),(([e,s])=>t(s,e))),Q=(e,t)=>O(W(e),(([e,s])=>t(s,e))),U=(e,t)=>$(Q(e,((e,s)=>[s,t(e,s)]))),X=e=>k(e)&&0==(e=>D(N(e)))(e),Y=(e,t,s)=>(q(e,t)||(e[t]=s()),e[t]),Z=(e,t,s,n=0)=>R(e)||!k(e)||!n&&X(e)||j(e)?(s?.(),!1):(Q(e,((s,n)=>{t(s,n)||G(e,n)})),!!n||!X(e)),_=e=>e?.size??0,ee=(e,t)=>e?.has(t)??!1,te=e=>R(e)||0==_(e),se=e=>e.clear(),ne=(e,t)=>e?.forEach(t),ae=(e,t)=>e?.delete(t),le=e=>new Map(e),re=e=>[...e?.keys()??[]],oe=(e,t)=>e?.get(t),ie=(e,t)=>ne(e,((e,s)=>t(s,e))),ce=(e,t,s)=>R(s)?(ae(e,t),e):e?.set(t,s),de=(e,t,s,n)=>(ee(e,t)?n?.(oe(e,t)):ce(e,t,s()),oe(e,t)),ue=(e,t,s,n=ce)=>(Q(t,((t,n)=>s(e,n,t))),ie(e,(s=>q(t,s)?0:n(e,s))),e),ge=(e,t,s,n)=>{const a={};return ne(e,((e,l)=>{if(!s?.(e,l)){const s=t?t(e,l):e;!n?.(s)&&(a[l]=s)}})),a},he=(e,t,s)=>ge(e,(e=>ge(e,t,s)),te,X),fe=(e,t,s)=>ge(e,(e=>he(e,t,s)),te,X),be=(e,t)=>{const s=le();return ne(e,((e,n)=>s.set(n,t?.(e)??e))),s},Ce=e=>be(e,be),Te=e=>be(e,Ce),ve=(e,t,s,n,a=0)=>L((s?de:oe)(e,t[a],a>D(t)-2?s:le),(l=>{if(a>D(t)-2)return n?.(l)&&ce(e,t[a]),l;const r=ve(l,t,s,n,a+1);return te(l)&&ce(e,t[a]),r})),pe=new globalThis.TextEncoder,Ve=e=>{let t=2166136261;return F(pe.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},ye=([e,t,s])=>[e,t,s],we=([e,t])=>[e,t],Se=e=>e[2],Ie=(e,t)=>Ve(e+":"+t),Me=(e,t,s)=>{e[2]=t>>>0,s>e[0]&&(e[0]=s)},me=e=>[e,$()],Re=(e="")=>[e,le(),0],Le=([e,t,s],n=ye)=>[e,ge(t,n),s],He=(e,s)=>{return E(e)&&3==D(e)&&(a=e[0],t(a)==n)&&s(e[1])&&t(e[2])==l&&m(e[2]);var a},Je=e=>new Set(E(e)||R(e)?e:[e]),Ee=(e,t)=>e?.add(t),xe=/^\d+$/,De=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{xe.test(t)&&D(e)<1e3&&z(e,t)}]},Fe=e=>[e,e],Oe=()=>[le(),le()],ze=e=>[...e],Ae=([e,t])=>e===t,Pe=e=>{const s=t(e);return H(s)||s==l&&m(e)?s:void 0},We=e=>null===e||!R(Pe(e)),je=(e,t,s,n,a)=>R(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a),ke=(e,t,s)=>R(s)?e.delValue(t):e.setValue(t,s),Ne=e=>JSON.stringify(e,((e,t)=>t instanceof Map?A.fromEntries([...t]):t)),Be=JSON.parse,$e=(e,t,s)=>ce(e,t,oe(e,t)==-s?void 0:s),qe=()=>{let e,t,n=!1,a=!1,r=0,d=[];const S=le(),I=le(),M=le(),m=le(),E=le(),A=le(),P=le(),W=le(),j=le(),k=le(),N=le(),$=le(),K=le(),U=le(),Y=Je(),pe=le(),Ve=le(),ye=le(),we=le(),Se=Oe(),Ie=Oe(),Me=Oe(),me=Oe(),Re=Oe(),Le=Oe(),He=Oe(),xe=Oe(),We=Oe(),Ge=Oe(),Ke=Oe(),Qe=Oe(),Ue=Oe(),Xe=Oe(),Ye=Oe(),Ze=Oe(),_e=Oe(),et=Oe(),tt=Oe(),st=Oe(),nt=Oe(),at=Oe(),lt=le(),rt=Oe(),[ot,it,ct,dt]=(e=>{let t;const[n,a]=De(),l=le();return[(e,a,r,o=[],i=(()=>[]))=>{t??=Js;const c=n(1);return ce(l,c,[e,a,r,o,i]),Ee(ve(a,r??[s],Je),c),c},(e,n,...a)=>F(((e,t=[s])=>{const n=[],a=(e,s)=>s==D(t)?z(n,e):null===t[s]?ne(e,(e=>a(e,s+1))):F([t[s],null],(t=>a(oe(e,t),s+1)));return a(e,0),n})(e,n),(e=>ne(e,(e=>oe(l,e)[0](t,...n??[],...a))))),e=>L(oe(l,e),(([,t,n])=>(ve(t,n??[s],void 0,(t=>(ae(t,e),te(t)?1:0))),ce(l,e),a(e),n))),e=>L(oe(l,e),(([e,,s=[],n,a])=>{const l=(...r)=>{const o=D(r);o==D(s)?e(t,...r,...a(r)):R(s[o])?F(n[o]?.(...r)??[],(e=>l(...r,e))):l(...r,s[o])};l()}))]})(),ut=e=>{if(!Z(e,((e,t)=>[o,i].includes(t))))return!1;const t=e[o];return!(!H(t)&&t!=l||(Pe(e[i])!=t&&G(e,i),0))},gt=(t,s)=>(!e||ee(N,s)||Nt(s))&&Z(t,((e,t)=>ht(s,t,e)),(()=>Nt(s))),ht=(e,t,s,n)=>Z(n?s:Tt(s,e,t),((n,a)=>L(ft(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>Nt(e,t))),ft=(t,s,n,a)=>e?L(oe(oe(N,t),n),(e=>Pe(a)!=e[o]?Nt(t,s,n,a,e[i]):a),(()=>Nt(t,s,n,a))):R(Pe(a))?Nt(t,s,n,a):a,bt=(e,t)=>Z(t?e:vt(e),((t,s)=>L(Ct(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Bt())),Ct=(e,s)=>t?L(oe(K,e),(t=>Pe(s)!=t[o]?Bt(e,s,t[i]):s),(()=>Bt(e,s))):R(Pe(s))?Bt(e,s):s,Tt=(e,t,s)=>(L(oe($,t),(([n,a])=>{ne(n,((t,s)=>{q(e,s)||(e[s]=t)})),ne(a,(n=>{q(e,n)||Nt(t,s,n)}))})),e),vt=e=>(t&&(ne(U,((t,s)=>{q(e,s)||(e[s]=t)})),ne(Y,(t=>{q(e,t)||Bt(t)}))),e),pt=e=>ue(N,e,((e,t,s)=>{const n=le(),a=Je();ue(de(N,t,le),s,((e,t,s)=>{ce(e,t,s),L(s[i],(e=>ce(n,t,e)),(()=>Ee(a,t)))})),ce($,t,[n,a])}),((e,t)=>{ce(N,t),ce($,t)})),Vt=e=>ue(K,e,((e,t,s)=>{ce(K,t,s),L(s[i],(e=>ce(U,t,e)),(()=>Ee(Y,t)))}),((e,t)=>{ce(K,t),ce(U,t),ae(Y,t)})),yt=e=>X(e)?ys():Cs(e),wt=e=>ue(ye,e,((e,t,s)=>St(t,s)),((e,t)=>xt(t))),St=(e,t)=>ue(de(ye,e,(()=>(zt(e,1),ce(pe,e,De()),ce(Ve,e,le()),le()))),t,((t,s,n)=>It(e,t,s,n)),((t,s)=>Dt(e,t,s))),It=(e,t,s,n,a)=>ue(de(t,s,(()=>(At(e,s,1),le()))),n,((t,n,a)=>Mt(e,s,t,n,a)),((n,l)=>Ft(e,t,s,n,l,a))),Mt=(e,t,s,n,a)=>{ee(s,n)||Pt(e,t,n,1);const l=oe(s,n);a!==l&&(Wt(e,t,n,l,a),ce(s,n,a))},mt=(e,t,s,n,a)=>L(oe(t,s),(t=>Mt(e,s,t,n,a)),(()=>It(e,t,s,Tt({[n]:a},e,s)))),Rt=e=>X(e)?Is():Ts(e),Lt=e=>ue(we,e,((e,t,s)=>Ht(t,s)),((e,t)=>Ot(t))),Ht=(e,t)=>{ee(we,e)||jt(e,1);const s=oe(we,e);t!==s&&(kt(e,s,t),ce(we,e,t))},Jt=(e,t)=>{const[s]=oe(pe,e),n=s(t);return ee(oe(ye,e),n)?Jt(e,t):n},Et=e=>oe(ye,e)??St(e,{}),xt=e=>St(e,{}),Dt=(e,t,s)=>{const[,n]=oe(pe,e);n(s),It(e,t,s,{},!0)},Ft=(e,t,s,n,a,l)=>{const r=oe(oe($,e)?.[0],a);if(!R(r)&&!l)return Mt(e,s,n,a,r);const o=t=>{Wt(e,s,t,oe(n,t)),Pt(e,s,t,-1),ce(n,t)};R(r)?o(a):ie(n,o),te(n)&&(At(e,s,-1),te(ce(t,s))&&(zt(e,-1),ce(ye,e),ce(pe,e),ce(Ve,e)))},Ot=e=>{const t=oe(U,e);if(!R(t))return Ht(e,t);kt(e,oe(we,e)),jt(e,-1),ce(we,e)},zt=(e,t)=>$e(S,e,t),At=(e,t,s)=>$e(de(m,e,le),t,s)&&ce(M,e,de(M,e,(()=>0))+s),Pt=(e,t,s,n)=>{const a=oe(Ve,e),l=oe(a,s)??0;(0==l&&1==n||1==l&&-1==n)&&$e(de(I,e,le),s,n),ce(a,s,l!=-n?l+n:null),$e(de(de(E,e,le),t,le),s,n)},Wt=(e,t,s,n,a)=>de(de(de(A,e,le),t,le),s,(()=>[n,0]))[1]=a,jt=(e,t)=>$e(P,e,t),kt=(e,t,s)=>de(W,e,(()=>[t,0]))[1]=s,Nt=(e,t,s,n,a)=>(z(de(de(de(j,e,le),t,le),s,(()=>[])),n),a),Bt=(e,t,s)=>(z(de(k,e,(()=>[])),t),s),$t=(e,t,s)=>L(oe(oe(oe(A,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Fe(ls(e,t,s))])),qt=e=>L(oe(W,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Fe(is(e))])),Gt=e=>te(j)||te(Ze[e])?0:ne(e?Te(j):j,((t,s)=>ne(t,((t,n)=>ne(t,((t,a)=>it(Ze[e],[s,n,a],t))))))),Kt=e=>te(k)||te(_e[e])?0:ne(e?be(k):k,((t,s)=>it(_e[e],[s],t))),Qt=(e,t,s,n)=>{if(!te(e))return it(t,n,(()=>ge(e))),ie(e,((e,t)=>it(s,[...n??[],e],1==t))),1},Ut=e=>{const t=cs();t!=n&&it(Se[e],void 0,t);const s=te(Ge[e]),a=te(Ue[e])&&te(Xe[e])&&te(We[e])&&te(Ke[e])&&te(Le[e])&&te(He[e])&&te(xe[e])&&s&&te(Me[e])&&te(me[e]),l=te(Ye[e])&&te(Qe[e])&&te(Re[e])&&te(Ie[e]);if(!a||!l){const t=e?[be(S),Ce(I),be(M),Ce(m),Te(E),Te(A)]:[S,I,M,m,E,A];if(!a){Qt(t[0],Me[e],me[e]),ne(t[1],((t,s)=>Qt(t,Le[e],He[e],[s]))),ne(t[2],((t,s)=>{0!=t&&it(xe[e],[s],ts(s))}));const n=Je();ne(t[3],((t,a)=>{Qt(t,We[e],Ke[e],[a])&&!s&&(it(Ge[e],[a,null]),Ee(n,a))})),s||ne(t[5],((t,s)=>{if(!ee(n,s)){const n=Je();ne(t,(e=>ne(e,(([t,s],a)=>s!==t?Ee(n,a):ae(e,a))))),ne(n,(t=>it(Ge[e],[s,t])))}})),ne(t[4],((t,s)=>ne(t,((t,n)=>Qt(t,Ue[e],Xe[e],[s,n])))))}if(!l){let s;ne(t[5],((t,n)=>{let a;ne(t,((t,l)=>{let r;ne(t,(([t,o],i)=>{o!==t&&(it(Ye[e],[n,l,i],o,t,$t),s=a=r=1)})),r&&it(Qe[e],[n,l],$t)})),a&&it(Re[e],[n],$t)})),s&&it(Ie[e],void 0,$t)}}},Xt=e=>{const t=fs();t!=a&&it(et[e],void 0,t);const s=te(st[e])&&te(nt[e]),n=te(at[e])&&te(tt[e]);if(!s||!n){const t=e?[be(P),be(W)]:[P,W];if(s||Qt(t[0],st[e],nt[e]),!n){let s;ne(t[1],(([t,n],a)=>{n!==t&&(it(at[e],[a],n,t,qt),s=1)})),s&&it(tt[e],void 0,qt)}}},Yt=(e,...t)=>(Rs((()=>e(...O(t,w)))),Js),Zt=()=>fe(ye),_t=()=>re(ye),es=e=>re(oe(Ve,w(e))),ts=e=>_(oe(ye,w(e))),ss=e=>re(oe(ye,w(e))),ns=(e,t,s,n=0,a)=>{return O(x((r=oe(ye,w(e)),o=(e,s)=>[R(t)?s:oe(e,w(t)),s],l=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(l)),n,R(a)?a:n+a),(([,e])=>e));var l,r,o},as=(e,t)=>re(oe(oe(ye,w(e)),w(t))),ls=(e,t,s)=>oe(oe(oe(ye,w(e)),w(t)),w(s)),rs=()=>ge(we),os=()=>re(we),is=e=>oe(we,w(e)),cs=()=>!te(ye),ds=e=>ee(ye,w(e)),us=(e,t)=>ee(oe(Ve,w(e)),w(t)),gs=(e,t)=>ee(oe(ye,w(e)),w(t)),hs=(e,t,s)=>ee(oe(oe(ye,w(e)),w(t)),w(s)),fs=()=>!te(we),bs=e=>ee(we,w(e)),Cs=e=>Yt((()=>(e=>Z(e,gt,Nt))(e)?wt(e):0)),Ts=e=>Yt((()=>bt(e)?Lt(e):0)),vs=e=>{try{yt(Be(e))}catch{}return Js},ps=t=>Yt((()=>{if((e=Z(t,(e=>Z(e,ut))))&&(pt(t),!te(ye))){const e=Zt();ys(),Cs(e)}})),Vs=e=>Yt((()=>{if(t=(e=>Z(e,ut))(e)){const s=rs();ms(),Is(),t=!0,Vt(e),Ts(s)}})),ys=()=>Yt((()=>wt({}))),ws=e=>Yt((e=>ee(ye,e)?xt(e):0),e),Ss=(e,t)=>Yt(((e,t)=>L(oe(ye,e),(s=>ee(s,t)?Dt(e,s,t):0))),e,t),Is=()=>Yt((()=>Lt({}))),Ms=()=>Yt((()=>{pt({}),e=!1})),ms=()=>Yt((()=>{Vt({}),t=!1})),Rs=(e,t)=>{if(-1!=r){Ls();const s=e();return Hs(t),s}},Ls=()=>(-1!=r&&r++,1==r&&it(lt,void 0),Js),Hs=e=>(r>0&&(r--,0==r&&(r=1,Gt(1),te(A)||Ut(1),Kt(1),te(W)||Xt(1),e?.(Js)&&(ne(A,((e,t)=>ne(e,((e,s)=>ne(e,(([e],n)=>je(Js,t,s,n,e))))))),se(A),ne(W,(([e],t)=>ke(Js,t,e))),se(W)),it(rt[0],void 0),r=-1,Gt(0),te(A)||Ut(0),Kt(0),te(W)||Xt(0),d[0]?.(Js),it(rt[1],void 0),d[1]?.(Js),r=0,n=cs(),a=fs(),F([S,I,M,m,E,A,j,P,W,k],se))),Js),Js={getContent:()=>[Zt(),rs()],getTables:Zt,getTableIds:_t,getTable:e=>he(oe(ye,w(e))),getTableCellIds:es,getRowCount:ts,getRowIds:ss,getSortedRowIds:ns,getRow:(e,t)=>ge(oe(oe(ye,w(e)),w(t))),getCellIds:as,getCell:ls,getValues:rs,getValueIds:os,getValue:is,hasTables:cs,hasTable:ds,hasTableCell:us,hasRow:gs,hasCell:hs,hasValues:fs,hasValue:bs,getTablesJson:()=>Ne(ye),getValuesJson:()=>Ne(we),getJson:()=>Ne([ye,we]),getTablesSchemaJson:()=>Ne(N),getValuesSchemaJson:()=>Ne(K),getSchemaJson:()=>Ne([N,K]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>Yt((()=>{(X(e)?ys:Cs)(e),(X(t)?Is:Ts)(t)})),setTables:Cs,setTable:(e,t)=>Yt((e=>gt(t,e)?St(e,t):0),e),setRow:(e,t,s)=>Yt(((e,t)=>ht(e,t,s)?It(e,Et(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Rs((()=>{let n;return ht(e,n,t)&&(e=w(e),It(e,Et(e),n=Jt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Yt(((e,t)=>{if(ht(e,t,s,1)){const n=Et(e);Q(s,((s,a)=>mt(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>Yt(((e,t,s)=>L(ft(e,t,s,J(n)?n(ls(e,t,s)):n),(n=>mt(e,Et(e),t,s,n)))),e,t,s),setValues:Ts,setPartialValues:e=>Yt((()=>bt(e,1)?Q(e,((e,t)=>Ht(t,e))):0)),setValue:(e,t)=>Yt((e=>L(Ct(e,J(t)?t(is(e)):t),(t=>Ht(e,t)))),e),applyChanges:e=>Yt((()=>{Q(e[0],((e,t)=>R(e)?ws(t):Q(e,((e,s)=>R(e)?Ss(t,s):Q(e,((e,n)=>je(Js,t,s,n,e))))))),Q(e[1],((e,t)=>ke(Js,t,e)))})),setTablesJson:vs,setValuesJson:e=>{try{Rt(Be(e))}catch{}return Js},setJson:e=>Yt((()=>{try{const[t,s]=Be(e);yt(t),Rt(s)}catch{vs(e)}})),setTablesSchema:ps,setValuesSchema:Vs,setSchema:(e,t)=>Yt((()=>{ps(e),Vs(t)})),delTables:ys,delTable:ws,delRow:Ss,delCell:(e,t,s,n)=>Yt(((e,t,s)=>L(oe(ye,e),(a=>L(oe(a,t),(l=>ee(l,s)?Ft(e,a,t,l,s,n):0))))),e,t,s),delValues:Is,delValue:e=>Yt((e=>ee(we,e)?Ot(e):0),e),delTablesSchema:Ms,delValuesSchema:ms,delSchema:()=>Yt((()=>{Ms(),ms()})),transaction:Rs,startTransaction:Ls,getTransactionChanges:()=>[ge(A,((e,t)=>-1===oe(S,t)?void 0:ge(e,((e,s)=>-1===oe(oe(m,t),s)?void 0:ge(e,(([,e])=>e),(e=>Ae(e)))),te,X)),te,X),ge(W,(([,e])=>e),(e=>Ae(e))),1],getTransactionLog:()=>[!te(A),!te(W),fe(A,ze,Ae),fe(j),ge(W,ze,Ae),ge(k),ge(S),he(m),fe(E),ge(P)],finishTransaction:Hs,forEachTable:e=>ne(ye,((t,s)=>e(s,(e=>ne(t,((t,s)=>e(s,(e=>ie(t,e))))))))),forEachTableCell:(e,t)=>ie(oe(Ve,w(e)),t),forEachRow:(e,t)=>ne(oe(ye,w(e)),((e,s)=>t(s,(t=>ie(e,t))))),forEachCell:(e,t,s)=>ie(oe(oe(ye,w(e)),w(t)),s),forEachValue:e=>ie(we,e),addSortedRowIdsListener:(e,t,s,n,a,l,r)=>{let o=ns(e,t,s,n,a);return ot((()=>{const r=ns(e,t,s,n,a);var i,c,d;c=o,D(i=r)===D(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(o=r,l(Js,e,t,s,n,a,o))}),Ge[r?1:0],[e,t],[_t])},addStartTransactionListener:e=>ot(e,lt),addWillFinishTransactionListener:e=>ot(e,rt[0]),addDidFinishTransactionListener:e=>ot(e,rt[1]),callListener:e=>(dt(e),Js),delListener:e=>(ct(e),Js),getListenerStats:()=>({}),createStore:qe,addListener:ot,callListeners:it,setInternalListeners:(e,t)=>d=[e,t]};return Q({[c+g]:[0,Se,[],()=>[cs()]],[g]:[0,Ie],[h]:[0,Me],[c+u]:[1,me,[_t],e=>[ds(...e)]],[u]:[1,Re,[_t]],[u+v]:[1,Le,[_t]],[c+u+T]:[2,He,[_t,es],e=>[us(...e)]],[b]:[1,xe,[_t]],[C]:[1,We,[_t]],[c+f]:[2,Ke,[_t,ss],e=>[gs(...e)]],[f]:[2,Qe,[_t,ss]],[v]:[2,Ue,[_t,ss]],[c+T]:[3,Xe,[_t,ss,as],e=>[hs(...e)]],[T]:[3,Ye,[_t,ss,as],e=>Fe(ls(...e))],InvalidCell:[3,Ze],[c+V]:[0,et,[],()=>[fs()]],[V]:[0,tt],[y]:[0,st],[c+p]:[1,nt,[os],e=>[bs(...e)]],[p]:[1,at,[os],e=>Fe(is(e[0]))],InvalidValue:[1,_e]},(([e,t,s,n],a)=>{Js["add"+a+"Listener"]=(...a)=>ot(a[e],t[a[e+1]?1:0],e>0?x(a,0,e):void 0,s,n)})),B(Js)},Ge=2**36,Ke=2**30,Qe=2**24,Ue=2**18,Xe=4096,Ye=64,Ze=e=>String.fromCharCode(48+(63&e)),_e=(e,t)=>((e,t)=>e.charCodeAt(t))(e,t)-48,et={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},tt=(e="")=>[e,[Re(e),Re(e)],0];e.createMergeableStore=e=>{let t,n,a=1,l=tt();const[r,o]=(e=>{let t=0,s=-1;const n=Ve(e),a=e=>{const n=t,[a,l]=R(e)||""==e?[0,0]:[_e(r=e,0)*Ge+_e(r,1)*Ke+_e(r,2)*Qe+_e(r,3)*Ue+_e(r,4)*Xe+_e(r,5)*Ye+_e(r,6),_e(r,7)*Ue+_e(r,8)*Xe+_e(r,9)*Ye+_e(r,10),_e(r,11)*Qe+_e(r,12)*Ue+_e(r,13)*Xe+_e(r,14)*Ye+_e(r,15)];var r;t=M(n,a,Date.now()),s=t==n?t==a?M(s,l):s:t==a?l:-1};return[()=>{return a(),l=++s,r=n,Ze((e=t)/Ge)+Ze(e/Ke)+Ze(e/Qe)+Ze(e/Ue)+Ze(e/Xe)+Ze(e/Ye)+Ze(e)+Ze(l/Ue)+Ze(l/Xe)+Ze(l/Ye)+Ze(l)+Ze(r/Qe)+Ze(r/Ue)+Ze(r/Xe)+Ze(r/Ye)+Ze(r);var e,l,r},a]})(e),i=qe(),c=e=>{const t=a;return a=0,e(),a=t,b},d=(e,t=0)=>{const s={},n={},[a,[[r,o,i],c],d]=e,[,[g,h]]=l,[f,b,C]=g;if(r){let e=t?i:C^(r>f?(f?Ve(f):0)^Ve(r):0);K(o,(([n,a,l],r)=>{const o=de(b,r,Re),[i,c,d]=o;let g=t?l:d^(n>i?(i?Ve(i):0)^Ve(n):0);K(a,((e,n)=>{const[a,l]=u(e,de(c,n,Re),Y(Y(s,r,$),n,$),t);g^=t?0:(a?Ie(n,a):0)^Ie(n,l)})),Me(o,g,n),e^=t?0:(d?Ie(r,d):0)^Ie(r,o[2])})),Me(g,e,r)}return u(c,h,n,t),Me(l,t?d:g[2]^h[2],a),[s,n,1]},u=(e,t,n,a)=>{const[l,r,o]=e,[i,c,d]=t;if(l){let e=a?o:d^(l>i?(i?Ve(i):0)^Ve(l):0);K(r,(([t,l,r],o)=>{const i=de(c,o,(()=>[s,void 0,0])),[d,,u]=i;t>d&&(Me(i,a?r:Ve(Ne(l??null)+":"+t),t),i[1]=l,n[o]=l,e^=a?0:Ie(o,u)^Ie(o,i[2]))})),Me(t,e,l)}return[d,t[2]]},g=()=>[l[0],[Le(l[1][0],(e=>Le(e,(e=>Le(e))))),Le(l[1][1])],l[2]],h=()=>{if(R(n)){const[,,e,,n]=i.getTransactionLog(),a=X(e)&&X(n)?s:t??(t=r()),l=[a,[me(X(e)?s:a),me(X(n)?s:a),1]],[[,o],[,c]]=l[1];return Q(e,((e,t)=>{const[,s]=o[t]=me(a);Q(e,((e,t)=>{const[,n]=s[t]=me(a);Q(e,(([,e],t)=>n[t]=[a,e]))}))})),Q(n,(([,e],t)=>c[t]=[a,e])),l}return n},f=e=>c((()=>{o(e[0]),i.applyChanges(d(e))})),b={getId:()=>e,getMergeableContent:g,getMergeableContentHashes:()=>[l[0],[l[1][0][2],l[1][1][2]]],getMergeableTableHashes:()=>ge(l[1][0][1],Se),getMergeableTableIdsDiff:e=>{const t=[];return ie(l[1][0][1],((s,[,,n])=>{n!==e?.[s]&&z(t,s)})),t},getMergeableRowHashes:e=>$(O(e,(e=>[e,ge(oe(l[1][0][1],e)?.[1],Se)]))),getMergeableRowIdsDiff:e=>U(e,((e,t)=>{const s=[];return ie(oe(l[1][0][1],t)?.[1],((t,[,,n])=>{n!==e?.[t]&&z(s,t)})),s})),getMergeableCellHashes:e=>U(e,((e,t)=>$(O(e,(e=>[e,ge(oe(oe(l[1][0][1],t)?.[1],e)?.[1],Se)]))))),getMergeableTablesChanges:e=>{const[,[[t,s]]]=l,n={};return K(e,((e,t)=>L(oe(s,t),(([s,a])=>{const l={};K(e,((e,t)=>L(oe(a,t),(([s,n])=>{const a=ge(n,we,(([,,t],s)=>t==e?.[s]));X(a)||(l[t]=[s,a])})))),X(l)||(n[t]=[s,l])})))),[t,n]},getMergeableValuesHashes:()=>ge(l[1][1][1],Se),getMergeableValuesChanges:e=>[l[1][1][0],ge(l[1][1][1],we,(([,,t],s)=>t==e?.[s]))],setMergeableContent:e=>c((()=>(e=>He(e,(e=>E(e)&&2==D(e)&&He(e[0],(e=>Z(e,(e=>He(e,(e=>Z(e,(e=>He(e,(e=>Z(e,(e=>He(e,We)),void 0,1)))),void 0,1)))),void 0,1)))&&He(e[1],(e=>Z(e,(e=>He(e,We)),void 0,1))))))(e)?i.transaction((()=>{i.delTables().delValues(),l=tt(),o(e[0]),i.applyChanges(d(e,1))})):0)),setDefaultContent:e=>(t="0",i.setContent(e),b),getTransactionMergeableChanges:h,applyMergeableChanges:f,merge:e=>{const t=g(),s=e.getMergeableContent();return e.applyMergeableChanges(t),f(s)}};return i.setInternalListeners((()=>{a&&(n=h(),d(n))}),(()=>t=n=void 0)),Q(i,((e,t)=>b[t]=S(t,"set")||S(t,"del")||S(t,"apply")||I(t,"Transaction")||"callListener"==t?(...t)=>(e(...t),b):S(t,"add")&&I(t,"Listener")?(...s)=>{const n=et[x(t,3,-8)]??0,a=s[n];return s[n]=(e,...t)=>a(b,...t),e(...s)}:e)),B(b)}},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseMergeableStore={});
