var e,t;e=this,t=function(e,t){"use strict";const s=e=>typeof e,n="",o=s(n),r=s(!0),a=s(0),l=s(s),i="type",d="default",c="utf8",u=(e,t)=>e.includes(t),h=(e,t)=>e.every(t),f=(e,t)=>T(e)===T(t)&&h(e,((e,s)=>t[s]===e)),g=(e,t)=>h(e,((s,n)=>0==n||t(e[n-1],s)<=0)),R=(e,t)=>e.sort(t),L=(e,t)=>e.forEach(t),w=e=>I(e,((e,t)=>e+t),0),T=e=>e.length,v=e=>0==T(e),I=(e,t,s)=>e.reduce(t,s),p=(e,...t)=>e.push(...t),b=e=>e.pop(),y=e=>JSON.stringify(e,((e,t)=>k(t,Map)?I([...t],((e,[t,s])=>(e[t]=s,e)),{}):t)),S=JSON.parse,C=Math.max,m=Math.min,E=isFinite,k=(e,t)=>e instanceof t,M=e=>null==e,x=(e,t,s)=>M(e)?s?.():t(e),D=e=>e==o||e==r,A=e=>s(e)==l,F=()=>{},P=e=>e.size,J=(Q=P,e=>I(z(e),((e,t)=>e+Q(t)),0));var Q;const j=(e,t)=>e?.has(t)??!1,O=e=>M(e)||0==P(e),z=e=>[...e?.values()??[]],N=e=>e.clear(),W=(e,t)=>e?.forEach(t),B=(e,t)=>e?.delete(t),_=e=>new Map(e),q=e=>[...e?.keys()??[]],H=(e,t)=>e?.get(t),G=(e,t)=>W(e,((e,s)=>t(s,e))),K=(e,t,s)=>M(s)?(B(e,t),e):e?.set(t,s),U=(e,t,s)=>(j(e,t)||e.set(t,s()),H(e,t)),V=(e,t,s)=>{const n={},o=t??(e=>e);return W(e,((e,t)=>x(o(e),(e=>s?.(e)?0:n[t]=e)))),n},X=(e,t)=>{const s=_(),n=t??(e=>e);return W(e,((e,t)=>s.set(t,n(e)))),s},Y=e=>X(e,X),Z=(e,t,s,n,o=0)=>x((s?U:H)(e,t[o],o>T(t)-2?s:_),(r=>{if(o>T(t)-2)return n?.(r)&&K(e,t[o]),r;const a=Z(r,t,s,n,o+1);return O(r)&&K(e,t[o]),a})),$=e=>new Set(e),ee=(e,t)=>e?.add(t),te=(e,t,s)=>{const n=e.hasRow,o=_(),r=_(),a=_(),l=_(),i=_(),d=(t,s,...n)=>{const o=U(i,t,$);return L(n,(t=>ee(o,t)&&s&&e.callListener(t))),n},c=(t,...s)=>x(H(i,t),(n=>{L(v(s)?z(n):s,(t=>{e.delListener(t),B(n,t)})),O(n)&&K(i,t)})),u=(e,s)=>{K(o,e,s),j(r,e)||(K(r,e,t()),K(a,e,_()),K(l,e,_()))},h=e=>{K(o,e),K(r,e),K(a,e),K(l,e),c(e)};return[()=>e,()=>q(o),e=>G(r,e),e=>j(r,e),e=>H(o,e),e=>H(r,e),(e,t)=>K(r,e,t),u,(t,o,r,i,h)=>{u(t,o);const f=_(),g=_(),R=H(a,t),w=H(l,t),T=t=>{const r=s=>e.getCell(o,t,s),a=H(R,t),l=n(o,t)?s(i(r,t)):void 0;if(a!=l&&K(f,t,[a,l]),!M(h)){const e=H(w,t),s=n(o,t)?h(r,t):void 0;e!=s&&K(g,t,s)}},v=e=>{r((()=>{W(f,(([,e],t)=>K(R,t,e))),W(g,((e,t)=>K(w,t,e)))}),f,g,R,w,e),N(f),N(g)};G(R,T),e.hasTable(o)&&L(e.getRowIds(o),(e=>{j(R,e)||T(e)})),v(!0),c(t),d(t,0,e.addRowListener(o,null,((e,t,s)=>T(s))),e.addTableListener(o,(()=>v())))},h,()=>G(i,h),d,c]},se=(e,t)=>s(e)==o?t=>t(e):e??(()=>t??n),ne=e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))},oe=(e,t=[n])=>{const s=[],o=(e,n)=>n==T(t)?p(s,e):L([t[n],null],(t=>o(H(e,t),n+1)));return o(e,0),s},re=e=>{let t,s=0;const o=[],r=_();return[(a,l,i)=>{t??=e();const d=b(o)??n+s++;return K(r,d,[a,l,i]),ee(Z(l,i??[n],$),d),d},(e,s,...n)=>L(oe(e,s),(e=>W(e,(e=>x(H(r,e),(([e])=>e(t,...s??[],...n))))))),e=>x(H(r,e),(([,t,s])=>(Z(t,s??[n],void 0,(t=>(B(t,e),O(t)?1:0))),K(r,e),T(o)<1e3&&p(o,e),s))),(e,t)=>!h(oe(e,t),M),(e,s,n)=>x(H(r,e),(([e,,o=[]])=>{const r=(...a)=>{const l=T(a);l==T(o)?e(t,...a,...n(a)):M(o[l])?L(s[l](...a),(e=>r(...a,e))):r(...a,o[l])};r()}))]},ae=Object,le=ae.keys,ie=ae.isFrozen,de=ae.freeze,ce=(e,t)=>!M(((e,t)=>x(e,(e=>e[t])))(e,t)),ue=(e,t)=>delete e[t],he=(e,t)=>L(ae.entries(e),(([e,s])=>t(s,e))),fe=e=>v(le(e)),ge=e=>{const t=s(e);return D(t)||t==a&&E(e)?t:void 0},Re=(e,t,s,n,o)=>M(o)?e.delCell(t,s,n,!0):e.setCell(t,s,n,o),Le=ne((e=>{let t,s,o,r=100,a=_(),l=1;const i=_(),d=_(),[c,h,f]=re((()=>z)),g=_(),R=_(),w=[],I=[],y=(t,s)=>{l=0,e.transaction((()=>W(H(g,s),((s,n)=>W(s,((s,o)=>W(s,((s,r)=>Re(e,n,o,r,s[t]))))))))),l=1},S=e=>{K(g,e),K(R,e),h(d,[e])},C=(e,t)=>L(((e,t)=>e.splice(0,t))(e,t??T(e)),S),m=()=>C(w,T(w)-r),E=e.addCellListener(null,null,null,((e,s,n,r,i,d)=>{if(l){x(t,(()=>{p(w,t),m(),C(I),t=void 0,o=1}));const e=U(a,s,_),l=U(e,n,_),c=U(l,r,(()=>[d,void 0]));c[1]=i,c[0]===i&&O(K(l,r))&&O(K(e,n))&&O(K(a,s))&&(t=b(w),o=1),F()}})),k=(e="")=>(M(t)&&(t=n+s++,K(g,t,a),J(t,e),a=_(),o=1),t),D=()=>{v(w)||(I.unshift(k()),y(0,t),t=b(w),o=1)},A=()=>{v(I)||(p(w,t),t=I.shift(),y(1,t),o=1)},F=()=>{o&&(h(i),o=0)},P=e=>{const t=k(e);return F(),t},J=(e,t)=>(Q(e)&&H(R,e)!==t&&(K(R,e,t),h(d,[e])),z),Q=e=>j(g,e),z={setSize:e=>(r=e,m(),z),addCheckpoint:P,setCheckpoint:J,getStore:()=>e,getCheckpointIds:()=>[[...w],t,[...I]],forEachCheckpoint:e=>G(R,e),hasCheckpoint:Q,getCheckpoint:e=>H(R,e),goBackward:()=>(D(),F(),z),goForward:()=>(A(),F(),z),goTo:e=>{const s=u(w,e)?D:u(I,e)?A:null;for(;!M(s)&&e!=t;)s();return F(),z},addCheckpointIdsListener:e=>c(e,i),addCheckpointListener:(e,t)=>c(t,d,[e]),delListener:e=>(f(e),z),clear:()=>(C(w),C(I),M(t)||S(t),t=void 0,s=0,P(),z),destroy:()=>{e.delListener(E)},getListenerStats:()=>({})};return de(z.clear())})),we=(e,t)=>e<t?-1:1,Te=ne((e=>{const t=_(),s=_(),[o,r,a,l,i,d,c,,u,h,f]=te(e,_,(e=>M(e)?n:e+n)),[L,w,T]=re((()=>I)),v=(t,s,n)=>{const o=i(t);W(n,((t,n)=>s(n,(s=>W(t,(t=>s(t,(s=>e.forEachCell(o,t,s)))))))))},I={setIndexDefinition:(e,n,o,r,a,l=we)=>{const i=M(a)?void 0:([e],[t])=>a(e,t);return u(e,n,((n,o,a,u,h,f)=>{let L=0;const T=$(),v=$(),I=d(e);if(W(o,(([e,t],s)=>{M(e)||(ee(T,e),x(H(I,e),(t=>{B(t,s),O(t)&&(K(I,e),L=1)}))),M(t)||(ee(T,t),j(I,t)||(K(I,t,$()),L=1),ee(H(I,t),s),M(r)||ee(v,t))})),n(),O(h)||(f?G(I,(e=>ee(v,e))):G(a,(e=>x(H(u,e),(e=>ee(v,e))))),W(v,(e=>{const t=(t,s)=>l(H(h,t),H(h,s),e),s=[...H(I,e)];g(s,t)||(K(I,e,$(R(s,t))),ee(T,e))}))),(L||f)&&!M(i)){const t=[...I];g(t,i)||(c(e,_(R(t,i))),L=1)}L&&w(t,[e]),W(T,(t=>w(s,[e,t])))}),se(o),x(r,se)),I},delIndexDefinition:e=>(h(e),I),getStore:o,getIndexIds:r,forEachIndex:e=>a(((t,s)=>e(t,(e=>v(t,e,s))))),forEachSlice:(e,t)=>v(e,t,d(e)),hasIndex:l,hasSlice:(e,t)=>j(d(e),t),getTableId:i,getSliceIds:e=>q(d(e)),getSliceRowIds:(e,t)=>z(H(d(e),t)),addSliceIdsListener:(e,s)=>L(s,t,[e]),addSliceRowIdsListener:(e,t,n)=>L(n,s,[e,t]),delListener:e=>(T(e),I),destroy:f,getListenerStats:()=>({})};return de(I)})),ve=_([["avg",[(e,t)=>w(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>C(...e),(e,t)=>C(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:C(t,e)]],["min",[e=>m(...e),(e,t)=>m(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:m(t,e)]],["sum",[e=>w(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),Ie=(e,t,s,n,o,r=!1)=>{if(O(s))return;const[a,l,i,d]=o;return r||=M(e),W(n,(([s,n])=>{r||(e=M(s)?l?.(e,n,t++):M(n)?i?.(e,s,t--):d?.(e,n,s,t),r||=M(e))})),r?a(z(s),P(s)):e},pe=ne((e=>{const t=_(),[s,o,r,a,l,i,d,,c,u,h]=te(e,F,(e=>isNaN(e)||M(e)||!0===e||!1===e||e===n?void 0:1*e)),[f,g,R]=re((()=>L)),L={setMetricDefinition:(e,s,n,o,r,a,l)=>{const u=A(n)?[n,r,a,l]:H(ve,n)??H(ve,"sum");return c(e,s,((s,n,o,r,a,l)=>{const c=i(e),h=P(r);l||=M(c),s();let f=Ie(c,h,r,n,u,l);E(f)||(f=void 0),f!=c&&(d(e,f),g(t,[e],f,c))}),se(o,1)),L},delMetricDefinition:e=>(u(e),L),getStore:s,getMetricIds:o,forEachMetric:r,hasMetric:a,getTableId:l,getMetric:i,addMetricListener:(e,s)=>f(s,t,[e]),delListener:e=>(R(e),L),destroy:h,getListenerStats:()=>({})};return de(L)})),be=(e,t,s,o,r)=>{let a,l=0;const i={load:async s=>{if(2!=l){l=1;const o=await t();M(o)||o==n?e.setTables(s):e.setJson(o),l=0}return i},startAutoLoad:async e=>(i.stopAutoLoad(),await i.load(e),o(i.load),i),stopAutoLoad:()=>(r(),i),save:async()=>(1!=l&&(l=2,await s(e.getJson()),l=0),i),startAutoSave:async()=>(await i.stopAutoSave().save(),a=e.addTablesListener((()=>i.save())),i),stopAutoSave:()=>(x(a,e.delListener),i),getStore:()=>e,destroy:()=>i.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return de(i)},ye="storage",Se=globalThis.window,Ce=(e,t,s)=>{let n;return be(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{n=n=>{n.storageArea===s&&n.key===t&&e()},Se.addEventListener(ye,n)}),(()=>{Se.removeEventListener(ye,n),n=void 0}))},me=e=>e.headers.get("ETag"),Ee=ne((e=>{const[t,s,o,r,a,,,l,,i,d,c,u]=te(e,(()=>!0),F),g=e.createStore(),w=e.createStore(),I=e.createStore(),b=_(),y=(e,t,...s)=>L(s,(s=>ee(U(U(b,t,_),e,$),s))),S=(e,t,s)=>c(e,0,t.addWillFinishTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),C={setQueryDefinition:(t,s,o)=>{let r;l(t,s),g.delTable(t),w.delTable(t),I.delTable(t);const a=[],i=[[null,[s,null,null,[],_()]]],d=[],b=[],m=[],E=[];o({select:(e,t)=>{const s=A(e)?[T(a)+n,e]:[M(t)?e:t,s=>s(e,t)];return p(a,s),{as:e=>s[0]=e}},join:(e,t,s)=>{const n=M(s)||A(t)?null:t,o=M(n)?t:s,r=[e,[e,n,A(o)?o:e=>e(o),[],_()]];return p(i,r),{as:e=>r[0]=e}},where:(e,t,s)=>p(d,A(e)?e:M(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,o)=>{const r=[e,[e,A(t)?[t,s,n,o]:H(ve,t)??[(e,t)=>t]]];return p(b,r),{as:e=>r[0]=e}},having:(e,t)=>p(m,A(e)?e:s=>s(e)===t),order:(e,t)=>p(E,[A(e)?e:t=>t(e)??0,t]),limit:(e,t)=>{r=M(t)?[0,e]:[e,t]}});const k=_(a);if(O(k))return C;const D=_(i);G(D,((e,[,t])=>x(H(D,t),(({3:t})=>M(e)?0:p(t,e)))));const F=_(b);let J=g,Q=w;if(v(E)&&M(r))Q=I;else{S(t,Q,I);const e=(e,t)=>{const n=H(s,e)??[],o=H(s,t)??[],r=E.findIndex(((e,t)=>n[t]!==o[t]));return r<0?0:we(n[r],o[r])*(E[r][1]?-1:1)},s=_(),n=_();y(Q,t,v(E)?Q.addRowIdsListener(t,(()=>N(n))):Q.addRowListener(t,null,((e,o,r)=>{let a=null;if(Q.hasRow(t,r)){const e=H(s,r)??[],o=Q.getRow(t,r),i=e=>o[e];if(l=([e])=>e(i,r),a=E.map(l),f(e,a))return void(H(n,r)&&I.setRow(t,r,o))}var l;K(s,r,a),N(n)})),Q.addTableListener(t,(()=>{if(O(n)&&(I.delTable(t),Q.hasTable(t))){const s=Q.getTable(t);L(R(le(s),e),(e=>K(n,e,0))),L(x(r,(([e,t])=>{return s=q(n),o=e,r=e+t,s.slice(o,r);var s,o,r}),(()=>q(n))),(e=>{I.setRow(t,e,s[e]),K(n,e,1)}))}})))}if(O(F)&&v(m))J=Q;else{S(t,J,Q);const e=_();G(F,((t,[s,n])=>ee(U(e,s,$),[t,n])));const s=$();G(k,(t=>j(e,t)?0:ee(s,t)));const n=_(),o=(s,n,o,r)=>x(s,(([s,a,l,i])=>{G(n,((t,[n])=>{const a=U(s,t,_),l=H(a,o),d=r?void 0:n;if(l!==d){const s=$([[l,d]]),n=P(a);K(a,o,d),W(H(e,t),(([e,t])=>{const o=Ie(i[e],n,a,s,t);i[e]=M(ge(o))?null:o}))}})),(O(a)||!h(m,(e=>e((e=>i[e]))))?Q.delRow:Q.setRow)(t,l,i)}));y(J,t,J.addRowListener(t,null,((r,a,l,i)=>{const d=[],c=[],u=_(),h=J.hasRow(t,l);let f=!h;W(s,(e=>{const[s,n,o]=i(t,l,e);p(d,n),p(c,o),f||=s})),G(e,(e=>{const[s,,n]=i(t,l,e);(f||s)&&K(u,e,[n])})),f&&o(Z(n,d,void 0,(([,e,s])=>{if(B(e,l),O(e))return Q.delRow(t,s),1})),u,l,1),h&&o(Z(n,c,(()=>{const e={};return W(s,(s=>e[s]=J.getCell(t,l,s))),[_(),$(),Q.addRow(t,e,1),e]}),(([,e])=>{ee(e,l)})),u,l)})))}S(t,e,J);const z=(n,o,r,a)=>{const l=t=>e.getCell(o,r,t);L(a,(s=>{const[o,,r,a,i]=H(D,s),d=r?.(l,n),[h,f]=H(i,n)??[];d!=h&&(M(f)||u(t,f),K(i,n,M(d)?null:[d,...c(t,1,e.addRowListener(o,d,(()=>z(n,o,d,a))))]))})),(n=>{const o=(t,o)=>e.getCell(...M(o)?[s,n,t]:t===s?[s,n,o]:[H(D,t)?.[0],H(H(D,t)?.[4],n)?.[0],o]);J.transaction((()=>h(d,(e=>e(o)))?G(k,((e,s)=>Re(J,t,n,e,s(o,n)))):J.delRow(t,n)))})(n)},{3:V}=H(D,null);return J.transaction((()=>c(t,1,e.addRowListener(s,null,((n,o,r)=>{e.hasRow(s,r)?z(r,s,r,V):(J.delRow(t,r),W(D,(({4:e})=>x(H(e,r),(([,s])=>{u(t,s),K(e,r)})))))}))))),C},delQueryDefinition:e=>(G(H(b,e),((e,t)=>W(t,(t=>e.delListener(t))))),i(e),C),getStore:t,getQueryIds:s,forEachQuery:o,hasQuery:r,getTableId:a,getResultTable:e=>I.getTable(e),getResultRowIds:e=>I.getRowIds(e),getResultRow:(e,t)=>I.getRow(e,t),getResultCellIds:(e,t)=>I.getCellIds(e,t),getResultCell:(e,t,s)=>I.getCell(e,t,s),hasResultTable:e=>I.hasTable(e),hasResultRow:(e,t)=>I.hasRow(e,t),hasResultCell:(e,t,s)=>I.hasCell(e,t,s),forEachResultTable:e=>I.forEachTable(e),forEachResultRow:(e,t)=>I.forEachRow(e,t),forEachResultCell:(e,t,s)=>I.forEachCell(e,t,s),addResultTableListener:(e,t)=>I.addTableListener(e,((e,...s)=>t(C,...s))),addResultRowIdsListener:(e,t,s)=>I.addRowIdsListener(e,((e,...s)=>t(C,...s)),s),addResultRowListener:(e,t,s)=>I.addRowListener(e,t,((e,...t)=>s(C,...t))),addResultCellIdsListener:(e,t,s)=>I.addCellIdsListener(e,t,((e,...t)=>s(C,...t))),addResultCellListener:(e,t,s,n)=>I.addCellListener(e,t,s,((e,...t)=>n(C,...t))),delListener:e=>(I.delListener(e),C),destroy:d,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=I.getListenerStats();return n}};return de(C)})),ke=ne((e=>{const t=_(),s=_(),o=_(),r=_(),[a,l,i,d,c,u,,,h,f,g]=te(e,(()=>[_(),_(),_(),_()]),(e=>M(e)?void 0:e+n)),[R,L,w]=re((()=>p)),T=(e,t,s)=>x(u(e),(([n,,o])=>{if(!j(o,t)){const r=$();if(c(e)!=I(e))ee(r,t);else{let e=t;for(;!M(e)&&!j(r,e);)ee(r,e),e=H(n,e)}if(s)return r;K(o,t,r)}return H(o,t)})),v=(e,t)=>x(u(e),(([,,e])=>K(e,t))),I=e=>H(t,e),p={setRelationshipDefinition:(e,n,a,l)=>(K(t,e,a),h(e,n,((t,n)=>{const a=$(),l=$(),i=$(),[d,c]=u(e);W(n,(([t,s],n)=>{M(t)||(ee(l,t),x(H(c,t),(e=>{B(e,n),O(e)&&K(c,t)}))),M(s)||(ee(l,s),j(c,s)||K(c,s,$()),ee(H(c,s),n)),ee(a,n),K(d,n,s),G(H(r,e),(t=>{j(T(e,t),n)&&ee(i,t)}))})),t(),W(a,(t=>L(s,[e,t]))),W(l,(t=>L(o,[e,t]))),W(i,(t=>{v(e,t),L(r,[e,t])}))}),se(l)),p),delRelationshipDefinition:e=>(K(t,e),f(e),p),getStore:a,getRelationshipIds:l,forEachRelationship:t=>i((s=>t(s,(t=>e.forEachRow(c(s),t))))),hasRelationship:d,getLocalTableId:c,getRemoteTableId:I,getRemoteRowId:(e,t)=>H(u(e)?.[0],t),getLocalRowIds:(e,t)=>z(H(u(e)?.[1],t)),getLinkedRowIds:(e,t)=>M(u(e))?[t]:z(T(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>R(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>R(s,o,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(T(e,t),R(s,r,[e,t])),delListener:e=>(v(...w(e)),p),destroy:g,getListenerStats:()=>({})};return de(p)})),Me=e=>[e,e],xe=e=>0==((e,t=J)=>t(e[0])+t(e[1]))(e),De=()=>[_(),_()],Ae=()=>[De(),De()],Fe=(e,t,s,n=K)=>{const o=(r=q(e),a=e=>!ce(t,e),r.filter(a));var r,a;return L(le(t),(n=>s(e,n,t[n]))),L(o,(t=>n(e,t))),e},Pe=(e,t,s)=>M(e)||!(e=>k(e,ae)&&e.constructor==ae)(e)||fe(e)||ie(e)?(s?.(),!1):(he(e,((s,n)=>{t(s,n)||ue(e,n)})),!fe(e)),Je=(e,t,s)=>K(e,t,H(e,t)==-s?void 0:s),Qe=()=>{let e,t,s=0,o=0;const r=_(),l=_(),c=_(),h=_(),g=_(),R=_(),w=_(),T=_(),v=De(),I=Ae(),b=De(),C=Ae(),m=De(),E=Ae(),k=De(),F=De(),J=De(),[Q,z,B,Z,te]=re((()=>et)),se=(t,s)=>(!e||j(R,s)||ke(s))&&Pe(t,((e,t)=>ne(s,t,e)),(()=>ke(s))),ne=(e,t,s,n)=>Pe(n?s:ae(s,e,t),((n,o)=>x(oe(e,t,o,n),(e=>(s[o]=e,!0)),(()=>!1))),(()=>ke(e,t))),oe=(t,s,n,o)=>e?x(H(H(R,t),n),(e=>ge(o)!=e.type?ke(t,s,n,o,e.default):o),(()=>ke(t,s,n,o))):M(ge(o))?ke(t,s,n,o):o,ae=(e,t,s)=>(x(H(w,t),(([n,o])=>{W(n,((t,s)=>{ce(e,s)||(e[s]=t)})),W(o,(n=>{ce(e,n)||ke(t,s,n)}))})),e),le=e=>Fe(R,e,((e,t,s)=>{const n=_(),o=$();Fe(U(R,t,_),s,((e,t,s)=>{K(e,t,s),x(s.default,(e=>K(n,t,e)),(()=>ee(o,t)))})),K(w,t,[n,o])}),((e,t)=>{K(R,t),K(w,t)})),ie=e=>Fe(T,e,((e,t,s)=>Re(t,s)),((e,t)=>pe(t))),Re=(e,t)=>Fe(U(T,e,(()=>(Se(e,1),_()))),t,((t,s,n)=>Le(e,t,s,n)),((t,s)=>be(e,t,s))),Le=(e,t,s,n,o)=>Fe(U(t,s,(()=>(Ce(e,s,1),_()))),n,((t,n,o)=>we(e,s,t,n,o)),((n,r)=>ye(e,t,s,n,r,o))),we=(e,t,s,n,o)=>{j(s,n)||me(e,t,n,1);const r=H(s,n);o!==r&&(Ee(e,t,n,r,o),K(s,n,o))},Te=(e,t,s,n,o)=>x(H(t,s),(t=>we(e,s,t,n,o)),(()=>Le(e,t,s,ae({[n]:o},e,s)))),ve=e=>{const t=n+s++;return j(e,t)?ve(e):t},Ie=e=>H(T,e)??Re(e,{}),pe=e=>Re(e,{}),be=(e,t,s)=>Le(e,t,s,{},!0),ye=(e,t,s,n,o,r)=>{const a=H(H(w,e)?.[0],o);if(!M(a)&&!r)return we(e,s,n,o,a);const l=t=>{Ee(e,s,t,H(n,t)),me(e,s,t,-1),K(n,t)};M(a)?l(o):G(n,l),O(n)&&(Ce(e,s,-1),O(K(t,s))&&(Se(e,-1),K(T,e)))},Se=(e,t)=>Je(O(r)?K(r,null,Z(I[0][1])||Z(I[1][1])?_e():0):r,e,t),Ce=(e,t,s)=>Je(U(l,e,(()=>_([[null,Z(C[0][1],[e])||Z(C[1][1],[e])?qe(e):0]]))),t,s),me=(e,t,s,n)=>Je(U(U(c,e,_),t,(()=>_([[null,Z(E[0][1],[e,t])||Z(E[1][1],[e,t])?He(e,t):0]]))),s,n),Ee=(e,t,s,n,o)=>U(U(U(h,e,_),t,_),s,(()=>[n,0]))[1]=o,ke=(e,t,s,n,o)=>(p(U(U(U(g,e,_),t,_),s,(()=>[])),n),o),je=(e,t,s)=>x(H(H(H(h,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Me(Ge(e,t,s))])),Oe=e=>O(g)||O(F[e])?0:W(e?X(g,Y):g,((t,s)=>W(t,((t,n)=>W(t,((t,o)=>z(F[e],[s,n,o],t))))))),ze=(e,t,s,n)=>{P(t)>1?(z(e[0],n),z(e[1],n)):O(t)||0==H(t,null)||f(H(t,null),s(...n??[]))||z(e[1],n)},Ne=e=>{const t=xe(E[e])&&xe(C[e])&&xe(I[e]),s=O(k[e])&&O(m[e])&&O(b[e])&&O(v[e]);if(!t||!s){const n=e?[X(r),Y(l),X(c,Y),X(h,Y)]:[r,l,c,h];if(t||(W(n[2],((t,s)=>W(t,((t,n)=>ze(E[e],t,He,[s,n]))))),W(n[1],((t,s)=>ze(C[e],t,qe,[s]))),ze(I[e],n[0],_e)),!s){let t;W(n[3],((s,n)=>{let o;W(s,((s,r)=>{let a;W(s,(([s,l],i)=>{l!==s&&(z(k[e],[n,r,i],l,s,je),t=o=a=1)})),a&&z(m[e],[n,r],je)})),o&&z(b[e],[n],je)})),t&&z(v[e],void 0,je)}}},We=e=>(Ye(e),et),Be=()=>V(T,(e=>V(e,V))),_e=()=>q(T),qe=e=>q(H(T,e)),He=(e,t)=>q(H(H(T,e),t)),Ge=(e,t,s)=>H(H(H(T,e),t),s),Ke=e=>We((()=>(e=>Pe(e,se,ke))(e)?ie(e):0)),Ue=(e,t,s,n)=>We((()=>x(oe(e,t,s,A(n)?n(Ge(e,t,s)):n),(n=>Te(e,Ie(e),t,s,n))))),Ve=()=>We((()=>ie({}))),Xe=(e,t,s,n)=>We((()=>x(H(T,e),(o=>x(H(o,t),(r=>j(r,s)?ye(e,o,t,r,s,n):0)))))),Ye=(e,t)=>{if(-1==o)return;Ze();const s=e?.();return $e(t),s},Ze=()=>(o++,et),$e=e=>(o>0&&(o--,0==o&&(t=!O(h),o=1,Oe(1),t&&Ne(1),o=-1,e?.(V(h,(e=>V(e,(e=>V(e,(e=>[...e]),(([e,t])=>e===t))),fe)),fe),V(g,(e=>V(e,V))))&&(o=1,W(h,((e,t)=>W(e,((e,s)=>W(e,(([e],n)=>M(e)?Xe(t,s,n,!0):Ue(t,s,n,e))))))),o=-1,t=!1),z(J[0],void 0,t),Oe(0),t&&Ne(0),z(J[1],void 0,t),o=0,L([h,g,r,l,c],N))),et),et={getTables:Be,getTableIds:_e,getTable:e=>V(H(T,e),V),getRowIds:qe,getRow:(e,t)=>V(H(H(T,e),t)),getCellIds:He,getCell:Ge,hasTables:()=>!O(T),hasTable:e=>j(T,e),hasRow:(e,t)=>j(H(T,e),t),hasCell:(e,t,s)=>j(H(H(T,e),t),s),getJson:()=>y(T),getSchemaJson:()=>y(R),setTables:Ke,setTable:(e,t)=>We((()=>se(t,e)?Re(e,t):0)),setRow:(e,t,s)=>We((()=>ne(e,t,s)?Le(e,Ie(e),t,s):0)),addRow:(e,t,s)=>Ye((()=>{const n=ne(e,void 0,t),o=n||s?ve(H(T,e)):void 0;return n&&Le(e,Ie(e),o,t),o})),setPartialRow:(e,t,s)=>We((()=>{if(ne(e,t,s,1)){const n=Ie(e);he(s,((s,o)=>Te(e,n,t,o,s)))}})),setCell:Ue,setJson:e=>{try{"{}"===e?Ve():Ke(S(e))}catch{}return et},setSchema:t=>We((()=>{if((e=(e=>Pe(e,(e=>Pe(e,(e=>{if(!Pe(e,((e,t)=>u([i,d],t))))return!1;const t=e.type;return!(!D(t)&&t!=a||(ge(e.default)!=t&&ue(e,d),0))})))))(t))&&(le(t),!O(T))){const e=Be();Ve(),Ke(e)}})),delTables:Ve,delTable:e=>We((()=>j(T,e)?pe(e):0)),delRow:(e,t)=>We((()=>x(H(T,e),(s=>j(s,t)?be(e,s,t):0)))),delCell:Xe,delSchema:()=>We((()=>{le({}),e=!1})),transaction:Ye,startTransaction:Ze,finishTransaction:$e,forEachTable:e=>W(T,((t,s)=>e(s,(e=>W(t,((t,s)=>e(s,(e=>G(t,e))))))))),forEachRow:(e,t)=>W(H(T,e),((e,s)=>t(s,(t=>G(e,t))))),forEachCell:(e,t,s)=>G(H(H(T,e),t),s),addTablesListener:(e,t)=>Q(e,v[t?1:0]),addTableIdsListener:(e,t,s)=>Q(e,I[s?1:0][t?1:0]),addTableListener:(e,t,s)=>Q(t,b[s?1:0],[e]),addRowIdsListener:(e,t,s,n)=>Q(t,C[n?1:0][s?1:0],[e]),addRowListener:(e,t,s,n)=>Q(s,m[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n,o)=>Q(s,E[o?1:0][n?1:0],[e,t]),addCellListener:(e,t,s,n,o)=>Q(n,k[o?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,o)=>Q(n,F[o?1:0],[e,t,s]),addWillFinishTransactionListener:e=>Q(e,J[0]),addDidFinishTransactionListener:e=>Q(e,J[1]),callListener:e=>(te(e,[_e,qe,He],(e=>M(e[2])?[]:Me(Ge(...e)))),et),delListener:e=>(B(e),et),getListenerStats:()=>({}),createStore:Qe};return de(et)};e.createCheckpoints=Le,e.createCustomPersister=be,e.createFilePersister=(e,s)=>{let n;return be(e,(async()=>{try{return await t.promises.readFile(s,c)}catch{}}),(async e=>{try{await t.promises.writeFile(s,e,c)}catch{}}),(e=>{n=t.watch(s,e)}),(()=>{n?.close(),n=void 0}))},e.createIndexes=Te,e.createLocalPersister=(e,t)=>Ce(e,t,localStorage),e.createMetrics=pe,e.createQueries=Ee,e.createRelationships=ke,e.createRemotePersister=(e,t,s,n)=>{let o,r;return be(e,(async()=>{const e=await fetch(t);return r=me(e),e.text()}),(async e=>await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>{o=setInterval((async()=>{const s=await fetch(t,{method:"HEAD"}),n=me(s);M(r)||M(n)||n==r||(r=n,e())}),1e3*n)}),(()=>{x(o,clearInterval),o=void 0}))},e.createSessionPersister=(e,t)=>Ce(e,t,sessionStorage),e.createStore=Qe,e.defaultSorter=we,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={},e.fs);
