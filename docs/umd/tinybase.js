var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),o=t(0),r=t(t),l="type",i="default",c="Listener",d="Result",u="add",g="Has",h="Ids",f="Table",b=f+"s",C=f+h,w="Row",L=w+"Count",y=w+h,p="Sorted"+w+h,v="Cell",T=v+h,S="Value",I=S+"s",R=S+h,M=e=>s+e,m=(e,t)=>e.startsWith(t),V=(e,t)=>e.endsWith(t),A=Promise,E=Math.max,H=Math.min,D=isFinite,k=e=>null==e,x=(e,t,s)=>k(e)?s?.():t(e),J=e=>e==n||e==a,F=e=>t(e)==n,Q=e=>t(e)==r,z=e=>Array.isArray(e),N=(e,t,s)=>e.slice(t,s),P=e=>e.length,O=()=>{},W=(e,t)=>e.includes(t),j=(e,t)=>e.every(t),$=(e,t)=>P(e)===P(t)&&j(e,((e,s)=>t[s]===e)),B=(e,t)=>j(e,((s,n)=>0==n||t(e[n-1],s)<=0)),_=(e,t)=>e.sort(t),q=(e,t)=>e.forEach(t),G=(e,t)=>e.map(t),K=e=>X(e,((e,t)=>e+t),0),U=e=>0==P(e),X=(e,t,s)=>e.reduce(t,s),Y=(e,...t)=>e.push(...t),Z=e=>e.pop(),ee=e=>e.shift(),te=Object,se=e=>te.getPrototypeOf(e),ne=te.entries,ae=te.isFrozen,oe=e=>!k(e)&&x(se(e),(e=>e==te.prototype||k(se(e))),(()=>!0)),re=te.keys,le=te.freeze,ie=(e=[])=>te.fromEntries(e),ce=(e,t)=>t in e,de=(e,t)=>(delete e[t],e),ue=(e,t)=>q(ne(e),(([e,s])=>t(s,e))),ge=(e,t)=>G(ne(e),(([e,s])=>t(s,e))),he=(e,t)=>ie(ge(e,((e,s)=>[s,t(e,s)]))),fe=e=>oe(e)&&0==(e=>P(re(e)))(e),be=(e,t,s)=>(ce(e,t)||(e[t]=s()),e[t]),Ce=(e,t,s,n=0)=>k(e)||!oe(e)||!n&&fe(e)||ae(e)?(s?.(),!1):(ge(e,((s,n)=>{t(s,n)||de(e,n)})),!!n||!fe(e)),we=e=>e?.size??0,Le=(e,t)=>e?.has(t)??!1,ye=e=>k(e)||0==we(e),pe=e=>[...e?.values()??[]],ve=e=>e.clear(),Te=(e,t)=>e?.forEach(t),Se=(e,t)=>e?.delete(t),Ie=e=>new Map(e),Re=e=>[...e?.keys()??[]],Me=(e,t)=>e?.get(t),me=(e,t)=>Te(e,((e,s)=>t(s,e))),Ve=(e,t,s)=>k(s)?(Se(e,t),e):e?.set(t,s),Ae=(e,t,s,n)=>(Le(e,t)?n?.(Me(e,t)):Ve(e,t,s()),Me(e,t)),Ee=(e,t,s,n=Ve)=>(ge(t,((t,n)=>s(e,n,t))),me(e,(s=>ce(t,s)?0:n(e,s))),e),He=(e,t,s,n)=>{const a={};return Te(e,((e,o)=>{if(!s?.(e,o)){const s=t?t(e,o):e;!n?.(s)&&(a[o]=s)}})),a},De=(e,t,s)=>He(e,(e=>He(e,t,s)),ye,fe),ke=(e,t,s)=>He(e,(e=>De(e,t,s)),ye,fe),xe=(e,t)=>{const s=Ie();return Te(e,((e,n)=>s.set(n,t?.(e)??e))),s},Je=e=>xe(e,xe),Fe=e=>xe(e,Je),Qe=(e,t,s,n,a=0)=>x((s?Ae:Me)(e,t[a],a>P(t)-2?s:Ie),(o=>{if(a>P(t)-2)return n?.(o)&&Ve(e,t[a]),o;const r=Qe(o,t,s,n,a+1);return ye(o)&&Ve(e,t[a]),r})),ze=e=>{const s=t(e);return J(s)||s==o&&D(e)?s:void 0},Ne=e=>null===e||!k(ze(e)),Pe=(e,t,s,n,a)=>k(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a),Oe=(e,t,s)=>k(s)?e.delValue(t):e.setValue(t,s),We=e=>new Set(z(e)||k(e)?e:[e]),je=(e,t)=>e?.add(t),$e=(e,t,s,n,a)=>{const o=e.hasRow,r=Ie(),l=Ie(),i=Ie(),c=Ie(),d=Ie(),u=Ie(),g=(t,s,...n)=>{const a=Ae(u,t,We);return q(n,(t=>je(a,t)&&s&&e.callListener(t))),n},h=(t,...s)=>x(Me(u,t),(n=>{q(U(s)?pe(n):s,(t=>{e.delListener(t),Se(n,t)})),ye(n)&&Ve(u,t)})),f=(e,s)=>{Ve(r,e,s),Le(l,e)||(Ve(l,e,t()),Ve(c,e,Ie()),Ve(d,e,Ie()),a(i))},b=e=>{Ve(r,e),Ve(l,e),Ve(c,e),Ve(d,e),h(e),a(i)};return[()=>e,()=>Re(r),e=>me(l,e),e=>Le(l,e),e=>Me(r,e),e=>Me(l,e),(e,t)=>Ve(l,e,t),f,(t,n,a,r,l)=>{f(t,n);const i=Ie(),u=Ie(),b=Me(c,t),C=Me(d,t),w=t=>{const a=s=>e.getCell(n,t,s),c=Me(b,t),d=o(n,t)?s(r(a,t)):void 0;if(c===d||z(c)&&z(d)&&$(c,d)||Ve(i,t,[c,d]),!k(l)){const e=Me(C,t),s=o(n,t)?l(a,t):void 0;e!=s&&Ve(u,t,s)}},L=e=>{a((()=>{Te(i,(([,e],t)=>Ve(b,t,e))),Te(u,((e,t)=>Ve(C,t,e)))}),i,u,b,C,e),ve(i),ve(u)};me(b,w),e.hasTable(n)&&q(e.getRowIds(n),(e=>{Le(b,e)||w(e)})),L(!0),h(t),g(t,0,e.addRowListener(n,null,((e,t,s)=>w(s))),e.addTableListener(n,(()=>L())))},b,e=>n(e,i),()=>me(u,b),g,h]},Be=(e,t)=>F(e)?t=>t(e):e??(()=>t??s),_e=(e,t)=>{const s=new WeakMap;return n=>{s.has(n)||s.set(n,e(n));const a=s.get(n);return t?.(a),a}},qe=/^\d+$/,Ge=()=>{const e=[];let t=0;return[n=>(n?ee(e):null)??s+t++,t=>{qe.test(t)&&P(e)<1e3&&Y(e,t)}]},Ke=e=>{let t;const[n,a]=Ge(),o=Ie();return[(a,r,l,i=[],c=(()=>[]))=>{t??=e();const d=n(1);return Ve(o,d,[a,r,l,i,c]),je(Qe(r,l??[s],We),d),d},(e,n,...a)=>q(((e,t=[s])=>{const n=[],a=(e,s)=>s==P(t)?Y(n,e):null===t[s]?Te(e,(e=>a(e,s+1))):q([t[s],null],(t=>a(Me(e,t),s+1)));return a(e,0),n})(e,n),(e=>Te(e,(e=>Me(o,e)[0](t,...n??[],...a))))),e=>x(Me(o,e),(([,t,n])=>(Qe(t,n??[s],void 0,(t=>(Se(t,e),ye(t)?1:0))),Ve(o,e),a(e),n))),e=>x(Me(o,e),(([e,,s=[],n,a])=>{const o=(...r)=>{const l=P(r);l==P(s)?e(t,...r,...a(r)):k(s[l])?q(n[l]?.(...r)??[],(e=>o(...r,e))):o(...r,s[l])};o()}))]},Ue=_e((e=>{let t,n,a,o=100,r=Ie(),l=Ie(),i=1;const c=Ie(),d=Ie(),[u,g,h]=Ke((()=>J)),f=Ie(),b=Ie(),C=[],w=[],L=(t,s)=>{i=0,e.transaction((()=>{const[n,a]=Me(f,s);Te(n,((s,n)=>Te(s,((s,a)=>Te(s,((s,o)=>Pe(e,n,a,o,s[t]))))))),Te(a,((s,n)=>Oe(e,n,s[t])))})),i=1},y=e=>{Ve(f,e),Ve(b,e),g(d,[e])},p=(e,t)=>q(((e,t)=>e.splice(0,t))(e,t??P(e)),y),v=()=>p(C,P(C)-o),T=()=>x(t,(()=>{Y(C,t),v(),p(w),t=void 0,a=1})),S=()=>{t=Z(C),a=1};let I,R;const M=(e="")=>(k(t)&&(t=s+n++,Ve(f,t,[r,l]),H(t,e),r=Ie(),l=Ie(),a=1),t),m=()=>{U(C)||(((e,...t)=>{e.unshift(...t)})(w,M()),L(0,t),t=Z(C),a=1)},V=()=>{U(w)||(Y(C,t),t=ee(w),L(1,t),a=1)},A=()=>{a&&(g(c),a=0)},E=e=>{const t=M(e);return A(),t},H=(e,t)=>(D(e)&&Me(b,e)!==t&&(Ve(b,e,t),g(d,[e])),J),D=e=>Le(f,e),J={setSize:e=>(o=e,v(),J),addCheckpoint:E,setCheckpoint:H,getStore:()=>e,getCheckpointIds:()=>[[...C],t,[...w]],forEachCheckpoint:e=>me(b,e),hasCheckpoint:D,getCheckpoint:e=>Me(b,e),goBackward:()=>(m(),A(),J),goForward:()=>(V(),A(),J),goTo:e=>{const s=W(C,e)?m:W(w,e)?V:null;for(;!k(s)&&e!=t;)s();return A(),J},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(h(e),J),clear:()=>(p(C),p(w),k(t)||y(t),t=void 0,n=0,E(),J),clearForward:()=>(U(w)||(p(w),g(c)),J),destroy:()=>{e.delListener(I),e.delListener(R)},getListenerStats:()=>({}),_registerListeners:()=>{I=e.addCellListener(null,null,null,((e,t,s,n,a,o)=>{if(i){T();const e=Ae(r,t,Ie),l=Ae(e,s,Ie),i=Ae(l,n,(()=>[o,void 0]));i[1]=a,i[0]===a&&ye(Ve(l,n))&&ye(Ve(e,s))&&ye(Ve(r,t))&&S(),A()}})),R=e.addValueListener(null,((e,t,s,n)=>{if(i){T();const e=Ae(l,t,(()=>[n,void 0]));e[1]=s,e[0]===s&&ye(Ve(l,t))&&S(),A()}}))}};return le(J.clear())}),(e=>e._registerListeners())),Xe=(e,t)=>(e??0)<(t??0)?-1:1,Ye=_e((e=>{const t=Ie(),n=Ie(),[a,o,r]=Ke((()=>y)),[l,i,c,d,u,g,h,,f,b,C,w]=$e(e,Ie,(e=>k(e)?s:z(e)?G(e,M):M(e)),a,o),L=(t,s,n)=>{const a=u(t);Te(n,((t,n)=>s(n,(s=>Te(t,(t=>s(t,(s=>e.forEachCell(a,t,s)))))))))},y={setIndexDefinition:(e,s,a,r,l,i=Xe)=>{const c=k(l)?void 0:([e],[t])=>l(e,t);return f(e,s,((s,a,l,d,u,f)=>{let b=0;const C=We(),w=We(),L=g(e);if(Te(a,(([e,t],s)=>{const n=We(e),a=We(t);Te(n,(e=>Se(a,e)?Se(n,e):0)),Te(n,(e=>{je(C,e),x(Me(L,e),(t=>{Se(t,s),ye(t)&&(Ve(L,e),b=1)}))})),Te(a,(e=>{je(C,e),Le(L,e)||(Ve(L,e,We()),b=1),je(Me(L,e),s),k(r)||je(w,e)}))})),s(),ye(u)||(f?me(L,(e=>je(w,e))):me(l,(e=>x(Me(d,e),(e=>je(w,e))))),Te(w,(e=>{const t=(t,s)=>i(Me(u,t),Me(u,s),e),s=[...Me(L,e)];B(s,t)||(Ve(L,e,We(_(s,t))),je(C,e))}))),(b||f)&&!k(c)){const t=[...L];B(t,c)||(h(e,Ie(_(t,c))),b=1)}b&&o(t,[e]),Te(C,(t=>o(n,[e,t])))}),Be(a),x(r,Be)),y},delIndexDefinition:e=>(b(e),y),getStore:l,getIndexIds:i,forEachIndex:e=>c(((t,s)=>e(t,(e=>L(t,e,s))))),forEachSlice:(e,t)=>L(e,t,g(e)),hasIndex:d,hasSlice:(e,t)=>Le(g(e),t),getTableId:u,getSliceIds:e=>Re(g(e)),getSliceRowIds:(e,t)=>pe(Me(g(e),t)),addIndexIdsListener:C,addSliceIdsListener:(e,s)=>a(s,t,[e]),addSliceRowIdsListener:(e,t,s)=>a(s,n,[e,t]),delListener:e=>(r(e),y),destroy:w,getListenerStats:()=>({})};return le(y)})),Ze=Ie([["avg",[(e,t)=>K(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>E(...e),(e,t)=>E(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:E(t,e)]],["min",[e=>H(...e),(e,t)=>H(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:H(t,e)]],["sum",[e=>K(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),et=(e,t,s,n,a,o=!1)=>{if(ye(s))return;const[r,l,i,c]=a;return o||=k(e),Te(n,(([s,n])=>{o||(e=k(s)?l?.(e,n,t++):k(n)?i?.(e,s,t--):c?.(e,n,s,t),o||=k(e))})),o?r(pe(s),we(s)):e},tt=_e((e=>{const t=Ie(),[n,a,o]=Ke((()=>w)),[r,l,i,c,d,u,g,,h,f,b,C]=$e(e,O,(e=>isNaN(e)||k(e)||!0===e||!1===e||e===s?void 0:1*e),n,a),w={setMetricDefinition:(e,s,n,o,r,l,i)=>{const c=Q(n)?[n,r,l,i]:Me(Ze,n)??Me(Ze,"sum");return h(e,s,((s,n,o,r,l,i)=>{const d=u(e),h=we(r);i||=k(d),s();let f=et(d,h,r,n,c,i);D(f)||(f=void 0),f!=d&&(g(e,f),a(t,[e],f,d))}),Be(o,1)),w},delMetricDefinition:e=>(f(e),w),getStore:r,getMetricIds:l,forEachMetric:i,hasMetric:c,getTableId:d,getMetric:u,addMetricIdsListener:b,addMetricListener:(e,s)=>n(s,t,[e]),delListener:e=>(o(e),w),destroy:C,getListenerStats:()=>({})};return le(w)})),st=Ie(),nt=Ie(),at=(e,t,s,n,a,o,r,l={},i=[])=>{let c,d,u,g=0;Ae(st,i,(()=>0)),Ae(nt,i,(()=>[]));const[h,f,b,C]=((e,t)=>!e||k(t.getMergeableContent)?[0,t.getContent,t.getTransactionChanges,([e,t])=>!fe(e)||!fe(t)]:[1,t.getMergeableContent,t.getTransactionMergeableChanges,([,[[,e],[,t]]])=>!fe(e)||!fe(t)])(r,e),w=async e=>(2!=g&&(g=1,await y.schedule((async()=>{await e(),g=0}))),y),L=t=>{(h&&F(t?.[0])?1===t?.[1][2]?e.applyMergeableChanges:e.setMergeableContent:1===t?.[2]?e.applyChanges:e.setContent)(t)},y={load:async(s,n)=>await w((async()=>{try{L(await t())}catch(t){o?.(t),e.setContent([s,n])}})),startAutoLoad:async(e={},s={})=>(await y.stopAutoLoad().load(e,s),d=n((async(e,s)=>{const n=s?.();await w((async()=>{try{L(n??e?.()??await t())}catch(e){o?.(e)}}))})),y),stopAutoLoad:()=>(d&&(a(d),d=void 0),y),isAutoLoading:()=>!k(d),save:async e=>(1!=g&&(g=2,await y.schedule((async()=>{try{await s(f,e)}catch(e){o?.(e)}g=0}))),y),startAutoSave:async()=>(await y.stopAutoSave().save(),u=e.addDidFinishTransactionListener((()=>{const e=b();C(e)&&y.save((()=>e))})),y),stopAutoSave:()=>(x(u,e.delListener),u=void 0,y),isAutoSaving:()=>!k(u),schedule:async(...e)=>(Y(Me(nt,i),...e),await(async()=>{if(!Me(st,i)){for(Ve(st,i,1);!k(c=ee(Me(nt,i)));)try{await c()}catch(e){o?.(e)}Ve(st,i,0)}})(),y),getStore:()=>e,destroy:()=>y.stopAutoLoad().stopAutoSave(),getStats:()=>({}),...l};return le(y)},ot=new globalThis.TextEncoder,rt=e=>{let t=2166136261;return q(ot.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},lt=2**36,it=2**30,ct=2**24,dt=2**18,ut=4096,gt=64,ht=e=>String.fromCharCode(48+(63&e)),ft=(e,t)=>((e,t)=>e.charCodeAt(t))(e,t)-48,bt=e=>{let t=0,s=-1;const n=rt(e),a=e=>{const n=t,[a,o]=k(e)||""==e?[0,0]:[ft(r=e,0)*lt+ft(r,1)*it+ft(r,2)*ct+ft(r,3)*dt+ft(r,4)*ut+ft(r,5)*gt+ft(r,6),ft(r,7)*dt+ft(r,8)*ut+ft(r,9)*gt+ft(r,10),ft(r,11)*ct+ft(r,12)*dt+ft(r,13)*ut+ft(r,14)*gt+ft(r,15)];var r;t=E(n,a,Date.now()),s=t==n?t==a?E(s,o):s:t==a?o:-1};return[()=>{return a(),o=++s,r=n,ht((e=t)/lt)+ht(e/it)+ht(e/ct)+ht(e/dt)+ht(e/ut)+ht(e/gt)+ht(e)+ht(o/dt)+ht(o/ut)+ht(o/gt)+ht(o)+ht(r/ct)+ht(r/dt)+ht(r/ut)+ht(r/gt)+ht(r);var e,o,r},a]},Ct=_e((e=>{const t=e.createStore,n=t(),a=t(),o=Ie(),{addListener:r,callListeners:l,delListener:i}=a,[g,h,b,C,S,,,I,,R,M,m,V,A]=$e(e,(()=>!0),O,r,l),E=(e,t,...s)=>q(s,(s=>je(Ae(Ae(o,t,Ie),e,We),s))),H=e=>{x(Me(o,e),(e=>{me(e,((e,t)=>Te(t,(t=>e.delListener(t))))),ve(e)})),q([a,n],(t=>t.delTable(e)))},D=(e,t,s)=>E(t,e,t.addStartTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),J={setQueryDefinition:(t,o,r)=>{I(t,o),H(t);const l=[],i=[[null,[o,null,null,[],Ie()]]],c=[],d=[],u=[];r({select:(e,t)=>{const n=Q(e)?[P(l)+s,e]:[k(t)?e:t,s=>s(e,t)];return Y(l,n),{as:e=>n[0]=e}},join:(e,t,s)=>{const n=k(s)||Q(t)?null:t,a=k(n)?t:s,o=[e,[e,n,Q(a)?a:e=>e(a),[],Ie()]];return Y(i,o),{as:e=>o[0]=e}},where:(e,t,s)=>Y(c,Q(e)?e:k(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,a)=>{const o=[e,[e,Q(t)?[t,s,n,a]:Me(Ze,t)??[(e,t)=>t]]];return Y(d,o),{as:e=>o[0]=e}},having:(e,t)=>Y(u,Q(e)?e:s=>s(e)===t)});const g=Ie(l);if(ye(g))return J;const h=Ie(i);me(h,((e,[,t])=>x(Me(h,t),(({3:t})=>k(e)?0:Y(t,e)))));const f=Ie(d);let b=n;if(ye(f)&&U(u))b=a;else{D(t,b,a);const e=Ie();me(f,((t,[s,n])=>je(Ae(e,s,We),[t,n])));const s=We();me(g,(t=>Le(e,t)?0:je(s,t)));const n=Ie(),o=(s,n,o,r)=>x(s,(([l,i,c,d])=>{me(n,((t,[s])=>{const n=Ae(l,t,Ie),a=Me(n,o),i=r?void 0:s;if(a!==i){const s=We([[a,i]]),r=we(n);Ve(n,o,i),Te(Me(e,t),(([e,t])=>{const a=et(d[e],r,n,s,t);d[e]=k(ze(a))?null:a}))}})),ye(i)||!j(u,(e=>e((e=>d[e]))))?a.delRow(t,c):k(c)?s[2]=a.addRow(t,d):a.setRow(t,c,d)}));E(b,t,b.addRowListener(t,null,((a,r,l,i)=>{const c=[],d=[],u=Ie(),g=b.hasRow(t,l);let h=!g;Te(s,(e=>{const[s,n,a]=i(t,l,e);Y(c,n),Y(d,a),h||=s})),me(e,(e=>{const[s,,n]=i(t,l,e);(h||s)&&Ve(u,e,[n])})),h&&o(Qe(n,c,void 0,(([,e])=>(Se(e,l),ye(e)))),u,l,1),g&&o(Qe(n,d,(()=>{const e={};return Te(s,(s=>e[s]=b.getCell(t,l,s))),[Ie(),We(),void 0,e]}),(([,e])=>{je(e,l)})),u,l)})))}D(t,e,b);const C=(s,n,a,r)=>{const l=t=>e.getCell(n,a,t);q(r,(n=>{const[a,,o,r,i]=Me(h,n),c=o?.(l,s),[d,u]=Me(i,s)??[];c!=d&&(k(u)||A(t,u),Ve(i,s,k(c)?null:[c,...V(t,1,e.addRowListener(a,c,(()=>C(s,a,c,r))))]))})),(s=>{const n=(t,n)=>e.getCell(...k(n)?[o,s,t]:t===o?[o,s,n]:[Me(h,t)?.[0],Me(Me(h,t)?.[4],s)?.[0],n]);b.transaction((()=>j(c,(e=>e(n)))?me(g,((e,a)=>Pe(b,t,s,e,a(n,s)))):b.delRow(t,s)))})(s)},{3:w}=Me(h,null);return b.transaction((()=>V(t,1,e.addRowListener(o,null,((s,n,a)=>{e.hasRow(o,a)?C(a,o,a,w):(b.delRow(t,a),Te(h,(({4:e})=>x(Me(e,a),(([,s])=>{A(t,s),Ve(e,a)})))))}))))),J},delQueryDefinition:e=>(H(e),R(e),J),getStore:g,getQueryIds:h,forEachQuery:b,hasQuery:C,getTableId:S,addQueryIdsListener:e=>M((()=>e(J))),delListener:e=>(i(e),J),destroy:m,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=a.getListenerStats();return n}};return ge({[f]:[1,1],[f+T]:[0,1],[L]:[0,1],[y]:[0,1],[p]:[0,5],[w]:[1,2],[T]:[0,2],[v]:[1,3]},(([e,t],s)=>{q(e?["get","has","forEach"]:["get"],(e=>J[e+d+s]=(...t)=>a[e+s](...t))),J[u+d+s+c]=(...e)=>a[u+s+c](...N(e,0,t),((s,...n)=>e[t](J,...n)),!0)})),le(J)})),wt=_e((e=>{const t=Ie(),n=Ie(),a=Ie(),o=Ie(),[r,l,i]=Ke((()=>T)),[c,d,u,g,h,f,,,b,C,w,L]=$e(e,(()=>[Ie(),Ie(),Ie(),Ie()]),(e=>k(e)?void 0:e+s),r,l),y=(e,t,s)=>x(f(e),(([n,,a])=>{if(!Le(a,t)){const o=We();if(h(e)!=v(e))je(o,t);else{let e=t;for(;!k(e)&&!Le(o,e);)je(o,e),e=Me(n,e)}if(s)return o;Ve(a,t,o)}return Me(a,t)})),p=(e,t)=>x(f(e),(([,,e])=>Ve(e,t))),v=e=>Me(t,e),T={setRelationshipDefinition:(e,s,r,i)=>(Ve(t,e,r),b(e,s,((t,s)=>{const r=We(),i=We(),c=We(),[d,u]=f(e);Te(s,(([t,s],n)=>{k(t)||(je(i,t),x(Me(u,t),(e=>{Se(e,n),ye(e)&&Ve(u,t)}))),k(s)||(je(i,s),Le(u,s)||Ve(u,s,We()),je(Me(u,s),n)),je(r,n),Ve(d,n,s),me(Me(o,e),(t=>{Le(y(e,t),n)&&je(c,t)}))})),t(),Te(r,(t=>l(n,[e,t]))),Te(i,(t=>l(a,[e,t]))),Te(c,(t=>{p(e,t),l(o,[e,t])}))}),Be(i)),T),delRelationshipDefinition:e=>(Ve(t,e),C(e),T),getStore:c,getRelationshipIds:d,forEachRelationship:t=>u((s=>t(s,(t=>e.forEachRow(h(s),t))))),hasRelationship:g,getLocalTableId:h,getRemoteTableId:v,getRemoteRowId:(e,t)=>Me(f(e)?.[0],t),getLocalRowIds:(e,t)=>pe(Me(f(e)?.[1],t)),getLinkedRowIds:(e,t)=>k(f(e))?[t]:pe(y(e,t,!0)),addRelationshipIdsListener:w,addRemoteRowIdListener:(e,t,s)=>r(s,n,[e,t]),addLocalRowIdsListener:(e,t,s)=>r(s,a,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(y(e,t),r(s,o,[e,t])),delListener:e=>(p(...i(e)??[]),T),destroy:L,getListenerStats:()=>({})};return le(T)})),Lt=([e,t,s])=>[e,t,s],yt=([e,t])=>[e,t],pt=e=>e[2],vt=(e,t)=>rt(e+":"+t),Tt=(e,t,s)=>{e[2]=t>>>0,s>e[0]&&(e[0]=s)},St=e=>[e,ie()],It=(e="")=>[e,Ie(),0],Rt=([e,t,s],n=Lt)=>[e,He(t,n),s],Mt=(e,s)=>z(e)&&3==P(e)&&F(e[0])&&s(e[1])&&t(e[2])==o&&D(e[2]),mt=e=>[e,e],Vt=()=>[Ie(),Ie()],At=e=>[...e],Et=([e,t])=>e===t,Ht=e=>JSON.stringify(e,((e,t)=>t instanceof Map?te.fromEntries([...t]):t)),Dt=JSON.parse,kt=(e,t,s)=>Ve(e,t,Me(e,t)==-s?void 0:s),xt=()=>{let e,t,s=!1,n=!1,a=0,r=[];const d=Ie(),h=Ie(),p=Ie(),m=Ie(),V=Ie(),A=Ie(),E=Ie(),H=Ie(),D=Ie(),F=Ie(),z=Ie(),P=Ie(),O=Ie(),j=Ie(),B=We(),K=Ie(),U=Ie(),X=Ie(),Z=Ie(),ee=Vt(),te=Vt(),se=Vt(),ne=Vt(),ae=Vt(),oe=Vt(),re=Vt(),ie=Vt(),ue=Vt(),he=Vt(),be=Vt(),pe=Vt(),Qe=Vt(),Ne=Vt(),$e=Vt(),Be=Vt(),_e=Vt(),qe=Vt(),Ue=Vt(),Ye=Vt(),Ze=Vt(),et=Vt(),tt=Ie(),st=Vt(),[nt,at,ot,rt]=Ke((()=>xs)),lt=e=>{if(!Ce(e,((e,t)=>W([l,i],t))))return!1;const t=e[l];return!(!J(t)&&t!=o||(ze(e[i])!=t&&de(e,i),0))},it=(t,s)=>(!e||Le(z,s)||_t(s))&&Ce(t,((e,t)=>ct(s,t,e)),(()=>_t(s))),ct=(e,t,s,n)=>Ce(n?s:ht(s,e,t),((n,a)=>x(dt(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>_t(e,t))),dt=(t,s,n,a)=>e?x(Me(Me(z,t),n),(e=>ze(a)!=e[l]?_t(t,s,n,a,e[i]):a),(()=>_t(t,s,n,a))):k(ze(a))?_t(t,s,n,a):a,ut=(e,t)=>Ce(t?e:ft(e),((t,s)=>x(gt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>qt())),gt=(e,s)=>t?x(Me(O,e),(t=>ze(s)!=t[l]?qt(e,s,t[i]):s),(()=>qt(e,s))):k(ze(s))?qt(e,s):s,ht=(e,t,s)=>(x(Me(P,t),(([n,a])=>{Te(n,((t,s)=>{ce(e,s)||(e[s]=t)})),Te(a,(n=>{ce(e,n)||_t(t,s,n)}))})),e),ft=e=>(t&&(Te(j,((t,s)=>{ce(e,s)||(e[s]=t)})),Te(B,(t=>{ce(e,t)||qt(t)}))),e),bt=e=>Ee(z,e,((e,t,s)=>{const n=Ie(),a=We();Ee(Ae(z,t,Ie),s,((e,t,s)=>{Ve(e,t,s),x(s[i],(e=>Ve(n,t,e)),(()=>je(a,t)))})),Ve(P,t,[n,a])}),((e,t)=>{Ve(z,t),Ve(P,t)})),Ct=e=>Ee(O,e,((e,t,s)=>{Ve(O,t,s),x(s[i],(e=>Ve(j,t,e)),(()=>je(B,t)))}),((e,t)=>{Ve(O,t),Ve(j,t),Se(B,t)})),wt=e=>fe(e)?Rs():ps(e),Lt=e=>Ee(X,e,((e,t,s)=>yt(t,s)),((e,t)=>Ft(t))),yt=(e,t)=>Ee(Ae(X,e,(()=>(Pt(e,1),Ve(K,e,Ge()),Ve(U,e,Ie()),Ie()))),t,((t,s,n)=>pt(e,t,s,n)),((t,s)=>Qt(e,t,s))),pt=(e,t,s,n,a)=>Ee(Ae(t,s,(()=>(Ot(e,s,1),Ie()))),n,((t,n,a)=>vt(e,s,t,n,a)),((n,o)=>zt(e,t,s,n,o,a))),vt=(e,t,s,n,a)=>{Le(s,n)||Wt(e,t,n,1);const o=Me(s,n);a!==o&&(jt(e,t,n,o,a),Ve(s,n,a))},Tt=(e,t,s,n,a)=>x(Me(t,s),(t=>vt(e,s,t,n,a)),(()=>pt(e,t,s,ht({[n]:a},e,s)))),St=e=>fe(e)?Vs():vs(e),It=e=>Ee(Z,e,((e,t,s)=>Rt(t,s)),((e,t)=>Nt(t))),Rt=(e,t)=>{Le(Z,e)||$t(e,1);const s=Me(Z,e);t!==s&&(Bt(e,s,t),Ve(Z,e,t))},Mt=(e,t)=>{const[s]=Me(K,e),n=s(t);return Le(Me(X,e),n)?Mt(e,t):n},Jt=e=>Me(X,e)??yt(e,{}),Ft=e=>yt(e,{}),Qt=(e,t,s)=>{const[,n]=Me(K,e);n(s),pt(e,t,s,{},!0)},zt=(e,t,s,n,a,o)=>{const r=Me(Me(P,e)?.[0],a);if(!k(r)&&!o)return vt(e,s,n,a,r);const l=t=>{jt(e,s,t,Me(n,t)),Wt(e,s,t,-1),Ve(n,t)};k(r)?l(a):me(n,l),ye(n)&&(Ot(e,s,-1),ye(Ve(t,s))&&(Pt(e,-1),Ve(X,e),Ve(K,e),Ve(U,e)))},Nt=e=>{const t=Me(j,e);if(!k(t))return Rt(e,t);Bt(e,Me(Z,e)),$t(e,-1),Ve(Z,e)},Pt=(e,t)=>kt(d,e,t),Ot=(e,t,s)=>kt(Ae(m,e,Ie),t,s)&&Ve(p,e,Ae(p,e,(()=>0))+s),Wt=(e,t,s,n)=>{const a=Me(U,e),o=Me(a,s)??0;(0==o&&1==n||1==o&&-1==n)&&kt(Ae(h,e,Ie),s,n),Ve(a,s,o!=-n?o+n:null),kt(Ae(Ae(V,e,Ie),t,Ie),s,n)},jt=(e,t,s,n,a)=>Ae(Ae(Ae(A,e,Ie),t,Ie),s,(()=>[n,0]))[1]=a,$t=(e,t)=>kt(E,e,t),Bt=(e,t,s)=>Ae(H,e,(()=>[t,0]))[1]=s,_t=(e,t,s,n,a)=>(Y(Ae(Ae(Ae(D,e,Ie),t,Ie),s,(()=>[])),n),a),qt=(e,t,s)=>(Y(Ae(F,e,(()=>[])),t),s),Gt=(e,t,s)=>x(Me(Me(Me(A,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...mt(cs(e,t,s))])),Kt=e=>x(Me(H,e),(([e,t])=>[!0,e,t]),(()=>[!1,...mt(gs(e))])),Ut=e=>ye(D)||ye(Be[e])?0:Te(e?Fe(D):D,((t,s)=>Te(t,((t,n)=>Te(t,((t,a)=>at(Be[e],[s,n,a],t))))))),Xt=e=>ye(F)||ye(_e[e])?0:Te(e?xe(F):F,((t,s)=>at(_e[e],[s],t))),Yt=(e,t,s,n)=>{if(!ye(e))return at(t,n,(()=>He(e))),me(e,((e,t)=>at(s,[...n??[],e],1==t))),1},Zt=e=>{const t=hs();t!=s&&at(ee[e],void 0,t);const n=ye(he[e]),a=ye(Qe[e])&&ye(Ne[e])&&ye(ue[e])&&ye(be[e])&&ye(oe[e])&&ye(re[e])&&ye(ie[e])&&n&&ye(se[e])&&ye(ne[e]),o=ye($e[e])&&ye(pe[e])&&ye(ae[e])&&ye(te[e]);if(!a||!o){const t=e?[xe(d),Je(h),xe(p),Je(m),Fe(V),Fe(A)]:[d,h,p,m,V,A];if(!a){Yt(t[0],se[e],ne[e]),Te(t[1],((t,s)=>Yt(t,oe[e],re[e],[s]))),Te(t[2],((t,s)=>{0!=t&&at(ie[e],[s],os(s))}));const s=We();Te(t[3],((t,a)=>{Yt(t,ue[e],be[e],[a])&&!n&&(at(he[e],[a,null]),je(s,a))})),n||Te(t[5],((t,n)=>{if(!Le(s,n)){const s=We();Te(t,(e=>Te(e,(([t,n],a)=>n!==t?je(s,a):Se(e,a))))),Te(s,(t=>at(he[e],[n,t])))}})),Te(t[4],((t,s)=>Te(t,((t,n)=>Yt(t,Qe[e],Ne[e],[s,n])))))}if(!o){let s;Te(t[5],((t,n)=>{let a;Te(t,((t,o)=>{let r;Te(t,(([t,l],i)=>{l!==t&&(at($e[e],[n,o,i],l,t,Gt),s=a=r=1)})),r&&at(pe[e],[n,o],Gt)})),a&&at(ae[e],[n],Gt)})),s&&at(te[e],void 0,Gt)}}},es=e=>{const t=Ls();t!=n&&at(qe[e],void 0,t);const s=ye(Ye[e])&&ye(Ze[e]),a=ye(et[e])&&ye(Ue[e]);if(!s||!a){const t=e?[xe(E),xe(H)]:[E,H];if(s||Yt(t[0],Ye[e],Ze[e]),!a){let s;Te(t[1],(([t,n],a)=>{n!==t&&(at(et[e],[a],n,t,Kt),s=1)})),s&&at(Ue[e],void 0,Kt)}}},ts=(e,...t)=>(Hs((()=>e(...G(t,M)))),xs),ss=()=>ke(X),ns=()=>Re(X),as=e=>Re(Me(U,M(e))),os=e=>we(Me(X,M(e))),rs=e=>Re(Me(X,M(e))),ls=(e,t,s,n=0,a)=>{return G(N(_((o=Me(X,M(e)),r=(e,s)=>[k(t)?s:Me(e,M(t)),s],G([...o?.entries()??[]],(([e,t])=>r(t,e)))),(([e],[t])=>Xe(e,t)*(s?-1:1))),n,k(a)?a:n+a),(([,e])=>e));var o,r},is=(e,t)=>Re(Me(Me(X,M(e)),M(t))),cs=(e,t,s)=>Me(Me(Me(X,M(e)),M(t)),M(s)),ds=()=>He(Z),us=()=>Re(Z),gs=e=>Me(Z,M(e)),hs=()=>!ye(X),fs=e=>Le(X,M(e)),bs=(e,t)=>Le(Me(U,M(e)),M(t)),Cs=(e,t)=>Le(Me(X,M(e)),M(t)),ws=(e,t,s)=>Le(Me(Me(X,M(e)),M(t)),M(s)),Ls=()=>!ye(Z),ys=e=>Le(Z,M(e)),ps=e=>ts((()=>(e=>Ce(e,it,_t))(e)?Lt(e):0)),vs=e=>ts((()=>ut(e)?It(e):0)),Ts=e=>{try{wt(Dt(e))}catch{}return xs},Ss=t=>ts((()=>{if((e=Ce(t,(e=>Ce(e,lt))))&&(bt(t),!ye(X))){const e=ss();Rs(),ps(e)}})),Is=e=>ts((()=>{if(t=(e=>Ce(e,lt))(e)){const s=ds();Es(),Vs(),t=!0,Ct(e),vs(s)}})),Rs=()=>ts((()=>Lt({}))),Ms=e=>ts((e=>Le(X,e)?Ft(e):0),e),ms=(e,t)=>ts(((e,t)=>x(Me(X,e),(s=>Le(s,t)?Qt(e,s,t):0))),e,t),Vs=()=>ts((()=>It({}))),As=()=>ts((()=>{bt({}),e=!1})),Es=()=>ts((()=>{Ct({}),t=!1})),Hs=(e,t)=>{if(-1!=a){Ds();const s=e();return ks(t),s}},Ds=()=>(-1!=a&&a++,1==a&&at(tt,void 0),xs),ks=e=>(a>0&&(a--,0==a&&(a=1,Ut(1),ye(A)||Zt(1),Xt(1),ye(H)||es(1),e?.(xs)&&(Te(A,((e,t)=>Te(e,((e,s)=>Te(e,(([e],n)=>Pe(xs,t,s,n,e))))))),ve(A),Te(H,(([e],t)=>Oe(xs,t,e))),ve(H)),at(st[0],void 0),a=-1,Ut(0),ye(A)||Zt(0),Xt(0),ye(H)||es(0),r[0]?.(xs),at(st[1],void 0),r[1]?.(xs),a=0,s=hs(),n=Ls(),q([d,h,p,m,V,A,D,E,H,F],ve))),xs),xs={getContent:()=>[ss(),ds()],getTables:ss,getTableIds:ns,getTable:e=>De(Me(X,M(e))),getTableCellIds:as,getRowCount:os,getRowIds:rs,getSortedRowIds:ls,getRow:(e,t)=>He(Me(Me(X,M(e)),M(t))),getCellIds:is,getCell:cs,getValues:ds,getValueIds:us,getValue:gs,hasTables:hs,hasTable:fs,hasTableCell:bs,hasRow:Cs,hasCell:ws,hasValues:Ls,hasValue:ys,getTablesJson:()=>Ht(X),getValuesJson:()=>Ht(Z),getJson:()=>Ht([X,Z]),getTablesSchemaJson:()=>Ht(z),getValuesSchemaJson:()=>Ht(O),getSchemaJson:()=>Ht([z,O]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>ts((()=>{(fe(e)?Rs:ps)(e),(fe(t)?Vs:vs)(t)})),setTables:ps,setTable:(e,t)=>ts((e=>it(t,e)?yt(e,t):0),e),setRow:(e,t,s)=>ts(((e,t)=>ct(e,t,s)?pt(e,Jt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Hs((()=>{let n;return ct(e,n,t)&&(e=M(e),pt(e,Jt(e),n=Mt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>ts(((e,t)=>{if(ct(e,t,s,1)){const n=Jt(e);ge(s,((s,a)=>Tt(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>ts(((e,t,s)=>x(dt(e,t,s,Q(n)?n(cs(e,t,s)):n),(n=>Tt(e,Jt(e),t,s,n)))),e,t,s),setValues:vs,setPartialValues:e=>ts((()=>ut(e,1)?ge(e,((e,t)=>Rt(t,e))):0)),setValue:(e,t)=>ts((e=>x(gt(e,Q(t)?t(gs(e)):t),(t=>Rt(e,t)))),e),applyChanges:e=>ts((()=>{ge(e[0],((e,t)=>k(e)?Ms(t):ge(e,((e,s)=>k(e)?ms(t,s):ge(e,((e,n)=>Pe(xs,t,s,n,e))))))),ge(e[1],((e,t)=>Oe(xs,t,e)))})),setTablesJson:Ts,setValuesJson:e=>{try{St(Dt(e))}catch{}return xs},setJson:e=>ts((()=>{try{const[t,s]=Dt(e);wt(t),St(s)}catch{Ts(e)}})),setTablesSchema:Ss,setValuesSchema:Is,setSchema:(e,t)=>ts((()=>{Ss(e),Is(t)})),delTables:Rs,delTable:Ms,delRow:ms,delCell:(e,t,s,n)=>ts(((e,t,s)=>x(Me(X,e),(a=>x(Me(a,t),(o=>Le(o,s)?zt(e,a,t,o,s,n):0))))),e,t,s),delValues:Vs,delValue:e=>ts((e=>Le(Z,e)?Nt(e):0),e),delTablesSchema:As,delValuesSchema:Es,delSchema:()=>ts((()=>{As(),Es()})),transaction:Hs,startTransaction:Ds,getTransactionChanges:()=>[He(A,((e,t)=>-1===Me(d,t)?void 0:He(e,((e,s)=>-1===Me(Me(m,t),s)?void 0:He(e,(([,e])=>e),(e=>Et(e)))),ye,fe)),ye,fe),He(H,(([,e])=>e),(e=>Et(e))),1],getTransactionLog:()=>[!ye(A),!ye(H),ke(A,At,Et),ke(D),He(H,At,Et),He(F),He(d),De(m),ke(V),He(E)],finishTransaction:ks,forEachTable:e=>Te(X,((t,s)=>e(s,(e=>Te(t,((t,s)=>e(s,(e=>me(t,e))))))))),forEachTableCell:(e,t)=>me(Me(U,M(e)),t),forEachRow:(e,t)=>Te(Me(X,M(e)),((e,s)=>t(s,(t=>me(e,t))))),forEachCell:(e,t,s)=>me(Me(Me(X,M(e)),M(t)),s),forEachValue:e=>me(Z,e),addSortedRowIdsListener:(e,t,s,n,a,o,r)=>{let l=ls(e,t,s,n,a);return nt((()=>{const r=ls(e,t,s,n,a);$(r,l)||(l=r,o(xs,e,t,s,n,a,l))}),he[r?1:0],[e,t],[ns])},addStartTransactionListener:e=>nt(e,tt),addWillFinishTransactionListener:e=>nt(e,st[0]),addDidFinishTransactionListener:e=>nt(e,st[1]),callListener:e=>(rt(e),xs),delListener:e=>(ot(e),xs),getListenerStats:()=>({}),createStore:xt,addListener:nt,callListeners:at,setInternalListeners:(e,t)=>r=[e,t]};return ge({[g+b]:[0,ee,[],()=>[hs()]],[b]:[0,te],[C]:[0,se],[g+f]:[1,ne,[ns],e=>[fs(...e)]],[f]:[1,ae,[ns]],[f+T]:[1,oe,[ns]],[g+f+v]:[2,re,[ns,as],e=>[bs(...e)]],[L]:[1,ie,[ns]],[y]:[1,ue,[ns]],[g+w]:[2,be,[ns,rs],e=>[Cs(...e)]],[w]:[2,pe,[ns,rs]],[T]:[2,Qe,[ns,rs]],[g+v]:[3,Ne,[ns,rs,is],e=>[ws(...e)]],[v]:[3,$e,[ns,rs,is],e=>mt(cs(...e))],InvalidCell:[3,Be],[g+I]:[0,qe,[],()=>[Ls()]],[I]:[0,Ue],[R]:[0,Ye],[g+S]:[1,Ze,[us],e=>[ys(...e)]],[S]:[1,et,[us],e=>mt(gs(e[0]))],InvalidValue:[1,_e]},(([e,t,s,n],a)=>{xs[u+a+c]=(...a)=>nt(a[e],t[a[e+1]?1:0],e>0?N(a,0,e):void 0,s,n)})),le(xs)},Jt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Ft=(e="")=>[e,[It(e),It(e)],0];e.createCheckpoints=Ue,e.createCustomPersister=at,e.createCustomSynchronizer=(e,t,n,a,o=1,r)=>{let l;const[i]=bt(e.getId()),c=Ie();n(((s,n,a,o)=>{0==a?x(Me(c,n),(([e,t])=>k(e)||e==s?t(o,s):0)):1==a&&g.isAutoLoading()?u(s,o).then((e=>l?.(void 0,(()=>e)))):x(2==a&&g.isAutoSaving()?e.getMergeableContentHashes():3==a?e.getMergeableTableIdsDiff(o):4==a?e.getMergeableRowIdsDiff(o):5==a?e.getMergeableTablesChanges(o):6==a?e.getMergeableValuesChanges(o):void 0,(e=>{t(s,n,0,e)}))}));const d=async(e,s,n="")=>new A(((a,r)=>{const l=i(),d=setTimeout((()=>{Se(c,l),r(`No response from ${e??"anyone"} to '${s}'`)}),1e3*o);Ve(c,l,[e,(e,t)=>{clearTimeout(d),Se(c,l),a([e,t])}]),t(e,l,s,n)})),u=async(t=null,n)=>{k(n)&&([n,t]=await d(t,2));const[a,[o,r]]=n,[,[l,i]]=e.getMergeableContentHashes(),c=[s,[[s,{}],[s,{}],1]];return l!=o&&(c[0]=a,c[1][0]=(await d(t,5,e.getMergeableCellHashes((await d(t,4,e.getMergeableRowHashes((await d(t,3,e.getMergeableTableHashes()))[0])))[0])))[0]),i!=r&&(c[0]=a,c[1][1]=(await d(t,6,e.getMergeableValuesHashes()))[0]),c},g=at(e,(async()=>{const e=await u();return e[0]!=s?e:void 0}),(async()=>{t(null,null,1,e.getMergeableContentHashes())}),(e=>l=e),(()=>l=void 0),r,!0,{startSync:async()=>await(await g.startAutoLoad()).startAutoSave(),stopSync:()=>g.stopAutoLoad().stopAutoSave(),destroy:()=>(a(),g.stopSync()),getSynchronizerStats:()=>({})});return g},e.createIndexes=Ye,e.createMergeableStore=e=>{let t,n,a=1,o=Ft();const[r,l]=bt(e),i=xt(),c=e=>{const t=a;return a=0,e(),a=t,b},d=(e,t=0)=>{const s={},n={},[a,[[r,l,i],c],d]=e,[,[g,h]]=o,[f,b,C]=g;if(r){let e=t?i:C^(r>f?(f?rt(f):0)^rt(r):0);ue(l,(([n,a,o],r)=>{const l=Ae(b,r,It),[i,c,d]=l;let g=t?o:d^(n>i?(i?rt(i):0)^rt(n):0);ue(a,((e,n)=>{const[a,o]=u(e,Ae(c,n,It),be(be(s,r,ie),n,ie),t);g^=t?0:(a?vt(n,a):0)^vt(n,o)})),Tt(l,g,n),e^=t?0:(d?vt(r,d):0)^vt(r,l[2])})),Tt(g,e,r)}return u(c,h,n,t),Tt(o,t?d:g[2]^h[2],a),[s,n,1]},u=(e,t,n,a)=>{const[o,r,l]=e,[i,c,d]=t;if(o){let e=a?l:d^(o>i?(i?rt(i):0)^rt(o):0);ue(r,(([t,o,r],l)=>{const i=Ae(c,l,(()=>[s,void 0,0])),[d,,u]=i;t>d&&(Tt(i,a?r:rt(Ht(o??null)+":"+t),t),i[1]=o,n[l]=o,e^=a?0:vt(l,u)^vt(l,i[2]))})),Tt(t,e,o)}return[d,t[2]]},g=()=>[o[0],[Rt(o[1][0],(e=>Rt(e,(e=>Rt(e))))),Rt(o[1][1])],o[2]],h=()=>{if(k(n)){const[,,e,,n]=i.getTransactionLog(),a=fe(e)&&fe(n)?s:t??(t=r()),o=[a,[St(fe(e)?s:a),St(fe(n)?s:a),1]],[[,l],[,c]]=o[1];return ge(e,((e,t)=>{const[,s]=l[t]=St(a);ge(e,((e,t)=>{const[,n]=s[t]=St(a);ge(e,(([,e],t)=>n[t]=[a,e]))}))})),ge(n,(([,e],t)=>c[t]=[a,e])),o}return n},f=e=>c((()=>{l(e[0]),i.applyChanges(d(e))})),b={getId:()=>e,getMergeableContent:g,getMergeableContentHashes:()=>[o[0],[o[1][0][2],o[1][1][2]]],getMergeableTableHashes:()=>He(o[1][0][1],pt),getMergeableTableIdsDiff:e=>{const t=[];return me(o[1][0][1],((s,[,,n])=>{n!==e?.[s]&&Y(t,s)})),t},getMergeableRowHashes:e=>ie(G(e,(e=>[e,He(Me(o[1][0][1],e)?.[1],pt)]))),getMergeableRowIdsDiff:e=>he(e,((e,t)=>{const s=[];return me(Me(o[1][0][1],t)?.[1],((t,[,,n])=>{n!==e?.[t]&&Y(s,t)})),s})),getMergeableCellHashes:e=>he(e,((e,t)=>ie(G(e,(e=>[e,He(Me(Me(o[1][0][1],t)?.[1],e)?.[1],pt)]))))),getMergeableTablesChanges:e=>{const[,[[t,s]]]=o,n={};return ue(e,((e,t)=>x(Me(s,t),(([s,a])=>{const o={};ue(e,((e,t)=>x(Me(a,t),(([s,n])=>{const a=He(n,yt,(([,,t],s)=>t==e?.[s]));fe(a)||(o[t]=[s,a])})))),fe(o)||(n[t]=[s,o])})))),[t,n]},getMergeableValuesHashes:()=>He(o[1][1][1],pt),getMergeableValuesChanges:e=>[o[1][1][0],He(o[1][1][1],yt,(([,,t],s)=>t==e?.[s]))],setMergeableContent:e=>c((()=>(e=>Mt(e,(e=>z(e)&&2==P(e)&&Mt(e[0],(e=>Ce(e,(e=>Mt(e,(e=>Ce(e,(e=>Mt(e,(e=>Ce(e,(e=>Mt(e,Ne)),void 0,1)))),void 0,1)))),void 0,1)))&&Mt(e[1],(e=>Ce(e,(e=>Mt(e,Ne)),void 0,1))))))(e)?i.transaction((()=>{i.delTables().delValues(),o=Ft(),l(e[0]),i.applyChanges(d(e,1))})):0)),getTransactionMergeableChanges:h,applyMergeableChanges:f,merge:e=>{const t=g(),s=e.getMergeableContent();return e.applyMergeableChanges(t),f(s)}};return i.setInternalListeners((()=>{a&&(n=h(),d(n))}),(()=>t=n=void 0)),ge(i,((e,t)=>b[t]=m(t,"set")||m(t,"del")||m(t,"apply")||V(t,"Transaction")||"callListener"==t?(...t)=>(e(...t),b):m(t,"add")&&V(t,"Listener")?(...s)=>{const n=Jt[N(t,3,-8)]??0,a=s[n];return s[n]=(e,...t)=>a(b,...t),e(...s)}:e)),le(b)},e.createMetrics=tt,e.createQueries=Ct,e.createRelationships=wt,e.createStore=xt,e.defaultSorter=Xe},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={});
