var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),a=t(!0),o=t(0),r=t(t),l="type",i="default",c="Listener",d="Result",u="add",g="Has",h="Ids",f="Table",b=f+"s",C=f+h,w="Row",L=w+"Count",p=w+h,y="Sorted"+w+h,v="Cell",T=v+h,S="Value",R=S+"s",I=S+h,M=e=>n+e,m=(e,t)=>e.startsWith(t),V=(e,t)=>e.endsWith(t),D=Promise,E=Math.max,H=Math.min,A=isFinite,k=e=>null==e,x=(e,t,n)=>k(e)?n?.():t(e),J=e=>e==s||e==a,F=e=>t(e)==s,Q=e=>t(e)==r,z=e=>Array.isArray(e),N=(e,t,n)=>e.slice(t,n),P=e=>e.length,O=()=>{},W=(e,t)=>e.includes(t),j=(e,t)=>e.every(t),B=(e,t)=>P(e)===P(t)&&j(e,((e,n)=>t[n]===e)),U=(e,t)=>j(e,((n,s)=>0==s||t(e[s-1],n)<=0)),$=(e,t)=>e.sort(t),_=(e,t)=>e.forEach(t),q=(e,t)=>e.map(t),G=e=>X(e,((e,t)=>e+t),0),K=e=>0==P(e),X=(e,t,n)=>e.reduce(t,n),Y=(e,...t)=>e.push(...t),Z=e=>e.pop(),ee=e=>e.shift(),te=Object,ne=e=>te.getPrototypeOf(e),se=te.entries,ae=te.isFrozen,oe=e=>!k(e)&&x(ne(e),(e=>e==te.prototype||k(ne(e))),(()=>!0)),re=te.keys,le=te.freeze,ie=(e=[])=>te.fromEntries(e),ce=(e,t)=>t in e,de=(e,t)=>(delete e[t],e),ue=(e,t)=>_(se(e),(([e,n])=>t(n,e))),ge=(e,t)=>q(se(e),(([e,n])=>t(n,e))),he=e=>oe(e)&&0==(e=>P(re(e)))(e),fe=(e,t,n)=>(ce(e,t)||(e[t]=n()),e[t]),be=(e,t,n,s=0)=>k(e)||!oe(e)||!s&&he(e)||ae(e)?(n?.(),!1):(ge(e,((n,s)=>{t(n,s)||de(e,s)})),!!s||!he(e)),Ce=e=>e?.size??0,we=(e,t)=>e?.has(t)??!1,Le=e=>k(e)||0==Ce(e),pe=e=>[...e?.values()??[]],ye=e=>e.clear(),ve=(e,t)=>e?.forEach(t),Te=(e,t)=>e?.delete(t),Se=e=>new Map(e),Re=e=>[...e?.keys()??[]],Ie=(e,t)=>e?.get(t),Me=(e,t)=>ve(e,((e,n)=>t(n,e))),me=(e,t,n)=>k(n)?(Te(e,t),e):e?.set(t,n),Ve=(e,t,n,s)=>(we(e,t)?s?.(Ie(e,t)):me(e,t,n()),Ie(e,t)),De=(e,t,n,s=me)=>(ge(t,((t,s)=>n(e,s,t))),Me(e,(n=>ce(t,n)?0:s(e,n))),e),Ee=(e,t,n,s)=>{const a={};return ve(e,((e,o)=>{if(!n?.(e,o)){const n=t?t(e,o):e;!s?.(n)&&(a[o]=n)}})),a},He=(e,t,n)=>Ee(e,(e=>Ee(e,t,n)),Le,he),Ae=(e,t,n)=>Ee(e,(e=>He(e,t,n)),Le,he),ke=(e,t)=>{const n=Se();return ve(e,((e,s)=>n.set(s,t?.(e)??e))),n},xe=e=>ke(e,ke),Je=e=>ke(e,xe),Fe=(e,t,n,s,a=0)=>x((n?Ve:Ie)(e,t[a],a>P(t)-2?n:Se),(o=>{if(a>P(t)-2)return s?.(o)&&me(e,t[a]),o;const r=Fe(o,t,n,s,a+1);return Le(o)&&me(e,t[a]),r})),Qe=e=>{const n=t(e);return J(n)||n==o&&A(e)?n:void 0},ze=e=>k(e)||!k(Qe(e)),Ne=(e,t,n,s,a)=>k(a)?e.delCell(t,n,s,!0):e.setCell(t,n,s,a),Pe=(e,t,n)=>k(n)?e.delValue(t):e.setValue(t,n),Oe=e=>new Set(z(e)||k(e)?e:[e]),We=(e,t)=>e?.add(t),je=(e,t,n,s,a)=>{const o=e.hasRow,r=Se(),l=Se(),i=Se(),c=Se(),d=Se(),u=Se(),g=(t,n,...s)=>{const a=Ve(u,t,Oe);return _(s,(t=>We(a,t)&&n&&e.callListener(t))),s},h=(t,...n)=>x(Ie(u,t),(s=>{_(K(n)?pe(s):n,(t=>{e.delListener(t),Te(s,t)})),Le(s)&&me(u,t)})),f=(e,n)=>{me(r,e,n),we(l,e)||(me(l,e,t()),me(c,e,Se()),me(d,e,Se()),a(i))},b=e=>{me(r,e),me(l,e),me(c,e),me(d,e),h(e),a(i)};return[()=>e,()=>Re(r),e=>Me(l,e),e=>we(l,e),e=>Ie(r,e),e=>Ie(l,e),(e,t)=>me(l,e,t),f,(t,s,a,r,l)=>{f(t,s);const i=Se(),u=Se(),b=Ie(c,t),C=Ie(d,t),w=t=>{const a=n=>e.getCell(s,t,n),c=Ie(b,t),d=o(s,t)?n(r(a,t)):void 0;if(c===d||z(c)&&z(d)&&B(c,d)||me(i,t,[c,d]),!k(l)){const e=Ie(C,t),n=o(s,t)?l(a,t):void 0;e!=n&&me(u,t,n)}},L=e=>{a((()=>{ve(i,(([,e],t)=>me(b,t,e))),ve(u,((e,t)=>me(C,t,e)))}),i,u,b,C,e),ye(i),ye(u)};Me(b,w),e.hasTable(s)&&_(e.getRowIds(s),(e=>{we(b,e)||w(e)})),L(!0),h(t),g(t,0,e.addRowListener(s,null,((e,t,n)=>w(n))),e.addTableListener(s,(()=>L())))},b,e=>s(e,i),()=>Me(u,b),g,h]},Be=(e,t)=>F(e)?t=>t(e):e??(()=>t??n),Ue=(e,t)=>{const n=new WeakMap;return s=>{n.has(s)||n.set(s,e(s));const a=n.get(s);return t?.(a),a}},$e=/^\d+$/,_e=()=>{const e=[];let t=0;return[s=>(s?ee(e):null)??n+t++,t=>{$e.test(t)&&P(e)<1e3&&Y(e,t)}]},qe=e=>{let t;const[s,a]=_e(),o=Se();return[(a,r,l,i=[],c=(()=>[]))=>{t??=e();const d=s(1);return me(o,d,[a,r,l,i,c]),We(Fe(r,l??[n],Oe),d),d},(e,s,...a)=>_(((e,t=[n])=>{const s=[],a=(e,n)=>n==P(t)?Y(s,e):null===t[n]?ve(e,(e=>a(e,n+1))):_([t[n],null],(t=>a(Ie(e,t),n+1)));return a(e,0),s})(e,s),(e=>ve(e,(e=>Ie(o,e)[0](t,...s??[],...a))))),e=>x(Ie(o,e),(([,t,s])=>(Fe(t,s??[n],void 0,(t=>(Te(t,e),Le(t)?1:0))),me(o,e),a(e),s))),e=>x(Ie(o,e),(([e,,n=[],s,a])=>{const o=(...r)=>{const l=P(r);l==P(n)?e(t,...r,...a(r)):k(n[l])?_(s[l]?.(...r)??[],(e=>o(...r,e))):o(...r,n[l])};o()}))]},Ge=Ue((e=>{let t,s,a,o=100,r=Se(),l=Se(),i=1;const c=Se(),d=Se(),[u,g,h]=qe((()=>J)),f=Se(),b=Se(),C=[],w=[],L=(t,n)=>{i=0,e.transaction((()=>{const[s,a]=Ie(f,n);ve(s,((n,s)=>ve(n,((n,a)=>ve(n,((n,o)=>Ne(e,s,a,o,n[t]))))))),ve(a,((n,s)=>Pe(e,s,n[t])))})),i=1},p=e=>{me(f,e),me(b,e),g(d,[e])},y=(e,t)=>_(((e,t)=>e.splice(0,t))(e,t??P(e)),p),v=()=>y(C,P(C)-o),T=()=>x(t,(()=>{Y(C,t),v(),y(w),t=void 0,a=1})),S=()=>{t=Z(C),a=1};let R,I;const M=(e=n)=>(k(t)&&(t=n+s++,me(f,t,[r,l]),H(t,e),r=Se(),l=Se(),a=1),t),m=()=>{K(C)||(((e,...t)=>{e.unshift(...t)})(w,M()),L(0,t),t=Z(C),a=1)},V=()=>{K(w)||(Y(C,t),t=ee(w),L(1,t),a=1)},D=()=>{a&&(g(c),a=0)},E=e=>{const t=M(e);return D(),t},H=(e,t)=>(A(e)&&Ie(b,e)!==t&&(me(b,e,t),g(d,[e])),J),A=e=>we(f,e),J={setSize:e=>(o=e,v(),J),addCheckpoint:E,setCheckpoint:H,getStore:()=>e,getCheckpointIds:()=>[[...C],t,[...w]],forEachCheckpoint:e=>Me(b,e),hasCheckpoint:A,getCheckpoint:e=>Ie(b,e),goBackward:()=>(m(),D(),J),goForward:()=>(V(),D(),J),goTo:e=>{const n=W(C,e)?m:W(w,e)?V:null;for(;!k(n)&&e!=t;)n();return D(),J},addCheckpointIdsListener:e=>u(e,c),addCheckpointListener:(e,t)=>u(t,d,[e]),delListener:e=>(h(e),J),clear:()=>(y(C),y(w),k(t)||p(t),t=void 0,s=0,E(),J),clearForward:()=>(K(w)||(y(w),g(c)),J),destroy:()=>{e.delListener(R),e.delListener(I)},getListenerStats:()=>({}),_registerListeners:()=>{R=e.addCellListener(null,null,null,((e,t,n,s,a,o)=>{if(i){T();const e=Ve(r,t,Se),l=Ve(e,n,Se),i=Ve(l,s,(()=>[o,void 0]));i[1]=a,i[0]===a&&Le(me(l,s))&&Le(me(e,n))&&Le(me(r,t))&&S(),D()}})),I=e.addValueListener(null,((e,t,n,s)=>{if(i){T();const e=Ve(l,t,(()=>[s,void 0]));e[1]=n,e[0]===n&&Le(me(l,t))&&S(),D()}}))}};return le(J.clear())}),(e=>e._registerListeners())),Ke="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(n),Xe=Se(q(Ke,((e,t)=>[e,t]))),Ye=e=>Ke[63&e],Ze=(e,t)=>Ie(Xe,e[t])??0,et=(e,t)=>(e??0)<(t??0)?-1:1,tt=(e=16)=>X(crypto.getRandomValues(new Uint8Array(e)),((e,t)=>e+Ye(t)),""),nt=Ue((e=>{const t=Se(),s=Se(),[a,o,r]=qe((()=>p)),[l,i,c,d,u,g,h,,f,b,C,w]=je(e,Se,(e=>k(e)?n:z(e)?q(e,M):M(e)),a,o),L=(t,n,s)=>{const a=u(t);ve(s,((t,s)=>n(s,(n=>ve(t,(t=>n(t,(n=>e.forEachCell(a,t,n)))))))))},p={setIndexDefinition:(e,n,a,r,l,i=et)=>{const c=k(l)?void 0:([e],[t])=>l(e,t);return f(e,n,((n,a,l,d,u,f)=>{let b=0;const C=Oe(),w=Oe(),L=g(e);if(ve(a,(([e,t],n)=>{const s=Oe(e),a=Oe(t);ve(s,(e=>Te(a,e)?Te(s,e):0)),ve(s,(e=>{We(C,e),x(Ie(L,e),(t=>{Te(t,n),Le(t)&&(me(L,e),b=1)}))})),ve(a,(e=>{We(C,e),we(L,e)||(me(L,e,Oe()),b=1),We(Ie(L,e),n),k(r)||We(w,e)}))})),n(),Le(u)||(f?Me(L,(e=>We(w,e))):Me(l,(e=>x(Ie(d,e),(e=>We(w,e))))),ve(w,(e=>{const t=(t,n)=>i(Ie(u,t),Ie(u,n),e),n=[...Ie(L,e)];U(n,t)||(me(L,e,Oe($(n,t))),We(C,e))}))),(b||f)&&!k(c)){const t=[...L];U(t,c)||(h(e,Se($(t,c))),b=1)}b&&o(t,[e]),ve(C,(t=>o(s,[e,t])))}),Be(a),x(r,Be)),p},delIndexDefinition:e=>(b(e),p),getStore:l,getIndexIds:i,forEachIndex:e=>c(((t,n)=>e(t,(e=>L(t,e,n))))),forEachSlice:(e,t)=>L(e,t,g(e)),hasIndex:d,hasSlice:(e,t)=>we(g(e),t),getTableId:u,getSliceIds:e=>Re(g(e)),getSliceRowIds:(e,t)=>pe(Ie(g(e),t)),addIndexIdsListener:C,addSliceIdsListener:(e,n)=>a(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>a(n,s,[e,t]),delListener:e=>(r(e),p),destroy:w,getListenerStats:()=>({})};return le(p)})),st=Se([["avg",[(e,t)=>G(e)/t,(e,t,n)=>e+(t-e)/(n+1),(e,t,n)=>e+(e-t)/(n-1),(e,t,n,s)=>e+(t-n)/s]],["max",[e=>E(...e),(e,t)=>E(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:E(t,e)]],["min",[e=>H(...e),(e,t)=>H(t,e),(e,t)=>t==e?void 0:e,(e,t,n)=>n==e?void 0:H(t,e)]],["sum",[e=>G(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,n)=>e-n+t]]]),at=(e,t,n,s,a,o=!1)=>{if(Le(n))return;const[r,l,i,c]=a;return o||=k(e),ve(s,(([n,s])=>{o||(e=k(n)?l?.(e,s,t++):k(s)?i?.(e,n,t--):c?.(e,s,n,t),o||=k(e))})),o?r(pe(n),Ce(n)):e},ot=Ue((e=>{const t=Se(),[s,a,o]=qe((()=>w)),[r,l,i,c,d,u,g,,h,f,b,C]=je(e,O,(e=>isNaN(e)||k(e)||!0===e||!1===e||e===n?void 0:1*e),s,a),w={setMetricDefinition:(e,n,s,o,r,l,i)=>{const c=Q(s)?[s,r,l,i]:Ie(st,s)??Ie(st,"sum");return h(e,n,((n,s,o,r,l,i)=>{const d=u(e),h=Ce(r);i||=k(d),n();let f=at(d,h,r,s,c,i);A(f)||(f=void 0),f!=d&&(g(e,f),a(t,[e],f,d))}),Be(o,1)),w},delMetricDefinition:e=>(f(e),w),getStore:r,getMetricIds:l,forEachMetric:i,hasMetric:c,getTableId:d,getMetric:u,addMetricIdsListener:b,addMetricListener:(e,n)=>s(n,t,[e]),delListener:e=>(o(e),w),destroy:C,getListenerStats:()=>({})};return le(w)})),rt=Se(),lt=Se(),it=(e,t,n,s,a,o,r,l={},i=[])=>{let c,d,u,g=0;Ve(rt,i,(()=>0)),Ve(lt,i,(()=>[]));const[h,f,b,C,w]=((e=1,t)=>e>1&&"getMergeableContent"in t?[1,t.getMergeableContent,t.getTransactionMergeableChanges,([[e],[t]])=>!he(e)||!he(t),t.setDefaultContent]:2!=e?[0,t.getContent,t.getTransactionChanges,([e,t])=>!he(e)||!he(t),t.setContent]:0)(r,e),L=t=>{(h&&z(t?.[0])?1===t?.[2]?e.applyMergeableChanges:e.setMergeableContent:1===t?.[2]?e.applyChanges:e.setContent)(t)},p=async e=>(2!=g&&(g=1,await S((async()=>{try{L(await t())}catch(t){o?.(t),e&&w(e)}g=0}))),R),y=()=>(d&&(a(d),d=void 0),R),v=async e=>(1!=g&&(g=2,await S((async()=>{try{await n(f,e)}catch(e){o?.(e)}g=0}))),R),T=()=>(x(u,e.delListener),u=void 0,R),S=async(...e)=>(Y(Ie(lt,i),...e),await(async()=>{if(!Ie(rt,i)){for(me(rt,i,1);!k(c=ee(Ie(lt,i)));)try{await c()}catch(e){o?.(e)}me(rt,i,0)}})(),R),R={load:p,startAutoLoad:async e=>(await y().load(e),d=s((async(e,t)=>{t||e?2!=g&&(g=1,L(t??e),g=0):await p()})),R),stopAutoLoad:y,isAutoLoading:()=>!k(d),save:v,startAutoSave:async()=>(await T().save(),u=e.addDidFinishTransactionListener((()=>{const e=b();C(e)&&v(e)})),R),stopAutoSave:T,isAutoSaving:()=>!k(u),schedule:S,getStore:()=>e,destroy:()=>y().stopAutoSave(),getStats:()=>({}),...l};return le(R)},ct=new globalThis.TextEncoder,dt=e=>{let t=2166136261;return _(ct.encode(e),(e=>{t^=e,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)})),t>>>0},ut=([e,t,n])=>[e,t,n],gt=([e,t])=>ht(e,t),ht=(e,t)=>t?[e,t]:[e],ft=e=>e[2],bt=(e,t)=>dt(e+":"+t),Ct=(e,t)=>t>e?(e?dt(e):0)^dt(t):0,wt=(e,t)=>((e??"")>(t??"")?e:t)??"",Lt=(e,t,n)=>{e[2]=t>>>0,n>e[1]&&(e[1]=n)},pt=(e=n)=>ht(ie(),e),yt=(e=n)=>[Se(),e,0],vt=([e,t,n],s=ut)=>[Ee(e,s),t,n],Tt=([e,t],n=gt)=>ht(Ee(e,n),t),St=(e,n)=>z(e)&&3==P(e)&&F(e[1])&&t(e[2])==o&&A(e[2])&&n(e[0]),Rt=Ue((e=>{const t=e.createStore,s=t(),a=t(),o=Se(),{addListener:r,callListeners:l,delListener:i}=a,[g,h,b,C,S,,,R,,I,M,m,V,D]=je(e,(()=>!0),O,r,l),E=(e,t,...n)=>_(n,(n=>We(Ve(Ve(o,t,Se),e,Oe),n))),H=e=>{x(Ie(o,e),(e=>{Me(e,((e,t)=>ve(t,(t=>e.delListener(t))))),ye(e)})),_([a,s],(t=>t.delTable(e)))},A=(e,t,n)=>E(t,e,t.addStartTransactionListener(n.startTransaction),t.addDidFinishTransactionListener((()=>n.finishTransaction()))),J={setQueryDefinition:(t,o,r)=>{R(t,o),H(t);const l=[],i=[[null,[o,null,null,[],Se()]]],c=[],d=[],u=[];r({select:(e,t)=>{const s=Q(e)?[P(l)+n,e]:[k(t)?e:t,n=>n(e,t)];return Y(l,s),{as:e=>s[0]=e}},join:(e,t,n)=>{const s=k(n)||Q(t)?null:t,a=k(s)?t:n,o=[e,[e,s,Q(a)?a:e=>e(a),[],Se()]];return Y(i,o),{as:e=>o[0]=e}},where:(e,t,n)=>Y(c,Q(e)?e:k(n)?n=>n(e)===t:s=>s(e,t)===n),group:(e,t,n,s,a)=>{const o=[e,[e,Q(t)?[t,n,s,a]:Ie(st,t)??[(e,t)=>t]]];return Y(d,o),{as:e=>o[0]=e}},having:(e,t)=>Y(u,Q(e)?e:n=>n(e)===t)});const g=Se(l);if(Le(g))return J;const h=Se(i);Me(h,((e,[,t])=>x(Ie(h,t),(({3:t})=>k(e)?0:Y(t,e)))));const f=Se(d);let b=s;if(Le(f)&&K(u))b=a;else{A(t,b,a);const e=Se();Me(f,((t,[n,s])=>We(Ve(e,n,Oe),[t,s])));const n=Oe();Me(g,(t=>we(e,t)?0:We(n,t)));const s=Se(),o=(n,s,o,r)=>x(n,(([l,i,c,d])=>{Me(s,((t,[n])=>{const s=Ve(l,t,Se),a=Ie(s,o),i=r?void 0:n;if(a!==i){const n=Oe([[a,i]]),r=Ce(s);me(s,o,i),ve(Ie(e,t),(([e,t])=>{const a=at(d[e],r,s,n,t);d[e]=k(Qe(a))?null:a}))}})),Le(i)||!j(u,(e=>e((e=>d[e]))))?a.delRow(t,c):k(c)?n[2]=a.addRow(t,d):a.setRow(t,c,d)}));E(b,t,b.addRowListener(t,null,((a,r,l,i)=>{const c=[],d=[],u=Se(),g=b.hasRow(t,l);let h=!g;ve(n,(e=>{const[n,s,a]=i(t,l,e);Y(c,s),Y(d,a),h||=n})),Me(e,(e=>{const[n,,s]=i(t,l,e);(h||n)&&me(u,e,[s])})),h&&o(Fe(s,c,void 0,(([,e])=>(Te(e,l),Le(e)))),u,l,1),g&&o(Fe(s,d,(()=>{const e={};return ve(n,(n=>e[n]=b.getCell(t,l,n))),[Se(),Oe(),void 0,e]}),(([,e])=>{We(e,l)})),u,l)})))}A(t,e,b);const C=(n,s,a,r)=>{const l=t=>e.getCell(s,a,t);_(r,(s=>{const[a,,o,r,i]=Ie(h,s),c=o?.(l,n),[d,u]=Ie(i,n)??[];c!=d&&(k(u)||D(t,u),me(i,n,k(c)?null:[c,...V(t,1,e.addRowListener(a,c,(()=>C(n,a,c,r))))]))})),(n=>{const s=(t,s)=>e.getCell(...k(s)?[o,n,t]:t===o?[o,n,s]:[Ie(h,t)?.[0],Ie(Ie(h,t)?.[4],n)?.[0],s]);b.transaction((()=>j(c,(e=>e(s)))?Me(g,((e,a)=>Ne(b,t,n,e,a(s,n)))):b.delRow(t,n)))})(n)},{3:w}=Ie(h,null);return b.transaction((()=>V(t,1,e.addRowListener(o,null,((n,s,a)=>{e.hasRow(o,a)?C(a,o,a,w):(b.delRow(t,a),ve(h,(({4:e})=>x(Ie(e,a),(([,n])=>{D(t,n),me(e,a)})))))}))))),J},delQueryDefinition:e=>(H(e),I(e),J),getStore:g,getQueryIds:h,forEachQuery:b,hasQuery:C,getTableId:S,addQueryIdsListener:e=>M((()=>e(J))),delListener:e=>(i(e),J),destroy:m,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:n,...s}=a.getListenerStats();return s}};return ge({[f]:[1,1],[f+T]:[0,1],[L]:[0,1],[p]:[0,1],[y]:[0,5],[w]:[1,2],[T]:[0,2],[v]:[1,3]},(([e,t],n)=>{_(e?["get","has","forEach"]:["get"],(e=>J[e+d+n]=(...t)=>a[e+n](...t))),J[u+d+n+c]=(...e)=>a[u+n+c](...N(e,0,t),((n,...s)=>e[t](J,...s)),!0)})),le(J)})),It=Ue((e=>{const t=Se(),s=Se(),a=Se(),o=Se(),[r,l,i]=qe((()=>T)),[c,d,u,g,h,f,,,b,C,w,L]=je(e,(()=>[Se(),Se(),Se(),Se()]),(e=>k(e)?void 0:e+n),r,l),p=(e,t,n)=>x(f(e),(([s,,a])=>{if(!we(a,t)){const o=Oe();if(h(e)!=v(e))We(o,t);else{let e=t;for(;!k(e)&&!we(o,e);)We(o,e),e=Ie(s,e)}if(n)return o;me(a,t,o)}return Ie(a,t)})),y=(e,t)=>x(f(e),(([,,e])=>me(e,t))),v=e=>Ie(t,e),T={setRelationshipDefinition:(e,n,r,i)=>(me(t,e,r),b(e,n,((t,n)=>{const r=Oe(),i=Oe(),c=Oe(),[d,u]=f(e);ve(n,(([t,n],s)=>{k(t)||(We(i,t),x(Ie(u,t),(e=>{Te(e,s),Le(e)&&me(u,t)}))),k(n)||(We(i,n),we(u,n)||me(u,n,Oe()),We(Ie(u,n),s)),We(r,s),me(d,s,n),Me(Ie(o,e),(t=>{we(p(e,t),s)&&We(c,t)}))})),t(),ve(r,(t=>l(s,[e,t]))),ve(i,(t=>l(a,[e,t]))),ve(c,(t=>{y(e,t),l(o,[e,t])}))}),Be(i)),T),delRelationshipDefinition:e=>(me(t,e),C(e),T),getStore:c,getRelationshipIds:d,forEachRelationship:t=>u((n=>t(n,(t=>e.forEachRow(h(n),t))))),hasRelationship:g,getLocalTableId:h,getRemoteTableId:v,getRemoteRowId:(e,t)=>Ie(f(e)?.[0],t),getLocalRowIds:(e,t)=>pe(Ie(f(e)?.[1],t)),getLinkedRowIds:(e,t)=>k(f(e))?[t]:pe(p(e,t,!0)),addRelationshipIdsListener:w,addRemoteRowIdListener:(e,t,n)=>r(n,s,[e,t]),addLocalRowIdsListener:(e,t,n)=>r(n,a,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(p(e,t),r(n,o,[e,t])),delListener:e=>(y(...i(e)??[]),T),destroy:L,getListenerStats:()=>({})};return le(T)})),Mt=e=>[e,e],mt=()=>[Se(),Se()],Vt=e=>[...e],Dt=([e,t])=>e===t,Et=e=>JSON.stringify(e,((e,t)=>t instanceof Map?te.fromEntries([...t]):t)),Ht=JSON.parse,At=(e,t,n)=>me(e,t,Ie(e,t)==-n?void 0:n),kt=()=>{let e,t,n=!1,s=!1,a=0,r=[];const d=Se(),h=Se(),y=Se(),m=Se(),V=Se(),D=Se(),E=Se(),H=Se(),A=Se(),F=Se(),z=Se(),P=Se(),O=Se(),j=Se(),U=Oe(),G=Se(),K=Se(),X=Se(),Z=Se(),ee=mt(),te=mt(),ne=mt(),se=mt(),ae=mt(),oe=mt(),re=mt(),ie=mt(),ue=mt(),fe=mt(),pe=mt(),Fe=mt(),ze=mt(),je=mt(),Be=mt(),Ue=mt(),$e=mt(),Ge=mt(),Ke=mt(),Xe=mt(),Ye=mt(),Ze=mt(),tt=Se(),nt=mt(),[st,at,ot,rt]=qe((()=>Jn)),lt=e=>{if(!be(e,((e,t)=>W([l,i],t))))return!1;const t=e[l];return!(!J(t)&&t!=o||(Qe(e[i])!=t&&de(e,i),0))},it=(t,n)=>(!e||we(z,n)||$t(n))&&be(t,((e,t)=>ct(n,t,e)),(()=>$t(n))),ct=(e,t,n,s)=>be(s?n:ht(n,e,t),((s,a)=>x(dt(e,t,a,s),(e=>(n[a]=e,!0)),(()=>!1))),(()=>$t(e,t))),dt=(t,n,s,a)=>e?x(Ie(Ie(z,t),s),(e=>Qe(a)!=e[l]?$t(t,n,s,a,e[i]):a),(()=>$t(t,n,s,a))):k(Qe(a))?$t(t,n,s,a):a,ut=(e,t)=>be(t?e:ft(e),((t,n)=>x(gt(n,t),(t=>(e[n]=t,!0)),(()=>!1))),(()=>_t())),gt=(e,n)=>t?x(Ie(O,e),(t=>Qe(n)!=t[l]?_t(e,n,t[i]):n),(()=>_t(e,n))):k(Qe(n))?_t(e,n):n,ht=(e,t,n)=>(x(Ie(P,t),(([s,a])=>{ve(s,((t,n)=>{ce(e,n)||(e[n]=t)})),ve(a,(s=>{ce(e,s)||$t(t,n,s)}))})),e),ft=e=>(t&&(ve(j,((t,n)=>{ce(e,n)||(e[n]=t)})),ve(U,(t=>{ce(e,t)||_t(t)}))),e),bt=e=>De(z,e,((e,t,n)=>{const s=Se(),a=Oe();De(Ve(z,t,Se),n,((e,t,n)=>{me(e,t,n),x(n[i],(e=>me(s,t,e)),(()=>We(a,t)))})),me(P,t,[s,a])}),((e,t)=>{me(z,t),me(P,t)})),Ct=e=>De(O,e,((e,t,n)=>{me(O,t,n),x(n[i],(e=>me(j,t,e)),(()=>We(U,t)))}),((e,t)=>{me(O,t),me(j,t),Te(U,t)})),wt=e=>he(e)?Mn():vn(e),Lt=e=>De(X,e,((e,t,n)=>pt(t,n)),((e,t)=>Ft(t))),pt=(e,t)=>De(Ve(X,e,(()=>(Pt(e,1),me(G,e,_e()),me(K,e,Se()),Se()))),t,((t,n,s)=>yt(e,t,n,s)),((t,n)=>Qt(e,t,n))),yt=(e,t,n,s,a)=>De(Ve(t,n,(()=>(Ot(e,n,1),Se()))),s,((t,s,a)=>vt(e,n,t,s,a)),((s,o)=>zt(e,t,n,s,o,a))),vt=(e,t,n,s,a)=>{we(n,s)||Wt(e,t,s,1);const o=Ie(n,s);a!==o&&(jt(e,t,s,o,a),me(n,s,a))},Tt=(e,t,n,s,a)=>x(Ie(t,n),(t=>vt(e,n,t,s,a)),(()=>yt(e,t,n,ht({[s]:a},e,n)))),St=e=>he(e)?Dn():Tn(e),Rt=e=>De(Z,e,((e,t,n)=>It(t,n)),((e,t)=>Nt(t))),It=(e,t)=>{we(Z,e)||Bt(e,1);const n=Ie(Z,e);t!==n&&(Ut(e,n,t),me(Z,e,t))},xt=(e,t)=>{const[n]=Ie(G,e),s=n(t);return we(Ie(X,e),s)?xt(e,t):s},Jt=e=>Ie(X,e)??pt(e,{}),Ft=e=>pt(e,{}),Qt=(e,t,n)=>{const[,s]=Ie(G,e);s(n),yt(e,t,n,{},!0)},zt=(e,t,n,s,a,o)=>{const r=Ie(Ie(P,e)?.[0],a);if(!k(r)&&!o)return vt(e,n,s,a,r);const l=t=>{jt(e,n,t,Ie(s,t)),Wt(e,n,t,-1),me(s,t)};k(r)?l(a):Me(s,l),Le(s)&&(Ot(e,n,-1),Le(me(t,n))&&(Pt(e,-1),me(X,e),me(G,e),me(K,e)))},Nt=e=>{const t=Ie(j,e);if(!k(t))return It(e,t);Ut(e,Ie(Z,e)),Bt(e,-1),me(Z,e)},Pt=(e,t)=>At(d,e,t),Ot=(e,t,n)=>At(Ve(m,e,Se),t,n)&&me(y,e,Ve(y,e,(()=>0))+n),Wt=(e,t,n,s)=>{const a=Ie(K,e),o=Ie(a,n)??0;(0==o&&1==s||1==o&&-1==s)&&At(Ve(h,e,Se),n,s),me(a,n,o!=-s?o+s:null),At(Ve(Ve(V,e,Se),t,Se),n,s)},jt=(e,t,n,s,a)=>{Ve(Ve(Ve(D,e,Se),t,Se),n,(()=>[s,0]))[1]=a,r[3]?.(e,t,n,a)},Bt=(e,t)=>At(E,e,t),Ut=(e,t,n)=>{Ve(H,e,(()=>[t,0]))[1]=n,r[4]?.(e,n)},$t=(e,t,n,s,a)=>(Y(Ve(Ve(Ve(A,e,Se),t,Se),n,(()=>[])),s),a),_t=(e,t,n)=>(Y(Ve(F,e,(()=>[])),t),n),qt=(e,t,n)=>x(Ie(Ie(Ie(D,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...Mt(dn(e,t,n))])),Gt=e=>x(Ie(H,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Mt(hn(e))])),Kt=e=>Le(A)||Le(Ue[e])?0:ve(e?Je(A):A,((t,n)=>ve(t,((t,s)=>ve(t,((t,a)=>at(Ue[e],[n,s,a],t))))))),Xt=e=>Le(F)||Le($e[e])?0:ve(e?ke(F):F,((t,n)=>at($e[e],[n],t))),Yt=(e,t,n,s)=>{if(!Le(e))return at(t,s,(()=>Ee(e))),Me(e,((e,t)=>at(n,[...s??[],e],1==t))),1},Zt=e=>{const t=fn();t!=n&&at(ee[e],void 0,t);const s=Le(fe[e]),a=Le(ze[e])&&Le(je[e])&&Le(ue[e])&&Le(pe[e])&&Le(oe[e])&&Le(re[e])&&Le(ie[e])&&s&&Le(ne[e])&&Le(se[e]),o=Le(Be[e])&&Le(Fe[e])&&Le(ae[e])&&Le(te[e]);if(!a||!o){const t=e?[ke(d),xe(h),ke(y),xe(m),Je(V),Je(D)]:[d,h,y,m,V,D];if(!a){Yt(t[0],ne[e],se[e]),ve(t[1],((t,n)=>Yt(t,oe[e],re[e],[n]))),ve(t[2],((t,n)=>{0!=t&&at(ie[e],[n],on(n))}));const n=Oe();ve(t[3],((t,a)=>{Yt(t,ue[e],pe[e],[a])&&!s&&(at(fe[e],[a,null]),We(n,a))})),s||ve(t[5],((t,s)=>{if(!we(n,s)){const n=Oe();ve(t,(e=>ve(e,(([t,s],a)=>s!==t?We(n,a):Te(e,a))))),ve(n,(t=>at(fe[e],[s,t])))}})),ve(t[4],((t,n)=>ve(t,((t,s)=>Yt(t,ze[e],je[e],[n,s])))))}if(!o){let n;ve(t[5],((t,s)=>{let a;ve(t,((t,o)=>{let r;ve(t,(([t,l],i)=>{l!==t&&(at(Be[e],[s,o,i],l,t,qt),n=a=r=1)})),r&&at(Fe[e],[s,o],qt)})),a&&at(ae[e],[s],qt)})),n&&at(te[e],void 0,qt)}}},en=e=>{const t=pn();t!=s&&at(Ge[e],void 0,t);const n=Le(Xe[e])&&Le(Ye[e]),a=Le(Ze[e])&&Le(Ke[e]);if(!n||!a){const t=e?[ke(E),ke(H)]:[E,H];if(n||Yt(t[0],Xe[e],Ye[e]),!a){let n;ve(t[1],(([t,s],a)=>{s!==t&&(at(Ze[e],[a],s,t,Gt),n=1)})),n&&at(Ke[e],void 0,Gt)}}},tn=(e,...t)=>(An((()=>e(...q(t,M)))),Jn),nn=()=>Ae(X),sn=()=>Re(X),an=e=>Re(Ie(K,M(e))),on=e=>Ce(Ie(X,M(e))),rn=e=>Re(Ie(X,M(e))),ln=(e,t,n,s=0,a)=>{return q(N($((o=Ie(X,M(e)),r=(e,n)=>[k(t)?n:Ie(e,M(t)),n],q([...o?.entries()??[]],(([e,t])=>r(t,e)))),(([e],[t])=>et(e,t)*(n?-1:1))),s,k(a)?a:s+a),(([,e])=>e));var o,r},cn=(e,t)=>Re(Ie(Ie(X,M(e)),M(t))),dn=(e,t,n)=>Ie(Ie(Ie(X,M(e)),M(t)),M(n)),un=()=>Ee(Z),gn=()=>Re(Z),hn=e=>Ie(Z,M(e)),fn=()=>!Le(X),bn=e=>we(X,M(e)),Cn=(e,t)=>we(Ie(K,M(e)),M(t)),wn=(e,t)=>we(Ie(X,M(e)),M(t)),Ln=(e,t,n)=>we(Ie(Ie(X,M(e)),M(t)),M(n)),pn=()=>!Le(Z),yn=e=>we(Z,M(e)),vn=e=>tn((()=>(e=>be(e,it,$t))(e)?Lt(e):0)),Tn=e=>tn((()=>ut(e)?Rt(e):0)),Sn=e=>{try{wt(Ht(e))}catch{}return Jn},Rn=t=>tn((()=>{if((e=be(t,(e=>be(e,lt))))&&(bt(t),!Le(X))){const e=nn();Mn(),vn(e)}})),In=e=>tn((()=>{if(t=(e=>be(e,lt))(e)){const n=un();Hn(),Dn(),t=!0,Ct(e),Tn(n)}})),Mn=()=>tn((()=>Lt({}))),mn=e=>tn((e=>we(X,e)?Ft(e):0),e),Vn=(e,t)=>tn(((e,t)=>x(Ie(X,e),(n=>we(n,t)?Qt(e,n,t):0))),e,t),Dn=()=>tn((()=>Rt({}))),En=()=>tn((()=>{bt({}),e=!1})),Hn=()=>tn((()=>{Ct({}),t=!1})),An=(e,t)=>{if(-1!=a){kn();const n=e();return xn(t),n}},kn=()=>(-1!=a&&a++,1==a&&(r[0]?.(),at(tt)),Jn),xn=e=>(a>0&&(a--,0==a&&(a=1,Kt(1),Le(D)||Zt(1),Xt(1),Le(H)||en(1),e?.(Jn)&&(ve(D,((e,t)=>ve(e,((e,n)=>ve(e,(([e],s)=>Ne(Jn,t,n,s,e))))))),ye(D),ve(H,(([e],t)=>Pe(Jn,t,e))),ye(H)),at(nt[0],void 0),a=-1,Kt(0),Le(D)||Zt(0),Xt(0),Le(H)||en(0),r[1]?.(),at(nt[1],void 0),r[2]?.(),a=0,n=fn(),s=pn(),_([d,h,y,m,V,D,A,E,H,F],ye))),Jn),Jn={getContent:()=>[nn(),un()],getTables:nn,getTableIds:sn,getTable:e=>He(Ie(X,M(e))),getTableCellIds:an,getRowCount:on,getRowIds:rn,getSortedRowIds:ln,getRow:(e,t)=>Ee(Ie(Ie(X,M(e)),M(t))),getCellIds:cn,getCell:dn,getValues:un,getValueIds:gn,getValue:hn,hasTables:fn,hasTable:bn,hasTableCell:Cn,hasRow:wn,hasCell:Ln,hasValues:pn,hasValue:yn,getTablesJson:()=>Et(X),getValuesJson:()=>Et(Z),getJson:()=>Et([X,Z]),getTablesSchemaJson:()=>Et(z),getValuesSchemaJson:()=>Et(O),getSchemaJson:()=>Et([z,O]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>tn((()=>{(he(e)?Mn:vn)(e),(he(t)?Dn:Tn)(t)})),setTables:vn,setTable:(e,t)=>tn((e=>it(t,e)?pt(e,t):0),e),setRow:(e,t,n)=>tn(((e,t)=>ct(e,t,n)?yt(e,Jt(e),t,n):0),e,t),addRow:(e,t,n=!0)=>An((()=>{let s;return ct(e,s,t)&&(e=M(e),yt(e,Jt(e),s=xt(e,n?1:0),t)),s})),setPartialRow:(e,t,n)=>tn(((e,t)=>{if(ct(e,t,n,1)){const s=Jt(e);ge(n,((n,a)=>Tt(e,s,t,a,n)))}}),e,t),setCell:(e,t,n,s)=>tn(((e,t,n)=>x(dt(e,t,n,Q(s)?s(dn(e,t,n)):s),(s=>Tt(e,Jt(e),t,n,s)))),e,t,n),setValues:Tn,setPartialValues:e=>tn((()=>ut(e,1)?ge(e,((e,t)=>It(t,e))):0)),setValue:(e,t)=>tn((e=>x(gt(e,Q(t)?t(hn(e)):t),(t=>It(e,t)))),e),applyChanges:e=>tn((()=>{ge(e[0],((e,t)=>k(e)?mn(t):ge(e,((e,n)=>k(e)?Vn(t,n):ge(e,((e,s)=>Ne(Jn,t,n,s,e))))))),ge(e[1],((e,t)=>Pe(Jn,t,e)))})),setTablesJson:Sn,setValuesJson:e=>{try{St(Ht(e))}catch{}return Jn},setJson:e=>tn((()=>{try{const[t,n]=Ht(e);wt(t),St(n)}catch{Sn(e)}})),setTablesSchema:Rn,setValuesSchema:In,setSchema:(e,t)=>tn((()=>{Rn(e),In(t)})),delTables:Mn,delTable:mn,delRow:Vn,delCell:(e,t,n,s)=>tn(((e,t,n)=>x(Ie(X,e),(a=>x(Ie(a,t),(o=>we(o,n)?zt(e,a,t,o,n,s):0))))),e,t,n),delValues:Dn,delValue:e=>tn((e=>we(Z,e)?Nt(e):0),e),delTablesSchema:En,delValuesSchema:Hn,delSchema:()=>tn((()=>{En(),Hn()})),transaction:An,startTransaction:kn,getTransactionChanges:()=>[Ee(D,((e,t)=>-1===Ie(d,t)?void 0:Ee(e,((e,n)=>-1===Ie(Ie(m,t),n)?void 0:Ee(e,(([,e])=>e),(e=>Dt(e)))),Le,he)),Le,he),Ee(H,(([,e])=>e),(e=>Dt(e))),1],getTransactionLog:()=>[!Le(D),!Le(H),Ae(D,Vt,Dt),Ae(A),Ee(H,Vt,Dt),Ee(F),Ee(d),He(m),Ae(V),Ee(E)],finishTransaction:xn,forEachTable:e=>ve(X,((t,n)=>e(n,(e=>ve(t,((t,n)=>e(n,(e=>Me(t,e))))))))),forEachTableCell:(e,t)=>Me(Ie(K,M(e)),t),forEachRow:(e,t)=>ve(Ie(X,M(e)),((e,n)=>t(n,(t=>Me(e,t))))),forEachCell:(e,t,n)=>Me(Ie(Ie(X,M(e)),M(t)),n),forEachValue:e=>Me(Z,e),addSortedRowIdsListener:(e,t,n,s,a,o,r)=>{let l=ln(e,t,n,s,a);return st((()=>{const r=ln(e,t,n,s,a);B(r,l)||(l=r,o(Jn,e,t,n,s,a,l))}),fe[r?1:0],[e,t],[sn])},addStartTransactionListener:e=>st(e,tt),addWillFinishTransactionListener:e=>st(e,nt[0]),addDidFinishTransactionListener:e=>st(e,nt[1]),callListener:e=>(rt(e),Jn),delListener:e=>(ot(e),Jn),getListenerStats:()=>({}),createStore:kt,addListener:st,callListeners:at,setInternalListeners:(e,t,n,s,a)=>r=[e,t,n,s,a]};return ge({[g+b]:[0,ee,[],()=>[fn()]],[b]:[0,te],[C]:[0,ne],[g+f]:[1,se,[sn],e=>[bn(...e)]],[f]:[1,ae,[sn]],[f+T]:[1,oe,[sn]],[g+f+v]:[2,re,[sn,an],e=>[Cn(...e)]],[L]:[1,ie,[sn]],[p]:[1,ue,[sn]],[g+w]:[2,pe,[sn,rn],e=>[wn(...e)]],[w]:[2,Fe,[sn,rn]],[T]:[2,ze,[sn,rn]],[g+v]:[3,je,[sn,rn,cn],e=>[Ln(...e)]],[v]:[3,Be,[sn,rn,cn],e=>Mt(dn(...e))],InvalidCell:[3,Ue],[g+R]:[0,Ge,[],()=>[pn()]],[R]:[0,Ke],[I]:[0,Xe],[g+S]:[1,Ye,[gn],e=>[yn(...e)]],[S]:[1,Ze,[gn],e=>Mt(hn(e[0]))],InvalidValue:[1,$e]},(([e,t,n,s],a)=>{Jn[u+a+c]=(...a)=>st(a[e],t[a[e+1]?1:0],e>0?N(a,0,e):void 0,n,s)})),le(Jn)},xt=2**36,Jt=2**30,Ft=2**24,Qt=2**18,zt=4096,Nt={HasTable:1,Table:1,TableCellIds:1,HasTableCell:2,RowCount:1,RowIds:1,SortedRowIds:5,HasRow:2,Row:2,CellIds:2,HasCell:3,Cell:3,HasValue:1,Value:1,InvalidCell:3,InvalidValue:1},Pt=(e=n)=>[yt(e),yt(e)];e.createCheckpoints=Ge,e.createCustomPersister=it,e.createCustomSynchronizer=(e,t,s,a,o,r,l={})=>{let i;const c=Se();s(((n,s,a,o)=>{0==a?x(Ie(c,s),(([e,t])=>k(e)||e==n?t(o,n):0)):2==a&&h.isAutoLoading()?g(n,o).then((e=>{i?.(void 0,e)})):3==a&&h.isAutoLoading()?i?.(void 0,o):x(1==a&&h.isAutoSaving()?e.getMergeableContentHashes():4==a?e.getMergeableTableDiff(o):5==a?e.getMergeableRowDiff(o):6==a?e.getMergeableCellDiff(o):7==a?e.getMergeableValueDiff(o):void 0,(e=>{t(n,s,0,e)}))}));const d=async(e,s,a=n)=>new D(((n,r)=>{const l=tt(),i=setTimeout((()=>{Te(c,l),r(`No response from ${e??"anyone"} to '${s}'`)}),1e3*o);me(c,l,[e,(e,t)=>{clearTimeout(i),Te(c,l),n([e,t])}]),t(e,l,s,a)})),u=(e,[t,n])=>{ue(t,(([t,n],s)=>{const a=fe(e[0],s,pt);ue(t,(([e,t],n)=>{const s=fe(a[0],n,pt);ue(e,(([e,t],n)=>s[0][n]=ht(e,t))),s[1]=wt(s[1],t)})),a[1]=wt(a[1],n)})),e[1]=wt(e[1],n)},g=async(t=null,n)=>{k(n)&&([n,t]=await d(t,1));const[s,a]=n,[o,r]=e.getMergeableContentHashes();let l=pt();if(o!=s){const[n,s]=(await d(t,4,e.getMergeableTableHashes()))[0];if(l=n,!he(s)){const[n,a]=(await d(t,5,e.getMergeableRowHashes(s)))[0];if(u(l,n),!he(a)){const n=(await d(t,6,e.getMergeableCellHashes(a)))[0];u(l,n)}}}return[l,r==a?pt():(await d(t,7,e.getMergeableValuesHashes()))[0],1]},h=it(e,(async()=>{const e=await g();return he(e[0][0])&&he(e[1][0])?void 0:e}),(async(n,s)=>{s?t(null,null,3,s):t(null,null,2,e.getMergeableContentHashes())}),(e=>i=e),(()=>i=void 0),r,2,{startSync:async e=>await(await h.startAutoLoad(e)).startAutoSave(),stopSync:()=>h.stopAutoLoad().stopAutoSave(),destroy:()=>(a(),h.stopSync()),getSynchronizerStats:()=>({}),...l});return h},e.createIndexes=nt,e.createMergeableStore=e=>{let t=1,s=Pt(),a=0;const o=Se(),r=Oe(),[l,i]=(e=>{let t=0,n=-1;const s=x(e,(e=>{const t=dt(e);return Ye(t/Ft)+Ye(t/Qt)+Ye(t/zt)+Ye(t/64)+Ye(t)}),(()=>tt(5))),a=e=>{const s=t,[a,o]=k(e)||""==e?[0,0]:[Ze(r=e,0)*xt+Ze(r,1)*Jt+Ze(r,2)*Ft+Ze(r,3)*Qt+Ze(r,4)*zt+64*Ze(r,5)+Ze(r,6),Ze(r,7)*Qt+Ze(r,8)*zt+64*Ze(r,9)+Ze(r,10)];var r;t=E(s,a,Date.now()),n=t==s?t==a?E(n,o):n:t==a?o:-1};return[()=>{return a(),o=++n,Ye((e=t)/xt)+Ye(e/Jt)+Ye(e/Ft)+Ye(e/Qt)+Ye(e/zt)+Ye(e/64)+Ye(e)+Ye(o/Qt)+Ye(o/zt)+Ye(o/64)+Ye(o)+s;var e,o},a]})(e),c=kt(),d=e=>{const n=t;return t=0,e(),t=n,b},u=(e,t=0)=>{const a={},o={},[[r,l=n,c=0],d]=e,[u,h]=s,[f,b,C]=u;let w=t?c:C,L=l;ue(r,(([e,s=n,o=0],r)=>{const l=Ve(f,r,yt),[i,c,d]=l;let u=t?o:d,h=s;ue(e,((e,n)=>{const[s,o,l]=g(e,Ve(i,n,yt),fe(fe(a,r,ie),n,ie),t);u^=t?0:(o?bt(n,o):0)^bt(n,l),h=wt(h,s)})),u^=t?0:Ct(c,s),Lt(l,u,s),w^=t?0:(d?bt(r,d):0)^bt(r,l[2]),L=wt(L,h)})),w^=t?0:Ct(b,l),Lt(u,w,l);const[p]=g(d,h,o,t);return i(wt(L,p)),[a,o,1]},g=(e,t,s,a)=>{const[o,r=n,l=0]=e,[i,c,d]=t;let u=r,g=a?l:d;return ue(o,(([e,t,o=0],r)=>{const l=Ve(i,r,(()=>[void 0,n,0])),[,c,d]=l;(!c||t>c)&&(Lt(l,a?o:dt(Et(e??null)+":"+t),t),l[0]=e,s[r]=e,g^=a?0:bt(r,d)^bt(r,l[2]),u=wt(u,t))})),g^=a?0:Ct(c,r),Lt(t,g,r),[u,d,t[2]]},h=()=>[vt(s[0],(e=>vt(e,(e=>vt(e))))),vt(s[1])],f=e=>d((()=>c.applyChanges(u(e)))),b={getMergeableContent:h,getMergeableContentHashes:()=>[s[0][2],s[1][2]],getMergeableTableHashes:()=>Ee(s[0][0],ft),getMergeableTableDiff:e=>{const t=pt(s[0][1]),n={};return Me(s[0][0],((s,[a,o,r])=>ce(e,s)?r!=e[s]?n[s]=r:0:t[0][s]=Tt([a,o],(e=>Tt(e))))),[t,n]},getMergeableRowHashes:e=>{const t={};return ue(e,((e,n)=>x(Ie(s[0][0],n),(([s,,a])=>a!=e?Me(s,((e,[,,s])=>fe(t,n,ie)[e]=s)):0)))),t},getMergeableRowDiff:e=>{const t=pt(s[0][1]),n={};return ue(e,((e,a)=>Me(Ie(s[0][0],a)?.[0],((s,[o,r,l])=>ce(e,s)?l!==e[s]?fe(n,a,ie)[s]=l:0:fe(t[0],a,pt)[0][s]=Tt([o,r]))))),[t,n]},getMergeableCellHashes:e=>{const t={};return ue(e,((e,n)=>x(Ie(s[0][0],n),(([s])=>ue(e,((e,a)=>x(Ie(s,a),(([s,,o])=>o!==e?Me(s,((e,[,,s])=>fe(fe(t,n,ie),a,ie)[e]=s)):0)))))))),t},getMergeableCellDiff:e=>{const[[t,n]]=s,a={};return ue(e,((e,n)=>ue(e,((e,s)=>x(Ie(t,n),(([t,o])=>x(Ie(t,s),(([t,r])=>Me(t,((t,[l,i,c])=>c!==e[t]?fe(fe(a,n,(()=>pt(o)))[0],s,(()=>pt(r)))[0][t]=[l,i]:0)))))))))),ht(a,n)},getMergeableValuesHashes:()=>Ee(s[1][0],ft),getMergeableValueDiff:e=>{const[,[t,n]]=s,a=Ee(t,gt,(([,,t],n)=>t==e?.[n]));return ht(a,n)},setMergeableContent:e=>d((()=>(e=>z(e)&&2==P(e)&&St(e[0],(e=>be(e,(e=>St(e,(e=>be(e,(e=>St(e,(e=>be(e,(e=>St(e,ze)),void 0,1)))),void 0,1)))),void 0,1)))&&St(e[1],(e=>be(e,(e=>St(e,ze)),void 0,1))))(e)?c.transaction((()=>{c.delTables().delValues(),s=Pt(),c.applyChanges(u(e,1))})):0)),setDefaultContent:e=>(c.transaction((()=>{a=1,c.setContent(e),a=0})),b),getTransactionMergeableChanges:()=>{const[[e,t],[n,a]]=s,l={};ve(o,((t,n)=>x(Ie(e,n),(([e,s])=>{const a={};ve(t,((t,n)=>x(Ie(e,n),(([e,s])=>{const o={};ve(t,(t=>{x(Ie(e,t),(([e,n])=>o[t]=ht(e,n)))})),a[n]=ht(o,s)})))),l[n]=ht(a,s)}))));const i={};return ve(r,(e=>x(Ie(n,e),(([t,n])=>i[e]=ht(t,n))))),[ht(l,t),ht(i,a),1]},applyMergeableChanges:f,merge:e=>{const t=h(),n=e.getMergeableContent();return e.applyMergeableChanges(t),f(n)}};return c.setInternalListeners((()=>{}),(()=>{}),(()=>{ye(o),ye(r)}),((e,s,r,i)=>{We(Ve(Ve(o,e,Se),s,Oe),r),t&&u([[{[e]:[{[s]:[{[r]:[i,a?n:l()]}]}]}],[{}],1])}),((e,s)=>{We(r,e),t&&u([[{}],[{[e]:[s,a?n:l()]}],1])})),ge(c,((e,t)=>b[t]=m(t,"set")||m(t,"del")||m(t,"apply")||V(t,"Transaction")||"callListener"==t?(...t)=>(e(...t),b):m(t,"add")&&V(t,"Listener")?(...n)=>{const s=Nt[N(t,3,-8)]??0,a=n[s];return n[s]=(e,...t)=>a(b,...t),e(...n)}:e)),le(b)},e.createMetrics=ot,e.createQueries=Rt,e.createRelationships=It,e.createStore=kt,e.defaultSorter=et,e.getUniqueId=tt},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={});
