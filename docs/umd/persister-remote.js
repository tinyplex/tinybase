var t,e;t=this,e=function(t){"use strict";const e=clearInterval,a=t=>null==t,s=(t,e,s)=>a(t)?s?.():e(t),n=Object,o=t=>n.getPrototypeOf(t),r=n.keys,i=n.freeze,c=t=>(t=>!a(t)&&s(o(t),(t=>t==n.prototype||a(o(t))),(()=>!0)))(t)&&0==(t=>r(t).length)(t),y=JSON.parse,d=t=>new Map(t),l=(t,e)=>t?.get(e),p=(t,e,s)=>{return a(s)?(n=t,o=e,n?.delete(o),t):t?.set(e,s);var n,o},u=(t,e,a,s)=>{var n,o;return n=t,o=e,n?.has(o)||p(t,e,a()),l(t,e)},h=d(),f=d(),g=t=>t.headers.get("ETag");t.createRemotePersister=(t,o,r,d=5,v)=>{let w;return((t,e,n,o,r,y,d,g={},v=[])=>{let w,A,S,C=0;u(h,v,(()=>0)),u(f,v,(()=>[]));const[T,b,m,L,O]=((t,e)=>[0,e.getContent,e.getTransactionChanges,([t,e])=>!c(t)||!c(e),e.setContent])(0,t),x=async t=>(2!=C&&(C=1,await P.schedule((async()=>{await t(),C=0}))),P),M=e=>{var a;(T&&(a=e?.[0],Array.isArray(a))?1===e?.[2]?t.applyMergeableChanges:t.setMergeableContent:1===e?.[2]?t.applyChanges:t.setContent)(e)},P={load:async t=>await x((async()=>{try{M(await e())}catch(e){y?.(e),t&&O(t)}})),startAutoLoad:async t=>(await P.stopAutoLoad().load(t),A=o((async(t,a)=>{const s=a?.();await x((async()=>{try{M(s??t?.()??await e())}catch(t){y?.(t)}}))})),P),stopAutoLoad:()=>(A&&(r(A),A=void 0),P),isAutoLoading:()=>!a(A),save:async t=>(1!=C&&(C=2,await P.schedule((async()=>{try{await n(b,t)}catch(t){y?.(t)}C=0}))),P),startAutoSave:async()=>(await P.stopAutoSave().save(),S=t.addDidFinishTransactionListener((()=>{const t=m();L(t)&&P.save((()=>t))})),P),stopAutoSave:()=>(s(S,t.delListener),S=void 0,P),isAutoSaving:()=>!a(S),schedule:async(...t)=>(((t,...e)=>{t.push(...e)})(l(f,v),...t),await(async()=>{if(!l(h,v)){for(p(h,v,1);!a((t=l(f,v),w=t.shift()));)try{await w()}catch(t){y?.(t)}p(h,v,0)}var t})(),P),getStore:()=>t,destroy:()=>P.stopAutoLoad().stopAutoSave(),getStats:()=>({}),...g};return i(P)})(t,(async()=>{const t=await fetch(o);return w=g(t),y(await t.text())}),(async t=>{return await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:(e=t(),JSON.stringify(e,((t,e)=>e instanceof Map?n.fromEntries([...e]):e)))});var e}),(t=>setInterval((async()=>{const e=await fetch(o,{method:"HEAD"}),s=g(e);a(w)||a(s)||s==w||(w=s,t())}),1e3*d)),(t=>e(t)),v,0,{getUrls:()=>[o,r]})}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterRemote={});
