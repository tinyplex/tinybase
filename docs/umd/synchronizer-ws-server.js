var e,t;e=this,t=function(e){"use strict";const t=e=>null==e,n=(e,n,s)=>t(e)?s?.():n(e),s=(e,t,n)=>e.slice(t,n),o=e=>e?.size??0,r=(c=o,e=>{return t=(e,t)=>e+c(t),a(e).reduce(t,0);var t});var c;const a=e=>[...e?.values()??[]],i=(e,t)=>e?.delete(t),d=e=>new Map(e),l=e=>[...e?.keys()??[]],f=(e,t)=>e?.get(t),u=(e,n,s)=>t(s)?(i(e,n),e):e?.set(n,s),h=/\/([^?]*)/;e.createWsServer=e=>{const c=d();return e.on("connection",((e,r)=>n(r.url?.match(h),(([a])=>n(r.headers["sec-websocket-key"],(n=>{const r=(g=d,p=l=c,v=h=a,p?.has(v)||u(l,h,g()),f(l,h));var l,h,g,p,v;u(r,n,e),e.on("message",(e=>{const t=e.toString("utf8"),o=t.indexOf("\n");if(-1!==o){const e=s(t,0,o),c=s(t,o+1);""===e?((e,t)=>{((e,t)=>{e?.forEach(((e,t)=>{return s=e,t!=n?s.send(n+"\n"+c):0;var s}))})(e)})(r):f(r,e)?.send(n+"\n"+c)}})),e.on("close",(()=>{i(r,n),(e=>t(e)||0==o(e))(r)&&i(c,a)}))})))))),{getWebSocketServer:()=>e,getPaths:()=>l(c),getClientIds:e=>l(f(c,e)),getStats:()=>({paths:o(c),clients:r(c)}),destroy:()=>{e.close(),c.clear()}}}},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseSynchronizerWsServer={});
