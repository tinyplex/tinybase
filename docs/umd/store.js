var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n=t(""),s=t(!0),r=t(0),l=t(t),a="type",o="default",i=e=>[e,e],d=(e,t)=>e.forEach(t),c=e=>e.length,u=e=>0==c(e),f=(e,t,n)=>e.slice(t,n),h=(e,...t)=>e.push(...t),T=e=>JSON.stringify(e,((e,t)=>{return g(t,Map)?(n=[...t],s=(e,[t,n])=>(e[t]=n,e),r={},n.reduce(s,r)):t;var n,s,r})),b=JSON.parse,p=isFinite,g=(e,t)=>e instanceof t,y=e=>null==e,L=(e,t,n)=>y(e)?n?.():t(e),w=e=>e==n||e==s,v=e=>e.size,R=(e,t)=>e?.has(t)??!1,S=e=>y(e)||0==v(e),C=e=>e.clear(),I=(e,t)=>e?.forEach(t),m=(e,t)=>e?.delete(t),E=e=>new Map(e),J=(e=E)=>[e(),e()],F=e=>[...e?.keys()??[]],O=(e,t)=>e?.get(t),j=(e,t)=>I(e,((e,n)=>t(n,e))),x=(e,t,n)=>y(n)?(m(e,t),e):e?.set(t,n),z=(e,t,n)=>(R(e,t)||e.set(t,n()),O(e,t)),M=(e,t,n)=>{const s={},r=t??(e=>e);return I(e,((e,t)=>L(r(e),(e=>n?.(e)?0:s[t]=e)))),s},k=(e,t)=>{const n=E(),s=t??(e=>e);return I(e,((e,t)=>n.set(t,s(e)))),n},N=e=>k(e,k),P=e=>new Set(e),_=(e,t)=>e?.add(t),B=(e,t,n)=>c(n)<2?_(u(n)?e:z(e,n[0],P),t):B(z(e,n[0],E),t,f(n,1)),D=e=>{const t=(n,s,...r)=>L(n,(n=>u(r)?e(n,s):d([r[0],null],(e=>t(O(n,e),s,...f(r,1))))));return t},W=Object,q=W.keys,A=W.isFrozen,G=W.freeze,H=(e,t)=>!y(((e,t)=>L(e,(e=>e[t])))(e,t)),K=(e,t)=>delete e[t],Q=(e,t)=>d(W.entries(e),(([e,n])=>t(n,e))),U=e=>u(q(e)),V=e=>{const n=t(e);return w(n)||n==r&&p(e)?n:void 0},X=(e,t,n,s=x)=>{const r=(l=F(e),a=e=>!H(t,e),l.filter(a));var l,a;return d(q(t),(s=>n(e,s,t[s]))),d(r,(t=>s(e,t))),e},Y=(e,t,n)=>y(e)||!(e=>g(e,W)&&e.constructor==W)(e)||U(e)||A(e)?(n?.(),!1):(Q(e,((n,s)=>{t(n,s)||K(e,s)})),!U(e)),Z=(e,t,n)=>x(e,t,O(e,t)==-n?void 0:n),$=()=>{let e,n,s=0,u=0;const f=E(),p=E(),g=E(),W=E(),q=E(),A=E(),ee=E(),te=E(),ne=J(P),se=J(P),re=J(),le=J(),ae=J(),oe=J(),ie=J(),de=J(),ce=J(P),[ue,fe,he,Te]=(e=>{let t,n=0;const s=[],r=E();return[(l,a,o=[])=>{t??=e();const i=s.pop()??""+n++;return x(r,i,[l,a,o]),B(a,i,o),i},(e,n=[],...s)=>D(I)(e,(e=>L(O(r,e),(([e])=>e(t,...n,...s)))),...n),e=>L(O(r,e),(([,t,n])=>(D(m)(t,e,...n),x(r,e),c(s)<1e3&&h(s,e),n)),(()=>[])),(e,n,s)=>L(O(r,e),(([e,,r])=>{const l=(...a)=>{const o=c(a);o==c(r)?e(t,...a,...s(a)):y(r[o])?d(n[o](...a),(e=>l(...a,e))):l(...a,r[o])};l()}))]})((()=>Ze)),be=(t,n)=>(!e||R(A,n)||Me(n))&&Y(t,((e,t)=>pe(n,t,e)),(()=>Me(n))),pe=(e,t,n,s)=>Y(s?n:ye(n,e,t),((s,r)=>L(ge(e,t,r,s),(e=>(n[r]=e,!0)),(()=>!1))),(()=>Me(e,t))),ge=(t,n,s,r)=>e?L(O(O(A,t),s),(e=>V(r)!=e.type?Me(t,n,s,r,e.default):r),(()=>Me(t,n,s,r))):y(V(r))?Me(t,n,s,r):r,ye=(e,t,n)=>(L(O(ee,t),(([s,r])=>{I(s,((t,n)=>{H(e,n)||(e[n]=t)})),I(r,(s=>{H(e,s)||Me(t,n,s)}))})),e),Le=e=>X(A,e,((e,t,n)=>{const s=E(),r=P();X(z(A,t,E),n,((e,t,n)=>{x(e,t,n),L(n.default,(e=>x(s,t,e)),(()=>_(r,t)))})),x(ee,t,[s,r])}),((e,t)=>{x(A,t),x(ee,t)})),we=e=>X(te,e,((e,t,n)=>ve(t,n)),((e,t)=>Ee(t))),ve=(e,t)=>X(z(te,e,(()=>(Oe(e,1),E()))),t,((t,n,s)=>Re(e,t,n,s)),((t,n)=>Je(e,t,n))),Re=(e,t,n,s,r)=>X(z(t,n,(()=>(je(e,n,1),E()))),s,((t,s,r)=>Se(e,n,t,s,r)),((s,l)=>Fe(e,t,n,s,l,r))),Se=(e,t,n,s,r)=>{R(n,s)||xe(e,t,s,1);const l=O(n,s);r!==l&&(ze(e,t,s,l,r),x(n,s,r))},Ce=(e,t,n,s,r)=>L(O(t,n),(t=>Se(e,n,t,s,r)),(()=>Re(e,t,n,ye({[s]:r},e,n)))),Ie=e=>{const t=""+s++;return R(e,t)?Ie(e):t},me=e=>O(te,e)??ve(e,{}),Ee=e=>ve(e,{}),Je=(e,t,n)=>Re(e,t,n,{},!0),Fe=(e,t,n,s,r,l)=>{const a=O(O(ee,e)?.[0],r);if(!y(a)&&!l)return Se(e,n,s,r,a);const o=t=>{ze(e,n,t,O(s,t)),xe(e,n,t,-1),x(s,t)};y(a)?o(r):j(s,o),S(s)&&(je(e,n,-1),S(x(t,n))&&(Oe(e,-1),x(te,e)))},Oe=(e,t)=>Z(S(f)?x(f,null,We()):f,e,t),je=(e,t,n)=>Z(z(p,e,(()=>E([[null,qe(e)]]))),t,n),xe=(e,t,n,s)=>Z(z(z(g,e,E),t,(()=>E([[null,Ae(e,t)]]))),n,s),ze=(e,t,n,s,r)=>z(z(z(W,e,E),t,E),n,(()=>[s,0]))[1]=r,Me=(e,t,n,s,r)=>(h(z(z(z(q,e,E),t,E),n,(()=>[])),s),r),ke=(e,t,n)=>L(O(O(O(W,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...i(Ge(e,t,n))])),Ne=e=>S(q)||S(de[e])?0:I(e?k(q,N):q,((t,n)=>I(t,((t,s)=>I(t,((t,r)=>fe(de[e],[n,s,r],t))))))),Pe=(e,t,n,s)=>{var r,l,a;(v(t)>1||!S(t)&&(r=O(t,null),l=n(...s),c(r)!==c(l)||(a=(e,t)=>l[t]===e,!r.every(a))))&&fe(e,s)},_e=e=>{const t=S(oe[e])&&S(le[e])&&S(se[e]),n=S(ie[e])&&S(ae[e])&&S(re[e])&&S(ne[e]);if(!t||!n){const s=e?[k(f),N(p),k(g,N),k(W,N)]:[f,p,g,W];if(t||(I(s[2],((t,n)=>I(t,((t,s)=>Pe(oe[e],t,Ae,[n,s]))))),I(s[1],((t,n)=>Pe(le[e],t,qe,[n]))),Pe(se[e],s[0],We,[])),!n){let t;I(s[3],((n,s)=>{let r;I(n,((n,l)=>{let a;I(n,(([n,o],i)=>{o!==n&&(fe(ie[e],[s,l,i],o,n,ke),t=r=a=1)})),a&&fe(ae[e],[s,l],ke)})),r&&fe(re[e],[s],ke)})),t&&fe(ne[e],[],ke)}}},Be=e=>(Ve(e),Ze),De=()=>M(te,(e=>M(e,M))),We=()=>F(te),qe=e=>F(O(te,e)),Ae=(e,t)=>F(O(O(te,e),t)),Ge=(e,t,n)=>O(O(O(te,e),t),n),He=e=>Be((()=>(e=>Y(e,be,Me))(e)?we(e):0)),Ke=(e,n,s,r)=>Be((()=>L(ge(e,n,s,t(r)==l?r(Ge(e,n,s)):r),(t=>Ce(e,me(e),n,s,t))))),Qe=()=>Be((()=>we({}))),Ue=(e,t,n,s)=>Be((()=>L(O(te,e),(r=>L(O(r,t),(l=>R(l,n)?Fe(e,r,t,l,n,s):0)))))),Ve=(e,t)=>{if(-1==u)return;Xe();const n=e?.();return Ye(t),n},Xe=()=>(u++,Ze),Ye=e=>(u>0&&(u--,0==u&&(n=!S(W),u=1,Ne(1),n&&_e(1),u=-1,e?.(M(W,(e=>M(e,(e=>M(e,(e=>[...e]),(([e,t])=>e===t))),U)),U),M(q,(e=>M(e,M))))&&(u=1,I(W,((e,t)=>I(e,((e,n)=>I(e,(([e],s)=>y(e)?Ue(t,n,s,!0):Ke(t,n,s,e))))))),u=-1,n=!1),fe(ce[0],[],n),Ne(0),n&&_e(0),fe(ce[1],[],n),u=0,d([W,q,f,p,g],C))),Ze),Ze={getTables:De,getTableIds:We,getTable:e=>M(O(te,e),M),getRowIds:qe,getRow:(e,t)=>M(O(O(te,e),t)),getCellIds:Ae,getCell:Ge,hasTables:()=>!S(te),hasTable:e=>R(te,e),hasRow:(e,t)=>R(O(te,e),t),hasCell:(e,t,n)=>R(O(O(te,e),t),n),getJson:()=>T(te),getSchemaJson:()=>T(A),setTables:He,setTable:(e,t)=>Be((()=>be(t,e)?ve(e,t):0)),setRow:(e,t,n)=>Be((()=>pe(e,t,n)?Re(e,me(e),t,n):0)),addRow:(e,t,n)=>Ve((()=>{const s=pe(e,void 0,t),r=s||n?Ie(O(te,e)):void 0;return s&&Re(e,me(e),r,t),r})),setPartialRow:(e,t,n)=>Be((()=>{if(pe(e,t,n,1)){const s=me(e);Q(n,((n,r)=>Ce(e,s,t,r,n)))}})),setCell:Ke,setJson:e=>{try{"{}"===e?Qe():He(b(e))}catch{}return Ze},setSchema:t=>Be((()=>{if((e=(e=>Y(e,(e=>Y(e,(e=>{if(!Y(e,((e,t)=>[a,o].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(V(e.default)!=t&&K(e,o),0))})))))(t))&&(Le(t),!S(te))){const e=De();Qe(),He(e)}})),delTables:Qe,delTable:e=>Be((()=>R(te,e)?Ee(e):0)),delRow:(e,t)=>Be((()=>L(O(te,e),(n=>R(n,t)?Je(e,n,t):0)))),delCell:Ue,delSchema:()=>Be((()=>{Le({}),e=!1})),transaction:Ve,startTransaction:Xe,finishTransaction:Ye,forEachTable:e=>I(te,((t,n)=>e(n,(e=>I(t,((t,n)=>e(n,(e=>j(t,e))))))))),forEachRow:(e,t)=>I(O(te,e),((e,n)=>t(n,(t=>j(e,t))))),forEachCell:(e,t,n)=>j(O(O(te,e),t),n),addTablesListener:(e,t)=>ue(e,ne[t?1:0]),addTableIdsListener:(e,t)=>ue(e,se[t?1:0]),addTableListener:(e,t,n)=>ue(t,re[n?1:0],[e]),addRowIdsListener:(e,t,n)=>ue(t,le[n?1:0],[e]),addRowListener:(e,t,n,s)=>ue(n,ae[s?1:0],[e,t]),addCellIdsListener:(e,t,n,s)=>ue(n,oe[s?1:0],[e,t]),addCellListener:(e,t,n,s,r)=>ue(s,ie[r?1:0],[e,t,n]),addInvalidCellListener:(e,t,n,s,r)=>ue(s,de[r?1:0],[e,t,n]),addWillFinishTransactionListener:e=>ue(e,ce[0]),addDidFinishTransactionListener:e=>ue(e,ce[1]),callListener:e=>(Te(e,[We,qe,Ae],(e=>y(e[2])?[]:i(Ge(...e)))),Ze),delListener:e=>(he(e),Ze),getListenerStats:()=>({}),createStore:$};return G(Ze)};e.createStore=$,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
