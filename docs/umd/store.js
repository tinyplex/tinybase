var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=t(!0),o=t(0),l=t(t),a="type",i="default",c=(e,t)=>e.forEach(t),d=(e,t)=>e.map(t),u=e=>e.length,f=(e,t,n)=>e.slice(t,n),h=(e,...t)=>e.push(...t),T=e=>JSON.stringify(e,((e,t)=>{return g(t,Map)?(n=[...t],s=(e,[t,n])=>(e[t]=n,e),r={},n.reduce(s,r)):t;var n,s,r})),b=JSON.parse,p=isFinite,g=(e,t)=>e instanceof t,v=e=>null==e,y=(e,t,n)=>v(e)?n?.():t(e),w=e=>e==s||e==r,R=(e,t)=>e?.has(t)??!1,S=e=>v(e)||0==(e=>e.size)(e),C=e=>e.clear(),I=(e,t)=>e?.forEach(t),L=(e,t)=>e?.delete(t),m=e=>new Map(e),E=e=>[...e?.keys()??[]],J=(e,t)=>e?.get(t),F=(e,t)=>I(e,((e,n)=>t(n,e))),O=(e,t,n)=>v(n)?(L(e,t),e):e?.set(t,n),j=(e,t,n)=>(R(e,t)||O(e,t,n()),J(e,t)),x=(e,t,n)=>{const s={},r=t??(e=>e);return I(e,((e,t)=>y(r(e),(e=>n?.(e)?0:s[t]=e)))),s},z=(e,t)=>{const n=m(),s=t??(e=>e);return I(e,((e,t)=>n.set(t,s(e)))),n},M=e=>z(e,z),k=(e,t,n,s,r=0)=>y((n?j:J)(e,t[r],r>u(t)-2?n:m),(o=>{if(r>u(t)-2)return s?.(o)&&O(e,t[r]),o;const l=k(o,t,n,s,r+1);return S(o)&&O(e,t[r]),l})),N=Object,P=N.keys,_=N.isFrozen,B=N.freeze,D=(e,t)=>!v(((e,t)=>y(e,(e=>e[t])))(e,t)),W=(e,t)=>delete e[t],$=(e,t)=>c(N.entries(e),(([e,n])=>t(n,e))),q=e=>{return t=P(e),0==u(t);var t},A=e=>new Set(e),G=(e,t)=>e?.add(t),H=/^\d+$/,K=()=>{const e=[];let t=0;return[()=>e.shift()??n+t++,t=>{H.test(t)&&u(e)<1e3&&h(e,t)}]},Q=e=>{let t;const[s,r]=K(),o=m();return[(r,l,a)=>{t??=e();const i=s();return O(o,i,[r,l,a]),G(k(l,a??[n],A),i),i},(e,s,...r)=>c(((e,t=[n])=>{const s=[],r=(e,n)=>n==u(t)?h(s,e):null===t[n]?I(e,(e=>r(e,n+1))):c([t[n],null],(t=>r(J(e,t),n+1)));return r(e,0),s})(e,s),(e=>I(e,(e=>J(o,e)[0](t,...s??[],...r))))),e=>y(J(o,e),(([,t,s])=>(k(t,s??[n],void 0,(t=>(L(t,e),S(t)?1:0))),O(o,e),r(e),s))),(e,n,s)=>y(J(o,e),(([e,,r=[]])=>{const o=(...l)=>{const a=u(l);a==u(r)?e(t,...l,...s(l)):v(r[a])?c(n[a](...l),(e=>o(...l,e))):o(...l,r[a])};o()}))]},U=e=>[e,e],V=()=>[m(),m()],X=e=>{const n=t(e);return w(n)||n==o&&p(e)?n:void 0},Y=e=>n+e,Z=(e,t,n,s=O)=>{const r=(o=E(e),l=e=>!D(t,e),o.filter(l));var o,l;return c(P(t),(s=>n(e,s,t[s]))),c(r,(t=>s(e,t))),e},ee=(e,t,n)=>v(e)||!(e=>g(e,N)&&e.constructor==N)(e)||q(e)||_(e)?(n?.(),!1):($(e,((n,s)=>{t(n,s)||W(e,s)})),!q(e)),te=(e,t,n)=>O(e,t,J(e,t)==-n?void 0:n),ne=()=>{let e,n,s=0;const r=m(),p=m(),g=m(),k=m(),N=m(),P=m(),_=m(),H=m(),se=m(),re=V(),oe=V(),le=V(),ae=V(),ie=V(),ce=V(),de=V(),ue=V(),fe=V(),he=V(),[Te,be,pe,ge]=Q((()=>et)),ve=(t,n)=>(!e||R(P,n)||Pe(n))&&ee(t,((e,t)=>ye(n,t,e)),(()=>Pe(n))),ye=(e,t,n,s)=>ee(s?n:Re(n,e,t),((s,r)=>y(we(e,t,r,s),(e=>(n[r]=e,!0)),(()=>!1))),(()=>Pe(e,t))),we=(t,n,s,r)=>e?y(J(J(P,t),s),(e=>X(r)!=e.type?Pe(t,n,s,r,e.default):r),(()=>Pe(t,n,s,r))):v(X(r))?Pe(t,n,s,r):r,Re=(e,t,n)=>(y(J(_,t),(([s,r])=>{I(s,((t,n)=>{D(e,n)||(e[n]=t)})),I(r,(s=>{D(e,s)||Pe(t,n,s)}))})),e),Se=e=>Z(P,e,((e,t,n)=>{const s=m(),r=A();Z(j(P,t,m),n,((e,t,n)=>{O(e,t,n),y(n.default,(e=>O(s,t,e)),(()=>G(r,t)))})),O(_,t,[s,r])}),((e,t)=>{O(P,t),O(_,t)})),Ce=e=>Z(se,e,((e,t,n)=>Ie(t,n)),((e,t)=>Oe(t))),Ie=(e,t)=>Z(j(se,e,(()=>(ze(e,1),m()))),t,((t,n,s)=>Le(e,t,n,s)),((t,n)=>je(e,t,n))),Le=(e,t,n,s,r)=>Z(j(t,n,(()=>(Me(e,n,1),m()))),s,((t,s,r)=>me(e,n,t,s,r)),((s,o)=>xe(e,t,n,s,o,r))),me=(e,t,n,s,r)=>{R(n,s)||ke(e,t,s,1);const o=J(n,s);r!==o&&(Ne(e,t,s,o,r),O(n,s,r))},Ee=(e,t,n,s,r)=>y(J(t,n),(t=>me(e,n,t,s,r)),(()=>Le(e,t,n,Re({[s]:r},e,n)))),Je=e=>{const[t]=j(H,e,K),n=t();return R(J(se,e),n)?Je(e):n},Fe=e=>J(se,e)??Ie(e,{}),Oe=e=>Ie(e,{}),je=(e,t,n)=>{const[,s]=j(H,e,K);s(n),Le(e,t,n,{},!0)},xe=(e,t,n,s,r,o)=>{const l=J(J(_,e)?.[0],r);if(!v(l)&&!o)return me(e,n,s,r,l);const a=t=>{Ne(e,n,t,J(s,t)),ke(e,n,t,-1),O(s,t)};v(l)?a(r):F(s,a),S(s)&&(Me(e,n,-1),S(O(t,n))&&(ze(e,-1),O(se,e)))},ze=(e,t)=>te(r,e,t),Me=(e,t,n)=>te(j(p,e,m),t,n),ke=(e,t,n,s)=>te(j(j(g,e,m),t,m),n,s),Ne=(e,t,n,s,r)=>j(j(j(k,e,m),t,m),n,(()=>[s,0]))[1]=r,Pe=(e,t,n,s,r)=>(h(j(j(j(N,e,m),t,m),n,(()=>[])),s),r),_e=(e,t,n)=>y(J(J(J(k,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...U(Qe(e,t,n))])),Be=e=>S(N)||S(fe[e])?0:I(e?z(N,M):N,((t,n)=>I(t,((t,s)=>I(t,((t,r)=>be(fe[e],[n,s,r],t))))))),De=(e,t,n)=>{if(!S(t))return be(e,n),1},We=e=>{const t=S(ie[e]),n=S(de[e])&&S(ae[e])&&t&&S(oe[e]),s=S(ue[e])&&S(ce[e])&&S(le[e])&&S(re[e]);if(!n||!s){const o=e?[z(r),M(p),z(g,M),z(k,M)]:[r,p,g,k];if(!n){I(o[2],((t,n)=>I(t,((t,s)=>De(de[e],t,[n,s])))));const n=A();I(o[1],((s,r)=>{De(ae[e],s,[r])&&!t&&(be(ie[e],[r,null]),G(n,r))})),t||I(o[3],((t,s)=>{if(!R(n,s)){const n=A();I(t,(e=>I(e,(([t,s],r)=>s!==t?G(n,r):L(e,r))))),I(n,(t=>be(ie[e],[s,t])))}})),De(oe[e],o[0])}if(!s){let t;I(o[3],((n,s)=>{let r;I(n,((n,o)=>{let l;I(n,(([n,a],i)=>{a!==n&&(be(ue[e],[s,o,i],a,n,_e),t=r=l=1)})),l&&be(ce[e],[s,o],_e)})),r&&be(le[e],[s],_e)})),t&&be(re[e],void 0,_e)}}},$e=(e,...t)=>(Xe((()=>e(...d(t,Y)))),et),qe=()=>x(se,(e=>x(e,x))),Ae=()=>E(se),Ge=e=>E(J(se,Y(e))),He=(e,t,n,s=0,r)=>{const o=[];return F(J(se,Y(e)),((e,n)=>h(o,[v(t)?e:J(n,Y(t)),e]))),d(f(o.sort((([e],[t])=>(e<t?-1:1)*(n?-1:1))),s,v(r)?r:s+r),(([,e])=>e))},Ke=(e,t)=>E(J(J(se,Y(e)),Y(t))),Qe=(e,t,n)=>J(J(J(se,Y(e)),Y(t)),Y(n)),Ue=e=>$e((()=>(e=>ee(e,ve,Pe))(e)?Ce(e):0)),Ve=()=>$e((()=>Ce({}))),Xe=(e,t)=>{if(-1==s)return;Ye();const n=e?.();return Ze(t),n},Ye=()=>(s++,et),Ze=e=>(s>0&&(s--,0==s&&(n=!S(k),s=1,Be(1),n&&We(1),s=-1,e?.(x(k,(e=>x(e,(e=>x(e,(e=>[...e]),(([e,t])=>e===t))),q)),q),x(N,(e=>x(e,x))))&&(s=1,I(k,((e,t)=>I(e,((e,n)=>I(e,(([e],s)=>((e,t,n,s,r)=>v(r)?e.delCell(t,n,s,!0):e.setCell(t,n,s,r))(et,t,n,s,e))))))),s=-1,n=!1),be(he[0],void 0,n),Be(0),n&&We(0),be(he[1],void 0,n),s=0,c([k,N,r,p,g],C))),et),et={getTables:qe,getTableIds:Ae,getTable:e=>x(J(se,Y(e)),x),getRowIds:Ge,getSortedRowIds:He,getRow:(e,t)=>x(J(J(se,Y(e)),Y(t))),getCellIds:Ke,getCell:Qe,hasTables:()=>!S(se),hasTable:e=>R(se,Y(e)),hasRow:(e,t)=>R(J(se,Y(e)),Y(t)),hasCell:(e,t,n)=>R(J(J(se,Y(e)),Y(t)),Y(n)),getJson:()=>T(se),getSchemaJson:()=>T(P),setTables:Ue,setTable:(e,t)=>$e((e=>ve(t,e)?Ie(e,t):0),e),setRow:(e,t,n)=>$e(((e,t)=>ye(Y(e),Y(t),n)?Le(Y(e),Fe(Y(e)),Y(t),n):0),e,t),addRow:(e,t)=>Xe((()=>{let n;return ye(e,n,t)&&(e=Y(e),Le(e,Fe(e),n=Je(e),t)),n})),setPartialRow:(e,t,n)=>$e(((e,t)=>{if(ye(e,t,n,1)){const s=Fe(e);$(n,((n,r)=>Ee(e,s,t,r,n)))}}),e,t),setCell:(e,n,s,r)=>$e(((e,n,s)=>y(we(e,n,s,t(r)==l?r(Qe(e,n,s)):r),(t=>Ee(e,Fe(e),n,s,t)))),e,n,s),setJson:e=>{try{"{}"===e?Ve():Ue(b(e))}catch{}return et},setSchema:t=>$e((()=>{if((e=(e=>ee(e,(e=>ee(e,(e=>{if(!ee(e,((e,t)=>[a,i].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=o||(X(e.default)!=t&&W(e,i),0))})))))(t))&&(Se(t),!S(se))){const e=qe();Ve(),Ue(e)}})),delTables:Ve,delTable:e=>$e((e=>R(se,e)?Oe(e):0),e),delRow:(e,t)=>$e(((e,t)=>y(J(se,e),(n=>R(n,t)?je(e,n,t):0))),e,t),delCell:(e,t,n,s)=>$e(((e,t,n)=>y(J(se,e),(r=>y(J(r,t),(o=>R(o,n)?xe(e,r,t,o,n,s):0))))),e,t,n),delSchema:()=>$e((()=>{Se({}),e=!1})),transaction:Xe,startTransaction:Ye,finishTransaction:Ze,forEachTable:e=>I(se,((t,n)=>e(n,(e=>I(t,((t,n)=>e(n,(e=>F(t,e))))))))),forEachRow:(e,t)=>I(J(se,Y(e)),((e,n)=>t(n,(t=>F(e,t))))),forEachCell:(e,t,n)=>F(J(J(se,Y(e)),Y(t)),n),addSortedRowIdsListener:(e,t,n,s,r,o,l)=>{let a=He(e,t,n,s,r);return Te((()=>{const l=He(e,t,n,s,r);var i,c,d;c=a,u(i=l)===u(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(a=l,o(et,e,t,n,s,r,a))}),ie[l?1:0],[e,t])},addWillFinishTransactionListener:e=>Te(e,he[0]),addDidFinishTransactionListener:e=>Te(e,he[1]),callListener:e=>(ge(e,[Ae,Ge,Ke],(e=>v(e[2])?[]:U(Qe(...e)))),et),delListener:e=>(pe(e),et),getListenerStats:()=>({}),createStore:ne};return $({Tables:[0,re],TableIds:[0,oe],Table:[1,le],RowIds:[1,ae],Row:[2,ce],CellIds:[2,de],Cell:[3,ue],InvalidCell:[3,fe]},(([e,t],n)=>{et["add"+n+"Listener"]=(...n)=>Te(n[e],t[n[e+1]?1:0],e>0?f(n,0,e):void 0)})),B(et)};e.createStore=ne,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
