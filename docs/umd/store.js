var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),l=t(0),o=t(t),r="type",i="default",c="Has",d="Ids",u="Table",f=u+"s",h=u+d,g="Row",T=g+"Count",b=g+d,S="Cell",V=S+d,p="Value",y=p+"s",C=p+d,v=e=>s+e,m=isFinite,w=e=>null==e,L=(e,t,s)=>w(e)?s?.():t(e),R=e=>e==n||e==a,I=e=>t(e)==o,J=(e,t,s)=>e.slice(t,s),E=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),x=(e,...t)=>e.push(...t),z=Object,M=e=>z.getPrototypeOf(e),P=z.entries,j=z.isFrozen,k=e=>!w(e)&&L(M(e),(e=>e==z.prototype||w(M(e))),(()=>!0)),A=z.keys,N=z.freeze,B=(e,t)=>t in e,D=(e,t)=>(delete e[t],e),H=(e,t)=>O(P(e),(([e,s])=>t(s,e))),W=e=>k(e)&&0==(e=>E(A(e)))(e),q=(e,t,s,n=0)=>w(e)||!k(e)||!n&&W(e)||j(e)?(s?.(),!1):(H(e,((s,n)=>{t(s,n)||D(e,n)})),!!n||!W(e)),G=e=>e?.size??0,K=(e,t)=>e?.has(t)??!1,Q=e=>w(e)||0==G(e),U=e=>e.clear(),X=(e,t)=>e?.forEach(t),Y=(e,t)=>e?.delete(t),Z=e=>new Map(e),$=e=>[...e?.keys()??[]],_=(e,t)=>e?.get(t),ee=(e,t)=>X(e,((e,s)=>t(s,e))),te=(e,t,s)=>w(s)?(Y(e,t),e):e?.set(t,s),se=(e,t,s,n)=>(K(e,t)?n?.(_(e,t)):te(e,t,s()),_(e,t)),ne=(e,t,s,n=te)=>(H(t,((t,n)=>s(e,n,t))),ee(e,(s=>B(t,s)?0:n(e,s))),e),ae=(e,t,s,n)=>{const a={};return X(e,((e,l)=>{if(!s?.(e,l)){const s=t?t(e,l):e;!n?.(s)&&(a[l]=s)}})),a},le=(e,t,s)=>ae(e,(e=>ae(e,t,s)),Q,W),oe=(e,t,s)=>ae(e,(e=>le(e,t,s)),Q,W),re=(e,t)=>{const s=Z();return X(e,((e,n)=>s.set(n,t?.(e)??e))),s},ie=e=>re(e,re),ce=e=>re(e,ie),de=(e,t,s,n,a=0)=>L((s?se:_)(e,t[a],a>E(t)-2?s:Z),(l=>{if(a>E(t)-2)return n?.(l)&&te(e,t[a]),l;const o=de(l,t,s,n,a+1);return Q(l)&&te(e,t[a]),o})),ue=e=>new Set(Array.isArray(e)||w(e)?e:[e]),fe=(e,t)=>e?.add(t),he=/^\d+$/,ge=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{he.test(t)&&E(e)<1e3&&x(e,t)}]},Te=e=>[e,e],be=()=>[Z(),Z()],Se=e=>[...e],Ve=([e,t])=>e===t,pe=e=>{const s=t(e);return R(s)||s==l&&m(e)?s:void 0},ye=(e,t,s,n,a)=>w(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a),Ce=(e,t,s)=>w(s)?e.delValue(t):e.setValue(t,s),ve=e=>JSON.stringify(e,((e,t)=>t instanceof Map?z.fromEntries([...t]):t)),me=JSON.parse;Z(O("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(s),((e,t)=>[e,t])));const we=(e,t,s)=>te(e,t,_(e,t)==-s?void 0:s),Le=()=>{let e,t,n=!1,a=!1,o=0,d=[];const m=Z(),z=Z(),M=Z(),P=Z(),j=Z(),k=Z(),A=Z(),he=Z(),Re=Z(),Ie=Z(),Je=Z(),Ee=Z(),Fe=Z(),Oe=Z(),xe=ue(),ze=Z(),Me=Z(),Pe=Z(),je=Z(),ke=be(),Ae=be(),Ne=be(),Be=be(),De=be(),He=be(),We=be(),qe=be(),Ge=be(),Ke=be(),Qe=be(),Ue=be(),Xe=be(),Ye=be(),Ze=be(),$e=be(),_e=be(),et=be(),tt=be(),st=be(),nt=be(),at=be(),lt=Z(),ot=be(),[rt,it,ct,dt]=(e=>{let t;const[n,a]=ge(),l=Z();return[(e,a,o,r=[],i=(()=>[]))=>{t??=Fs;const c=n(1);return te(l,c,[e,a,o,r,i]),fe(de(a,o??[s],ue),c),c},(e,n,...a)=>F(((e,t=[s])=>{const n=[],a=(e,s)=>s==E(t)?x(n,e):null===t[s]?X(e,(e=>a(e,s+1))):F([t[s],null],(t=>a(_(e,t),s+1)));return a(e,0),n})(e,n),(e=>X(e,(e=>_(l,e)[0](t,...n??[],...a))))),e=>L(_(l,e),(([,t,n])=>(de(t,n??[s],void 0,(t=>(Y(t,e),Q(t)?1:0))),te(l,e),a(e),n))),e=>L(_(l,e),(([e,,s=[],n,a])=>{const l=(...o)=>{const r=E(o);r==E(s)?e(t,...o,...a(o)):w(s[r])?F(n[r]?.(...o)??[],(e=>l(...o,e))):l(...o,s[r])};l()}))]})(),ut=e=>{if(!q(e,((e,t)=>[r,i].includes(t))))return!1;const t=e[r];return!(!R(t)&&t!=l||(pe(e[i])!=t&&D(e,i),0))},ft=(t,s)=>(!e||K(Je,s)||Ht(s))&&q(t,((e,t)=>ht(s,t,e)),(()=>Ht(s))),ht=(e,t,s,n)=>q(n?s:St(s,e,t),((n,a)=>L(gt(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>Ht(e,t))),gt=(t,s,n,a)=>e?L(_(_(Je,t),n),(e=>pe(a)!=e[r]?Ht(t,s,n,a,e[i]):a),(()=>Ht(t,s,n,a))):w(pe(a))?Ht(t,s,n,a):a,Tt=(e,t)=>q(t?e:Vt(e),((t,s)=>L(bt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Wt())),bt=(e,s)=>t?L(_(Fe,e),(t=>pe(s)!=t[r]?Wt(e,s,t[i]):s),(()=>Wt(e,s))):w(pe(s))?Wt(e,s):s,St=(e,t,s)=>(L(_(Ee,t),(([n,a])=>{X(n,((t,s)=>{B(e,s)||(e[s]=t)})),X(a,(n=>{B(e,n)||Ht(t,s,n)}))})),e),Vt=e=>(t&&(X(Oe,((t,s)=>{B(e,s)||(e[s]=t)})),X(xe,(t=>{B(e,t)||Wt(t)}))),e),pt=e=>ne(Je,e,((e,t,s)=>{const n=Z(),a=ue();ne(se(Je,t,Z),s,((e,t,s)=>{te(e,t,s),L(s[i],(e=>te(n,t,e)),(()=>fe(a,t)))})),te(Ee,t,[n,a])}),((e,t)=>{te(Je,t),te(Ee,t)})),yt=e=>ne(Fe,e,((e,t,s)=>{te(Fe,t,s),L(s[i],(e=>te(Oe,t,e)),(()=>fe(xe,t)))}),((e,t)=>{te(Fe,t),te(Oe,t),Y(xe,t)})),Ct=e=>W(e)?Cs():bs(e),vt=e=>ne(Pe,e,((e,t,s)=>mt(t,s)),((e,t)=>xt(t))),mt=(e,t)=>ne(se(Pe,e,(()=>(jt(e,1),te(ze,e,ge()),te(Me,e,Z()),Z()))),t,((t,s,n)=>wt(e,t,s,n)),((t,s)=>zt(e,t,s))),wt=(e,t,s,n,a)=>ne(se(t,s,(()=>(kt(e,s,1),Z()))),n,((t,n,a)=>Lt(e,s,t,n,a)),((n,l)=>Mt(e,t,s,n,l,a))),Lt=(e,t,s,n,a)=>{K(s,n)||At(e,t,n,1);const l=_(s,n);a!==l&&(Nt(e,t,n,l,a),te(s,n,a))},Rt=(e,t,s,n,a)=>L(_(t,s),(t=>Lt(e,s,t,n,a)),(()=>wt(e,t,s,St({[n]:a},e,s)))),It=e=>W(e)?ws():Ss(e),Jt=e=>ne(je,e,((e,t,s)=>Et(t,s)),((e,t)=>Pt(t))),Et=(e,t)=>{K(je,e)||Bt(e,1);const s=_(je,e);t!==s&&(Dt(e,s,t),te(je,e,t))},Ft=(e,t)=>{const[s]=_(ze,e),n=s(t);return K(_(Pe,e),n)?Ft(e,t):n},Ot=e=>_(Pe,e)??mt(e,{}),xt=e=>mt(e,{}),zt=(e,t,s)=>{const[,n]=_(ze,e);n(s),wt(e,t,s,{},!0)},Mt=(e,t,s,n,a,l)=>{const o=_(_(Ee,e)?.[0],a);if(!w(o)&&!l)return Lt(e,s,n,a,o);const r=t=>{Nt(e,s,t,_(n,t)),At(e,s,t,-1),te(n,t)};w(o)?r(a):ee(n,r),Q(n)&&(kt(e,s,-1),Q(te(t,s))&&(jt(e,-1),te(Pe,e),te(ze,e),te(Me,e)))},Pt=e=>{const t=_(Oe,e);if(!w(t))return Et(e,t);Dt(e,_(je,e)),Bt(e,-1),te(je,e)},jt=(e,t)=>we(m,e,t),kt=(e,t,s)=>we(se(P,e,Z),t,s)&&te(M,e,se(M,e,(()=>0))+s),At=(e,t,s,n)=>{const a=_(Me,e),l=_(a,s)??0;(0==l&&1==n||1==l&&-1==n)&&we(se(z,e,Z),s,n),te(a,s,l!=-n?l+n:null),we(se(se(j,e,Z),t,Z),s,n)},Nt=(e,t,s,n,a)=>{se(se(se(k,e,Z),t,Z),s,(()=>[n,0]))[1]=a,d[3]?.(e,t,s,a)},Bt=(e,t)=>we(A,e,t),Dt=(e,t,s)=>{se(he,e,(()=>[t,0]))[1]=s,d[4]?.(e,s)},Ht=(e,t,s,n,a)=>(x(se(se(se(Re,e,Z),t,Z),s,(()=>[])),n),a),Wt=(e,t,s)=>(x(se(Ie,e,(()=>[])),t),s),qt=(e,t,s)=>L(_(_(_(k,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Te(ls(e,t,s))])),Gt=e=>L(_(he,e),(([e,t])=>[!0,e,t]),(()=>[!1,...Te(is(e))])),Kt=e=>Q(Re)||Q($e[e])?0:X(e?ce(Re):Re,((t,s)=>X(t,((t,n)=>X(t,((t,a)=>it($e[e],[s,n,a],t))))))),Qt=e=>Q(Ie)||Q(_e[e])?0:X(e?re(Ie):Ie,((t,s)=>it(_e[e],[s],t))),Ut=(e,t,s,n)=>{if(!Q(e))return it(t,n,(()=>ae(e))),ee(e,((e,t)=>it(s,[...n??[],e],1==t))),1},Xt=e=>{const t=cs();t!=n&&it(ke[e],void 0,t);const s=Q(Ke[e]),a=Q(Xe[e])&&Q(Ye[e])&&Q(Ge[e])&&Q(Qe[e])&&Q(He[e])&&Q(We[e])&&Q(qe[e])&&s&&Q(Ne[e])&&Q(Be[e]),l=Q(Ze[e])&&Q(Ue[e])&&Q(De[e])&&Q(Ae[e]);if(!a||!l){const t=e?[re(m),ie(z),re(M),ie(P),ce(j),ce(k)]:[m,z,M,P,j,k];if(!a){Ut(t[0],Ne[e],Be[e]),X(t[1],((t,s)=>Ut(t,He[e],We[e],[s]))),X(t[2],((t,s)=>{0!=t&&it(qe[e],[s],ts(s))}));const n=ue();X(t[3],((t,a)=>{Ut(t,Ge[e],Qe[e],[a])&&!s&&(it(Ke[e],[a,null]),fe(n,a))})),s||X(t[5],((t,s)=>{if(!K(n,s)){const n=ue();X(t,(e=>X(e,(([t,s],a)=>s!==t?fe(n,a):Y(e,a))))),X(n,(t=>it(Ke[e],[s,t])))}})),X(t[4],((t,s)=>X(t,((t,n)=>Ut(t,Xe[e],Ye[e],[s,n])))))}if(!l){let s;X(t[5],((t,n)=>{let a;X(t,((t,l)=>{let o;X(t,(([t,r],i)=>{r!==t&&(it(Ze[e],[n,l,i],r,t,qt),s=a=o=1)})),o&&it(Ue[e],[n,l],qt)})),a&&it(De[e],[n],qt)})),s&&it(Ae[e],void 0,qt)}}},Yt=e=>{const t=gs();t!=a&&it(et[e],void 0,t);const s=Q(st[e])&&Q(nt[e]),n=Q(at[e])&&Q(tt[e]);if(!s||!n){const t=e?[re(A),re(he)]:[A,he];if(s||Ut(t[0],st[e],nt[e]),!n){let s;X(t[1],(([t,n],a)=>{n!==t&&(it(at[e],[a],n,t,Gt),s=1)})),s&&it(tt[e],void 0,Gt)}}},Zt=(e,...t)=>(Is((()=>e(...O(t,v)))),Fs),$t=()=>oe(Pe),_t=()=>$(Pe),es=e=>$(_(Me,v(e))),ts=e=>G(_(Pe,v(e))),ss=e=>$(_(Pe,v(e))),ns=(e,t,s,n=0,a)=>{return O(J((o=_(Pe,v(e)),r=(e,s)=>[w(t)?s:_(e,v(t)),s],l=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(l)),n,w(a)?a:n+a),(([,e])=>e));var l,o,r},as=(e,t)=>$(_(_(Pe,v(e)),v(t))),ls=(e,t,s)=>_(_(_(Pe,v(e)),v(t)),v(s)),os=()=>ae(je),rs=()=>$(je),is=e=>_(je,v(e)),cs=()=>!Q(Pe),ds=e=>K(Pe,v(e)),us=(e,t)=>K(_(Me,v(e)),v(t)),fs=(e,t)=>K(_(Pe,v(e)),v(t)),hs=(e,t,s)=>K(_(_(Pe,v(e)),v(t)),v(s)),gs=()=>!Q(je),Ts=e=>K(je,v(e)),bs=e=>Zt((()=>(e=>q(e,ft,Ht))(e)?vt(e):0)),Ss=e=>Zt((()=>Tt(e)?Jt(e):0)),Vs=e=>{try{Ct(me(e))}catch{}return Fs},ps=t=>Zt((()=>{if((e=q(t,(e=>q(e,ut))))&&(pt(t),!Q(Pe))){const e=$t();Cs(),bs(e)}})),ys=e=>Zt((()=>{if(t=(e=>q(e,ut))(e)){const s=os();Rs(),ws(),t=!0,yt(e),Ss(s)}})),Cs=()=>Zt((()=>vt({}))),vs=e=>Zt((e=>K(Pe,e)?xt(e):0),e),ms=(e,t)=>Zt(((e,t)=>L(_(Pe,e),(s=>K(s,t)?zt(e,s,t):0))),e,t),ws=()=>Zt((()=>Jt({}))),Ls=()=>Zt((()=>{pt({}),e=!1})),Rs=()=>Zt((()=>{yt({}),t=!1})),Is=(e,t)=>{if(-1!=o){Js();const s=e();return Es(t),s}},Js=()=>(-1!=o&&o++,1==o&&(d[0]?.(),it(lt)),Fs),Es=e=>(o>0&&(o--,0==o&&(o=1,Kt(1),Q(k)||Xt(1),Qt(1),Q(he)||Yt(1),e?.(Fs)&&(X(k,((e,t)=>X(e,((e,s)=>X(e,(([e],n)=>ye(Fs,t,s,n,e))))))),U(k),X(he,(([e],t)=>Ce(Fs,t,e))),U(he)),it(ot[0],void 0),o=-1,Kt(0),Q(k)||Xt(0),Qt(0),Q(he)||Yt(0),d[1]?.(),it(ot[1],void 0),d[2]?.(),o=0,n=cs(),a=gs(),F([m,z,M,P,j,k,Re,A,he,Ie],U))),Fs),Fs={getContent:()=>[$t(),os()],getTables:$t,getTableIds:_t,getTable:e=>le(_(Pe,v(e))),getTableCellIds:es,getRowCount:ts,getRowIds:ss,getSortedRowIds:ns,getRow:(e,t)=>ae(_(_(Pe,v(e)),v(t))),getCellIds:as,getCell:ls,getValues:os,getValueIds:rs,getValue:is,hasTables:cs,hasTable:ds,hasTableCell:us,hasRow:fs,hasCell:hs,hasValues:gs,hasValue:Ts,getTablesJson:()=>ve(Pe),getValuesJson:()=>ve(je),getJson:()=>ve([Pe,je]),getTablesSchemaJson:()=>ve(Je),getValuesSchemaJson:()=>ve(Fe),getSchemaJson:()=>ve([Je,Fe]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>Zt((()=>{(W(e)?Cs:bs)(e),(W(t)?ws:Ss)(t)})),setTables:bs,setTable:(e,t)=>Zt((e=>ft(t,e)?mt(e,t):0),e),setRow:(e,t,s)=>Zt(((e,t)=>ht(e,t,s)?wt(e,Ot(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Is((()=>{let n;return ht(e,n,t)&&(e=v(e),wt(e,Ot(e),n=Ft(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Zt(((e,t)=>{if(ht(e,t,s,1)){const n=Ot(e);H(s,((s,a)=>Rt(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>Zt(((e,t,s)=>L(gt(e,t,s,I(n)?n(ls(e,t,s)):n),(n=>Rt(e,Ot(e),t,s,n)))),e,t,s),setValues:Ss,setPartialValues:e=>Zt((()=>Tt(e,1)?H(e,((e,t)=>Et(t,e))):0)),setValue:(e,t)=>Zt((e=>L(bt(e,I(t)?t(is(e)):t),(t=>Et(e,t)))),e),applyChanges:e=>Zt((()=>{H(e[0],((e,t)=>w(e)?vs(t):H(e,((e,s)=>w(e)?ms(t,s):H(e,((e,n)=>ye(Fs,t,s,n,e))))))),H(e[1],((e,t)=>Ce(Fs,t,e)))})),setTablesJson:Vs,setValuesJson:e=>{try{It(me(e))}catch{}return Fs},setJson:e=>Zt((()=>{try{const[t,s]=me(e);Ct(t),It(s)}catch{Vs(e)}})),setTablesSchema:ps,setValuesSchema:ys,setSchema:(e,t)=>Zt((()=>{ps(e),ys(t)})),delTables:Cs,delTable:vs,delRow:ms,delCell:(e,t,s,n)=>Zt(((e,t,s)=>L(_(Pe,e),(a=>L(_(a,t),(l=>K(l,s)?Mt(e,a,t,l,s,n):0))))),e,t,s),delValues:ws,delValue:e=>Zt((e=>K(je,e)?Pt(e):0),e),delTablesSchema:Ls,delValuesSchema:Rs,delSchema:()=>Zt((()=>{Ls(),Rs()})),transaction:Is,startTransaction:Js,getTransactionChanges:()=>[ae(k,((e,t)=>-1===_(m,t)?void 0:ae(e,((e,s)=>-1===_(_(P,t),s)?void 0:ae(e,(([,e])=>e),(e=>Ve(e)))),Q,W)),Q,W),ae(he,(([,e])=>e),(e=>Ve(e))),1],getTransactionLog:()=>[!Q(k),!Q(he),oe(k,Se,Ve),oe(Re),ae(he,Se,Ve),ae(Ie),ae(m),le(P),oe(j),ae(A)],finishTransaction:Es,forEachTable:e=>X(Pe,((t,s)=>e(s,(e=>X(t,((t,s)=>e(s,(e=>ee(t,e))))))))),forEachTableCell:(e,t)=>ee(_(Me,v(e)),t),forEachRow:(e,t)=>X(_(Pe,v(e)),((e,s)=>t(s,(t=>ee(e,t))))),forEachCell:(e,t,s)=>ee(_(_(Pe,v(e)),v(t)),s),forEachValue:e=>ee(je,e),addSortedRowIdsListener:(e,t,s,n,a,l,o)=>{let r=ns(e,t,s,n,a);return rt((()=>{const o=ns(e,t,s,n,a);var i,c,d;c=r,E(i=o)===E(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(r=o,l(Fs,e,t,s,n,a,r))}),Ke[o?1:0],[e,t],[_t])},addStartTransactionListener:e=>rt(e,lt),addWillFinishTransactionListener:e=>rt(e,ot[0]),addDidFinishTransactionListener:e=>rt(e,ot[1]),callListener:e=>(dt(e),Fs),delListener:e=>(ct(e),Fs),getListenerStats:()=>({}),isMergeable:()=>!1,createStore:Le,addListener:rt,callListeners:it,setInternalListeners:(e,t,s,n,a)=>d=[e,t,s,n,a]};return H({[c+f]:[0,ke,[],()=>[cs()]],[f]:[0,Ae],[h]:[0,Ne],[c+u]:[1,Be,[_t],e=>[ds(...e)]],[u]:[1,De,[_t]],[u+V]:[1,He,[_t]],[c+u+S]:[2,We,[_t,es],e=>[us(...e)]],[T]:[1,qe,[_t]],[b]:[1,Ge,[_t]],[c+g]:[2,Qe,[_t,ss],e=>[fs(...e)]],[g]:[2,Ue,[_t,ss]],[V]:[2,Xe,[_t,ss]],[c+S]:[3,Ye,[_t,ss,as],e=>[hs(...e)]],[S]:[3,Ze,[_t,ss,as],e=>Te(ls(...e))],InvalidCell:[3,$e],[c+y]:[0,et,[],()=>[gs()]],[y]:[0,tt],[C]:[0,st],[c+p]:[1,nt,[rs],e=>[Ts(...e)]],[p]:[1,at,[rs],e=>Te(is(e[0]))],InvalidValue:[1,_e]},(([e,t,s,n],a)=>{Fs["add"+a+"Listener"]=(...a)=>rt(a[e],t[a[e+1]?1:0],e>0?J(a,0,e):void 0,s,n)})),N(Fs)};e.createStore=Le},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
