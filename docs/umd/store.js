var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),a=t(t),l="type",o="default",i=e=>[e,e],d=(e,t)=>e.forEach(t),c=e=>e.length,f=e=>0==c(e),u=e=>e.slice(1),h=(e,t)=>e.push(t),T=e=>JSON.stringify(e,((e,t)=>{return g(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),b=JSON.parse,p=isFinite,g=(e,t)=>e instanceof t,y=e=>null==e,L=(e,t,s)=>y(e)?s?.():t(e),w=e=>e==s||e==n,R=(e,t)=>e?.has(t)??!1,C=e=>y(e)||0==(e=>e.size)(e),S=e=>e.clear(),v=(e,t)=>e?.forEach(t),I=(e,t)=>e?.delete(t),m=e=>new Map(e),E=(e=m)=>[e(),e()],J=e=>[...e?.keys()??[]],F=(e,t)=>e?.get(t),O=(e,t)=>v(e,((e,s)=>t(s,e))),j=(e,t,s)=>y(s)?(I(e,t),e):e?.set(t,s),x=(e,t,s)=>(R(e,t)||e.set(t,s()),F(e,t)),z=(e,t,s)=>{const n={},r=t??(e=>e);return v(e,((e,t)=>L(r(e),(e=>s?.(e)?0:n[t]=e)))),n},M=(e,t)=>{const s=m(),n=t??(e=>e);return v(e,((e,t)=>s.set(t,n(e)))),s},k=e=>M(e,M),N=Object,P=N.keys,_=N.isFrozen,B=N.freeze,D=(e,t)=>!y(((e,t)=>L(e,(e=>e[t])))(e,t)),W=(e,t)=>delete e[t],q=(e,t)=>d(N.entries(e),(([e,s])=>t(s,e))),A=e=>f(P(e)),G=e=>new Set(e),H=(e,t)=>e?.add(t),K=(e,t,s)=>c(s)<2?H(f(s)?e:x(e,s[0],G),t):K(x(e,s[0],m),t,u(s)),Q=e=>{const t=(s,n,...r)=>L(s,(s=>f(r)?e(s,n):d([r[0],null],(e=>t(F(s,e),n,...u(r))))));return t},U=(e,t,s,n=j)=>{const r=(a=J(e),l=e=>!D(t,e),a.filter(l));var a,l;return d(P(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},V=e=>{const s=t(e);return w(s)||s==r&&p(e)?s:void 0},X=(e,t,s)=>y(e)||!(e=>g(e,N)&&e.constructor==N)(e)||A(e)||_(e)?(s?.(),!1):(q(e,((s,n)=>{t(s,n)||W(e,n)})),!A(e)),Y=(e,t,s)=>j(e,t,F(e,t)==-s?void 0:s);e.createStore=()=>{let e,s,n=0,f=0;const u=m(),p=m(),g=m(),N=m(),P=m(),_=m(),Z=m(),$=m(),ee=E(G),te=E(G),se=E(),ne=E(),re=E(),ae=E(),le=E(),oe=E(),ie=E(G),[de,ce,fe,ue]=(e=>{let t,s=0;const n=[],r=m();return[(a,l,o=[])=>{t??=e();const i=n.pop()??""+s++;return j(r,i,[a,l,o]),K(l,i,o),i},(e,s=[],...n)=>Q(v)(e,(e=>L(F(r,e),(([e])=>e(t,...s,...n)))),...s),e=>L(F(r,e),(([,t,s])=>(Q(I)(t,e,...s),j(r,e),c(n)<1e3&&h(n,e),s)),(()=>[])),(e,s,n)=>L(F(r,e),(([e,,r])=>{const a=(...l)=>{const o=c(l);o==c(r)?e(t,...l,...n(l)):y(r[o])?d(s[o](...l),(e=>a(...l,e))):a(...l,r[o])};a()}))]})((()=>Ve)),he=(t,s)=>(!e||R(_,s)||xe(s))&&X(t,((e,t)=>Te(s,t,e)),(()=>xe(s))),Te=(e,t,s,n)=>X(n?s:pe(s,e,t),((n,r)=>L(be(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>xe(e,t))),be=(t,s,n,r)=>e?L(F(F(_,t),n),(e=>V(r)!=e.type?xe(t,s,n,r,e.default):r),(()=>xe(t,s,n,r))):y(V(r))?xe(t,s,n,r):r,pe=(e,t,s)=>(L(F(Z,t),(([n,r])=>{v(n,((t,s)=>{D(e,s)||(e[s]=t)})),v(r,(n=>{D(e,n)||xe(t,s,n)}))})),e),ge=e=>U(_,e,((e,t,s)=>{const n=m(),r=G();U(x(_,t,m),s,((e,t,s)=>{j(e,t,s),L(s.default,(e=>j(n,t,e)),(()=>H(r,t)))})),j(Z,t,[n,r])}),((e,t)=>{j(_,t),j(Z,t)})),ye=e=>U($,e,((e,t,s)=>Le(t,s)),((e,t)=>Ie(t))),Le=(e,t)=>U(x($,e,(()=>(Je(e,1),m()))),t,((t,s,n)=>we(e,t,s,n)),((t,s)=>me(e,t,s))),we=(e,t,s,n,r)=>U(x(t,s,(()=>(Fe(e,s,1),m()))),n,((t,n,r)=>Re(e,s,t,n,r)),((n,a)=>Ee(e,t,s,n,a,r))),Re=(e,t,s,n,r)=>{R(s,n)||Oe(e,t,n,1);const a=F(s,n);r!==a&&(je(e,t,n,a,r),j(s,n,r))},Ce=(e,t,s,n,r)=>L(F(t,s),(t=>Re(e,s,t,n,r)),(()=>we(e,t,s,pe({[n]:r},e,s)))),Se=e=>{const t=""+n++;return R(e,t)?Se(e):t},ve=e=>F($,e)??Le(e,{}),Ie=e=>Le(e,{}),me=(e,t,s)=>we(e,t,s,{},!0),Ee=(e,t,s,n,r,a)=>{const l=F(F(Z,e)?.[0],r);if(!y(l)&&!a)return Re(e,s,n,r,l);const o=t=>{je(e,s,t,F(n,t)),Oe(e,s,t,-1),j(n,t)};y(l)?o(r):O(n,o),C(n)&&(Fe(e,s,-1),C(j(t,s))&&(Je(e,-1),j($,e)))},Je=(e,t)=>Y(u,e,t),Fe=(e,t,s)=>Y(x(p,e,m),t,s),Oe=(e,t,s,n)=>Y(x(x(g,e,m),t,m),s,n),je=(e,t,s,n,r)=>x(x(x(N,e,m),t,m),s,(()=>[n,0]))[1]=r,xe=(e,t,s,n,r)=>(h(x(x(x(P,e,m),t,m),s,(()=>[])),n),r),ze=(e,t,s)=>L(F(F(F(N,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...i(We(e,t,s))])),Me=e=>C(P)||C(oe[e])?0:v(e?M(P,k):P,((t,s)=>v(t,((t,n)=>v(t,((t,r)=>ce(oe[e],[s,n,r],t))))))),ke=e=>{const t=C(ae[e])&&C(ne[e])&&C(te[e]),s=C(le[e])&&C(re[e])&&C(se[e])&&C(ee[e]);if(!t||!s){const n=e?[M(u),k(p),M(g,k),M(N,k)]:[u,p,g,N];if(t||(v(n[2],((t,s)=>v(t,((t,n)=>{C(t)||ce(ae[e],[s,n])})))),v(n[1],((t,s)=>{C(t)||ce(ne[e],[s])})),C(n[0])||ce(te[e])),!s){let t;v(n[3],((s,n)=>{let r;v(s,((s,a)=>{let l;v(s,(([s,o],i)=>{o!==s&&(ce(le[e],[n,a,i],o,s,ze),t=r=l=1)})),l&&ce(re[e],[n,a],ze)})),r&&ce(se[e],[n],ze)})),t&&ce(ee[e],[],ze)}}},Ne=e=>(Ke(e),Ve),Pe=()=>z($,(e=>z(e,z))),_e=()=>J($),Be=e=>J(F($,e)),De=(e,t)=>J(F(F($,e),t)),We=(e,t,s)=>F(F(F($,e),t),s),qe=e=>Ne((()=>(e=>X(e,he,xe))(e)?ye(e):0)),Ae=(e,s,n,r)=>Ne((()=>L(be(e,s,n,t(r)==a?r(We(e,s,n)):r),(t=>Ce(e,ve(e),s,n,t))))),Ge=()=>Ne((()=>ye({}))),He=(e,t,s,n)=>Ne((()=>L(F($,e),(r=>L(F(r,t),(a=>R(a,s)?Ee(e,r,t,a,s,n):0)))))),Ke=(e,t)=>{if(-1==f)return;Qe();const s=e?.();return Ue(t),s},Qe=()=>(f++,Ve),Ue=e=>(f>0&&(f--,0==f&&(s=!C(N),f=1,Me(1),s&&ke(1),f=-1,e?.(z(N,(e=>z(e,(e=>z(e,(e=>[...e]),(([e,t])=>e===t))),A)),A),z(P,(e=>z(e,z))))&&(f=1,v(N,((e,t)=>v(e,((e,s)=>v(e,(([e],n)=>y(e)?He(t,s,n,!0):Ae(t,s,n,e))))))),f=-1,s=!1),ce(ie[0],[],s),Me(0),s&&ke(0),ce(ie[1],[],s),f=0,d([N,P,u,p,g],S))),Ve),Ve={getTables:Pe,getTableIds:_e,getTable:e=>z(F($,e),z),getRowIds:Be,getRow:(e,t)=>z(F(F($,e),t)),getCellIds:De,getCell:We,hasTables:()=>!C($),hasTable:e=>R($,e),hasRow:(e,t)=>R(F($,e),t),hasCell:(e,t,s)=>R(F(F($,e),t),s),getJson:()=>T($),getSchemaJson:()=>T(_),setTables:qe,setTable:(e,t)=>Ne((()=>he(t,e)?Le(e,t):0)),setRow:(e,t,s)=>Ne((()=>Te(e,t,s)?we(e,ve(e),t,s):0)),addRow:(e,t)=>Ke((()=>{let s;return Te(e,s,t)&&we(e,ve(e),s=Se(F($,e)),t),s})),setPartialRow:(e,t,s)=>Ne((()=>{if(Te(e,t,s,1)){const n=ve(e);q(s,((s,r)=>Ce(e,n,t,r,s)))}})),setCell:Ae,setJson:e=>{try{"{}"===e?Ge():qe(b(e))}catch{}return Ve},setSchema:t=>Ne((()=>{if((e=(e=>X(e,(e=>X(e,(e=>{if(!X(e,((e,t)=>[l,o].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(V(e.default)!=t&&W(e,o),0))})))))(t))&&(ge(t),!C($))){const e=Pe();Ge(),qe(e)}})),delTables:Ge,delTable:e=>Ne((()=>R($,e)?Ie(e):0)),delRow:(e,t)=>Ne((()=>L(F($,e),(s=>R(s,t)?me(e,s,t):0)))),delCell:He,delSchema:()=>Ne((()=>{ge({}),e=!1})),transaction:Ke,startTransaction:Qe,finishTransaction:Ue,forEachTable:e=>v($,((t,s)=>e(s,(e=>v(t,((t,s)=>e(s,(e=>O(t,e))))))))),forEachRow:(e,t)=>v(F($,e),((e,s)=>t(s,(t=>O(e,t))))),forEachCell:(e,t,s)=>O(F(F($,e),t),s),addTablesListener:(e,t)=>de(e,ee[t?1:0]),addTableIdsListener:(e,t)=>de(e,te[t?1:0]),addTableListener:(e,t,s)=>de(t,se[s?1:0],[e]),addRowIdsListener:(e,t,s)=>de(t,ne[s?1:0],[e]),addRowListener:(e,t,s,n)=>de(s,re[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>de(s,ae[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>de(n,le[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>de(n,oe[r?1:0],[e,t,s]),addWillFinishTransactionListener:e=>de(e,ie[0]),addDidFinishTransactionListener:e=>de(e,ie[1]),callListener:e=>(ue(e,[_e,Be,De],(e=>y(e[2])?[]:i(We(...e)))),Ve),delListener:e=>(fe(e),Ve),getListenerStats:()=>({})};return B(Ve)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
