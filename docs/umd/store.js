var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),l=t(0),o=t(t),r="type",i="default",c="Has",d="Ids",u="Table",f=u+"s",h=u+d,g="Row",T=g+"Count",b=g+d,S="Cell",V=S+d,p="Value",v=p+"s",y=p+d,C=e=>s+e,m=isFinite,w=e=>null==e,L=(e,t,s)=>w(e)?s?.():t(e),R=e=>e==n||e==a,J=e=>t(e)==o,I=(e,t,s)=>e.slice(t,s),E=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),P=(e,...t)=>e.push(...t),x=Object,z=e=>x.getPrototypeOf(e),j=x.entries,k=x.keys,A=x.isFrozen,M=x.freeze,N=e=>!w(e)&&L(z(e),(e=>e==x.prototype||w(z(e))),(()=>!0)),B=(e,t)=>t in e,D=(e,t)=>(delete e[t],e),H=(e,t)=>O(j(e),(([e,s])=>t(s,e))),W=e=>N(e)&&0==(e=>E(k(e)))(e),$=e=>e?.size??0,q=(e,t)=>e?.has(t)??!1,G=e=>w(e)||0==$(e),K=e=>e.clear(),Q=(e,t)=>e?.forEach(t),U=(e,t)=>e?.delete(t),X=e=>new Map(e),Y=e=>[...e?.keys()??[]],Z=(e,t)=>e?.get(t),_=(e,t)=>Q(e,((e,s)=>t(s,e))),ee=(e,t,s)=>w(s)?(U(e,t),e):e?.set(t,s),te=(e,t,s)=>(q(e,t)||ee(e,t,s()),Z(e,t)),se=(e,t,s,n=ee)=>(H(t,((t,n)=>s(e,n,t))),_(e,(s=>B(t,s)?0:n(e,s))),e),ne=(e,t,s)=>{const n={};return Q(e,((e,a)=>{const l=t?t(e,a):e;!s?.(l,e)&&(n[a]=l)})),n},ae=(e,t,s)=>ne(e,(e=>ne(e,t,s)),W),le=(e,t,s)=>ne(e,(e=>ae(e,t,s)),W),oe=(e,t)=>{const s=X();return Q(e,((e,n)=>s.set(n,t?.(e)??e))),s},re=e=>oe(e,oe),ie=e=>oe(e,re),ce=(e,t,s,n,a=0)=>L((s?te:Z)(e,t[a],a>E(t)-2?s:X),(l=>{if(a>E(t)-2)return n?.(l)&&ee(e,t[a]),l;const o=ce(l,t,s,n,a+1);return G(l)&&ee(e,t[a]),o})),de=e=>new Set(Array.isArray(e)||w(e)?e:[e]),ue=(e,t)=>e?.add(t),fe=/^\d+$/,he=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{fe.test(t)&&E(e)<1e3&&P(e,t)}]},ge=e=>[e,e],Te=()=>[X(),X()],be=e=>[...e],Se=([e,t])=>e===t,Ve=e=>{const s=t(e);return R(s)||s==l&&m(e)?s:void 0},pe=(e,t,s,n,a)=>w(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a),ve=(e,t,s)=>w(s)?e.delValue(t):e.setValue(t,s),ye=e=>JSON.stringify(e,((e,t)=>t instanceof Map?x.fromEntries([...t]):t)),Ce=JSON.parse,me=(e,t,s)=>w(e)||!N(e)||W(e)||A(e)?(s?.(),!1):(H(e,((s,n)=>{t(s,n)||D(e,n)})),!W(e)),we=(e,t,s)=>ee(e,t,Z(e,t)==-s?void 0:s),Le=()=>{let e,t,n,a=!1,o=!1,d=!1,m=!1,x=0;const z=X(),j=X(),k=X(),A=X(),N=X(),fe=X(),Re=X(),Je=X(),Ie=X(),Ee=X(),Fe=X(),Oe=X(),Pe=X(),xe=X(),ze=de(),je=X(),ke=X(),Ae=X(),Me=X(),Ne=Te(),Be=Te(),De=Te(),He=Te(),We=Te(),$e=Te(),qe=Te(),Ge=Te(),Ke=Te(),Qe=Te(),Ue=Te(),Xe=Te(),Ye=Te(),Ze=Te(),_e=Te(),et=Te(),tt=Te(),st=Te(),nt=Te(),at=Te(),lt=Te(),ot=Te(),rt=X(),it=Te(),[ct,dt,ut,ft]=(e=>{let t;const[n,a]=he(),l=X();return[(e,a,o,r=[],i=(()=>[]))=>{t??=Ps;const c=n(1);return ee(l,c,[e,a,o,r,i]),ue(ce(a,o??[s],de),c),c},(e,n,...a)=>F(((e,t=[s])=>{const n=[],a=(e,s)=>s==E(t)?P(n,e):null===t[s]?Q(e,(e=>a(e,s+1))):F([t[s],null],(t=>a(Z(e,t),s+1)));return a(e,0),n})(e,n),(e=>Q(e,(e=>Z(l,e)[0](t,...n??[],...a))))),e=>L(Z(l,e),(([,t,n])=>(ce(t,n??[s],void 0,(t=>(U(t,e),G(t)?1:0))),ee(l,e),a(e),n))),e=>L(Z(l,e),(([e,,s=[],n,a])=>{const l=(...o)=>{const r=E(o);r==E(s)?e(t,...o,...a(o)):w(s[r])?F(n[r]?.(...o)??[],(e=>l(...o,e))):l(...o,s[r])};l()}))]})(),ht=e=>{if(!me(e,((e,t)=>[r,i].includes(t))))return!1;const t=e[r];return!(!R(t)&&t!=l||(Ve(e[i])!=t&&D(e,i),0))},gt=(t,s)=>(!e||q(Fe,s)||$t(s))&&me(t,((e,t)=>Tt(s,t,e)),(()=>$t(s))),Tt=(e,t,s,n)=>me(n?s:pt(s,e,t),((n,a)=>L(bt(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>$t(e,t))),bt=(t,s,n,a)=>e?L(Z(Z(Fe,t),n),(e=>Ve(a)!=e[r]?$t(t,s,n,a,e[i]):a),(()=>$t(t,s,n,a))):w(Ve(a))?$t(t,s,n,a):a,St=(e,t)=>me(t?e:vt(e),((t,s)=>L(Vt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>qt())),Vt=(e,s)=>t?L(Z(Pe,e),(t=>Ve(s)!=t[r]?qt(e,s,t[i]):s),(()=>qt(e,s))):w(Ve(s))?qt(e,s):s,pt=(e,t,s)=>(L(Z(Oe,t),(([n,a])=>{Q(n,((t,s)=>{B(e,s)||(e[s]=t)})),Q(a,(n=>{B(e,n)||$t(t,s,n)}))})),e),vt=e=>(t&&(Q(xe,((t,s)=>{B(e,s)||(e[s]=t)})),Q(ze,(t=>{B(e,t)||qt(t)}))),e),yt=e=>se(Fe,e,((e,t,s)=>{const n=X(),a=de();se(te(Fe,t,X),s,((e,t,s)=>{ee(e,t,s),L(s[i],(e=>ee(n,t,e)),(()=>ue(a,t)))})),ee(Oe,t,[n,a])}),((e,t)=>{ee(Fe,t),ee(Oe,t)})),Ct=e=>se(Pe,e,((e,t,s)=>{ee(Pe,t,s),L(s[i],(e=>ee(xe,t,e)),(()=>ue(ze,t)))}),((e,t)=>{ee(Pe,t),ee(xe,t),U(ze,t)})),mt=e=>W(e)?ms():Vs(e),wt=e=>se(Ae,e,((e,t,s)=>Lt(t,s)),((e,t)=>zt(t))),Lt=(e,t)=>se(te(Ae,e,(()=>(Mt(e,1),ee(je,e,he()),ee(ke,e,X()),X()))),t,((t,s,n)=>Rt(e,t,s,n)),((t,s)=>jt(e,t,s))),Rt=(e,t,s,n,a)=>se(te(t,s,(()=>(Nt(e,s,1),X()))),n,((t,n,a)=>Jt(e,s,t,n,a)),((n,l)=>kt(e,t,s,n,l,a))),Jt=(e,t,s,n,a)=>{q(s,n)||Bt(e,t,n,1);const l=Z(s,n);a!==l&&(Dt(e,t,n,l,a),ee(s,n,a))},It=(e,t,s,n,a)=>L(Z(t,s),(t=>Jt(e,s,t,n,a)),(()=>Rt(e,t,s,pt({[n]:a},e,s)))),Et=e=>W(e)?Rs():ps(e),Ft=e=>se(Me,e,((e,t,s)=>Ot(t,s)),((e,t)=>At(t))),Ot=(e,t)=>{q(Me,e)||Ht(e,1);const s=Z(Me,e);t!==s&&(Wt(e,s,t),ee(Me,e,t))},Pt=(e,t)=>{const[s]=Z(je,e),n=s(t);return q(Z(Ae,e),n)?Pt(e,t):n},xt=e=>Z(Ae,e)??Lt(e,{}),zt=e=>Lt(e,{}),jt=(e,t,s)=>{const[,n]=Z(je,e);n(s),Rt(e,t,s,{},!0)},kt=(e,t,s,n,a,l)=>{const o=Z(Z(Oe,e)?.[0],a);if(!w(o)&&!l)return Jt(e,s,n,a,o);const r=t=>{Dt(e,s,t,Z(n,t)),Bt(e,s,t,-1),ee(n,t)};w(o)?r(a):_(n,r),G(n)&&(Nt(e,s,-1),G(ee(t,s))&&(Mt(e,-1),ee(Ae,e),ee(je,e),ee(ke,e)))},At=e=>{const t=Z(xe,e);if(!w(t))return Ot(e,t);Wt(e,Z(Me,e)),Ht(e,-1),ee(Me,e)},Mt=(e,t)=>we(z,e,t),Nt=(e,t,s)=>we(te(A,e,X),t,s)&&ee(k,e,te(k,e,(()=>0))+s),Bt=(e,t,s,n)=>{const a=Z(ke,e),l=Z(a,s)??0;(0==l&&1==n||1==l&&-1==n)&&we(te(j,e,X),s,n),ee(a,s,l!=-n?l+n:null),we(te(te(N,e,X),t,X),s,n)},Dt=(e,t,s,n,a)=>te(te(te(fe,e,X),t,X),s,(()=>[n,0]))[1]=a,Ht=(e,t)=>we(Re,e,t),Wt=(e,t,s)=>te(Je,e,(()=>[t,0]))[1]=s,$t=(e,t,s,n,a)=>(P(te(te(te(Ie,e,X),t,X),s,(()=>[])),n),a),qt=(e,t,s)=>(P(te(Ee,e,(()=>[])),t),s),Gt=(e,t,s)=>L(Z(Z(Z(fe,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...ge(rs(e,t,s))])),Kt=e=>L(Z(Je,e),(([e,t])=>[!0,e,t]),(()=>[!1,...ge(ds(e))])),Qt=e=>G(Ie)||G(et[e])?0:Q(e?ie(Ie):Ie,((t,s)=>Q(t,((t,n)=>Q(t,((t,a)=>dt(et[e],[s,n,a],t))))))),Ut=e=>G(Ee)||G(tt[e])?0:Q(e?oe(Ee):Ee,((t,s)=>dt(tt[e],[s],t))),Xt=(e,t,s,n)=>{if(!G(e))return dt(t,n,(()=>ne(e))),_(e,((e,t)=>dt(s,[...n??[],e],1==t))),1},Yt=e=>{const t=us();t!=d&&dt(Ne[e],void 0,t);const s=G(Qe[e]),n=G(Ye[e])&&G(Ze[e])&&G(Ke[e])&&G(Ue[e])&&G($e[e])&&G(qe[e])&&G(Ge[e])&&s&&G(De[e])&&G(He[e]),a=G(_e[e])&&G(Xe[e])&&G(We[e])&&G(Be[e]);if(!n||!a){const t=e?[oe(z),re(j),oe(k),re(A),ie(N),ie(fe)]:[z,j,k,A,N,fe];if(!n){Xt(t[0],De[e],He[e]),Q(t[1],((t,s)=>Xt(t,$e[e],qe[e],[s]))),Q(t[2],((t,s)=>{0!=t&&dt(Ge[e],[s],ns(s))}));const n=de();Q(t[3],((t,a)=>{Xt(t,Ke[e],Ue[e],[a])&&!s&&(dt(Qe[e],[a,null]),ue(n,a))})),s||Q(t[5],((t,s)=>{if(!q(n,s)){const n=de();Q(t,(e=>Q(e,(([t,s],a)=>s!==t?ue(n,a):U(e,a))))),Q(n,(t=>dt(Qe[e],[s,t])))}})),Q(t[4],((t,s)=>Q(t,((t,n)=>Xt(t,Ye[e],Ze[e],[s,n])))))}if(!a){let s;Q(t[5],((t,n)=>{let a;Q(t,((t,l)=>{let o;Q(t,(([t,r],i)=>{r!==t&&(dt(_e[e],[n,l,i],r,t,Gt),s=a=o=1)})),o&&dt(Xe[e],[n,l],Gt)})),a&&dt(We[e],[n],Gt)})),s&&dt(Be[e],void 0,Gt)}}},Zt=e=>{const t=bs();t!=m&&dt(st[e],void 0,t);const s=G(at[e])&&G(lt[e]),n=G(ot[e])&&G(nt[e]);if(!s||!n){const t=e?[oe(Re),oe(Je)]:[Re,Je];if(s||Xt(t[0],at[e],lt[e]),!n){let s;Q(t[1],(([t,n],a)=>{n!==t&&(dt(ot[e],[a],n,t,Kt),s=1)})),s&&dt(nt[e],void 0,Kt)}}},_t=(e,...t)=>(Es((()=>e(...O(t,C)))),Ps),es=()=>le(Ae),ts=()=>Y(Ae),ss=e=>Y(Z(ke,C(e))),ns=e=>$(Z(Ae,C(e))),as=e=>Y(Z(Ae,C(e))),ls=(e,t,s,n=0,a)=>{return O(I((o=Z(Ae,C(e)),r=(e,s)=>[w(t)?s:Z(e,C(t)),s],l=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(l)),n,w(a)?a:n+a),(([,e])=>e));var l,o,r},os=(e,t)=>Y(Z(Z(Ae,C(e)),C(t))),rs=(e,t,s)=>Z(Z(Z(Ae,C(e)),C(t)),C(s)),is=()=>ne(Me),cs=()=>Y(Me),ds=e=>Z(Me,C(e)),us=()=>!G(Ae),fs=e=>q(Ae,C(e)),hs=(e,t)=>q(Z(ke,C(e)),C(t)),gs=(e,t)=>q(Z(Ae,C(e)),C(t)),Ts=(e,t,s)=>q(Z(Z(Ae,C(e)),C(t)),C(s)),bs=()=>!G(Me),Ss=e=>q(Me,C(e)),Vs=e=>_t((()=>(e=>me(e,gt,$t))(e)?wt(e):0)),ps=e=>_t((()=>St(e)?Ft(e):0)),vs=e=>{try{mt(Ce(e))}catch{}return Ps},ys=t=>_t((()=>{if((e=me(t,(e=>me(e,ht))))&&(yt(t),!G(Ae))){const e=es();ms(),Vs(e)}})),Cs=e=>_t((()=>{if(t=(e=>me(e,ht))(e)){const s=is();Is(),Rs(),t=!0,Ct(e),ps(s)}})),ms=()=>_t((()=>wt({}))),ws=e=>_t((e=>q(Ae,e)?zt(e):0),e),Ls=(e,t)=>_t(((e,t)=>L(Z(Ae,e),(s=>q(s,t)?jt(e,s,t):0))),e,t),Rs=()=>_t((()=>Ft({}))),Js=()=>_t((()=>{yt({}),e=!1})),Is=()=>_t((()=>{Ct({}),t=!1})),Es=(e,t)=>{if(-1!=x){Fs();const s=e();return Os(t),s}},Fs=()=>(-1!=x&&x++,1==x&&dt(rt,void 0),Ps),Os=e=>(x>0&&(x--,0==x&&(a=!G(fe),o=!G(Je),x=1,Qt(1),a&&Yt(1),Ut(1),o&&Zt(1),e?.(Ps)&&(Q(fe,((e,t)=>Q(e,((e,s)=>Q(e,(([e],n)=>pe(Ps,t,s,n,e))))))),Q(Je,(([e],t)=>ve(Ps,t,e))),a=o=!1),dt(it[0],void 0),x=-1,Qt(0),a&&Yt(0),Ut(0),o&&Zt(0),n?.(Ps),dt(it[1],void 0),x=0,a=o=!1,d=us(),m=bs(),F([z,j,k,A,N,fe,Ie,Re,Je,Ee],K))),Ps),Ps={getContent:()=>[es(),is()],getTables:es,getTableIds:ts,getTable:e=>ae(Z(Ae,C(e))),getTableCellIds:ss,getRowCount:ns,getRowIds:as,getSortedRowIds:ls,getRow:(e,t)=>ne(Z(Z(Ae,C(e)),C(t))),getCellIds:os,getCell:rs,getValues:is,getValueIds:cs,getValue:ds,hasTables:us,hasTable:fs,hasTableCell:hs,hasRow:gs,hasCell:Ts,hasValues:bs,hasValue:Ss,getTablesJson:()=>ye(Ae),getValuesJson:()=>ye(Me),getJson:()=>ye([Ae,Me]),getTablesSchemaJson:()=>ye(Fe),getValuesSchemaJson:()=>ye(Pe),getSchemaJson:()=>ye([Fe,Pe]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>_t((()=>{(W(e)?ms:Vs)(e),(W(t)?Rs:ps)(t)})),setTables:Vs,setTable:(e,t)=>_t((e=>gt(t,e)?Lt(e,t):0),e),setRow:(e,t,s)=>_t(((e,t)=>Tt(e,t,s)?Rt(e,xt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Es((()=>{let n;return Tt(e,n,t)&&(e=C(e),Rt(e,xt(e),n=Pt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>_t(((e,t)=>{if(Tt(e,t,s,1)){const n=xt(e);H(s,((s,a)=>It(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>_t(((e,t,s)=>L(bt(e,t,s,J(n)?n(rs(e,t,s)):n),(n=>It(e,xt(e),t,s,n)))),e,t,s),setValues:ps,setPartialValues:e=>_t((()=>St(e,1)?H(e,((e,t)=>Ot(t,e))):0)),setValue:(e,t)=>_t((e=>L(Vt(e,J(t)?t(ds(e)):t),(t=>Ot(e,t)))),e),applyChanges:e=>_t((()=>{H(e[0],((e,t)=>w(e)?ws(t):H(e,((e,s)=>w(e)?Ls(t,s):H(e,((e,n)=>pe(Ps,t,s,n,e))))))),H(e[1],((e,t)=>ve(Ps,t,e)))})),setTablesJson:vs,setValuesJson:e=>{try{Et(Ce(e))}catch{}return Ps},setJson:e=>_t((()=>{try{const[t,s]=Ce(e);mt(t),Et(s)}catch{vs(e)}})),setTablesSchema:ys,setValuesSchema:Cs,setSchema:(e,t)=>_t((()=>{ys(e),Cs(t)})),delTables:ms,delTable:ws,delRow:Ls,delCell:(e,t,s,n)=>_t(((e,t,s)=>L(Z(Ae,e),(a=>L(Z(a,t),(l=>q(l,s)?kt(e,a,t,l,s,n):0))))),e,t,s),delValues:Rs,delValue:e=>_t((e=>q(Me,e)?At(e):0),e),delTablesSchema:Js,delValuesSchema:Is,delSchema:()=>_t((()=>{Js(),Is()})),transaction:Es,startTransaction:Fs,getTransactionChanges:()=>[ne(fe,((e,t)=>-1===Z(z,t)?void 0:ne(e,((e,s)=>-1===Z(Z(A,t),s)?void 0:ne(e,(([,e])=>e),((e,t)=>Se(t)))),W)),W),ne(Je,(([,e])=>e),((e,t)=>Se(t)))],getTransactionLog:()=>[a,o,le(fe,be,Se),le(Ie),ne(Je,be,Se),ne(Ee),ne(z),ae(A),le(N),ne(Re)],finishTransaction:Os,forEachTable:e=>Q(Ae,((t,s)=>e(s,(e=>Q(t,((t,s)=>e(s,(e=>_(t,e))))))))),forEachTableCell:(e,t)=>_(Z(ke,C(e)),t),forEachRow:(e,t)=>Q(Z(Ae,C(e)),((e,s)=>t(s,(t=>_(e,t))))),forEachCell:(e,t,s)=>_(Z(Z(Ae,C(e)),C(t)),s),forEachValue:e=>_(Me,e),addSortedRowIdsListener:(e,t,s,n,a,l,o)=>{let r=ls(e,t,s,n,a);return ct((()=>{const o=ls(e,t,s,n,a);var i,c,d;c=r,E(i=o)===E(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(r=o,l(Ps,e,t,s,n,a,r))}),Qe[o?1:0],[e,t],[ts])},addStartTransactionListener:e=>ct(e,rt),addWillFinishTransactionListener:e=>ct(e,it[0]),addDidFinishTransactionListener:e=>ct(e,it[1]),callListener:e=>(ft(e),Ps),delListener:e=>(ut(e),Ps),getListenerStats:()=>({}),createStore:Le,addListener:ct,callListeners:dt,addPostTransactionListener:e=>{n=e}};return H({[c+f]:[0,Ne,[],()=>[us()]],[f]:[0,Be],[h]:[0,De],[c+u]:[1,He,[ts],e=>[fs(...e)]],[u]:[1,We,[ts]],[u+V]:[1,$e,[ts]],[c+u+S]:[2,qe,[ts,ss],e=>[hs(...e)]],[T]:[1,Ge,[ts]],[b]:[1,Ke,[ts]],[c+g]:[2,Ue,[ts,as],e=>[gs(...e)]],[g]:[2,Xe,[ts,as]],[V]:[2,Ye,[ts,as]],[c+S]:[3,Ze,[ts,as,os],e=>[Ts(...e)]],[S]:[3,_e,[ts,as,os],e=>ge(rs(...e))],InvalidCell:[3,et],[c+v]:[0,st,[],()=>[bs()]],[v]:[0,nt],[y]:[0,at],[c+p]:[1,lt,[cs],e=>[Ss(...e)]],[p]:[1,ot,[cs],e=>ge(ds(e[0]))],InvalidValue:[1,tt]},(([e,t,s,n],a)=>{Ps["add"+a+"Listener"]=(...a)=>ct(a[e],t[a[e+1]?1:0],e>0?I(a,0,e):void 0,s,n)})),M(Ps)};e.createStore=Le},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
