var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),a=t(0),o=t(t),r="type",c="default",i="Has",d="Ids",u="Table",h=u+"s",f=u+d,g="Row",T=g+"Count",b=g+d,V="Cell",C=V+d,S="Value",v=S+"s",y=S+d,p=e=>s+e,m=isFinite,w=e=>null==e,I=(e,t,s)=>w(e)?s?.():t(e),R=e=>e==n||e==l,J=e=>t(e)==o,L=(e,t,s)=>e.slice(t,s),E=e=>e.length,F=(e,t)=>e.forEach(t),O=(e,t)=>e.map(t),P=(e,...t)=>e.push(...t),x=Object,z=e=>x.getPrototypeOf(e),j=x.entries,k=x.keys,A=x.isFrozen,M=x.freeze,N=e=>!w(e)&&I(z(e),(e=>e==x.prototype||w(z(e))),(()=>!0)),B=(e,t)=>!w(((e,t)=>I(e,(e=>e[t])))(e,t)),D=(e,t)=>(delete e[t],e),H=(e,t)=>O(j(e),(([e,s])=>t(s,e))),W=e=>N(e)&&0==(e=>E(k(e)))(e),$=e=>e?.size??0,q=(e,t)=>e?.has(t)??!1,G=e=>w(e)||0==$(e),K=e=>e.clear(),Q=(e,t)=>e?.forEach(t),U=(e,t)=>e?.delete(t),X=e=>new Map(e),Y=e=>[...e?.keys()??[]],Z=(e,t)=>e?.get(t),_=(e,t)=>Q(e,((e,s)=>t(s,e))),ee=(e,t,s)=>w(s)?(U(e,t),e):e?.set(t,s),te=(e,t,s)=>(q(e,t)||ee(e,t,s()),Z(e,t)),se=(e,t,s,n=ee)=>(H(t,((t,n)=>s(e,n,t))),_(e,(s=>B(t,s)?0:n(e,s))),e),ne=(e,t,s)=>{const n={};return Q(e,((e,l)=>{const a=t?t(e,l):e;!s?.(a,e)&&(n[l]=a)})),n},le=(e,t,s)=>ne(e,(e=>ne(e,t,s)),W),ae=(e,t,s)=>ne(e,(e=>le(e,t,s)),W),oe=(e,t)=>{const s=X();return Q(e,((e,n)=>s.set(n,t?.(e)??e))),s},re=e=>oe(e,oe),ce=e=>oe(e,re),ie=(e,t,s,n,l=0)=>I((s?te:Z)(e,t[l],l>E(t)-2?s:X),(a=>{if(l>E(t)-2)return n?.(a)&&ee(e,t[l]),a;const o=ie(a,t,s,n,l+1);return G(a)&&ee(e,t[l]),o})),de=e=>new Set(Array.isArray(e)||w(e)?e:[e]),ue=(e,t)=>e?.add(t),he=/^\d+$/,fe=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{he.test(t)&&E(e)<1e3&&P(e,t)}]},ge=e=>[e,e],Te=()=>[X(),X()],be=e=>[...e],Ve=([e,t])=>e===t,Ce=e=>{const s=t(e);return R(s)||s==a&&m(e)?s:void 0},Se=(e,t,s,n,l)=>w(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l),ve=(e,t,s)=>w(s)?e.delValue(t):e.setValue(t,s),ye=e=>JSON.stringify(e,((e,t)=>t instanceof Map?x.fromEntries([...t]):t)),pe=JSON.parse,me=(e,t,s)=>w(e)||!N(e)||W(e)||A(e)?(s?.(),!1):(H(e,((s,n)=>{t(s,n)||D(e,n)})),!W(e)),we=(e,t,s)=>ee(e,t,Z(e,t)==-s?void 0:s),Ie=()=>{let e,t,n,l=!1,o=!1,d=!1,m=!1,x=0;const z=X(),j=X(),k=X(),A=X(),N=X(),he=X(),Re=X(),Je=X(),Le=X(),Ee=X(),Fe=X(),Oe=X(),Pe=X(),xe=X(),ze=de(),je=X(),ke=X(),Ae=X(),Me=X(),Ne=Te(),Be=Te(),De=Te(),He=Te(),We=Te(),$e=Te(),qe=Te(),Ge=Te(),Ke=Te(),Qe=Te(),Ue=Te(),Xe=Te(),Ye=Te(),Ze=Te(),_e=Te(),et=Te(),tt=Te(),st=Te(),nt=Te(),lt=Te(),at=Te(),ot=Te(),rt=X(),ct=Te(),[it,dt,ut,ht]=(e=>{let t;const[n,l]=fe(),a=X();return[(e,l,o,r=[],c=(()=>[]))=>{t??=zs;const i=n(1);return ee(a,i,[e,l,o,r,c]),ue(ie(l,o??[s],de),i),i},(e,n,...l)=>F(((e,t=[s])=>{const n=[],l=(e,s)=>s==E(t)?P(n,e):null===t[s]?Q(e,(e=>l(e,s+1))):F([t[s],null],(t=>l(Z(e,t),s+1)));return l(e,0),n})(e,n),(e=>Q(e,(e=>Z(a,e)[0](t,...n??[],...l))))),e=>I(Z(a,e),(([,t,n])=>(ie(t,n??[s],void 0,(t=>(U(t,e),G(t)?1:0))),ee(a,e),l(e),n))),e=>I(Z(a,e),(([e,,s=[],n,l])=>{const a=(...o)=>{const r=E(o);r==E(s)?e(t,...o,...l(o)):w(s[r])?F(n[r]?.(...o)??[],(e=>a(...o,e))):a(...o,s[r])};a()}))]})(),ft=e=>{if(!me(e,((e,t)=>[r,c].includes(t))))return!1;const t=e[r];return!(!R(t)&&t!=a||(Ce(e[c])!=t&&D(e,c),0))},gt=(t,s)=>(!e||q(Fe,s)||$t(s))&&me(t,((e,t)=>Tt(s,t,e)),(()=>$t(s))),Tt=(e,t,s,n)=>me(n?s:St(s,e,t),((n,l)=>I(bt(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>$t(e,t))),bt=(t,s,n,l)=>e?I(Z(Z(Fe,t),n),(e=>Ce(l)!=e[r]?$t(t,s,n,l,e[c]):l),(()=>$t(t,s,n,l))):w(Ce(l))?$t(t,s,n,l):l,Vt=(e,t)=>me(t?e:vt(e),((t,s)=>I(Ct(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>qt())),Ct=(e,s)=>t?I(Z(Pe,e),(t=>Ce(s)!=t[r]?qt(e,s,t[c]):s),(()=>qt(e,s))):w(Ce(s))?qt(e,s):s,St=(e,t,s)=>(I(Z(Oe,t),(([n,l])=>{Q(n,((t,s)=>{B(e,s)||(e[s]=t)})),Q(l,(n=>{B(e,n)||$t(t,s,n)}))})),e),vt=e=>(t&&(Q(xe,((t,s)=>{B(e,s)||(e[s]=t)})),Q(ze,(t=>{B(e,t)||qt(t)}))),e),yt=e=>se(Fe,e,((e,t,s)=>{const n=X(),l=de();se(te(Fe,t,X),s,((e,t,s)=>{ee(e,t,s),I(s[c],(e=>ee(n,t,e)),(()=>ue(l,t)))})),ee(Oe,t,[n,l])}),((e,t)=>{ee(Fe,t),ee(Oe,t)})),pt=e=>se(Pe,e,((e,t,s)=>{ee(Pe,t,s),I(s[c],(e=>ee(xe,t,e)),(()=>ue(ze,t)))}),((e,t)=>{ee(Pe,t),ee(xe,t),U(ze,t)})),mt=e=>W(e)?Is():vs(e),wt=e=>se(Ae,e,((e,t,s)=>It(t,s)),((e,t)=>zt(t))),It=(e,t)=>se(te(Ae,e,(()=>(Mt(e,1),ee(je,e,fe()),ee(ke,e,X()),X()))),t,((t,s,n)=>Rt(e,t,s,n)),((t,s)=>jt(e,t,s))),Rt=(e,t,s,n,l)=>se(te(t,s,(()=>(Nt(e,s,1),X()))),n,((t,n,l)=>Jt(e,s,t,n,l)),((n,a)=>kt(e,t,s,n,a,l))),Jt=(e,t,s,n,l)=>{q(s,n)||Bt(e,t,n,1);const a=Z(s,n);l!==a&&(Dt(e,t,n,a,l),ee(s,n,l))},Lt=(e,t,s,n,l)=>I(Z(t,s),(t=>Jt(e,s,t,n,l)),(()=>Rt(e,t,s,St({[n]:l},e,s)))),Et=e=>W(e)?Ls():ys(e),Ft=e=>se(Me,e,((e,t,s)=>Ot(t,s)),((e,t)=>At(t))),Ot=(e,t)=>{q(Me,e)||Ht(e,1);const s=Z(Me,e);t!==s&&(Wt(e,s,t),ee(Me,e,t))},Pt=(e,t)=>{const[s]=Z(je,e),n=s(t);return q(Z(Ae,e),n)?Pt(e,t):n},xt=e=>Z(Ae,e)??It(e,{}),zt=e=>It(e,{}),jt=(e,t,s)=>{const[,n]=Z(je,e);n(s),Rt(e,t,s,{},!0)},kt=(e,t,s,n,l,a)=>{const o=Z(Z(Oe,e)?.[0],l);if(!w(o)&&!a)return Jt(e,s,n,l,o);const r=t=>{Dt(e,s,t,Z(n,t)),Bt(e,s,t,-1),ee(n,t)};w(o)?r(l):_(n,r),G(n)&&(Nt(e,s,-1),G(ee(t,s))&&(Mt(e,-1),ee(Ae,e),ee(je,e),ee(ke,e)))},At=e=>{const t=Z(xe,e);if(!w(t))return Ot(e,t);Wt(e,Z(Me,e)),Ht(e,-1),ee(Me,e)},Mt=(e,t)=>we(z,e,t),Nt=(e,t,s)=>we(te(A,e,X),t,s)&&ee(k,e,te(k,e,(()=>0))+s),Bt=(e,t,s,n)=>{const l=Z(ke,e),a=Z(l,s)??0;(0==a&&1==n||1==a&&-1==n)&&we(te(j,e,X),s,n),ee(l,s,a!=-n?a+n:null),we(te(te(N,e,X),t,X),s,n)},Dt=(e,t,s,n,l)=>te(te(te(he,e,X),t,X),s,(()=>[n,0]))[1]=l,Ht=(e,t)=>we(Re,e,t),Wt=(e,t,s)=>te(Je,e,(()=>[t,0]))[1]=s,$t=(e,t,s,n,l)=>(P(te(te(te(Le,e,X),t,X),s,(()=>[])),n),l),qt=(e,t,s)=>(P(te(Ee,e,(()=>[])),t),s),Gt=(e,t,s)=>I(Z(Z(Z(he,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...ge(is(e,t,s))])),Kt=e=>I(Z(Je,e),(([e,t])=>[!0,e,t]),(()=>[!1,...ge(hs(e))])),Qt=e=>G(Le)||G(et[e])?0:Q(e?ce(Le):Le,((t,s)=>Q(t,((t,n)=>Q(t,((t,l)=>dt(et[e],[s,n,l],t))))))),Ut=e=>G(Ee)||G(tt[e])?0:Q(e?oe(Ee):Ee,((t,s)=>dt(tt[e],[s],t))),Xt=(e,t,s,n)=>{if(!G(e))return dt(t,n,(()=>ne(e))),_(e,((e,t)=>dt(s,[...n??[],e],1==t))),1},Yt=e=>{const t=fs();t!=d&&dt(Ne[e],void 0,t);const s=G(Qe[e]),n=G(Ye[e])&&G(Ze[e])&&G(Ke[e])&&G(Ue[e])&&G($e[e])&&G(qe[e])&&G(Ge[e])&&s&&G(De[e])&&G(He[e]),l=G(_e[e])&&G(Xe[e])&&G(We[e])&&G(Be[e]);if(!n||!l){const t=e?[oe(z),re(j),oe(k),re(A),ce(N),ce(he)]:[z,j,k,A,N,he];if(!n){Xt(t[0],De[e],He[e]),Q(t[1],((t,s)=>Xt(t,$e[e],qe[e],[s]))),Q(t[2],((t,s)=>{0!=t&&dt(Ge[e],[s],as(s))}));const n=de();Q(t[3],((t,l)=>{Xt(t,Ke[e],Ue[e],[l])&&!s&&(dt(Qe[e],[l,null]),ue(n,l))})),s||Q(t[5],((t,s)=>{if(!q(n,s)){const n=de();Q(t,(e=>Q(e,(([t,s],l)=>s!==t?ue(n,l):U(e,l))))),Q(n,(t=>dt(Qe[e],[s,t])))}})),Q(t[4],((t,s)=>Q(t,((t,n)=>Xt(t,Ye[e],Ze[e],[s,n])))))}if(!l){let s;Q(t[5],((t,n)=>{let l;Q(t,((t,a)=>{let o;Q(t,(([t,r],c)=>{r!==t&&(dt(_e[e],[n,a,c],r,t,Gt),s=l=o=1)})),o&&dt(Xe[e],[n,a],Gt)})),l&&dt(We[e],[n],Gt)})),s&&dt(Be[e],void 0,Gt)}}},Zt=e=>{const t=Cs();t!=m&&dt(st[e],void 0,t);const s=G(lt[e])&&G(at[e]),n=G(ot[e])&&G(nt[e]);if(!s||!n){const t=e?[oe(Re),oe(Je)]:[Re,Je];if(s||Xt(t[0],lt[e],at[e]),!n){let s;Q(t[1],(([t,n],l)=>{n!==t&&(dt(ot[e],[l],n,t,Kt),s=1)})),s&&dt(nt[e],void 0,Kt)}}},_t=(e,...t)=>(Os((()=>e(...O(t,p)))),zs),es=()=>[ne(he,((e,t)=>-1===Z(z,t)?null:ne(e,((e,s)=>-1===Z(Z(A,t),s)?null:ne(e,(([,e])=>e??null),((e,t)=>Ve(t)))),W)),W),ne(Je,(([,e])=>e??null),((e,t)=>Ve(t)))],ts=()=>({cellsTouched:l,valuesTouched:o,changedCells:ae(he,be,Ve),invalidCells:ae(Le),changedValues:ne(Je,be,Ve),invalidValues:ne(Ee),changedTableIds:ne(z),changedRowIds:le(A),changedCellIds:ae(N),changedValueIds:ne(Re)}),ss=()=>ae(Ae),ns=()=>Y(Ae),ls=e=>Y(Z(ke,p(e))),as=e=>$(Z(Ae,p(e))),os=e=>Y(Z(Ae,p(e))),rs=(e,t,s,n=0,l)=>{return O(L((o=Z(Ae,p(e)),r=(e,s)=>[w(t)?s:Z(e,p(t)),s],a=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),O([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(a)),n,w(l)?l:n+l),(([,e])=>e));var a,o,r},cs=(e,t)=>Y(Z(Z(Ae,p(e)),p(t))),is=(e,t,s)=>Z(Z(Z(Ae,p(e)),p(t)),p(s)),ds=()=>ne(Me),us=()=>Y(Me),hs=e=>Z(Me,p(e)),fs=()=>!G(Ae),gs=e=>q(Ae,p(e)),Ts=(e,t)=>q(Z(ke,p(e)),p(t)),bs=(e,t)=>q(Z(Ae,p(e)),p(t)),Vs=(e,t,s)=>q(Z(Z(Ae,p(e)),p(t)),p(s)),Cs=()=>!G(Me),Ss=e=>q(Me,p(e)),vs=e=>_t((()=>(e=>me(e,gt,$t))(e)?wt(e):0)),ys=e=>_t((()=>Vt(e)?Ft(e):0)),ps=e=>{try{mt(pe(e))}catch{}return zs},ms=t=>_t((()=>{if((e=me(t,(e=>me(e,ft))))&&(yt(t),!G(Ae))){const e=ss();Is(),vs(e)}})),ws=e=>_t((()=>{if(t=(e=>me(e,ft))(e)){const s=ds();Fs(),Ls(),t=!0,pt(e),ys(s)}})),Is=()=>_t((()=>wt({}))),Rs=e=>_t((e=>q(Ae,e)?zt(e):0),e),Js=(e,t)=>_t(((e,t)=>I(Z(Ae,e),(s=>q(s,t)?jt(e,s,t):0))),e,t),Ls=()=>_t((()=>Ft({}))),Es=()=>_t((()=>{yt({}),e=!1})),Fs=()=>_t((()=>{pt({}),t=!1})),Os=(e,t)=>{if(-1!=x){Ps();const s=e();return xs(t),s}},Ps=()=>(-1!=x&&x++,1==x&&dt(rt,void 0,es,ts),zs),xs=e=>(x>0&&(x--,0==x&&(l=!G(he),o=!G(Je),x=1,Qt(1),l&&Yt(1),Ut(1),o&&Zt(1),e?.(es,ts)&&(Q(he,((e,t)=>Q(e,((e,s)=>Q(e,(([e],n)=>Se(zs,t,s,n,e))))))),Q(Je,(([e],t)=>ve(zs,t,e))),l=o=!1),dt(ct[0],void 0,es,ts),x=-1,Qt(0),l&&Yt(0),Ut(0),o&&Zt(0),dt(ct[1],void 0,es,ts),n?.(zs,es,ts),x=0,l=o=!1,d=fs(),m=Cs(),F([z,j,k,A,N,he,Le,Re,Je,Ee],K))),zs),zs={getContent:()=>[ss(),ds()],getTables:ss,getTableIds:ns,getTable:e=>le(Z(Ae,p(e))),getTableCellIds:ls,getRowCount:as,getRowIds:os,getSortedRowIds:rs,getRow:(e,t)=>ne(Z(Z(Ae,p(e)),p(t))),getCellIds:cs,getCell:is,getValues:ds,getValueIds:us,getValue:hs,hasTables:fs,hasTable:gs,hasTableCell:Ts,hasRow:bs,hasCell:Vs,hasValues:Cs,hasValue:Ss,getTablesJson:()=>ye(Ae),getValuesJson:()=>ye(Me),getJson:()=>ye([Ae,Me]),getTablesSchemaJson:()=>ye(Fe),getValuesSchemaJson:()=>ye(Pe),getSchemaJson:()=>ye([Fe,Pe]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>_t((()=>{(W(e)?Is:vs)(e),(W(t)?Ls:ys)(t)})),setTables:vs,setTable:(e,t)=>_t((e=>gt(t,e)?It(e,t):0),e),setRow:(e,t,s)=>_t(((e,t)=>Tt(e,t,s)?Rt(e,xt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Os((()=>{let n;return Tt(e,n,t)&&(e=p(e),Rt(e,xt(e),n=Pt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>_t(((e,t)=>{if(Tt(e,t,s,1)){const n=xt(e);H(s,((s,l)=>Lt(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>_t(((e,t,s)=>I(bt(e,t,s,J(n)?n(is(e,t,s)):n),(n=>Lt(e,xt(e),t,s,n)))),e,t,s),setValues:ys,setPartialValues:e=>_t((()=>Vt(e,1)?H(e,((e,t)=>Ot(t,e))):0)),setValue:(e,t)=>_t((e=>I(Ct(e,J(t)?t(hs(e)):t),(t=>Ot(e,t)))),e),setTransactionChanges:e=>_t((()=>{H(e[0],((e,t)=>w(e)?Rs(t):H(e,((e,s)=>w(e)?Js(t,s):H(e,((e,n)=>Se(zs,t,s,n,e))))))),H(e[1],((e,t)=>ve(zs,t,e)))})),setTablesJson:ps,setValuesJson:e=>{try{Et(pe(e))}catch{}return zs},setJson:e=>_t((()=>{try{const[t,s]=pe(e);mt(t),Et(s)}catch{ps(e)}})),setTablesSchema:ms,setValuesSchema:ws,setSchema:(e,t)=>_t((()=>{ms(e),ws(t)})),delTables:Is,delTable:Rs,delRow:Js,delCell:(e,t,s,n)=>_t(((e,t,s)=>I(Z(Ae,e),(l=>I(Z(l,t),(a=>q(a,s)?kt(e,l,t,a,s,n):0))))),e,t,s),delValues:Ls,delValue:e=>_t((e=>q(Me,e)?At(e):0),e),delTablesSchema:Es,delValuesSchema:Fs,delSchema:()=>_t((()=>{Es(),Fs()})),transaction:Os,startTransaction:Ps,finishTransaction:xs,forEachTable:e=>Q(Ae,((t,s)=>e(s,(e=>Q(t,((t,s)=>e(s,(e=>_(t,e))))))))),forEachTableCell:(e,t)=>_(Z(ke,p(e)),t),forEachRow:(e,t)=>Q(Z(Ae,p(e)),((e,s)=>t(s,(t=>_(e,t))))),forEachCell:(e,t,s)=>_(Z(Z(Ae,p(e)),p(t)),s),forEachValue:e=>_(Me,e),addSortedRowIdsListener:(e,t,s,n,l,a,o)=>{let r=rs(e,t,s,n,l);return it((()=>{const o=rs(e,t,s,n,l);var c,i,d;i=r,E(c=o)===E(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(r=o,a(zs,e,t,s,n,l,r))}),Qe[o?1:0],[e,t],[ns])},addStartTransactionListener:e=>it(e,rt),addWillFinishTransactionListener:e=>it(e,ct[0]),addDidFinishTransactionListener:e=>it(e,ct[1]),callListener:e=>(ht(e),zs),delListener:e=>(ut(e),zs),getListenerStats:()=>({}),createStore:Ie,addListener:it,callListeners:dt,addPostTransactionListener:e=>{n=e}};return H({[i+h]:[0,Ne,[],()=>[fs()]],[h]:[0,Be],[f]:[0,De],[i+u]:[1,He,[ns],e=>[gs(...e)]],[u]:[1,We,[ns]],[u+C]:[1,$e,[ns]],[i+u+V]:[2,qe,[ns,ls],e=>[Ts(...e)]],[T]:[1,Ge,[ns]],[b]:[1,Ke,[ns]],[i+g]:[2,Ue,[ns,os],e=>[bs(...e)]],[g]:[2,Xe,[ns,os]],[C]:[2,Ye,[ns,os]],[i+V]:[3,Ze,[ns,os,cs],e=>[Vs(...e)]],[V]:[3,_e,[ns,os,cs],e=>ge(is(...e))],InvalidCell:[3,et],[i+v]:[0,st,[],()=>[Cs()]],[v]:[0,nt],[y]:[0,lt],[i+S]:[1,at,[us],e=>[Ss(...e)]],[S]:[1,ot,[us],e=>ge(hs(e[0]))],InvalidValue:[1,tt]},(([e,t,s,n],l)=>{zs["add"+l+"Listener"]=(...l)=>it(l[e],t[l[e+1]?1:0],e>0?L(l,0,e):void 0,s,n)})),M(zs)};e.createStore=Ie},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
