var e,t;e=this,t=function(e,t,s){"use strict";const l=e=>typeof e,n="",a=l(n),r=l(!0),o=l(0),i=l(l),d="type",u="default",c="Has",h="Ids",m="Table",g=m+"s",p=m+h,b="Row",I=b+"Count",f=b+h,y="Cell",w=y+h,C="Value",v=C+"s",k=C+h,S="currentTarget",x="value",T=e=>n+e,V=Math.floor,R=isFinite,q=e=>null==e,M=(e,t,s)=>q(e)?s?.():t(e),N=e=>e==a||e==r,L=e=>l(e)==i,E=e=>Array.isArray(e),z=(e,t,s)=>e.slice(t,s),O=e=>e.length,{PureComponent:$,Fragment:J,createElement:A,useCallback:F,useLayoutEffect:P,useRef:B,useState:D}=t,Q=(e,...t)=>q(e)?{}:e(...t),j=(e,t)=>e.sort(t),H=(e,t)=>e.forEach(t),W=(e,t)=>e.map(t),U=e=>0==O(e),G=(e,...t)=>e.push(...t),K=e=>e.shift(),X=Object,Y=e=>X.getPrototypeOf(e),Z=X.entries,_=X.isFrozen,ee=e=>!q(e)&&M(Y(e),(e=>e==X.prototype||q(Y(e))),(()=>!0)),te=X.keys,se=X.freeze,le=(e=[])=>X.fromEntries(e),ne=(e,t)=>t in e,ae=(e,t)=>(delete e[t],e),re=(e,t)=>W(Z(e),(([e,s])=>t(s,e))),oe=e=>ee(e)&&0==(e=>O(te(e)))(e),ie=(e,t,s,l=0)=>q(e)||!ee(e)||!l&&oe(e)||_(e)?(s?.(),!1):(re(e,((s,l)=>{t(s,l)||ae(e,l)})),!!l||!oe(e)),de=e=>JSON.stringify(e,((e,t)=>t instanceof Map?X.fromEntries([...t]):t)),ue=JSON.parse,ce="tinybaseInspector",he="TinyBase Inspector",me=["left","top","bottom","right","full"],ge="state",pe="sort",be="open",Ie="position",fe=be,ye="editable",we=(...e)=>de(e),Ce=(e,t)=>W(j(e),t),ve=(e,t)=>[!!s.useCell(ge,e,ye,t),F((s=>{t.setCell(ge,e,ye,(e=>!e)),s.preventDefault()}),[t,e])],ke="M20 80l5-15l40-40l10 10l-40 40l-15 5m5-15l10 10",Se='content:url("',xe=Se+"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' stroke-width='4' stroke='white' fill='none'>",Te='</svg>")',Ve=Se+"data:image/svg+xml,%3csvg viewBox='0 0 680 680' xmlns='http://www.w3.org/2000/svg' style='width:680px%3bheight:680px'%3e %3cpath stroke='white' stroke-width='80' fill='none' d='M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z' /%3e %3cpath fill='%23d81b60' d='M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z' /%3e %3cpath d='M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z' /%3e%3c/svg%3e\")",Re=W([[20,20,20,60],[20,20,60,20],[20,60,60,20],[60,20,20,60],[30,30,40,40]],(([e,t,s,l])=>xe+`<rect x='20' y='20' width='60' height='60' fill='grey'/><rect x='${e}' y='${t}' width='${s}' height='${l}' fill='white'/>`+Te)),qe=xe+"<path d='M20 20l60 60M20 80l60-60' />"+Te,Me=xe+`<path d='${ke}' />`+Te,Ne=xe+`<path d='${ke}M20 20l60 60' />`+Te,Le="*::-webkit-scrollbar",Ee=((e,t="")=>e.join(t))(re({"":"all:initial;font-family:sans-serif;font-size:0.75rem;position:fixed;z-index:999999","*":"all:revert","*::before":"all:revert","*::after":"all:revert",[Le]:"width:0.5rem;height:0.5rem;",[Le+"-track"]:"background:#111",[Le+"-thumb"]:"background:#999;border:1px solid #111",[Le+"-thumb:hover"]:"background:#fff",[Le+"-corner"]:"background:#111",img:"width:1rem;height:1rem;background:#111;border:0;vertical-align:text-bottom",">img":"padding:0.25rem;bottom:0;right:0;position:fixed;"+Ve,...le(W(["bottom:0;left:0","top:0;right:0"],((e,t)=>[`>img[data-position='${t}']`,e]))),main:"display:flex;flex-direction:column;background:#111d;color:#fff;position:fixed;",...le(W(["bottom:0;left:0;width:35vw;height:100vh","top:0;right:0;width:100vw;height:30vh","bottom:0;left:0;width:100vw;height:30vh","top:0;right:0;width:35vw;height:100vh","top:0;right:0;width:100vw;height:100vh"],((e,t)=>[`main[data-position='${t}']`,e]))),header:"display:flex;padding:0.25rem;background:#000;align-items:center","header>img:nth-of-type(1)":Ve,"header>img:nth-of-type(6)":qe,...le(W(Re,((e,t)=>[`header>img[data-id='${t}']`,e]))),"header>span":"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-left:0.25rem",article:"padding:0.25rem 0.25rem 0.25rem 0.5rem;overflow:auto;flex:1",details:"margin-left:0.75rem;width:fit-content;","details img":"display:none","details[open]>summary img":"display:unset;background:none;margin-left:0.25rem","details[open]>summary img.edit":Me,"details[open]>summary img.done":Ne,summary:"margin-left:-0.75rem;line-height:1.25rem;user-select:none;width:fit-content",table:"border-collapse:collapse;table-layout:fixed;margin-bottom:0.5rem","table input":"background:#111;color:unset;padding:0 0.25rem;border:0;font-size:unset;vertical-align:top;margin:0",'table input[type="number"]':"width:4rem","table tbody button":"font-size:0;background:#fff;border-radius:50%;margin:0 0.125rem 0 0;width:0.85rem;color:#111","table button:first-letter":"font-size:0.75rem",thead:"background:#222","th:nth-of-type(1)":"min-width:2rem;","th.sorted":"background:#000","table caption":"text-align:left;white-space:nowrap;line-height:1.25rem",button:"width:1.5rem;border:none;background:none;color:#fff;padding:0","button[disabled]":"color:#777","button.next":"margin-right:0.5rem",[`th,#${ce} td`]:"overflow:hidden;text-overflow:ellipsis;padding:0.25rem 0.5rem;max-width:12rem;white-space:nowrap;border-width:1px 0;border-style:solid;border-color:#777;text-align:left","span.warn":"margin:0.25rem;color:#d81b60"},((e,t)=>e?`#${ce} ${t}{${e}}`:""))),ze=({s:e})=>{const t=s.useValue(Ie,e)??1,l=s.useSetValueCallback(fe,(()=>!0),[],e);return s.useValue(fe,e)?null:A("img",{onClick:l,title:he,"data-position":t})},Oe=({uniqueId:e,summary:t,editable:l,handleEditable:n,children:a,s:r})=>{const o=!!s.useCell(ge,e,be,r),i=s.useSetCellCallback(ge,e,be,(e=>e[S].open),[],r);return A("details",{open:o,onToggle:i},A("summary",null,t,n?A("img",{onClick:n,className:l?"done":"edit"}):null),a)},$e=e=>{const t=l(e);return N(t)||t==o&&R(e)?t:void 0},Je=(e,t,s,l,n)=>q(n)?e.delCell(t,s,l,!0):e.setCell(t,s,l,n),Ae=(e,t,s)=>q(s)?e.delValue(t):e.setValue(t,s),Fe=(e,t,s,l)=>e==a?t:e==o?s:l,{useCallback:Pe,useMemo:Be,useState:De}=t,Qe="editable",je=(e,t)=>W(s.useTableCellIds(e,t),(t=>e+"."+t)),He=(e,t,s)=>{const l=Pe(e,t);return s?l:void 0},We=(...e)=>Be((()=>e),e),Ue=(e,t)=>Be((()=>({store:e,tableId:t})),[e,t]),Ge=(e,t)=>Be((()=>({queries:e,queryId:t})),[e,t]),Ke=(e,t=!1,s,l=0,n,a,r,o)=>{const[[i,d,u],c]=De([e,t,l]),h=Pe((e=>{c(e),o?.(e)}),[o]),m=He((e=>h([e,e==i&&!d,u])),[h,i,d,u],s),g=Pe((e=>h([i,d,e])),[h,i,d]),p=!0===r?it:r;return[[i,d,u],m,Be((()=>!1===r?null:A(p,{offset:u,limit:n,total:a,onChange:g})),[r,p,u,n,a,g])]},Xe=(e,t,s)=>Be((()=>{const n=t??e;return r=E(n)?le(W(n,(e=>[e,e]))):n,o=(e,t)=>{return{label:t,component:s,...(n=e,l(n)==a?{label:e}:e)};var n},le(re(r,((e,t)=>[t,o(e,t)])));var r,o}),[t,s,e]),Ye=({className:e,headerRow:t,idColumn:s,params:[l,n,a,r,o,i]})=>A("table",{className:e},i?A("caption",null,i):null,!1===t?null:A("thead",null,A("tr",null,!1===s?null:A(Ze,{sort:r??[],label:"Id",onClick:o}),re(l,(({label:e},t)=>A(Ze,{key:t,cellId:t,label:e,sort:r??[],onClick:o}))))),A("tbody",null,W(a,(e=>A("tr",{key:e},!1===s?null:A("th",null,e),re(l,(({component:t,getComponentProps:s},l)=>A("td",{key:l},A(t,{...Q(s,e,l),...n,rowId:e,cellId:l}))))))))),Ze=({cellId:e,sort:[t,s],label:l=e??n,onClick:a})=>A("th",{onClick:He((()=>a?.(e)),[a,e],a),className:q(s)||t!=e?void 0:`sorted ${s?"de":"a"}scending`},q(s)||t!=e?null:(s?"↓":"↑")+" ",l),_e=({localRowId:e,params:[l,n,a,r,o,i,d]})=>{const u=s.useRemoteRowId(o,e,i);return A("tr",null,!1===l?null:A(t.Fragment,null,A("th",null,e),A("th",null,u)),re(n,(({component:t,getComponentProps:s},l)=>{const[n,o]=l.split(".",2),i=n===a?e:n===r?u:null;return q(i)?null:A("td",{key:l},A(t,{...Q(s,i,o),store:d,tableId:n,rowId:i,cellId:o}))})))},et=({thing:e,onThingChange:t,className:s,hasSchema:l,showType:n=!0})=>{const[i,d]=De(),[u,c]=De(),[h,m]=De(),[g,p]=De(),[b,I]=De();u!==e&&(d($e(e)),c(e),m(e+""),p(Number(e)||0),I(!!e));const f=Pe(((e,s)=>{s(e),c(e),t(e)}),[t]),y=Pe((()=>{if(!l?.()){const e=Fe(i,o,r,a),s=Fe(e,h,g,b);d(e),c(s),t(s)}}),[l,t,h,g,b,i]);return A("div",{className:s},n?A("button",{className:i,onClick:y},i):null,Fe(i,A("input",{key:i,value:h,onChange:Pe((e=>f(e[S][x]+"",m)),[f])}),A("input",{key:i,type:"number",value:g,onChange:Pe((e=>f(Number(e[S][x]||0),p)),[f])}),A("input",{key:i,type:"checkbox",checked:b,onChange:Pe((e=>f(!!e[S].checked,I)),[f])})))},tt=({tableId:e,cellId:t,descending:l,offset:n,limit:a,store:r,editable:o,sortOnClick:i,paginator:d=!1,onChange:u,customCells:c,...h})=>{const[m,g,p]=Ke(t,l,i,n,a,s.useRowCount(e,r),d,u);return A(Ye,{...h,params:We(Xe(s.useTableCellIds(e,r),c,o?rt:s.CellView),Ue(r,e),s.useSortedRowIds(e,...m,a,r),m,g,p)})},st=({store:e,editable:t=!1,valueComponent:l=(t?ot:s.ValueView),getValueComponentProps:n,className:a,headerRow:r,idColumn:o})=>A("table",{className:a},!1===r?null:A("thead",null,A("tr",null,!1===o?null:A("th",null,"Id"),A("th",null,C))),A("tbody",null,W(s.useValueIds(e),(t=>A("tr",{key:t},!1===o?null:A("th",null,t),A("td",null,A(l,{...Q(n,t),valueId:t,store:e}))))))),lt=({indexId:e,sliceId:t,indexes:l,editable:n,customCells:a,...r})=>{const[o,i,d]=((e,t)=>[e,e?.getStore(),e?.getTableId(t)])(s.useIndexesOrIndexesById(l),e);return A(Ye,{...r,params:We(Xe(s.useTableCellIds(d,i),a,n?rt:s.CellView),Ue(i,d),s.useSliceRowIds(e,t,o))})},nt=({relationshipId:e,relationships:l,editable:n,customCells:a,className:r,headerRow:o,idColumn:i=!0})=>{const[d,u,c,h]=((e,t)=>[e,e?.getStore(),e?.getLocalTableId(t),e?.getRemoteTableId(t)])(s.useRelationshipsOrRelationshipsById(l),e),m=Xe([...je(c,u),...je(h,u)],a,n?rt:s.CellView),g=We(i,m,c,h,e,d,u);return A("table",{className:r},!1===o?null:A("thead",null,A("tr",null,!1===i?null:A(t.Fragment,null,A("th",null,c,".Id"),A("th",null,h,".Id")),re(m,(({label:e},t)=>A("th",{key:t},e))))),A("tbody",null,W(s.useRowIds(c,u),(e=>A(_e,{key:e,localRowId:e,params:g})))))},at=({queryId:e,cellId:t,descending:l,offset:n,limit:a,queries:r,sortOnClick:o,paginator:i=!1,customCells:d,onChange:u,...c})=>{const[h,m,g]=Ke(t,l,o,n,a,s.useResultRowCount(e,r),i,u);return A(Ye,{...c,params:We(Xe(s.useResultTableCellIds(e,r),d,s.ResultCellView),Ge(r,e),s.useResultSortedRowIds(e,...h,a,r),h,m,g)})},rt=({tableId:e,rowId:t,cellId:l,store:n,className:a,showType:r})=>A(et,{thing:s.useCell(e,t,l,n),onThingChange:s.useSetCellCallback(e,t,l,(e=>e),[],n),className:a??Qe+y,showType:r,hasSchema:s.useStoreOrStoreById(n)?.hasTablesSchema}),ot=({valueId:e,store:t,className:l,showType:n})=>A(et,{thing:s.useValue(e,t),onThingChange:s.useSetValueCallback(e,(e=>e),[],t),className:l??Qe+C,showType:n,hasSchema:s.useStoreOrStoreById(t)?.hasValuesSchema}),it=({onChange:e,total:s,offset:l=0,limit:n=s,singular:a="row",plural:r=a+"s"})=>{(l>s||l<0)&&(l=0,e(0));const o=He((()=>e(l-n)),[e,l,n],l>0),i=He((()=>e(l+n)),[e,l,n],l+n<s);return A(t.Fragment,null,s>n&&A(t.Fragment,null,A("button",{className:"previous",disabled:0==l,onClick:o},"←"),A("button",{className:"next",disabled:l+n>=s,onClick:i},"→"),l+1," to ",Math.min(s,l+n)," of "),s," ",1!=s?r:a)},dt=({indexes:e,indexesId:t,indexId:l,s:n})=>A(Oe,{uniqueId:we("i",t,l),summary:"Index: "+l,s:n},W(s.useSliceIds(l,e),(s=>A(ut,{indexes:e,indexesId:t,indexId:l,sliceId:s,s:n,key:s})))),ut=({indexes:e,indexesId:t,indexId:s,sliceId:l,s:n})=>{const a=we("i",t,s,l),[r,o]=ve(a,n);return A(Oe,{uniqueId:a,summary:"Slice: "+l,editable:r,handleEditable:o,s:n},A(lt,{sliceId:l,indexId:s,indexes:e,editable:r}))},ct=({indexesId:e,s:t})=>{const l=s.useIndexes(e),n=s.useIndexIds(l);return q(l)?null:A(Oe,{uniqueId:we("i",e),summary:"Indexes: "+(e??u),s:t},U(n)?"No indexes defined":Ce(n,(s=>A(dt,{indexes:l,indexesId:e,indexId:s,s:t,key:s}))))},ht=({metrics:e,metricId:t})=>A("tr",null,A("th",null,t),A("td",null,e?.getTableId(t)),A("td",null,s.useMetric(t,e))),mt=({metricsId:e,s:t})=>{const l=s.useMetrics(e),n=s.useMetricIds(l);return q(l)?null:A(Oe,{uniqueId:we("m",e),summary:"Metrics: "+(e??u),s:t},U(n)?"No metrics defined":A("table",null,A("thead",null,A("th",null,"Metric Id"),A("th",null,"Table Id"),A("th",null,"Metric")),A("tbody",null,W(n,(e=>A(ht,{metrics:l,metricId:e,key:e}))))))},gt=({queries:e,queriesId:t,queryId:l,s:n})=>{const a=we("q",t,l),[r,o,i]=ue(s.useCell(ge,a,pe,n)??"[]"),d=s.useSetCellCallback(ge,a,pe,de,[],n);return A(Oe,{uniqueId:a,summary:"Query: "+l,s:n},A(at,{queryId:l,queries:e,cellId:r,descending:o,offset:i,limit:10,paginator:!0,sortOnClick:!0,onChange:d}))},pt=({queriesId:e,s:t})=>{const l=s.useQueries(e),n=s.useQueryIds(l);return q(l)?null:A(Oe,{uniqueId:we("q",e),summary:"Queries: "+(e??u),s:t},U(n)?"No queries defined":Ce(n,(s=>A(gt,{queries:l,queriesId:e,queryId:s,s:t,key:s}))))},bt=({relationships:e,relationshipsId:t,relationshipId:s,s:l})=>{const n=we("r",t,s),[a,r]=ve(n,l);return A(Oe,{uniqueId:n,summary:"Relationship: "+s,editable:a,handleEditable:r,s:l},A(nt,{relationshipId:s,relationships:e,editable:a}))},It=({relationshipsId:e,s:t})=>{const l=s.useRelationships(e),n=s.useRelationshipIds(l);return q(l)?null:A(Oe,{uniqueId:we("r",e),summary:"Relationships: "+(e??u),s:t},U(n)?"No relationships defined":Ce(n,(s=>A(bt,{relationships:l,relationshipsId:e,relationshipId:s,s:t,key:s}))))},ft=({tableId:e,store:t,storeId:l,s:n})=>{const a=we("t",l,e),[r,o,i]=ue(s.useCell(ge,a,pe,n)??"[]"),d=s.useSetCellCallback(ge,a,pe,de,[],n),[u,c]=ve(a,n);return A(Oe,{uniqueId:a,summary:m+": "+e,editable:u,handleEditable:c,s:n},A(tt,{tableId:e,store:t,cellId:r,descending:o,offset:i,limit:10,paginator:!0,sortOnClick:!0,onChange:d,editable:u}))},yt=({store:e,storeId:t,s:l})=>{const n=we("v",t),[a,r]=ve(n,l);return U(s.useValueIds(e))?null:A(Oe,{uniqueId:n,summary:v,editable:a,handleEditable:r,s:l},A(st,{store:e,editable:a}))},wt=({storeId:e,s:t})=>{const l=s.useStore(e),n=s.useTableIds(l);return q(l)?null:A(Oe,{uniqueId:we("s",e),summary:(l.isMergeable()?"Mergeable":"")+"Store: "+(e??u),s:t},A(yt,{storeId:e,store:l,s:t}),Ce(n,(s=>A(ft,{store:l,storeId:e,tableId:s,s:t,key:s}))))},Ct=({s:e})=>{const t=B(null),l=B(0),[n,a]=D(!1),{scrollLeft:r,scrollTop:o}=s.useValues(e);P((()=>{const e=t.current;if(e&&!n){const t=new MutationObserver((()=>{e.scrollWidth>=V(r)+e.clientWidth&&e.scrollHeight>=V(o)+e.clientHeight&&e.scrollTo(r,o)}));return t.observe(e,{childList:!0,subtree:!0}),()=>t.disconnect()}}),[n,r,o]);const i=F((t=>{const{scrollLeft:s,scrollTop:n}=t[S];cancelIdleCallback(l.current),l.current=requestIdleCallback((()=>{a(!0),e.setPartialValues({scrollLeft:s,scrollTop:n})}))}),[e]),d=s.useStore(),u=s.useStoreIds(),c=s.useMetrics(),h=s.useMetricsIds(),m=s.useIndexes(),g=s.useIndexesIds(),p=s.useRelationships(),b=s.useRelationshipsIds(),I=s.useQueries(),f=s.useQueriesIds();return q(d)&&U(u)&&q(c)&&U(h)&&q(m)&&U(g)&&q(p)&&U(b)&&q(I)&&U(f)?A("span",{className:"warn"},"There are no Stores or other objects to inspect. Make sure you placed the Inspector inside a Provider component."):A("article",{ref:t,onScroll:i},A(wt,{s:e}),W(u,(t=>A(wt,{storeId:t,s:e,key:t}))),A(mt,{s:e}),W(h,(t=>A(mt,{metricsId:t,s:e,key:t}))),A(ct,{s:e}),W(g,(t=>A(ct,{indexesId:t,s:e,key:t}))),A(It,{s:e}),W(b,(t=>A(It,{relationshipsId:t,s:e,key:t}))),A(pt,{s:e}),W(f,(t=>A(pt,{queriesId:t,s:e,key:t}))))};class vt extends ${constructor(e){super(e),this.state={e:0}}static getDerivedStateFromError(){return{e:1}}componentDidCatch=(e,t)=>console.error(e,t.componentStack);render(){return this.state.e?A("span",{className:"warn"},"Inspector error: please see console for details."):this.props.children}}const kt=({s:e})=>{const t=s.useValue(Ie,e)??1,l=s.useSetValueCallback(fe,(()=>!1),[],e),n=s.useSetValueCallback(Ie,(e=>Number(e[S].dataset.id)),[],e);return A("header",null,A("img",{title:he}),A("span",null,he),W(me,((e,s)=>s==t?null:A("img",{onClick:n,"data-id":s,title:"Dock to "+e,key:s}))),A("img",{onClick:l,title:"Close"}))},St=({s:e})=>{const t=s.useValue(Ie,e)??1;return s.useValue(fe,e)?A("main",{"data-position":t},A(kt,{s:e}),A(vt,null,A(Ct,{s:e}))):null},xt=e=>e?.size??0,Tt=(e,t)=>e?.has(t)??!1,Vt=e=>q(e)||0==xt(e),Rt=e=>e.clear(),qt=(e,t)=>e?.forEach(t),Mt=(e,t)=>e?.delete(t),Nt=e=>new Map(e),Lt=e=>[...e?.keys()??[]],Et=(e,t)=>e?.get(t),zt=(e,t)=>qt(e,((e,s)=>t(s,e))),Ot=(e,t,s)=>q(s)?(Mt(e,t),e):e?.set(t,s),$t=(e,t,s,l)=>(Tt(e,t)?l?.(Et(e,t)):Ot(e,t,s()),Et(e,t)),Jt=(e,t,s,l=Ot)=>(re(t,((t,l)=>s(e,l,t))),zt(e,(s=>ne(t,s)?0:l(e,s))),e),At=(e,t,s,l)=>{const n={};return qt(e,((e,a)=>{if(!s?.(e,a)){const s=t?t(e,a):e;!l?.(s)&&(n[a]=s)}})),n},Ft=(e,t,s)=>At(e,(e=>At(e,t,s)),Vt,oe),Pt=(e,t,s)=>At(e,(e=>Ft(e,t,s)),Vt,oe),Bt=(e,t)=>{const s=Nt();return qt(e,((e,l)=>s.set(l,t?.(e)??e))),s},Dt=e=>Bt(e,Bt),Qt=e=>Bt(e,Dt),jt=(e,t,s,l,n=0)=>M((s?$t:Et)(e,t[n],n>O(t)-2?s:Nt),(a=>{if(n>O(t)-2)return l?.(a)&&Ot(e,t[n]),a;const r=jt(a,t,s,l,n+1);return Vt(a)&&Ot(e,t[n]),r})),Ht=Nt(),Wt=Nt(),Ut="storage",Gt=globalThis.window,Kt=e=>new Set(E(e)||q(e)?e:[e]),Xt=(e,t)=>e?.add(t),Yt=/^\d+$/,Zt=()=>{const e=[];let t=0;return[s=>(s?K(e):null)??n+t++,t=>{Yt.test(t)&&O(e)<1e3&&G(e,t)}]},_t=e=>[e,e],es=()=>[Nt(),Nt()],ts=e=>[...e],ss=([e,t])=>e===t;Nt(W("-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".split(n),((e,t)=>[e,t])));const ls=(e,t,s)=>Ot(e,t,Et(e,t)==-s?void 0:s),ns=()=>{let e,t,s=!1,l=!1,a=0,r=[];const i=Nt(),h=Nt(),S=Nt(),x=Nt(),V=Nt(),R=Nt(),E=Nt(),$=Nt(),J=Nt(),A=Nt(),F=Nt(),P=Nt(),B=Nt(),D=Nt(),Q=Kt(),U=Nt(),K=Nt(),X=Nt(),Y=Nt(),Z=es(),_=es(),ee=es(),te=es(),le=es(),ce=es(),he=es(),me=es(),ge=es(),pe=es(),be=es(),Ie=es(),fe=es(),ye=es(),we=es(),Ce=es(),ve=es(),ke=es(),Se=es(),xe=es(),Te=es(),Ve=es(),Re=Nt(),qe=es(),[Me,Ne,Le,Ee]=(e=>{let t;const[s,l]=Zt(),a=Nt();return[(e,l,r,o=[],i=(()=>[]))=>{t??=Ns;const d=s(1);return Ot(a,d,[e,l,r,o,i]),Xt(jt(l,r??[n],Kt),d),d},(e,s,...l)=>H(((e,t=[n])=>{const s=[],l=(e,n)=>n==O(t)?G(s,e):null===t[n]?qt(e,(e=>l(e,n+1))):H([t[n],null],(t=>l(Et(e,t),n+1)));return l(e,0),s})(e,s),(e=>qt(e,(e=>Et(a,e)[0](t,...s??[],...l))))),e=>M(Et(a,e),(([,t,s])=>(jt(t,s??[n],void 0,(t=>(Mt(t,e),Vt(t)?1:0))),Ot(a,e),l(e),s))),e=>M(Et(a,e),(([e,,s=[],l,n])=>{const a=(...r)=>{const o=O(r);o==O(s)?e(t,...r,...n(r)):q(s[o])?H(l[o]?.(...r)??[],(e=>a(...r,e))):a(...r,s[o])};a()}))]})(),ze=e=>{if(!ie(e,((e,t)=>[d,u].includes(t))))return!1;const t=e[d];return!(!N(t)&&t!=o||($e(e[u])!=t&&ae(e,u),0))},Oe=(t,s)=>(!e||Tt(F,s)||gt(s))&&ie(t,((e,t)=>Fe(s,t,e)),(()=>gt(s))),Fe=(e,t,s,l)=>ie(l?s:Qe(s,e,t),((l,n)=>M(Pe(e,t,n,l),(e=>(s[n]=e,!0)),(()=>!1))),(()=>gt(e,t))),Pe=(t,s,l,n)=>e?M(Et(Et(F,t),l),(e=>$e(n)!=e[d]?gt(t,s,l,n,e[u]):n),(()=>gt(t,s,l,n))):q($e(n))?gt(t,s,l,n):n,Be=(e,t)=>ie(t?e:je(e),((t,s)=>M(De(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>pt())),De=(e,s)=>t?M(Et(B,e),(t=>$e(s)!=t[d]?pt(e,s,t[u]):s),(()=>pt(e,s))):q($e(s))?pt(e,s):s,Qe=(e,t,s)=>(M(Et(P,t),(([l,n])=>{qt(l,((t,s)=>{ne(e,s)||(e[s]=t)})),qt(n,(l=>{ne(e,l)||gt(t,s,l)}))})),e),je=e=>(t&&(qt(D,((t,s)=>{ne(e,s)||(e[s]=t)})),qt(Q,(t=>{ne(e,t)||pt(t)}))),e),He=e=>Jt(F,e,((e,t,s)=>{const l=Nt(),n=Kt();Jt($t(F,t,Nt),s,((e,t,s)=>{Ot(e,t,s),M(s[u],(e=>Ot(l,t,e)),(()=>Xt(n,t)))})),Ot(P,t,[l,n])}),((e,t)=>{Ot(F,t),Ot(P,t)})),We=e=>Jt(B,e,((e,t,s)=>{Ot(B,t,s),M(s[u],(e=>Ot(D,t,e)),(()=>Xt(Q,t)))}),((e,t)=>{Ot(B,t),Ot(D,t),Mt(Q,t)})),Ue=e=>oe(e)?vs():Is(e),Ge=e=>Jt(X,e,((e,t,s)=>Ke(t,s)),((e,t)=>nt(t))),Ke=(e,t)=>Jt($t(X,e,(()=>(it(e,1),Ot(U,e,Zt()),Ot(K,e,Nt()),Nt()))),t,((t,s,l)=>Xe(e,t,s,l)),((t,s)=>at(e,t,s))),Xe=(e,t,s,l,n)=>Jt($t(t,s,(()=>(dt(e,s,1),Nt()))),l,((t,l,n)=>Ye(e,s,t,l,n)),((l,a)=>rt(e,t,s,l,a,n))),Ye=(e,t,s,l,n)=>{Tt(s,l)||ut(e,t,l,1);const a=Et(s,l);n!==a&&(ct(e,t,l,a,n),Ot(s,l,n))},Ze=(e,t,s,l,n)=>M(Et(t,s),(t=>Ye(e,s,t,l,n)),(()=>Xe(e,t,s,Qe({[l]:n},e,s)))),_e=e=>oe(e)?xs():fs(e),et=e=>Jt(Y,e,((e,t,s)=>tt(t,s)),((e,t)=>ot(t))),tt=(e,t)=>{Tt(Y,e)||ht(e,1);const s=Et(Y,e);t!==s&&(mt(e,s,t),Ot(Y,e,t))},st=(e,t)=>{const[s]=Et(U,e),l=s(t);return Tt(Et(X,e),l)?st(e,t):l},lt=e=>Et(X,e)??Ke(e,{}),nt=e=>Ke(e,{}),at=(e,t,s)=>{const[,l]=Et(U,e);l(s),Xe(e,t,s,{},!0)},rt=(e,t,s,l,n,a)=>{const r=Et(Et(P,e)?.[0],n);if(!q(r)&&!a)return Ye(e,s,l,n,r);const o=t=>{ct(e,s,t,Et(l,t)),ut(e,s,t,-1),Ot(l,t)};q(r)?o(n):zt(l,o),Vt(l)&&(dt(e,s,-1),Vt(Ot(t,s))&&(it(e,-1),Ot(X,e),Ot(U,e),Ot(K,e)))},ot=e=>{const t=Et(D,e);if(!q(t))return tt(e,t);mt(e,Et(Y,e)),ht(e,-1),Ot(Y,e)},it=(e,t)=>ls(i,e,t),dt=(e,t,s)=>ls($t(x,e,Nt),t,s)&&Ot(S,e,$t(S,e,(()=>0))+s),ut=(e,t,s,l)=>{const n=Et(K,e),a=Et(n,s)??0;(0==a&&1==l||1==a&&-1==l)&&ls($t(h,e,Nt),s,l),Ot(n,s,a!=-l?a+l:null),ls($t($t(V,e,Nt),t,Nt),s,l)},ct=(e,t,s,l,n)=>{$t($t($t(R,e,Nt),t,Nt),s,(()=>[l,0]))[1]=n,r[3]?.(e,t,s,n)},ht=(e,t)=>ls(E,e,t),mt=(e,t,s)=>{$t($,e,(()=>[t,0]))[1]=s,r[4]?.(e,s)},gt=(e,t,s,l,n)=>(G($t($t($t(J,e,Nt),t,Nt),s,(()=>[])),l),n),pt=(e,t,s)=>(G($t(A,e,(()=>[])),t),s),bt=(e,t,s)=>M(Et(Et(Et(R,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,..._t(rs(e,t,s))])),It=e=>M(Et($,e),(([e,t])=>[!0,e,t]),(()=>[!1,..._t(ds(e))])),ft=e=>Vt(J)||Vt(Ce[e])?0:qt(e?Qt(J):J,((t,s)=>qt(t,((t,l)=>qt(t,((t,n)=>Ne(Ce[e],[s,l,n],t))))))),yt=e=>Vt(A)||Vt(ve[e])?0:qt(e?Bt(A):A,((t,s)=>Ne(ve[e],[s],t))),wt=(e,t,s,l)=>{if(!Vt(e))return Ne(t,l,(()=>At(e))),zt(e,((e,t)=>Ne(s,[...l??[],e],1==t))),1},Ct=e=>{const t=us();t!=s&&Ne(Z[e],void 0,t);const l=Vt(pe[e]),n=Vt(fe[e])&&Vt(ye[e])&&Vt(ge[e])&&Vt(be[e])&&Vt(ce[e])&&Vt(he[e])&&Vt(me[e])&&l&&Vt(ee[e])&&Vt(te[e]),a=Vt(we[e])&&Vt(Ie[e])&&Vt(le[e])&&Vt(_[e]);if(!n||!a){const t=e?[Bt(i),Dt(h),Bt(S),Dt(x),Qt(V),Qt(R)]:[i,h,S,x,V,R];if(!n){wt(t[0],ee[e],te[e]),qt(t[1],((t,s)=>wt(t,ce[e],he[e],[s]))),qt(t[2],((t,s)=>{0!=t&&Ne(me[e],[s],Ut(s))}));const s=Kt();qt(t[3],((t,n)=>{wt(t,ge[e],be[e],[n])&&!l&&(Ne(pe[e],[n,null]),Xt(s,n))})),l||qt(t[5],((t,l)=>{if(!Tt(s,l)){const s=Kt();qt(t,(e=>qt(e,(([t,l],n)=>l!==t?Xt(s,n):Mt(e,n))))),qt(s,(t=>Ne(pe[e],[l,t])))}})),qt(t[4],((t,s)=>qt(t,((t,l)=>wt(t,fe[e],ye[e],[s,l])))))}if(!a){let s;qt(t[5],((t,l)=>{let n;qt(t,((t,a)=>{let r;qt(t,(([t,o],i)=>{o!==t&&(Ne(we[e],[l,a,i],o,t,bt),s=n=r=1)})),r&&Ne(Ie[e],[l,a],bt)})),n&&Ne(le[e],[l],bt)})),s&&Ne(_[e],void 0,bt)}}},vt=e=>{const t=ps();t!=l&&Ne(ke[e],void 0,t);const s=Vt(xe[e])&&Vt(Te[e]),n=Vt(Ve[e])&&Vt(Se[e]);if(!s||!n){const t=e?[Bt(E),Bt($)]:[E,$];if(s||wt(t[0],xe[e],Te[e]),!n){let s;qt(t[1],(([t,l],n)=>{l!==t&&(Ne(Ve[e],[n],l,t,It),s=1)})),s&&Ne(Se[e],void 0,It)}}},kt=(e,...t)=>(Rs((()=>e(...W(t,T)))),Ns),St=()=>Pt(X),Ht=()=>Lt(X),Wt=e=>Lt(Et(K,T(e))),Ut=e=>xt(Et(X,T(e))),Gt=e=>Lt(Et(X,T(e))),Yt=(e,t,s,l=0,n)=>{return W(z(j((a=Et(X,T(e)),r=(e,s)=>[q(t)?s:Et(e,T(t)),s],W([...a?.entries()??[]],(([e,t])=>r(t,e)))),(([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1))),l,q(n)?n:l+n),(([,e])=>e));var a,r},as=(e,t)=>Lt(Et(Et(X,T(e)),T(t))),rs=(e,t,s)=>Et(Et(Et(X,T(e)),T(t)),T(s)),os=()=>At(Y),is=()=>Lt(Y),ds=e=>Et(Y,T(e)),us=()=>!Vt(X),cs=e=>Tt(X,T(e)),hs=(e,t)=>Tt(Et(K,T(e)),T(t)),ms=(e,t)=>Tt(Et(X,T(e)),T(t)),gs=(e,t,s)=>Tt(Et(Et(X,T(e)),T(t)),T(s)),ps=()=>!Vt(Y),bs=e=>Tt(Y,T(e)),Is=e=>kt((()=>(e=>ie(e,Oe,gt))(e)?Ge(e):0)),fs=e=>kt((()=>Be(e)?et(e):0)),ys=e=>{try{Ue(ue(e))}catch{}return Ns},ws=t=>kt((()=>{if((e=ie(t,(e=>ie(e,ze))))&&(He(t),!Vt(X))){const e=St();vs(),Is(e)}})),Cs=e=>kt((()=>{if(t=(e=>ie(e,ze))(e)){const s=os();Vs(),xs(),t=!0,We(e),fs(s)}})),vs=()=>kt((()=>Ge({}))),ks=e=>kt((e=>Tt(X,e)?nt(e):0),e),Ss=(e,t)=>kt(((e,t)=>M(Et(X,e),(s=>Tt(s,t)?at(e,s,t):0))),e,t),xs=()=>kt((()=>et({}))),Ts=()=>kt((()=>{He({}),e=!1})),Vs=()=>kt((()=>{We({}),t=!1})),Rs=(e,t)=>{if(-1!=a){qs();const s=e();return Ms(t),s}},qs=()=>(-1!=a&&a++,1==a&&(r[0]?.(),Ne(Re)),Ns),Ms=e=>(a>0&&(a--,0==a&&(a=1,ft(1),Vt(R)||Ct(1),yt(1),Vt($)||vt(1),e?.(Ns)&&(qt(R,((e,t)=>qt(e,((e,s)=>qt(e,(([e],l)=>Je(Ns,t,s,l,e))))))),Rt(R),qt($,(([e],t)=>Ae(Ns,t,e))),Rt($)),Ne(qe[0],void 0),a=-1,ft(0),Vt(R)||Ct(0),yt(0),Vt($)||vt(0),r[1]?.(),Ne(qe[1],void 0),r[2]?.(),a=0,s=us(),l=ps(),H([i,h,S,x,V,R,J,E,$,A],Rt))),Ns),Ns={getContent:()=>[St(),os()],getTables:St,getTableIds:Ht,getTable:e=>Ft(Et(X,T(e))),getTableCellIds:Wt,getRowCount:Ut,getRowIds:Gt,getSortedRowIds:Yt,getRow:(e,t)=>At(Et(Et(X,T(e)),T(t))),getCellIds:as,getCell:rs,getValues:os,getValueIds:is,getValue:ds,hasTables:us,hasTable:cs,hasTableCell:hs,hasRow:ms,hasCell:gs,hasValues:ps,hasValue:bs,getTablesJson:()=>de(X),getValuesJson:()=>de(Y),getJson:()=>de([X,Y]),getTablesSchemaJson:()=>de(F),getValuesSchemaJson:()=>de(B),getSchemaJson:()=>de([F,B]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>kt((()=>{(oe(e)?vs:Is)(e),(oe(t)?xs:fs)(t)})),setTables:Is,setTable:(e,t)=>kt((e=>Oe(t,e)?Ke(e,t):0),e),setRow:(e,t,s)=>kt(((e,t)=>Fe(e,t,s)?Xe(e,lt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Rs((()=>{let l;return Fe(e,l,t)&&(e=T(e),Xe(e,lt(e),l=st(e,s?1:0),t)),l})),setPartialRow:(e,t,s)=>kt(((e,t)=>{if(Fe(e,t,s,1)){const l=lt(e);re(s,((s,n)=>Ze(e,l,t,n,s)))}}),e,t),setCell:(e,t,s,l)=>kt(((e,t,s)=>M(Pe(e,t,s,L(l)?l(rs(e,t,s)):l),(l=>Ze(e,lt(e),t,s,l)))),e,t,s),setValues:fs,setPartialValues:e=>kt((()=>Be(e,1)?re(e,((e,t)=>tt(t,e))):0)),setValue:(e,t)=>kt((e=>M(De(e,L(t)?t(ds(e)):t),(t=>tt(e,t)))),e),applyChanges:e=>kt((()=>{re(e[0],((e,t)=>q(e)?ks(t):re(e,((e,s)=>q(e)?Ss(t,s):re(e,((e,l)=>Je(Ns,t,s,l,e))))))),re(e[1],((e,t)=>Ae(Ns,t,e)))})),setTablesJson:ys,setValuesJson:e=>{try{_e(ue(e))}catch{}return Ns},setJson:e=>kt((()=>{try{const[t,s]=ue(e);Ue(t),_e(s)}catch{ys(e)}})),setTablesSchema:ws,setValuesSchema:Cs,setSchema:(e,t)=>kt((()=>{ws(e),Cs(t)})),delTables:vs,delTable:ks,delRow:Ss,delCell:(e,t,s,l)=>kt(((e,t,s)=>M(Et(X,e),(n=>M(Et(n,t),(a=>Tt(a,s)?rt(e,n,t,a,s,l):0))))),e,t,s),delValues:xs,delValue:e=>kt((e=>Tt(Y,e)?ot(e):0),e),delTablesSchema:Ts,delValuesSchema:Vs,delSchema:()=>kt((()=>{Ts(),Vs()})),transaction:Rs,startTransaction:qs,getTransactionChanges:()=>[At(R,((e,t)=>-1===Et(i,t)?void 0:At(e,((e,s)=>-1===Et(Et(x,t),s)?void 0:At(e,(([,e])=>e),(e=>ss(e)))),Vt,oe)),Vt,oe),At($,(([,e])=>e),(e=>ss(e))),1],getTransactionLog:()=>[!Vt(R),!Vt($),Pt(R,ts,ss),Pt(J),At($,ts,ss),At(A),At(i),Ft(x),Pt(V),At(E)],finishTransaction:Ms,forEachTable:e=>qt(X,((t,s)=>e(s,(e=>qt(t,((t,s)=>e(s,(e=>zt(t,e))))))))),forEachTableCell:(e,t)=>zt(Et(K,T(e)),t),forEachRow:(e,t)=>qt(Et(X,T(e)),((e,s)=>t(s,(t=>zt(e,t))))),forEachCell:(e,t,s)=>zt(Et(Et(X,T(e)),T(t)),s),forEachValue:e=>zt(Y,e),addSortedRowIdsListener:(e,t,s,l,n,a,r)=>{let o=Yt(e,t,s,l,n);return Me((()=>{const r=Yt(e,t,s,l,n);var i,d,u;d=o,O(i=r)===O(d)&&(u=(e,t)=>d[t]===e,i.every(u))||(o=r,a(Ns,e,t,s,l,n,o))}),pe[r?1:0],[e,t],[Ht])},addStartTransactionListener:e=>Me(e,Re),addWillFinishTransactionListener:e=>Me(e,qe[0]),addDidFinishTransactionListener:e=>Me(e,qe[1]),callListener:e=>(Ee(e),Ns),delListener:e=>(Le(e),Ns),getListenerStats:()=>({}),isMergeable:()=>!1,createStore:ns,addListener:Me,callListeners:Ne,setInternalListeners:(e,t,s,l,n)=>r=[e,t,s,l,n]};return re({[c+g]:[0,Z,[],()=>[us()]],[g]:[0,_],[p]:[0,ee],[c+m]:[1,te,[Ht],e=>[cs(...e)]],[m]:[1,le,[Ht]],[m+w]:[1,ce,[Ht]],[c+m+y]:[2,he,[Ht,Wt],e=>[hs(...e)]],[I]:[1,me,[Ht]],[f]:[1,ge,[Ht]],[c+b]:[2,be,[Ht,Gt],e=>[ms(...e)]],[b]:[2,Ie,[Ht,Gt]],[w]:[2,fe,[Ht,Gt]],[c+y]:[3,ye,[Ht,Gt,as],e=>[gs(...e)]],[y]:[3,we,[Ht,Gt,as],e=>_t(rs(...e))],InvalidCell:[3,Ce],[c+v]:[0,ke,[],()=>[ps()]],[v]:[0,Se],[k]:[0,xe],[c+C]:[1,Te,[is],e=>[bs(...e)]],[C]:[1,Ve,[is],e=>_t(ds(e[0]))],InvalidValue:[1,ve]},(([e,t,s,l],n)=>{Ns["add"+n+"Listener"]=(...n)=>Me(n[e],t[n[e+1]?1:0],e>0?z(n,0,e):void 0,s,l)})),se(Ns)};e.Inspector=({position:e="right",open:t=!1})=>{const l=s.useCreateStore(ns),n=me.indexOf(e);return s.useCreatePersister(l,(e=>{return t=ce,s=sessionStorage,((e,t,s,l,n,a,r,o={},i=[])=>{let d,u,c,h=0;$t(Ht,i,(()=>0)),$t(Wt,i,(()=>[]));const[m,g,p,b,I]=((e=1,t)=>e>1&&t.isMergeable()?[1,t.getMergeableContent,t.getTransactionMergeableChanges,([[e],[t]])=>!oe(e)||!oe(t),t.setDefaultContent]:2!=e?[0,t.getContent,t.getTransactionChanges,([e,t])=>!oe(e)||!oe(t),t.setContent]:(e=>{throw Error("Store type not supported by this Persister")})())(r,e),f=t=>{(m&&E(t?.[0])?1===t?.[2]?e.applyMergeableChanges:e.setMergeableContent:1===t?.[2]?e.applyChanges:e.setContent)(t)},y=async e=>(2!=h&&(h=1,await k((async()=>{try{f(await t())}catch(t){e&&I(e)}h=0}))),S),w=()=>(u&&(n(u),u=void 0),S),C=async e=>(1!=h&&(h=2,await k((async()=>{try{await s(g,e)}catch(e){}h=0}))),S),v=()=>(M(c,e.delListener),c=void 0,S),k=async(...e)=>(G(Et(Wt,i),...e),await(async()=>{if(!Et(Ht,i)){for(Ot(Ht,i,1);!q(d=K(Et(Wt,i)));)try{await d()}catch(e){}Ot(Ht,i,0)}})(),S),S={load:y,startAutoLoad:async e=>(await w().load(e),u=l((async(e,t)=>{t||e?2!=h&&(h=1,f(t??e),h=0):await y()})),S),stopAutoLoad:w,isAutoLoading:()=>!q(u),save:C,startAutoSave:async()=>(await v().save(),c=e.addDidFinishTransactionListener((()=>{const e=p();b(e)&&C(e)})),S),stopAutoSave:v,isAutoSaving:()=>!q(c),schedule:k,getStore:()=>e,destroy:()=>w().stopAutoSave(),getStats:()=>({}),...o};return se(S)})(e,(async()=>{return e=s.getItem(t),JSON.parse(e,((e,t)=>"￼"===t?void 0:t));var e}),(async e=>{return s.setItem(t,(l=e(),JSON.stringify(l,((e,t)=>void 0===t?"￼":t))));var l}),(e=>{const l=l=>{if(l.storageArea===s&&l.key===t)try{e(ue(l.newValue))}catch{e()}};return Gt.addEventListener(Ut,l),l}),(e=>Gt.removeEventListener(Ut,e)),0,3,{getStorageName:()=>t});var t,s}),void 0,(async e=>{await e.load([{},{position:-1==n?1:n,open:!!t}]),await e.startAutoSave()})),A(J,null,A("aside",{id:ce},A(ze,{s:l}),A(St,{s:l})),A("style",null,Ee))}},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("../ui-react/index.js")):"function"==typeof define&&define.amd?define(["exports","react","../ui-react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseUiReactInspector={},e.React,e.TinyBaseUiReact);
