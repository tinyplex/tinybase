var e,t;e=this,t=function(e){"use strict";const t=e=>null==e,n=(e,n,r)=>t(e)?r?.():n(e),r=e=>e.length,s=(e,t)=>e.includes(t),o=(e,t)=>e.forEach(t),i=e=>0==r(e),l=(e,...t)=>e.push(...t),c=e=>e.pop(),d=e=>e.shift(),a=Object.freeze,u=(e,t)=>e?.has(t)??!1,h=e=>t(e)||0==(e=>e?.size??0)(e),p=(e,t)=>e?.forEach(t),f=(e,t)=>e?.delete(t),g=e=>new Map(e),C=(e,t)=>e?.get(t),k=(e,n,r)=>t(r)?(f(e,n),e):e?.set(n,r),L=(e,t,n)=>(u(e,t)||k(e,t,n()),C(e,t)),v=(e,t,s,o,i=0)=>n((s?L:C)(e,t[i],i>r(t)-2?s:g),(n=>{if(i>r(t)-2)return o?.(n)&&k(e,t[i]),n;const l=v(n,t,s,o,i+1);return h(n)&&k(e,t[i]),l})),y=e=>new Set(Array.isArray(e)||t(e)?e:[e]),w=/^\d+$/,b=((e,b)=>{const S=new WeakMap;return e=>{S.has(e)||S.set(e,(e=>{let b,S,T,x=100,z=g(),E=g(),V=1;const j=g(),m=g(),[A,B,F]=(e=>{let s;const[i,c]=(()=>{const e=[];let t=0;return[n=>(n?d(e):null)??""+t++,t=>{w.test(t)&&r(e)<1e3&&l(e,t)}]})(),a=g();return[(e,t,n,r=[],o=(()=>[]))=>{s??=Z;const l=i(1);var c,d;return k(a,l,[e,t,n,r,o]),c=v(t,n??[""],y),d=l,c?.add(d),l},(e,t,...n)=>o(((e,t=[""])=>{const n=[],s=(e,i)=>i==r(t)?l(n,e):null===t[i]?p(e,(e=>s(e,i+1))):o([t[i],null],(t=>s(C(e,t),i+1)));return s(e,0),n})(e,t),(e=>p(e,(e=>C(a,e)[0](s,...t??[],...n))))),e=>n(C(a,e),(([,t,n])=>(v(t,n??[""],void 0,(t=>(f(t,e),h(t)?1:0))),k(a,e),c(e),n))),e=>n(C(a,e),(([e,,n=[],i,l])=>{const c=(...d)=>{const a=r(d);a==r(n)?e(s,...d,...l(d)):t(n[a])?o(i[a]?.(...d)??[],(e=>c(...d,e))):c(...d,n[a])};c()}))]})(),I=g(),M=g(),_=[],O=[],W=(n,r)=>{V=0,e.transaction((()=>{const[s,o]=C(I,r);p(s,((r,s)=>p(r,((r,o)=>p(r,((r,i)=>((e,n,r,s,o)=>t(o)?e.delCell(n,r,s,!0):e.setCell(n,r,s,o))(e,s,o,i,r[n]))))))),p(o,((r,s)=>((e,n,r)=>t(r)?e.delValue(n):e.setValue(n,r))(e,s,r[n])))})),V=1},$=e=>{k(I,e),k(M,e),B(m,[e])},q=(e,t)=>o(((e,t)=>e.splice(0,t))(e,t??r(e)),$),D=()=>q(_,r(_)-x),G=()=>n(b,(()=>{l(_,b),D(),q(O),b=void 0,T=1})),H=()=>{b=c(_),T=1};let J,K;const N=(e="")=>(t(b)&&(b=""+S++,k(I,b,[z,E]),X(b,e),z=g(),E=g(),T=1),b),P=()=>{i(_)||(((e,...t)=>{e.unshift(...t)})(O,N()),W(0,b),b=c(_),T=1)},Q=()=>{i(O)||(l(_,b),b=d(O),W(1,b),T=1)},R=()=>{T&&(B(j),T=0)},U=e=>{const t=N(e);return R(),t},X=(e,t)=>(Y(e)&&C(M,e)!==t&&(k(M,e,t),B(m,[e])),Z),Y=e=>u(I,e),Z={setSize:e=>(x=e,D(),Z),addCheckpoint:U,setCheckpoint:X,getStore:()=>e,getCheckpointIds:()=>[[..._],b,[...O]],forEachCheckpoint:e=>{return t=e,p(M,((e,n)=>t(n,e)));var t},hasCheckpoint:Y,getCheckpoint:e=>C(M,e),goBackward:()=>(P(),R(),Z),goForward:()=>(Q(),R(),Z),goTo:e=>{const n=s(_,e)?P:s(O,e)?Q:null;for(;!t(n)&&e!=b;)n();return R(),Z},addCheckpointIdsListener:e=>A(e,j),addCheckpointListener:(e,t)=>A(t,m,[e]),delListener:e=>(F(e),Z),clear:()=>(q(_),q(O),t(b)||$(b),b=void 0,S=0,U(),Z),clearForward:()=>(i(O)||(q(O),B(j)),Z),destroy:()=>{e.delListener(J),e.delListener(K)},getListenerStats:()=>({}),_registerListeners:()=>{J=e.addCellListener(null,null,null,((e,t,n,r,s,o)=>{if(V){G();const e=L(z,t,g),i=L(e,n,g),l=L(i,r,(()=>[o,void 0]));l[1]=s,l[0]===s&&h(k(i,r))&&h(k(e,n))&&h(k(z,t))&&H(),R()}})),K=e.addValueListener(null,((e,t,n,r)=>{if(V){G();const e=L(E,t,(()=>[r,void 0]));e[1]=n,e[0]===n&&h(k(E,t))&&H(),R()}}))}};return a(Z.clear())})(e));const b=S.get(e);return b._registerListeners(),b}})();e.createCheckpoints=b},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
