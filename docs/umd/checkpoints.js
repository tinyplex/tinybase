var e,t;e=this,t=function(e){"use strict";const t="",n=(e,t)=>e.includes(t),o=(e,t)=>e.forEach(t),s=e=>e.length,r=e=>0==s(e),i=(e,...t)=>e.push(...t),l=e=>e.pop(),c=e=>e.shift(),d=e=>null==e,a=(e,t,n)=>d(e)?n?.():t(e),u=(e,t)=>e?.has(t)??!1,p=e=>d(e)||0==(e=>e.size)(e),h=(e,t)=>e?.forEach(t),f=(e,t)=>e?.delete(t),C=e=>new Map(e),g=(e,t)=>e?.get(t),k=(e,t,n)=>d(n)?(f(e,t),e):e?.set(t,n),v=(e,t,n)=>(u(e,t)||k(e,t,n()),g(e,t)),y=(e,t,n,o,r=0)=>a((n?v:g)(e,t[r],r>s(t)-2?n:C),(i=>{if(r>s(t)-2)return o?.(i)&&k(e,t[r]),i;const l=y(i,t,n,o,r+1);return p(i)&&k(e,t[r]),l})),L=e=>new Set(e),b=/^\d+$/,w=e=>{let n;const[r,l]=(()=>{const e=[];let n=0;return[()=>c(e)??t+n++,t=>{b.test(t)&&s(e)<1e3&&i(e,t)}]})(),u=C();return[(o,s,i)=>{n??=e();const l=r();var c,d;return k(u,l,[o,s,i]),c=y(s,i??[t],L),d=l,c?.add(d),l},(e,r,...l)=>o(((e,n=[t])=>{const r=[],l=(e,t)=>t==s(n)?i(r,e):null===n[t]?h(e,(e=>l(e,t+1))):o([n[t],null],(n=>l(g(e,n),t+1)));return l(e,0),r})(e,r),(e=>h(e,(e=>g(u,e)[0](n,...r??[],...l))))),e=>a(g(u,e),(([,n,o])=>(y(n,o??[t],void 0,(t=>(f(t,e),p(t)?1:0))),k(u,e),l(e),o))),(e,t,r)=>a(g(u,e),(([e,,i=[]])=>{const l=(...c)=>{const a=s(c);a==s(i)?e(n,...c,...r(c)):d(i[a])?o(t[a](...c),(e=>l(...c,e))):l(...c,i[a])};l()}))]},S=Object.freeze,T=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{let f,y,L,b=100,T=C(),j=1;const x=C(),z=C(),[E,M,m]=w((()=>Q)),B=C(),I=C(),O=[],_=[],F=(t,n)=>{j=0,e.transaction((()=>h(g(B,n),((n,o)=>h(n,((n,s)=>h(n,((n,r)=>((e,t,n,o,s)=>d(s)?e.delCell(t,n,o,!0):e.setCell(t,n,o,s))(e,o,s,r,n[t]))))))))),j=1},P=e=>{k(B,e),k(I,e),M(z,[e])},W=(e,t)=>o(((e,t)=>e.splice(0,t))(e,t??s(e)),P),$=()=>W(O,s(O)-b),q=e.addCellListener(null,null,null,((e,t,n,o,s,r)=>{if(j){a(f,(()=>{i(O,f),$(),W(_),f=void 0,L=1}));const e=v(T,t,C),c=v(e,n,C),d=v(c,o,(()=>[r,void 0]));d[1]=s,d[0]===s&&p(k(c,o))&&p(k(e,n))&&p(k(T,t))&&(f=l(O),L=1),H()}})),A=(e="")=>(d(f)&&(f=t+y++,k(B,f,T),K(f,e),T=C(),L=1),f),D=()=>{r(O)||(_.unshift(A()),F(0,f),f=l(O),L=1)},G=()=>{r(_)||(i(O,f),f=c(_),F(1,f),L=1)},H=()=>{L&&(M(x),L=0)},J=e=>{const t=A(e);return H(),t},K=(e,t)=>(N(e)&&g(I,e)!==t&&(k(I,e,t),M(z,[e])),Q),N=e=>u(B,e),Q={setSize:e=>(b=e,$(),Q),addCheckpoint:J,setCheckpoint:K,getStore:()=>e,getCheckpointIds:()=>[[...O],f,[..._]],forEachCheckpoint:e=>{return t=e,h(I,((e,n)=>t(n,e)));var t},hasCheckpoint:N,getCheckpoint:e=>g(I,e),goBackward:()=>(D(),H(),Q),goForward:()=>(G(),H(),Q),goTo:e=>{const t=n(O,e)?D:n(_,e)?G:null;for(;!d(t)&&e!=f;)t();return H(),Q},addCheckpointIdsListener:e=>E(e,x),addCheckpointListener:(e,t)=>E(t,z,[e]),delListener:e=>(m(e),Q),clear:()=>(W(O),W(_),d(f)||P(f),f=void 0,y=0,J(),Q),destroy:()=>{e.delListener(q)},getListenerStats:()=>({})};return S(Q.clear())}));e.createCheckpoints=T,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
