var e,t;e=this,t=function(e){"use strict";const t="",n=(e,t)=>e.includes(t),o=(e,t)=>e.forEach(t),r=e=>e.length,s=e=>0==r(e),i=(e,...t)=>e.push(...t),l=e=>e.pop(),c=e=>e.shift(),d=e=>null==e,a=(e,t,n)=>d(e)?n?.():t(e),u=(e,t)=>e?.has(t)??!1,p=e=>d(e)||0==(e=>e.size)(e),h=(e,t)=>e?.forEach(t),f=(e,t)=>e?.delete(t),C=e=>new Map(e),g=(e,t)=>e?.get(t),k=(e,t,n)=>d(n)?(f(e,t),e):e?.set(t,n),y=(e,t,n)=>(u(e,t)||k(e,t,n()),g(e,t)),v=(e,t,n,o,s=0)=>a((n?y:g)(e,t[s],s>r(t)-2?n:C),(i=>{if(s>r(t)-2)return o?.(i)&&k(e,t[s]),i;const l=v(i,t,n,o,s+1);return p(i)&&k(e,t[s]),l})),L=e=>new Set(Array.isArray(e)||d(e)?e:[e]),b=/^\d+$/,w=e=>{let n;const[s,l]=(()=>{const e=[];let n=0;return[()=>c(e)??t+n++,t=>{b.test(t)&&r(e)<1e3&&i(e,t)}]})(),u=C();return[(o,r,i)=>{n??=e();const l=s();var c,d;return k(u,l,[o,r,i]),c=v(r,i??[t],L),d=l,c?.add(d),l},(e,s,...l)=>o(((e,n=[t])=>{const s=[],l=(e,t)=>t==r(n)?i(s,e):null===n[t]?h(e,(e=>l(e,t+1))):o([n[t],null],(n=>l(g(e,n),t+1)));return l(e,0),s})(e,s),(e=>h(e,(e=>g(u,e)[0](n,...s??[],...l))))),e=>a(g(u,e),(([,n,o])=>(v(n,o??[t],void 0,(t=>(f(t,e),p(t)?1:0))),k(u,e),l(e),o))),(e,t,s)=>a(g(u,e),(([e,,i=[]])=>{const l=(...c)=>{const a=r(c);a==r(i)?e(n,...c,...s(c)):d(i[a])?o(t[a](...c),(e=>l(...c,e))):l(...c,i[a])};l()}))]},S=Object.freeze,T=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{let f,v,L,b=100,T=C(),j=1;const x=C(),z=C(),[E,M,m]=w((()=>Q)),A=C(),B=C(),I=[],O=[],_=(t,n)=>{j=0,e.transaction((()=>h(g(A,n),((n,o)=>h(n,((n,r)=>h(n,((n,s)=>((e,t,n,o,r)=>d(r)?e.delCell(t,n,o,!0):e.setCell(t,n,o,r))(e,o,r,s,n[t]))))))))),j=1},F=e=>{k(A,e),k(B,e),M(z,[e])},P=(e,t)=>o(((e,t)=>e.splice(0,t))(e,t??r(e)),F),W=()=>P(I,r(I)-b),$=e.addCellListener(null,null,null,((e,t,n,o,r,s)=>{if(j){a(f,(()=>{i(I,f),W(),P(O),f=void 0,L=1}));const e=y(T,t,C),c=y(e,n,C),d=y(c,o,(()=>[s,void 0]));d[1]=r,d[0]===r&&p(k(c,o))&&p(k(e,n))&&p(k(T,t))&&(f=l(I),L=1),H()}})),q=(e="")=>(d(f)&&(f=t+v++,k(A,f,T),K(f,e),T=C(),L=1),f),D=()=>{s(I)||(O.unshift(q()),_(0,f),f=l(I),L=1)},G=()=>{s(O)||(i(I,f),f=c(O),_(1,f),L=1)},H=()=>{L&&(M(x),L=0)},J=e=>{const t=q(e);return H(),t},K=(e,t)=>(N(e)&&g(B,e)!==t&&(k(B,e,t),M(z,[e])),Q),N=e=>u(A,e),Q={setSize:e=>(b=e,W(),Q),addCheckpoint:J,setCheckpoint:K,getStore:()=>e,getCheckpointIds:()=>[[...I],f,[...O]],forEachCheckpoint:e=>{return t=e,h(B,((e,n)=>t(n,e)));var t},hasCheckpoint:N,getCheckpoint:e=>g(B,e),goBackward:()=>(D(),H(),Q),goForward:()=>(G(),H(),Q),goTo:e=>{const t=n(I,e)?D:n(O,e)?G:null;for(;!d(t)&&e!=f;)t();return H(),Q},addCheckpointIdsListener:e=>E(e,x),addCheckpointListener:(e,t)=>E(t,z,[e]),delListener:e=>(m(e),Q),clear:()=>(P(I),P(O),d(f)||F(f),f=void 0,v=0,J(),Q),destroy:()=>{e.delListener($)},getListenerStats:()=>({})};return S(Q.clear())}));e.createCheckpoints=T,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
