var e,t;e=this,t=function(e){"use strict";const t="",n=(e,t)=>e.includes(t),o=(e,t)=>e.forEach(t),s=e=>e.length,r=e=>0==s(e),i=(e,...t)=>e.push(...t),l=e=>e.pop(),c=e=>null==e,d=(e,t,n)=>c(e)?n?.():t(e),a=(e,t)=>e?.has(t)??!1,u=e=>c(e)||0==(e=>e.size)(e),p=(e,t)=>e?.forEach(t),h=(e,t)=>e?.delete(t),f=e=>new Map(e),C=(e,t)=>e?.get(t),g=(e,t,n)=>c(n)?(h(e,t),e):e?.set(t,n),k=(e,t,n)=>(a(e,t)||g(e,t,n()),C(e,t)),v=(e,t,n,o,r=0)=>d((n?k:C)(e,t[r],r>s(t)-2?n:f),(i=>{if(r>s(t)-2)return o?.(i)&&g(e,t[r]),i;const l=v(i,t,n,o,r+1);return u(i)&&g(e,t[r]),l})),y=e=>new Set(e),L=e=>{let n,r=0;const a=[],k=f();return[(o,s,i)=>{n??=e();const c=l(a)??t+r++;var d,u;return g(k,c,[o,s,i]),d=v(s,i??[t],y),u=c,d?.add(u),c},(e,r,...l)=>o(((e,n=[t])=>{const r=[],l=(e,t)=>t==s(n)?i(r,e):null===n[t]?p(e,(e=>l(e,t+1))):o([n[t],null],(n=>l(C(e,n),t+1)));return l(e,0),r})(e,r),(e=>p(e,(e=>C(k,e)[0](n,...r??[],...l))))),e=>d(C(k,e),(([,n,o])=>(v(n,o??[t],void 0,(t=>(h(t,e),u(t)?1:0))),g(k,e),s(a)<1e3&&i(a,e),o))),(e,t,r)=>d(C(k,e),(([e,,i=[]])=>{const l=(...d)=>{const a=s(d);a==s(i)?e(n,...d,...r(d)):c(i[a])?o(t[a](...d),(e=>l(...d,e))):l(...d,i[a])};l()}))]},b=Object.freeze,w=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{let h,v,y,w=100,S=f(),T=1;const j=f(),x=f(),[z,E,M]=L((()=>Q)),m=f(),B=f(),I=[],O=[],_=(t,n)=>{T=0,e.transaction((()=>p(C(m,n),((n,o)=>p(n,((n,s)=>p(n,((n,r)=>((e,t,n,o,s)=>c(s)?e.delCell(t,n,o,!0):e.setCell(t,n,o,s))(e,o,s,r,n[t]))))))))),T=1},F=e=>{g(m,e),g(B,e),E(x,[e])},P=(e,t)=>o(((e,t)=>e.splice(0,t))(e,t??s(e)),F),W=()=>P(I,s(I)-w),q=e.addCellListener(null,null,null,((e,t,n,o,s,r)=>{if(T){d(h,(()=>{i(I,h),W(),P(O),h=void 0,y=1}));const e=k(S,t,f),c=k(e,n,f),a=k(c,o,(()=>[r,void 0]));a[1]=s,a[0]===s&&u(g(c,o))&&u(g(e,n))&&u(g(S,t))&&(h=l(I),y=1),H()}})),A=(e="")=>(c(h)&&(h=t+v++,g(m,h,S),K(h,e),S=f(),y=1),h),D=()=>{r(I)||(O.unshift(A()),_(0,h),h=l(I),y=1)},G=()=>{r(O)||(i(I,h),h=O.shift(),_(1,h),y=1)},H=()=>{y&&(E(j),y=0)},J=e=>{const t=A(e);return H(),t},K=(e,t)=>(N(e)&&C(B,e)!==t&&(g(B,e,t),E(x,[e])),Q),N=e=>a(m,e),Q={setSize:e=>(w=e,W(),Q),addCheckpoint:J,setCheckpoint:K,getStore:()=>e,getCheckpointIds:()=>[[...I],h,[...O]],forEachCheckpoint:e=>{return t=e,p(B,((e,n)=>t(n,e)));var t},hasCheckpoint:N,getCheckpoint:e=>C(B,e),goBackward:()=>(D(),H(),Q),goForward:()=>(G(),H(),Q),goTo:e=>{const t=n(I,e)?D:n(O,e)?G:null;for(;!c(t)&&e!=h;)t();return H(),Q},addCheckpointIdsListener:e=>z(e,j),addCheckpointListener:(e,t)=>z(t,x,[e]),delListener:e=>(M(e),Q),clear:()=>(P(I),P(O),c(h)||F(h),h=void 0,v=0,J(),Q),destroy:()=>{e.delListener(q)},getListenerStats:()=>({})};return b(Q.clear())}));e.createCheckpoints=w,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
